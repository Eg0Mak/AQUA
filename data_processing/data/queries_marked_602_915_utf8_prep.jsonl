{"instruction": "Optimize the SQL query", "input": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1;", "output": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE serial_number = 'ABC123' AND pharmacies_id = 456;", "output": "SELECT *\nFROM assets\nWHERE serial_number = 'ABC123' AND pharmacies_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE created_at >= NOW() - INTERVAL '1 week';", "output": "SELECT *\nFROM hazards\nWHERE created_at >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE facility_id = 789;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE facility_id = 789;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-07-01' AND '2023-07-31';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-07-01' AND '2023-07-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND is_open = 1;", "output": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND is_open = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND date_created > '2023-01-01';", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW();", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW();"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT id, full_name\nFROM staff_directory\nWHERE org_id = 123;", "output": "SELECT id, full_name\nFROM staff_directory\nWHERE org_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456;", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE name = 'Fire Hazard' AND description = 'High risk of fire outbreak.';", "output": "SELECT *\nFROM hazards\nWHERE name = 'Fire Hazard' AND description = 'High risk of fire outbreak.';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = 789 AND is_default = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = 789 AND is_default = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_at >= NOW() - INTERVAL '1 week';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_at >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 789 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 789 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND is_open = 1;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND is_open = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1;", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND city = 'New York';", "output": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND city = 'New York';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by >= NOW() - INTERVAL '1 month';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT user_id, full_name\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123;", "output": "SELECT user_id, full_name\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE created_at >= NOW() - INTERVAL '30 days' OR updated_at >= NOW() - INTERVAL '30 days';", "output": "SELECT *\nFROM assets\nWHERE created_at >= CURRENT_DATE - INTERVAL '30 days' OR updated_at >= CURRENT_DATE - INTERVAL '30 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= NOW() - INTERVAL '3 months';", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= CURRENT_DATE - INTERVAL '3 months';"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '7 days';", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01';", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London';", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND updated_at >= NOW() - INTERVAL '1 month';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND updated_at >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= NOW() - INTERVAL '3 months'\nORDER BY name ASC ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= CURRENT_DATE - INTERVAL '3 months'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC ;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC ;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '7 days'\nORDER BY events_type_id ASC ;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '7 days'\nORDER BY events_type_id ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London'\nORDER BY trial_ends_at DESC ;", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London'\nORDER BY trial_ends_at DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND reg_number IS NOT NULL;", "output": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND reg_number IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND updated_at >= NOW() - INTERVAL '1 month';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND updated_at >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= NOW() - INTERVAL '3 months'\nORDER BY name ASC\nLIMIT 10 ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= CURRENT_DATE - INTERVAL '3 months'\nORDER BY name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0\nORDER BY ORDER DESC ;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0\nORDER BY \"order\" DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 20 ;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '7 days'\nORDER BY events_type_id ASC\nLIMIT 50 ;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '7 days'\nORDER BY events_type_id ASC\nLIMIT 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND updated_at >= NOW() - INTERVAL '3 months';", "output": "SELECT full_name, id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND updated_at >= CURRENT_DATE - INTERVAL '3 months';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND serial_number LIKE 'ABC%';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND serial_number LIKE 'ABC%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%fire%' AND created_at >= NOW() - INTERVAL '6 months'\nORDER BY created_at DESC ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%fire%' AND created_at >= CURRENT_DATE - INTERVAL '6 months'\nORDER BY created_at DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND name NOT LIKE '%Admin%';", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND name NOT LIKE '%Admin%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 50 ;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC\nLIMIT 10 ;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '1 month'\nORDER BY events_type_id ASC\nLIMIT 20 ;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '1 month'\nORDER BY events_type_id ASC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT id, full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL AND org_id = 123 AND is_active = 1;", "output": "SELECT id, full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL AND org_id = 123 AND is_active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL;", "output": "SELECT full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE updated_at >= NOW() - INTERVAL 7 DAYS;", "output": "SELECT *\nFROM assets\nWHERE updated_at >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE LENGTH(description) > 100;", "output": "SELECT *\nFROM hazards\nWHERE LENGTH(description) > 100;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, `order`\nFROM event_staff_roles\nORDER BY name ASC ;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE updated_by = 123;", "output": "SELECT *\nFROM event_actions\nWHERE updated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE is_open = 1;", "output": "SELECT *\nFROM EVENTS\nWHERE is_open = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created > '2023-01-01';", "output": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE city = 'New York';", "output": "SELECT *\nFROM organizations\nWHERE city = 'New York';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE 'ABC%';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE 'ABC%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE created_at >= NOW() - INTERVAL 30 DAYS AND organizations_id = 789;", "output": "SELECT *\nFROM hazards\nWHERE created_at >= CURRENT_DATE - INTERVAL '30 days' AND organizations_id = 789;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, id\nFROM staff_directory\nORDER BY full_name ASC ;", "output": "SELECT full_name, id\nFROM staff_directory\nORDER BY full_name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456;", "output": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= NOW() - INTERVAL 6 MONTHS;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= CURRENT_DATE - INTERVAL '6 months';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE `order` = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE \"order\" = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456;", "output": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456;", "output": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1;", "output": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123;", "output": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01';", "output": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE updated_at >= NOW() - INTERVAL 7 DAYS AND organizations_id = 123;", "output": "SELECT *\nFROM assets\nWHERE updated_at >= CURRENT_DATE - INTERVAL '7 days' AND organizations_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456;", "output": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, `order`\nFROM event_staff_roles\nORDER BY `order` DESC ;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nORDER BY \"order\" DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE updated_by = 123 AND date_created > '2023-01-01';", "output": "SELECT *\nFROM event_actions\nWHERE updated_by = 123 AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 123 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 123 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE is_open = 1 AND users_id = 123;", "output": "SELECT *\nFROM EVENTS\nWHERE is_open = 1 AND users_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created BETWEEN '2023-01-01' AND '2023-01-31';", "output": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created BETWEEN '2023-01-01' AND '2023-01-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE city = 'London' AND date_created > '2023-01-01';", "output": "SELECT *\nFROM organizations\nWHERE city = 'London' AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123 AND date_created < '2023-01-01';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123 AND date_created < '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE '%XYZ';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE '%XYZ';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE created_at >= NOW() - INTERVAL 30 DAYS AND organizations_id = 123;", "output": "SELECT *\nFROM hazards\nWHERE created_at >= CURRENT_DATE - INTERVAL '30 days' AND organizations_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, id\nFROM staff_directory\nORDER BY id ASC ;", "output": "SELECT full_name, id\nFROM staff_directory\nORDER BY id ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456 AND serial_number = 'XYZ';", "output": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456 AND serial_number = 'XYZ';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= NOW() - INTERVAL 6 MONTHS\nORDER BY name ASC ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= CURRENT_DATE - INTERVAL '6 months'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE `order` = 1 AND forms_id = 123;", "output": "SELECT *\nFROM event_staff_roles\nWHERE \"order\" = 1 AND forms_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456 AND action_date BETWEEN '2023-01-01' AND '2023-12-31';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456 AND action_date BETWEEN '2023-01-01' AND '2023-12-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456 AND date_closed >= NOW() - INTERVAL 1 MONTH;", "output": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;", "output": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123 AND trial_ends_at > NOW();", "output": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123 AND trial_ends_at > NOW();"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01' AND activated_by = 456;", "output": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01' AND activated_by = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE updated_at >= NOW() - INTERVAL 7 DAYS AND organizations_id = 123 AND asset_type_id = 456;", "output": "SELECT *\nFROM assets\nWHERE updated_at >= CURRENT_DATE - INTERVAL '7 days' AND organizations_id = 123 AND asset_type_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456 AND organizations_id = 789;", "output": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456 AND organizations_id = 789;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1;", "output": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE serial_number = 'ABC123' AND pharmacies_id = 456;", "output": "SELECT *\nFROM assets\nWHERE serial_number = 'ABC123' AND pharmacies_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE created_at >= NOW() - INTERVAL '1 week';", "output": "SELECT *\nFROM hazards\nWHERE created_at >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE facility_id = 789;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE facility_id = 789;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-07-01' AND '2023-07-31';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-07-01' AND '2023-07-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND is_open = 1;", "output": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND is_open = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND date_created > '2023-01-01';", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW();", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW();"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT id, full_name\nFROM staff_directory\nWHERE org_id = 123;", "output": "SELECT id, full_name\nFROM staff_directory\nWHERE org_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456;", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE name = 'Fire Hazard' AND description = 'High risk of fire outbreak.';", "output": "SELECT *\nFROM hazards\nWHERE name = 'Fire Hazard' AND description = 'High risk of fire outbreak.';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = 789 AND is_default = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = 789 AND is_default = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_at >= NOW() - INTERVAL '1 week';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_at >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 789 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 789 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND is_open = 1;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND is_open = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1;", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND city = 'New York';", "output": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND city = 'New York';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by >= NOW() - INTERVAL '1 month';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT user_id, full_name\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123;", "output": "SELECT user_id, full_name\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE created_at >= NOW() - INTERVAL '30 days' OR updated_at >= NOW() - INTERVAL '30 days';", "output": "SELECT *\nFROM assets\nWHERE created_at >= CURRENT_DATE - INTERVAL '30 days' OR updated_at >= CURRENT_DATE - INTERVAL '30 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= NOW() - INTERVAL '3 months';", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= CURRENT_DATE - INTERVAL '3 months';"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '7 days';", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01';", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London';", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND updated_at >= NOW() - INTERVAL '1 month';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND updated_at >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= NOW() - INTERVAL '3 months'\nORDER BY name ASC ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= CURRENT_DATE - INTERVAL '3 months'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC ;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC ;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '7 days'\nORDER BY events_type_id ASC ;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '7 days'\nORDER BY events_type_id ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;", "output": "SELECT *\nFROM users\nWHERE roles_id = 789 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London'\nORDER BY trial_ends_at DESC ;", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at > NOW() AND city = 'London'\nORDER BY trial_ends_at DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND reg_number IS NOT NULL;", "output": "SELECT full_name, employee_id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND reg_number IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND updated_at >= NOW() - INTERVAL '1 month';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND updated_at >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= NOW() - INTERVAL '3 months'\nORDER BY name ASC\nLIMIT 10 ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%danger%' AND created_at >= CURRENT_DATE - INTERVAL '3 months'\nORDER BY name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0\nORDER BY ORDER DESC ;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND is_default = 0\nORDER BY \"order\" DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 20 ;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND updated_by = 456 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '7 days'\nORDER BY events_type_id ASC\nLIMIT 50 ;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '7 days'\nORDER BY events_type_id ASC\nLIMIT 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND updated_at >= NOW() - INTERVAL '3 months';", "output": "SELECT full_name, id\nFROM staff_directory\nWHERE is_active = 1 AND org_id = 123 AND updated_at >= CURRENT_DATE - INTERVAL '3 months';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND serial_number LIKE 'ABC%';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND organizations_id = 456 AND asset_type_id = 789 AND serial_number LIKE 'ABC%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%fire%' AND created_at >= NOW() - INTERVAL '6 months'\nORDER BY created_at DESC ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%fire%' AND created_at >= CURRENT_DATE - INTERVAL '6 months'\nORDER BY created_at DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, ORDER\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND name NOT LIKE '%Admin%';", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nWHERE forms_id = 789 AND facility_id = 456 AND name NOT LIKE '%Admin%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 50 ;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = 123 AND action_date BETWEEN '2023-06-01' AND '2023-06-30'\nORDER BY action_date DESC\nLIMIT 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC\nLIMIT 10 ;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND facility_id = 456 AND organization_id = 123\nORDER BY tools_id ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= NOW() - INTERVAL '1 month'\nORDER BY events_type_id ASC\nLIMIT 20 ;", "output": "SELECT *\nFROM EVENTS\nWHERE users_id = 123 AND organization_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '1 month'\nORDER BY events_type_id ASC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;", "output": "SELECT *\nFROM pharmacies\nWHERE name = 'Pharmacy ABC' AND activated_by = 123 AND date_disabled > '2023-01-01'\nORDER BY name ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT id, full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL AND org_id = 123 AND is_active = 1;", "output": "SELECT id, full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL AND org_id = 123 AND is_active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL;", "output": "SELECT full_name\nFROM staff_directory\nWHERE official_user_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE updated_at >= NOW() - INTERVAL 7 DAYS;", "output": "SELECT *\nFROM assets\nWHERE updated_at >= CURRENT_DATE - INTERVAL '7 days';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE LENGTH(description) > 100;", "output": "SELECT *\nFROM hazards\nWHERE LENGTH(description) > 100;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, `order`\nFROM event_staff_roles\nORDER BY name ASC ;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE updated_by = 123;", "output": "SELECT *\nFROM event_actions\nWHERE updated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE is_open = 1;", "output": "SELECT *\nFROM EVENTS\nWHERE is_open = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created > '2023-01-01';", "output": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE city = 'New York';", "output": "SELECT *\nFROM organizations\nWHERE city = 'New York';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE 'ABC%';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE 'ABC%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE created_at >= NOW() - INTERVAL 30 DAYS AND organizations_id = 789;", "output": "SELECT *\nFROM hazards\nWHERE created_at >= CURRENT_DATE - INTERVAL '30 days' AND organizations_id = 789;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, id\nFROM staff_directory\nORDER BY full_name ASC ;", "output": "SELECT full_name, id\nFROM staff_directory\nORDER BY full_name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456;", "output": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= NOW() - INTERVAL 6 MONTHS;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= CURRENT_DATE - INTERVAL '6 months';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE `order` = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE \"order\" = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456;", "output": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456;", "output": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1;", "output": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123;", "output": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01';", "output": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE updated_at >= NOW() - INTERVAL 7 DAYS AND organizations_id = 123;", "output": "SELECT *\nFROM assets\nWHERE updated_at >= CURRENT_DATE - INTERVAL '7 days' AND organizations_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456;", "output": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, `order`\nFROM event_staff_roles\nORDER BY `order` DESC ;", "output": "SELECT name, \"order\"\nFROM event_staff_roles\nORDER BY \"order\" DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE updated_by = 123 AND date_created > '2023-01-01';", "output": "SELECT *\nFROM event_actions\nWHERE updated_by = 123 AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 123 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = 123 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE is_open = 1 AND users_id = 123;", "output": "SELECT *\nFROM EVENTS\nWHERE is_open = 1 AND users_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created BETWEEN '2023-01-01' AND '2023-01-31';", "output": "SELECT *\nFROM users\nWHERE TYPE = 'admin' AND date_created BETWEEN '2023-01-01' AND '2023-01-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE city = 'London' AND date_created > '2023-01-01';", "output": "SELECT *\nFROM organizations\nWHERE city = 'London' AND date_created > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123 AND date_created < '2023-01-01';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 123 AND date_created < '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE '%XYZ';", "output": "SELECT *\nFROM assets\nWHERE active = 1 AND serial_number LIKE '%XYZ';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE created_at >= NOW() - INTERVAL 30 DAYS AND organizations_id = 123;", "output": "SELECT *\nFROM hazards\nWHERE created_at >= CURRENT_DATE - INTERVAL '30 days' AND organizations_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT full_name, id\nFROM staff_directory\nORDER BY id ASC ;", "output": "SELECT full_name, id\nFROM staff_directory\nORDER BY id ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456 AND serial_number = 'XYZ';", "output": "SELECT *\nFROM assets\nWHERE asset_items_id = 123 AND organizations_id = 456 AND serial_number = 'XYZ';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= NOW() - INTERVAL 6 MONTHS\nORDER BY name ASC ;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%safety%' AND created_at >= CURRENT_DATE - INTERVAL '6 months'\nORDER BY name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE `order` = 1 AND forms_id = 123;", "output": "SELECT *\nFROM event_staff_roles\nWHERE \"order\" = 1 AND forms_id = 123;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456 AND action_date BETWEEN '2023-01-01' AND '2023-12-31';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = 123 AND user_id = 456 AND action_date BETWEEN '2023-01-01' AND '2023-12-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123 AND organization_id = 456;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE forms_id = 789 AND updated_by = 123 AND organization_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456 AND date_closed >= NOW() - INTERVAL 1 MONTH;", "output": "SELECT *\nFROM EVENTS\nWHERE events_type_id = 123 AND users_id = 456 AND date_closed >= CURRENT_DATE - INTERVAL '1 month';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;", "output": "SELECT *\nFROM users\nWHERE profiles_id = 123 AND active = 1 AND date_created > '2023-01-01'\nORDER BY full_name ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123 AND trial_ends_at > NOW();", "output": "SELECT *\nFROM organizations\nWHERE date_created > '2023-01-01' AND countries_id = 123 AND trial_ends_at > NOW();"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01' AND activated_by = 456;", "output": "SELECT *\nFROM pharmacies\nWHERE organizations_id = 123 AND date_created < '2023-01-01' AND activated_by = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE updated_at >= NOW() - INTERVAL 7 DAYS AND organizations_id = 123 AND asset_type_id = 456;", "output": "SELECT *\nFROM assets\nWHERE updated_at >= CURRENT_DATE - INTERVAL '7 days' AND organizations_id = 123 AND asset_type_id = 456;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456 AND organizations_id = 789;", "output": "SELECT *\nFROM hazards\nWHERE LENGTH(description) < 50 AND pharmacies_id = 456 AND organizations_id = 789;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND date_updated IS NOT NULL AND date_updated <> NULL AND LENGTH(TYPE) > 0 AND CHAR_LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND date_updated IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > CAST('2023-02-01' AS TEXT) AND countries_id IS NOT NULL AND countries_id <> NULL AND EXTRACT(YEAR FROM created_at) = 2023 AND EXTRACT(MONTH FROM created_at) >= 2;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-02-01' AND countries_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND LOWER(city) = 'chicago' AND city LIKE '%Chicago%';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '13579' AND official_user_id IS NOT NULL AND official_user_id <> NULL AND LENGTH(user_id) = 5 AND user_id LIKE '13579%';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '13579' AND official_user_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND updated_at IS NOT NULL AND updated_at <> NULL AND active IS NOT NULL AND active = 1;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '43210' AND created_at IS NOT NULL AND created_at <> NULL AND pharmacies_id::text = '43210';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '43210' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE is_default = CAST(TRUE AS BOOLEAN) AND forms_id IS NOT NULL AND forms_id <> NULL AND is_default = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE is_default = TRUE AND forms_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(user_id AS TEXT) = '65432' AND updated_at IS NOT NULL AND updated_at <> NULL AND user_id::text LIKE '65432%';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = '65432' AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(facility_id AS TEXT) = '54321' AND CAST(organization_id AS TEXT) = '87654' AND tools_id IS NOT NULL AND tools_id <> NULL AND facility_id::text = '54321' AND organization_id::text = '87654';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = '54321' AND organization_id = '87654' AND tools_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE ((harmt IS NOT NULL AND harmt <> NULL) OR (prescribers_id IS NOT NULL AND prescribers_id <> NULL)) AND is_open = CAST(TRUE AS BOOLEAN) AND date_created IS NOT NULL AND date_created <> NULL AND date_closed IS NOT NULL AND date_closed <> NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE (harmt IS NOT NULL OR prescribers_id IS NOT NULL) AND is_open = TRUE AND date_created IS NOT NULL AND date_closed IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE is_active = CAST(TRUE AS BOOLEAN) AND CAST(updated_at AS TEXT) > '2023-04-01' AND updated_at IS NOT NULL AND updated_at <> NULL AND is_active = 1;", "output": "SELECT *\nFROM users\nWHERE is_active = TRUE AND updated_at > '2023-04-01' AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE UPPER(city) = UPPER('Denver') AND trial_ends_at IS NOT NULL AND trial_ends_at <> NULL AND LOWER(city) = 'denver';", "output": "SELECT *\nFROM organizations\nWHERE city = 'Denver' AND trial_ends_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(activated_by) = UPPER('Pharmacist D') AND activate_at IS NOT NULL AND activate_at <> NULL AND activated_by ILIKE 'Pharmacist D';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 'Pharmacist D' AND activate_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '97531' AND employee_id IS NOT NULL AND employee_id <> NULL AND user_id::text = '97531';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '97531' AND employee_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND serial_number <> '' AND LENGTH(serial_number) > 0 AND active IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND serial_number <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE UPPER(name) = UPPER('Chemical Spill') AND description <> '' AND LENGTH(description) > 0 AND name ILIKE 'Chemical Spill';", "output": "SELECT *\nFROM hazards\nWHERE name = 'Chemical Spill' AND description <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '654' AND \"order\" IS NOT NULL AND \"order\" <> NULL AND forms_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '654' AND \"order\" IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '321' AND action_date IS NOT NULL AND action_date <> NULL AND date_done IS NOT NULL AND date_done <> NULL AND events_id::text = '321';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '321' AND action_date IS NOT NULL AND date_done IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '876' AND CAST(facility_id AS TEXT) = '543' AND updated_by IS NOT NULL AND updated_by <> NULL AND updated_at IS NOT NULL AND updated_at <> NULL;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '876' AND facility_id = '543' AND updated_by IS NOT NULL AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '987' AND date_created IS NOT NULL AND date_created <> NULL AND updated_by IS NOT NULL AND updated_by <> NULL AND harmt IS NOT NULL AND harmt <> NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '987' AND date_created IS NOT NULL AND updated_by IS NOT NULL AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND is_active = CAST(TRUE AS BOOLEAN) AND date_created IS NOT NULL AND date_created <> NULL AND sf_id IS NOT NULL AND sf_id <> NULL AND LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND is_active = TRUE AND date_created IS NOT NULL AND sf_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-02-01' AND countries_id IS NOT NULL AND countries_id <> NULL AND trial_ends_at IS NOT NULL AND trial_ends_at <> NULL AND name <> '' AND LENGTH(name) > 0;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-02-01' AND countries_id IS NOT NULL AND trial_ends_at IS NOT NULL AND name <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND activated_by IS NOT NULL AND activated_by <> NULL AND city ILIKE 'chicago';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL AND activated_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '13579' AND official_user_id IS NOT NULL AND official_user_id <> NULL AND fixed = CAST(TRUE AS BOOLEAN) AND user_id::text = '13579';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '13579' AND official_user_id IS NOT NULL AND fixed = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND updated_at IS NOT NULL AND updated_at <> NULL AND asset_type_id IS NOT NULL AND asset_type_id <> NULL AND active = 1;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at IS NOT NULL AND asset_type_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '43210' AND created_at IS NOT NULL AND created_at <> NULL AND pharmacies_id IS NOT NULL AND pharmacies_id <> NULL AND pharmacies_id::text = '43210';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '43210' AND created_at IS NOT NULL AND pharmacies_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE is_default = CAST(TRUE AS BOOLEAN) AND forms_id IS NOT NULL AND forms_id <> NULL AND facility_id IS NOT NULL AND facility_id <> NULL AND is_default = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE is_default = TRUE AND forms_id IS NOT NULL AND facility_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(user_id AS TEXT) = '65432' AND updated_at IS NOT NULL AND updated_at <> NULL AND user_pharmacy_id IS NOT NULL AND user_pharmacy_id <> NULL AND user_id::text = '65432';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = '65432' AND updated_at IS NOT NULL AND user_pharmacy_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(facility_id AS TEXT) = '54321' AND CAST(organization_id AS TEXT) = '87654' AND tools_id IS NOT NULL AND tools_id <> NULL AND updated_by IS NOT NULL AND updated_by <> NULL AND facility_id::text = '54321';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = '54321' AND organization_id = '87654' AND tools_id IS NOT NULL AND updated_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE ((harmt IS NOT NULL AND harmt <> NULL) OR (prescribers_id IS NOT NULL AND prescribers_id <> NULL)) AND is_open = CAST(TRUE AS BOOLEAN) AND date_created IS NOT NULL AND date_created <> NULL AND date_closed IS NOT NULL AND date_closed <> NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE (harmt IS NOT NULL OR prescribers_id IS NOT NULL) AND is_open = TRUE AND date_created IS NOT NULL AND date_closed IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE is_active = CAST(TRUE AS BOOLEAN) AND CAST(updated_at AS TEXT) > '2023-03-01' AND TYPE IS NOT NULL AND TYPE <> NULL AND date_updated IS NOT NULL AND date_updated <> NULL AND is_active = 1;", "output": "SELECT *\nFROM users\nWHERE is_active = TRUE AND updated_at > '2023-03-01' AND TYPE IS NOT NULL AND date_updated IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE UPPER(city) = UPPER('Seattle') AND trial_ends_at IS NOT NULL AND trial_ends_at <> NULL AND countries_id IS NOT NULL AND countries_id <> NULL AND city ILIKE 'seattle';", "output": "SELECT *\nFROM organizations\nWHERE city = 'Seattle' AND trial_ends_at IS NOT NULL AND countries_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(activated_by) = UPPER('Pharmacist B') AND activate_at IS NOT NULL AND activate_at <> NULL AND activated_by ILIKE 'Pharmacist B';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 'Pharmacist B' AND activate_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '98765' AND created_at IS NOT NULL AND created_at <> NULL AND user_id::text = '98765';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '98765' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE CAST(asset_type_id AS TEXT) = '789' AND serial_number IS NOT NULL AND serial_number <> NULL AND asset_type_id::text = '789';", "output": "SELECT *\nFROM assets\nWHERE asset_type_id = '789' AND serial_number IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '65432' AND description <> '' AND LENGTH(description) > 0 AND pharmacies_id::text = '65432';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '65432' AND description <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '654' AND \"order\" IS NOT NULL AND \"order\" <> NULL AND forms_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '654' AND \"order\" IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '987' AND UPPER(updated_by) = UPPER('John Smith') AND events_id::text = '987' AND updated_by ILIKE 'John Smith';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '987' AND updated_by = 'John Smith';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '543' AND UPPER(updated_by) = UPPER('Jane Doe') AND organization_id::text = '543' AND updated_by ILIKE 'Jane Doe';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '543' AND updated_by = 'Jane Doe';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '321' AND harmt IS NOT NULL AND harmt <> NULL AND reporters_id::text = '321';", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '321' AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('Admin' AS VARCHAR(255)) AND is_active = CAST(TRUE AS BOOLEAN) AND LENGTH(TYPE) = 5;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'Admin' AND is_active = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-01-01' AND CAST(updated_at AS TEXT) < '2023-06-30' AND created_at IS NOT NULL AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-01-01' AND updated_at < '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Los Angeles') AND daye_enabled IS NOT NULL AND daye_enabled <> NULL AND city ILIKE 'los angeles';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Los Angeles' AND daye_enabled IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE UPPER(full_name) = UPPER('Jane Doe') AND fixed = CAST(TRUE AS BOOLEAN) AND full_name ILIKE 'Jane Doe';", "output": "SELECT *\nFROM staff_directory\nWHERE full_name = 'Jane Doe' AND fixed = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND CAST(updated_at AS TEXT) >= '2023-01-01' AND CAST(updated_at AS TEXT) <= '2023-06-30' AND active IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at BETWEEN '2023-01-01' AND '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE UPPER(name) LIKE UPPER('Chemical%') AND name IS NOT NULL;", "output": "SELECT *\nFROM hazards\nWHERE name LIKE 'Chemical%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '789' AND CAST(facility_id AS TEXT) = '654' AND forms_id::text = '789' AND facility_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '789' AND facility_id = '654';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '987' AND UPPER(updated_by) = UPPER('John Smith') AND events_id::text = '987';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '987' AND updated_by = 'John Smith';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '543' AND UPPER(updated_by) = UPPER('Jane Doe') AND organization_id::text = '543';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '543' AND updated_by = 'Jane Doe';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '321' AND harmt IS NOT NULL AND harmt <> NULL AND reporters_id::text = '321';", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '321' AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND is_active = CAST(TRUE AS BOOLEAN) AND LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND is_active = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-01-01' AND CAST(updated_at AS TEXT) < '2023-06-30' AND created_at IS NOT NULL AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-01-01' AND updated_at < '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND city ILIKE 'chicago';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '13579' AND official_user_id IS NOT NULL AND official_user_id <> NULL AND user_id::text = '13579';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '13579' AND official_user_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND updated_at IS NOT NULL AND updated_at <> NULL AND active IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '43210' AND created_at IS NOT NULL AND created_at <> NULL AND pharmacies_id::text = '43210';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '43210' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '654' AND updates_by IS NOT NULL AND updates_by <> NULL AND forms_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '654' AND updates_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '321' AND action_date IS NOT NULL AND action_date <> NULL AND events_id::text = '321';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '321' AND action_date IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '876' AND CAST(facility_id AS TEXT) = '543' AND updated_by IS NOT NULL AND updated_by <> NULL AND organization_id::text = '876';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '876' AND facility_id = '543' AND updated_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '987' AND date_created IS NOT NULL AND date_created <> NULL AND reporters_id::text = '987';", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '987' AND date_created IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND date_updated IS NOT NULL AND date_updated <> NULL AND LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND date_updated IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-02-01' AND countries_id IS NOT NULL AND countries_id <> NULL AND created_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-02-01' AND countries_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND city ILIKE 'chicago';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE UPPER(employee_id) LIKE UPPER('EMP-%') AND employee_id IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE employee_id LIKE 'EMP-%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE CAST(updated_at AS TEXT) > CAST((CURRENT_TIMESTAMP - INTERVAL '1 day') AS TEXT) AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE updated_at > (CURRENT_TIMESTAMP - INTERVAL '1 day');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies WHERE UPPER(name) LIKE UPPER('%Healthcare%') AND name IS NOT NULL);", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies WHERE name LIKE '%Healthcare%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE UPPER(name) LIKE UPPER('%Coordinator%') AND name IS NOT NULL;", "output": "SELECT *\nFROM event_staff_roles\nWHERE name LIKE '%Coordinator%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id IN (SELECT user_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE UPPER(ROLE) = UPPER('Supervisor') AND ROLE IS NOT NULL) AND user_id IS NOT NULL);", "output": "SELECT *\nFROM event_actions\nWHERE user_id IN (SELECT user_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE ROLE = 'Supervisor'));"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE UPPER(city) LIKE UPPER('S%') AND city IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE city LIKE 'S%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE harmt IS NOT NULL AND harmt <> NULL AND reporters_id IN (SELECT users_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE UPPER(ROLE) = UPPER('Admin') AND ROLE IS NOT NULL) AND users_id IS NOT NULL);", "output": "SELECT *\nFROM EVENTS\nWHERE harmt IS NOT NULL AND reporters_id IN (SELECT users_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE ROLE = 'Admin'));"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE is_active = CAST(1 AS BOOLEAN) AND EXTRACT(DOW FROM updated_at) IN (1, 7) AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM users\nWHERE is_active = 1 AND DAYOFWEEK(updated_at) IN (1, 7);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE sf_id IN (SELECT sf_id FROM organizations GROUP BY sf_id HAVING COUNT(DISTINCT countries_id) > 1 AND COUNT(DISTINCT countries_id) <> 0);", "output": "SELECT *\nFROM organizations\nWHERE sf_id IN (SELECT sf_id FROM organizations GROUP BY sf_id HAVING COUNT(DISTINCT countries_id) > 1);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(activated_by) LIKE UPPER('%Pharma%') AND organizations_id IN (SELECT organizations_id FROM organizations WHERE UPPER(address) LIKE UPPER('P%') AND address IS NOT NULL);", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by LIKE '%Pharma%' AND organizations_id IN (SELECT organizations_id FROM organizations WHERE address LIKE 'P%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE UPPER(full_name) LIKE UPPER('%John%') AND UPPER(full_name) LIKE UPPER('%Doe%') AND full_name IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE full_name LIKE '%John%' AND full_name LIKE '%Doe%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE asset_items_id IN (SELECT MAX(CAST(asset_items_id AS BIGINT)) FROM assets WHERE asset_items_id IS NOT NULL);", "output": "SELECT *\nFROM assets\nWHERE asset_items_id IN (SELECT MAX(asset_items_id) FROM assets);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies GROUP BY pharmacies_id ORDER BY COUNT(*) DESC, pharmacies_id ASC LIMIT 1);", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies GROUP BY pharmacies_id ORDER BY COUNT(*) DESC LIMIT 1);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE forms_id IN (SELECT forms_id FROM event_staff_roles GROUP BY forms_id ORDER BY COUNT(*) DESC, forms_id ASC);", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id IN (SELECT forms_id FROM event_staff_roles GROUP BY forms_id ORDER BY COUNT(*) DESC);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE EXTRACT(DOW FROM action_date) IN (5, 6) AND action_date IS NOT NULL;", "output": "SELECT *\nFROM event_actions\nWHERE WEEKDAY(action_date) IN (5, 6);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id IN (SELECT organization_id FROM organizations WHERE UPPER(name) LIKE UPPER('%Institute%') AND name IS NOT NULL) AND facility_id IN (SELECT facility_id FROM facilities WHERE UPPER(city) LIKE UPPER('M%') AND city IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id IN (SELECT organization_id FROM organizations WHERE name LIKE '%Institute%') AND facility_id IN (SELECT facility_id FROM facilities WHERE city LIKE 'M%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(harmt AS TEXT) = CAST(prescribers_id AS TEXT) AND harmt IS NOT NULL AND prescribers_id IS NOT NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE harmt = prescribers_id;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(date_created AS DATE) = CAST(updated_at AS DATE) AND date_created IS NOT NULL AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM users\nWHERE DATE(date_created) = DATE(updated_at);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at IN (SELECT trial_ends_at FROM organizations GROUP BY trial_ends_at HAVING COUNT(*) > 1 AND COUNT(*) <> 0);", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at IN (SELECT trial_ends_at FROM organizations GROUP BY trial_ends_at HAVING COUNT(*) > 1);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activate_at = CAST('specific_date' AS TIMESTAMP) AND activated_by = SUBSTRING(name, 1, 2) AND name IS NOT NULL;", "output": "SELECT *\nFROM pharmacies\nWHERE activate_at = 'specific_date' AND activated_by = SUBSTRING(name, 1, 2);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE employee_id = REVERSE(employee_id) AND employee_id IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE employee_id = REVERSE(employee_id);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE serial_number ~ '[0-9]{3}' AND serial_number IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE serial_number REGEXP '[0-9]{3}';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE (UPPER(description) LIKE UPPER('%color1%') OR UPPER(description) LIKE UPPER('%color2%') OR UPPER(description) LIKE UPPER('%color3%')) AND description IS NOT NULL;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%color1%' OR description LIKE '%color2%' OR description LIKE '%color3%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE \"order\" = forms_id AND \"order\" IS NOT NULL AND forms_id IS NOT NULL;", "output": "SELECT *\nFROM event_staff_roles\nWHERE ORDER = forms_id;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = user_pharmacy_id AND user_id IS NOT NULL AND user_pharmacy_id IS NOT NULL;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = user_pharmacy_id;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MAX(updated_at) FROM formsettings_summarytools WHERE updated_at IS NOT NULL)\nUNION\nSELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MIN(updated_at) FROM formsettings_summarytools WHERE updated_at IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MAX(updated_at) FROM formsettings_summarytools)\nUNION\nSELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MIN(updated_at) FROM formsettings_summarytools);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE LENGTH(harmt) = LENGTH(prescribers_id) AND harmt IS NOT NULL AND prescribers_id IS NOT NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE LENGTH(harmt) = LENGTH(prescribers_id);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE updated_at >= (SELECT DATE_SUB(NOW(), INTERVAL '1 week'))\nGROUP BY user_id\nHAVING COUNT(DISTINCT DATE(updated_at)) >= 2 AND updated_at IS NOT NULL ;", "output": "SELECT *\nFROM users\nWHERE updated_at >= (SELECT DATE_SUB(NOW(), INTERVAL 1 WEEK))\nGROUP BY user_id\nHAVING COUNT(DISTINCT DATE(updated_at)) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at = DATE(created_at) AND trial_ends_at IS NOT NULL AND created_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at = DATE(created_at);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE (SELECT COUNT(*) FROM pharmacies WHERE daye_enabled IS NOT NULL) > (SELECT COUNT(*) FROM pharmacies WHERE date_disabled IS NOT NULL);", "output": "SELECT *\nFROM pharmacies\nWHERE (SELECT COUNT() FROM pharmacies WHERE daye_enabled IS NOT NULL) > (SELECT COUNT() FROM pharmacies WHERE date_disabled IS NOT NULL);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE LENGTH(full_name) = (SELECT MAX(LENGTH(full_name)) FROM staff_directory WHERE full_name IS NOT NULL) AND full_name IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE LENGTH(full_name) = (SELECT MAX(LENGTH(full_name)) FROM staff_directory);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE CAST(updated_at AS TEXT) > CAST((CURRENT_TIMESTAMP - INTERVAL '1 day') AS TEXT) AND serial_number ~ '([A-Za-z0-9]{2})+' AND serial_number IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE updated_at > (CURRENT_TIMESTAMP - INTERVAL 1 DAY) AND serial_number REGEXP '([A-Za-z0-9]{2})+';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE UPPER(description) LIKE UPPER('%industry_keyword%') AND description IS NOT NULL;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%industry_keyword%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE UPPER(name) LIKE UPPER('%Lead%')\nORDER BY \"order\" DESC AND name IS NOT NULL ;", "output": "SELECT *\nFROM event_staff_roles\nWHERE name LIKE '%Lead%'\nORDER BY ORDER DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE EXTRACT(DOW FROM action_date) IN (5, 6) AND date_done IS NOT NULL AND date_done <> NULL AND action_date IS NOT NULL;", "output": "SELECT *\nFROM event_actions\nWHERE WEEKDAY(action_date) IN (5, 6) AND date_done IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE UPPER(city) LIKE UPPER('M%') AND city IS NOT NULL) AND updated_by IN (SELECT name FROM organizations WHERE UPPER(name) LIKE UPPER('%Institute%') AND name IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE city LIKE 'M%') AND updated_by IN (SELECT name FROM organizations WHERE name LIKE '%Institute%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(harmt AS TEXT) = CAST(prescribers_id AS TEXT) AND harmt IS NOT NULL AND harmt <> NULL AND prescribers_id IS NOT NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE harmt = prescribers_id AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE UPPER(first_name) = UPPER('john') AND LOWER(last_name) = LOWER('doe') AND LENGTH(email) > 10 AND CHAR_LENGTH(phone) = 12 AND created_at::text LIKE '2023-%' AND updated_at IS NOT NULL AND updated_at <> NULL", "output": "SELECT *\nFROM users\nWHERE first_name = 'john' AND last_name = 'doe' AND LENGTH(email) > 10 AND LENGTH(phone) = 12 AND created_at >= '2023-01-01' AND created_at < '2024-01-01' AND updated_at IS NOT NULL"}
{"instruction": "Optimize the SQL query", "input": "SELECT product_id, product_name, price\nFROM products\nWHERE price BETWEEN 100.00 AND 500.00 AND category_id IN (SELECT category_id FROM categories WHERE category_name ILIKE '%electronics%')\nORDER BY price DESC, product_name ASC\nLIMIT 50\nOFFSET 0", "output": "SELECT product_id, product_name, price\nFROM products\nWHERE price BETWEEN 100.00 AND 500.00 AND category_id IN (SELECT category_id FROM categories WHERE category_name ILIKE '%electronics%')\nORDER BY price DESC, product_name ASC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent\nFROM orders\nWHERE EXTRACT(YEAR FROM order_date) = 2023 AND EXTRACT(MONTH FROM order_date) BETWEEN 1 AND 6\nGROUP BY customer_id\nHAVING COUNT(*) > 5 AND SUM(total_amount) > 1000.00\nORDER BY total_spent DESC", "output": "SELECT customer_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent\nFROM orders\nWHERE order_date >= '2023-01-01' AND order_date < '2023-07-01'\nGROUP BY customer_id\nHAVING COUNT(*) > 5 AND SUM(total_amount) > 1000.00\nORDER BY total_spent DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM employees\nWHERE (department = 'IT' OR department = 'Engineering') AND salary > 75000 AND EXTRACT(YEAR FROM hire_date) > 2018 AND active = TRUE AND manager_id IS NOT NULL\nORDER BY last_name, first_name", "output": "SELECT *\nFROM employees\nWHERE department IN ('IT', 'Engineering') AND salary > 75000 AND hire_date > '2018-12-31' AND active = TRUE AND manager_id IS NOT NULL\nORDER BY last_name, first_name"}
{"instruction": "Optimize the SQL query", "input": "SELECT product_id, product_name, description\nFROM products\nWHERE description LIKE '%wireless%' AND description LIKE '%bluetooth%' AND description NOT LIKE '%cord%' AND price < 200.00 AND stock_quantity > 0 AND category_id IN (1,2,3,4,5)", "output": "SELECT product_id, product_name, description\nFROM products\nWHERE description LIKE '%wireless%' AND description LIKE '%bluetooth%' AND description NOT LIKE '%cord%' AND price < 200.00 AND stock_quantity > 0 AND category_id IN (1,2,3,4,5)"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, c.customer_name, SUM(od.quantity * od.unit_price) AS order_total\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN order_details od ON o.order_id = od.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31'\nGROUP BY o.order_id, o.order_date, c.customer_name\nHAVING SUM(od.quantity * od.unit_price) > 500.00\nORDER BY order_total DESC", "output": "SELECT o.order_id, o.order_date, c.customer_name, SUM(od.quantity * od.unit_price) AS order_total\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN order_details od ON o.order_id = od.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31'\nGROUP BY o.order_id, o.order_date, c.customer_name\nHAVING SUM(od.quantity * od.unit_price) > 500.00\nORDER BY order_total DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT employee_id, first_name, last_name, email, phone, department, salary\nFROM employees\nWHERE salary BETWEEN 50000 AND 100000 AND department IN ('Sales', 'Marketing', 'Finance') AND hire_date > '2020-01-01' AND active = 1\nORDER BY salary DESC, last_name ASC, first_name ASC\nLIMIT 25", "output": "SELECT employee_id, first_name, last_name, email, phone, department, salary\nFROM employees\nWHERE salary BETWEEN 50000 AND 100000 AND department IN ('Sales', 'Marketing', 'Finance') AND hire_date > '2020-01-01' AND active = 1\nORDER BY salary DESC, last_name ASC, first_name ASC\nLIMIT 25"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, c.category_name, p.price, p.stock_quantity\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nWHERE p.price > 50.00 AND p.stock_quantity > 10 AND c.category_name LIKE '%Home%' AND p.discontinued = FALSE\nORDER BY p.price ASC, p.product_name ASC", "output": "SELECT p.product_id, p.product_name, c.category_name, p.price, p.stock_quantity\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nWHERE p.price > 50.00 AND p.stock_quantity > 10 AND c.category_name LIKE '%Home%' AND p.discontinued = FALSE\nORDER BY p.price ASC, p.product_name ASC"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id, customer_name, email, phone, address, city, state, zip_code\nFROM customers\nWHERE (city = 'New York' OR city = 'Los Angeles' OR city = 'Chicago') AND created_at >= '2022-01-01' AND email IS NOT NULL AND phone IS NOT NULL\nORDER BY customer_name ASC", "output": "SELECT customer_id, customer_name, email, phone, address, city, state, zip_code\nFROM customers\nWHERE city IN ('New York', 'Los Angeles', 'Chicago') AND created_at >= '2022-01-01' AND email IS NOT NULL AND phone IS NOT NULL\nORDER BY customer_name ASC"}
{"instruction": "Optimize the SQL query", "input": "SELECT order_id, customer_id, order_date, total_amount, status\nFROM orders\nWHERE status IN ('Shipped', 'Delivered') AND order_date BETWEEN '2023-01-01' AND '2023-03-31' AND total_amount > 100.00\nORDER BY order_date DESC, total_amount DESC", "output": "SELECT order_id, customer_id, order_date, total_amount, status\nFROM orders\nWHERE status IN ('Shipped', 'Delivered') AND order_date BETWEEN '2023-01-01' AND '2023-03-31' AND total_amount > 100.00\nORDER BY order_date DESC, total_amount DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE UPPER(first_name) = UPPER('john') AND LOWER(last_name) = LOWER('doe') AND LENGTH(email) > 10 AND CHAR_LENGTH(phone) = 12 AND created_at::text LIKE '2023-%' AND updated_at IS NOT NULL AND updated_at <> NULL", "output": "SELECT *\nFROM users\nWHERE first_name = 'john' AND last_name = 'doe' AND LENGTH(email) > 10 AND LENGTH(phone) = 12 AND created_at >= '2023-01-01' AND created_at < '2024-01-01' AND updated_at IS NOT NULL"}
{"instruction": "Optimize the SQL query", "input": "SELECT product_id, product_name, price\nFROM products\nWHERE price BETWEEN 100.00 AND 500.00 AND category_id IN (SELECT category_id FROM categories WHERE category_name ILIKE '%electronics%')\nORDER BY price DESC, product_name ASC\nLIMIT 50\nOFFSET 0", "output": "SELECT product_id, product_name, price\nFROM products\nWHERE price BETWEEN 100.00 AND 500.00 AND category_id IN (SELECT category_id FROM categories WHERE category_name ILIKE '%electronics%')\nORDER BY price DESC, product_name ASC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent\nFROM orders\nWHERE EXTRACT(YEAR FROM order_date) = 2023 AND EXTRACT(MONTH FROM order_date) BETWEEN 1 AND 6\nGROUP BY customer_id\nHAVING COUNT(*) > 5 AND SUM(total_amount) > 1000.00\nORDER BY total_spent DESC", "output": "SELECT customer_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent\nFROM orders\nWHERE order_date >= '2023-01-01' AND order_date < '2023-07-01'\nGROUP BY customer_id\nHAVING COUNT(*) > 5 AND SUM(total_amount) > 1000.00\nORDER BY total_spent DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM employees\nWHERE (department = 'IT' OR department = 'Engineering') AND salary > 75000 AND EXTRACT(YEAR FROM hire_date) > 2018 AND active = TRUE AND manager_id IS NOT NULL\nORDER BY last_name, first_name", "output": "SELECT *\nFROM employees\nWHERE department IN ('IT', 'Engineering') AND salary > 75000 AND hire_date > '2018-12-31' AND active = TRUE AND manager_id IS NOT NULL\nORDER BY last_name, first_name"}
{"instruction": "Optimize the SQL query", "input": "SELECT product_id, product_name, description\nFROM products\nWHERE description LIKE '%wireless%' AND description LIKE '%bluetooth%' AND description NOT LIKE '%cord%' AND price < 200.00 AND stock_quantity > 0 AND category_id IN (1,2,3,4,5)", "output": "SELECT product_id, product_name, description\nFROM products\nWHERE description LIKE '%wireless%' AND description LIKE '%bluetooth%' AND description NOT LIKE '%cord%' AND price < 200.00 AND stock_quantity > 0 AND category_id IN (1,2,3,4,5)"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, c.customer_name, SUM(od.quantity * od.unit_price) AS order_total\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN order_details od ON o.order_id = od.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31'\nGROUP BY o.order_id, o.order_date, c.customer_name\nHAVING SUM(od.quantity * od.unit_price) > 500.00\nORDER BY order_total DESC", "output": "SELECT o.order_id, o.order_date, c.customer_name, SUM(od.quantity * od.unit_price) AS order_total\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN order_details od ON o.order_id = od.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31'\nGROUP BY o.order_id, o.order_date, c.customer_name\nHAVING SUM(od.quantity * od.unit_price) > 500.00\nORDER BY order_total DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT employee_id, first_name, last_name, email, phone, department, salary\nFROM employees\nWHERE salary BETWEEN 50000 AND 100000 AND department IN ('Sales', 'Marketing', 'Finance') AND hire_date > '2020-01-01' AND active = 1\nORDER BY salary DESC, last_name ASC, first_name ASC\nLIMIT 25", "output": "SELECT employee_id, first_name, last_name, email, phone, department, salary\nFROM employees\nWHERE salary BETWEEN 50000 AND 100000 AND department IN ('Sales', 'Marketing', 'Finance') AND hire_date > '2020-01-01' AND active = 1\nORDER BY salary DESC, last_name ASC, first_name ASC\nLIMIT 25"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, c.category_name, p.price, p.stock_quantity\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nWHERE p.price > 50.00 AND p.stock_quantity > 10 AND c.category_name LIKE '%Home%' AND p.discontinued = FALSE\nORDER BY p.price ASC, p.product_name ASC", "output": "SELECT p.product_id, p.product_name, c.category_name, p.price, p.stock_quantity\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nWHERE p.price > 50.00 AND p.stock_quantity > 10 AND c.category_name LIKE '%Home%' AND p.discontinued = FALSE\nORDER BY p.price ASC, p.product_name ASC"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id, customer_name, email, phone, address, city, state, zip_code\nFROM customers\nWHERE (city = 'New York' OR city = 'Los Angeles' OR city = 'Chicago') AND created_at >= '2022-01-01' AND email IS NOT NULL AND phone IS NOT NULL\nORDER BY customer_name ASC", "output": "SELECT customer_id, customer_name, email, phone, address, city, state, zip_code\nFROM customers\nWHERE city IN ('New York', 'Los Angeles', 'Chicago') AND created_at >= '2022-01-01' AND email IS NOT NULL AND phone IS NOT NULL\nORDER BY customer_name ASC"}
{"instruction": "Optimize the SQL query", "input": "SELECT order_id, customer_id, order_date, total_amount, status\nFROM orders\nWHERE status IN ('Shipped', 'Delivered') AND order_date BETWEEN '2023-01-01' AND '2023-03-31' AND total_amount > 100.00\nORDER BY order_date DESC, total_amount DESC", "output": "SELECT order_id, customer_id, order_date, total_amount, status\nFROM orders\nWHERE status IN ('Shipped', 'Delivered') AND order_date BETWEEN '2023-01-01' AND '2023-03-31' AND total_amount > 100.00\nORDER BY order_date DESC, total_amount DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND date_updated IS NOT NULL AND date_updated <> NULL AND LENGTH(TYPE) > 0 AND CHAR_LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND date_updated IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > CAST('2023-02-01' AS TEXT) AND countries_id IS NOT NULL AND countries_id <> NULL AND EXTRACT(YEAR FROM created_at) = 2023 AND EXTRACT(MONTH FROM created_at) >= 2;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-02-01' AND countries_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND LOWER(city) = 'chicago' AND city LIKE '%Chicago%';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '13579' AND official_user_id IS NOT NULL AND official_user_id <> NULL AND LENGTH(user_id) = 5 AND user_id LIKE '13579%';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '13579' AND official_user_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND updated_at IS NOT NULL AND updated_at <> NULL AND active IS NOT NULL AND active = 1;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '43210' AND created_at IS NOT NULL AND created_at <> NULL AND pharmacies_id::text = '43210';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '43210' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE is_default = CAST(TRUE AS BOOLEAN) AND forms_id IS NOT NULL AND forms_id <> NULL AND is_default = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE is_default = TRUE AND forms_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(user_id AS TEXT) = '65432' AND updated_at IS NOT NULL AND updated_at <> NULL AND user_id::text LIKE '65432%';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = '65432' AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(facility_id AS TEXT) = '54321' AND CAST(organization_id AS TEXT) = '87654' AND tools_id IS NOT NULL AND tools_id <> NULL AND facility_id::text = '54321' AND organization_id::text = '87654';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = '54321' AND organization_id = '87654' AND tools_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE ((harmt IS NOT NULL AND harmt <> NULL) OR (prescribers_id IS NOT NULL AND prescribers_id <> NULL)) AND is_open = CAST(TRUE AS BOOLEAN) AND date_created IS NOT NULL AND date_created <> NULL AND date_closed IS NOT NULL AND date_closed <> NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE (harmt IS NOT NULL OR prescribers_id IS NOT NULL) AND is_open = TRUE AND date_created IS NOT NULL AND date_closed IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE is_active = CAST(TRUE AS BOOLEAN) AND CAST(updated_at AS TEXT) > '2023-04-01' AND updated_at IS NOT NULL AND updated_at <> NULL AND is_active = 1;", "output": "SELECT *\nFROM users\nWHERE is_active = TRUE AND updated_at > '2023-04-01' AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE UPPER(city) = UPPER('Denver') AND trial_ends_at IS NOT NULL AND trial_ends_at <> NULL AND LOWER(city) = 'denver';", "output": "SELECT *\nFROM organizations\nWHERE city = 'Denver' AND trial_ends_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(activated_by) = UPPER('Pharmacist D') AND activate_at IS NOT NULL AND activate_at <> NULL AND activated_by ILIKE 'Pharmacist D';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 'Pharmacist D' AND activate_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '97531' AND employee_id IS NOT NULL AND employee_id <> NULL AND user_id::text = '97531';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '97531' AND employee_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND serial_number <> '' AND LENGTH(serial_number) > 0 AND active IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND serial_number <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE UPPER(name) = UPPER('Chemical Spill') AND description <> '' AND LENGTH(description) > 0 AND name ILIKE 'Chemical Spill';", "output": "SELECT *\nFROM hazards\nWHERE name = 'Chemical Spill' AND description <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '654' AND \"order\" IS NOT NULL AND \"order\" <> NULL AND forms_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '654' AND \"order\" IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '321' AND action_date IS NOT NULL AND action_date <> NULL AND date_done IS NOT NULL AND date_done <> NULL AND events_id::text = '321';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '321' AND action_date IS NOT NULL AND date_done IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '876' AND CAST(facility_id AS TEXT) = '543' AND updated_by IS NOT NULL AND updated_by <> NULL AND updated_at IS NOT NULL AND updated_at <> NULL;", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '876' AND facility_id = '543' AND updated_by IS NOT NULL AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '987' AND date_created IS NOT NULL AND date_created <> NULL AND updated_by IS NOT NULL AND updated_by <> NULL AND harmt IS NOT NULL AND harmt <> NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '987' AND date_created IS NOT NULL AND updated_by IS NOT NULL AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND is_active = CAST(TRUE AS BOOLEAN) AND date_created IS NOT NULL AND date_created <> NULL AND sf_id IS NOT NULL AND sf_id <> NULL AND LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND is_active = TRUE AND date_created IS NOT NULL AND sf_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-02-01' AND countries_id IS NOT NULL AND countries_id <> NULL AND trial_ends_at IS NOT NULL AND trial_ends_at <> NULL AND name <> '' AND LENGTH(name) > 0;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-02-01' AND countries_id IS NOT NULL AND trial_ends_at IS NOT NULL AND name <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND activated_by IS NOT NULL AND activated_by <> NULL AND city ILIKE 'chicago';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL AND activated_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '13579' AND official_user_id IS NOT NULL AND official_user_id <> NULL AND fixed = CAST(TRUE AS BOOLEAN) AND user_id::text = '13579';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '13579' AND official_user_id IS NOT NULL AND fixed = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND updated_at IS NOT NULL AND updated_at <> NULL AND asset_type_id IS NOT NULL AND asset_type_id <> NULL AND active = 1;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at IS NOT NULL AND asset_type_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '43210' AND created_at IS NOT NULL AND created_at <> NULL AND pharmacies_id IS NOT NULL AND pharmacies_id <> NULL AND pharmacies_id::text = '43210';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '43210' AND created_at IS NOT NULL AND pharmacies_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE is_default = CAST(TRUE AS BOOLEAN) AND forms_id IS NOT NULL AND forms_id <> NULL AND facility_id IS NOT NULL AND facility_id <> NULL AND is_default = 1;", "output": "SELECT *\nFROM event_staff_roles\nWHERE is_default = TRUE AND forms_id IS NOT NULL AND facility_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(user_id AS TEXT) = '65432' AND updated_at IS NOT NULL AND updated_at <> NULL AND user_pharmacy_id IS NOT NULL AND user_pharmacy_id <> NULL AND user_id::text = '65432';", "output": "SELECT *\nFROM event_actions\nWHERE user_id = '65432' AND updated_at IS NOT NULL AND user_pharmacy_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(facility_id AS TEXT) = '54321' AND CAST(organization_id AS TEXT) = '87654' AND tools_id IS NOT NULL AND tools_id <> NULL AND updated_by IS NOT NULL AND updated_by <> NULL AND facility_id::text = '54321';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id = '54321' AND organization_id = '87654' AND tools_id IS NOT NULL AND updated_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE ((harmt IS NOT NULL AND harmt <> NULL) OR (prescribers_id IS NOT NULL AND prescribers_id <> NULL)) AND is_open = CAST(TRUE AS BOOLEAN) AND date_created IS NOT NULL AND date_created <> NULL AND date_closed IS NOT NULL AND date_closed <> NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE (harmt IS NOT NULL OR prescribers_id IS NOT NULL) AND is_open = TRUE AND date_created IS NOT NULL AND date_closed IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE is_active = CAST(TRUE AS BOOLEAN) AND CAST(updated_at AS TEXT) > '2023-03-01' AND TYPE IS NOT NULL AND TYPE <> NULL AND date_updated IS NOT NULL AND date_updated <> NULL AND is_active = 1;", "output": "SELECT *\nFROM users\nWHERE is_active = TRUE AND updated_at > '2023-03-01' AND TYPE IS NOT NULL AND date_updated IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE UPPER(city) = UPPER('Seattle') AND trial_ends_at IS NOT NULL AND trial_ends_at <> NULL AND countries_id IS NOT NULL AND countries_id <> NULL AND city ILIKE 'seattle';", "output": "SELECT *\nFROM organizations\nWHERE city = 'Seattle' AND trial_ends_at IS NOT NULL AND countries_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(activated_by) = UPPER('Pharmacist B') AND activate_at IS NOT NULL AND activate_at <> NULL AND activated_by ILIKE 'Pharmacist B';", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by = 'Pharmacist B' AND activate_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '98765' AND created_at IS NOT NULL AND created_at <> NULL AND user_id::text = '98765';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '98765' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE CAST(asset_type_id AS TEXT) = '789' AND serial_number IS NOT NULL AND serial_number <> NULL AND asset_type_id::text = '789';", "output": "SELECT *\nFROM assets\nWHERE asset_type_id = '789' AND serial_number IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '65432' AND description <> '' AND LENGTH(description) > 0 AND pharmacies_id::text = '65432';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '65432' AND description <> '';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '654' AND \"order\" IS NOT NULL AND \"order\" <> NULL AND forms_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '654' AND \"order\" IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '987' AND UPPER(updated_by) = UPPER('John Smith') AND events_id::text = '987' AND updated_by ILIKE 'John Smith';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '987' AND updated_by = 'John Smith';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '543' AND UPPER(updated_by) = UPPER('Jane Doe') AND organization_id::text = '543' AND updated_by ILIKE 'Jane Doe';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '543' AND updated_by = 'Jane Doe';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '321' AND harmt IS NOT NULL AND harmt <> NULL AND reporters_id::text = '321';", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '321' AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('Admin' AS VARCHAR(255)) AND is_active = CAST(TRUE AS BOOLEAN) AND LENGTH(TYPE) = 5;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'Admin' AND is_active = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-01-01' AND CAST(updated_at AS TEXT) < '2023-06-30' AND created_at IS NOT NULL AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-01-01' AND updated_at < '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Los Angeles') AND daye_enabled IS NOT NULL AND daye_enabled <> NULL AND city ILIKE 'los angeles';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Los Angeles' AND daye_enabled IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE UPPER(full_name) = UPPER('Jane Doe') AND fixed = CAST(TRUE AS BOOLEAN) AND full_name ILIKE 'Jane Doe';", "output": "SELECT *\nFROM staff_directory\nWHERE full_name = 'Jane Doe' AND fixed = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND CAST(updated_at AS TEXT) >= '2023-01-01' AND CAST(updated_at AS TEXT) <= '2023-06-30' AND active IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at BETWEEN '2023-01-01' AND '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE UPPER(name) LIKE UPPER('Chemical%') AND name IS NOT NULL;", "output": "SELECT *\nFROM hazards\nWHERE name LIKE 'Chemical%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '789' AND CAST(facility_id AS TEXT) = '654' AND forms_id::text = '789' AND facility_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '789' AND facility_id = '654';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '987' AND UPPER(updated_by) = UPPER('John Smith') AND events_id::text = '987';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '987' AND updated_by = 'John Smith';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '543' AND UPPER(updated_by) = UPPER('Jane Doe') AND organization_id::text = '543';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '543' AND updated_by = 'Jane Doe';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '321' AND harmt IS NOT NULL AND harmt <> NULL AND reporters_id::text = '321';", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '321' AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND is_active = CAST(TRUE AS BOOLEAN) AND LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND is_active = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-01-01' AND CAST(updated_at AS TEXT) < '2023-06-30' AND created_at IS NOT NULL AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-01-01' AND updated_at < '2023-06-30';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND city ILIKE 'chicago';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE CAST(user_id AS TEXT) = '13579' AND official_user_id IS NOT NULL AND official_user_id <> NULL AND user_id::text = '13579';", "output": "SELECT *\nFROM staff_directory\nWHERE user_id = '13579' AND official_user_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE active = CAST(TRUE AS BOOLEAN) AND updated_at IS NOT NULL AND updated_at <> NULL AND active IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE active = TRUE AND updated_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE CAST(pharmacies_id AS TEXT) = '43210' AND created_at IS NOT NULL AND created_at <> NULL AND pharmacies_id::text = '43210';", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id = '43210' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE CAST(forms_id AS TEXT) = '654' AND updates_by IS NOT NULL AND updates_by <> NULL AND forms_id::text = '654';", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id = '654' AND updates_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE CAST(events_id AS TEXT) = '321' AND action_date IS NOT NULL AND action_date <> NULL AND events_id::text = '321';", "output": "SELECT *\nFROM event_actions\nWHERE events_id = '321' AND action_date IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE CAST(organization_id AS TEXT) = '876' AND CAST(facility_id AS TEXT) = '543' AND updated_by IS NOT NULL AND updated_by <> NULL AND organization_id::text = '876';", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id = '876' AND facility_id = '543' AND updated_by IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(reporters_id AS TEXT) = '987' AND date_created IS NOT NULL AND date_created <> NULL AND reporters_id::text = '987';", "output": "SELECT *\nFROM EVENTS\nWHERE reporters_id = '987' AND date_created IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(TYPE AS VARCHAR(255)) = CAST('User' AS VARCHAR(255)) AND date_updated IS NOT NULL AND date_updated <> NULL AND LENGTH(TYPE) = 4;", "output": "SELECT *\nFROM users\nWHERE TYPE = 'User' AND date_updated IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE CAST(created_at AS TEXT) > '2023-02-01' AND countries_id IS NOT NULL AND countries_id <> NULL AND created_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE created_at > '2023-02-01' AND countries_id IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(city) = UPPER('Chicago') AND created_at IS NOT NULL AND created_at <> NULL AND city ILIKE 'chicago';", "output": "SELECT *\nFROM pharmacies\nWHERE city = 'Chicago' AND created_at IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE UPPER(employee_id) LIKE UPPER('EMP-%') AND employee_id IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE employee_id LIKE 'EMP-%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE CAST(updated_at AS TEXT) > CAST((CURRENT_TIMESTAMP - INTERVAL '1 day') AS TEXT) AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE updated_at > (CURRENT_TIMESTAMP - INTERVAL '1 day');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies WHERE UPPER(name) LIKE UPPER('%Healthcare%') AND name IS NOT NULL);", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies WHERE name LIKE '%Healthcare%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE UPPER(name) LIKE UPPER('%Coordinator%') AND name IS NOT NULL;", "output": "SELECT *\nFROM event_staff_roles\nWHERE name LIKE '%Coordinator%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id IN (SELECT user_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE UPPER(ROLE) = UPPER('Supervisor') AND ROLE IS NOT NULL) AND user_id IS NOT NULL);", "output": "SELECT *\nFROM event_actions\nWHERE user_id IN (SELECT user_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE ROLE = 'Supervisor'));"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE UPPER(city) LIKE UPPER('S%') AND city IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE city LIKE 'S%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE harmt IS NOT NULL AND harmt <> NULL AND reporters_id IN (SELECT users_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE UPPER(ROLE) = UPPER('Admin') AND ROLE IS NOT NULL) AND users_id IS NOT NULL);", "output": "SELECT *\nFROM EVENTS\nWHERE harmt IS NOT NULL AND reporters_id IN (SELECT users_id FROM users WHERE profiles_id IN (SELECT profiles_id FROM profiles WHERE ROLE = 'Admin'));"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE is_active = CAST(1 AS BOOLEAN) AND EXTRACT(DOW FROM updated_at) IN (1, 7) AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM users\nWHERE is_active = 1 AND DAYOFWEEK(updated_at) IN (1, 7);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE sf_id IN (SELECT sf_id FROM organizations GROUP BY sf_id HAVING COUNT(DISTINCT countries_id) > 1 AND COUNT(DISTINCT countries_id) <> 0);", "output": "SELECT *\nFROM organizations\nWHERE sf_id IN (SELECT sf_id FROM organizations GROUP BY sf_id HAVING COUNT(DISTINCT countries_id) > 1);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE UPPER(activated_by) LIKE UPPER('%Pharma%') AND organizations_id IN (SELECT organizations_id FROM organizations WHERE UPPER(address) LIKE UPPER('P%') AND address IS NOT NULL);", "output": "SELECT *\nFROM pharmacies\nWHERE activated_by LIKE '%Pharma%' AND organizations_id IN (SELECT organizations_id FROM organizations WHERE address LIKE 'P%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE UPPER(full_name) LIKE UPPER('%John%') AND UPPER(full_name) LIKE UPPER('%Doe%') AND full_name IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE full_name LIKE '%John%' AND full_name LIKE '%Doe%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE asset_items_id IN (SELECT MAX(CAST(asset_items_id AS BIGINT)) FROM assets WHERE asset_items_id IS NOT NULL);", "output": "SELECT *\nFROM assets\nWHERE asset_items_id IN (SELECT MAX(asset_items_id) FROM assets);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies GROUP BY pharmacies_id ORDER BY COUNT(*) DESC, pharmacies_id ASC LIMIT 1);", "output": "SELECT *\nFROM hazards\nWHERE pharmacies_id IN (SELECT pharmacies_id FROM pharmacies GROUP BY pharmacies_id ORDER BY COUNT(*) DESC LIMIT 1);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE forms_id IN (SELECT forms_id FROM event_staff_roles GROUP BY forms_id ORDER BY COUNT(*) DESC, forms_id ASC);", "output": "SELECT *\nFROM event_staff_roles\nWHERE forms_id IN (SELECT forms_id FROM event_staff_roles GROUP BY forms_id ORDER BY COUNT(*) DESC);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE EXTRACT(DOW FROM action_date) IN (5, 6) AND action_date IS NOT NULL;", "output": "SELECT *\nFROM event_actions\nWHERE WEEKDAY(action_date) IN (5, 6);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id IN (SELECT organization_id FROM organizations WHERE UPPER(name) LIKE UPPER('%Institute%') AND name IS NOT NULL) AND facility_id IN (SELECT facility_id FROM facilities WHERE UPPER(city) LIKE UPPER('M%') AND city IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE organization_id IN (SELECT organization_id FROM organizations WHERE name LIKE '%Institute%') AND facility_id IN (SELECT facility_id FROM facilities WHERE city LIKE 'M%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(harmt AS TEXT) = CAST(prescribers_id AS TEXT) AND harmt IS NOT NULL AND prescribers_id IS NOT NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE harmt = prescribers_id;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE CAST(date_created AS DATE) = CAST(updated_at AS DATE) AND date_created IS NOT NULL AND updated_at IS NOT NULL;", "output": "SELECT *\nFROM users\nWHERE DATE(date_created) = DATE(updated_at);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at IN (SELECT trial_ends_at FROM organizations GROUP BY trial_ends_at HAVING COUNT(*) > 1 AND COUNT(*) <> 0);", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at IN (SELECT trial_ends_at FROM organizations GROUP BY trial_ends_at HAVING COUNT(*) > 1);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE activate_at = CAST('specific_date' AS TIMESTAMP) AND activated_by = SUBSTRING(name, 1, 2) AND name IS NOT NULL;", "output": "SELECT *\nFROM pharmacies\nWHERE activate_at = 'specific_date' AND activated_by = SUBSTRING(name, 1, 2);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE employee_id = REVERSE(employee_id) AND employee_id IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE employee_id = REVERSE(employee_id);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE serial_number ~ '[0-9]{3}' AND serial_number IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE serial_number REGEXP '[0-9]{3}';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE (UPPER(description) LIKE UPPER('%color1%') OR UPPER(description) LIKE UPPER('%color2%') OR UPPER(description) LIKE UPPER('%color3%')) AND description IS NOT NULL;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%color1%' OR description LIKE '%color2%' OR description LIKE '%color3%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE \"order\" = forms_id AND \"order\" IS NOT NULL AND forms_id IS NOT NULL;", "output": "SELECT *\nFROM event_staff_roles\nWHERE ORDER = forms_id;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE user_id = user_pharmacy_id AND user_id IS NOT NULL AND user_pharmacy_id IS NOT NULL;", "output": "SELECT *\nFROM event_actions\nWHERE user_id = user_pharmacy_id;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MAX(updated_at) FROM formsettings_summarytools WHERE updated_at IS NOT NULL)\nUNION\nSELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MIN(updated_at) FROM formsettings_summarytools WHERE updated_at IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MAX(updated_at) FROM formsettings_summarytools)\nUNION\nSELECT *\nFROM formsettings_summarytools\nWHERE updated_at IN (SELECT MIN(updated_at) FROM formsettings_summarytools);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE LENGTH(harmt) = LENGTH(prescribers_id) AND harmt IS NOT NULL AND prescribers_id IS NOT NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE LENGTH(harmt) = LENGTH(prescribers_id);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE updated_at >= (SELECT DATE_SUB(NOW(), INTERVAL '1 week'))\nGROUP BY user_id\nHAVING COUNT(DISTINCT DATE(updated_at)) >= 2 AND updated_at IS NOT NULL ;", "output": "SELECT *\nFROM users\nWHERE updated_at >= (SELECT DATE_SUB(NOW(), INTERVAL 1 WEEK))\nGROUP BY user_id\nHAVING COUNT(DISTINCT DATE(updated_at)) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM organizations\nWHERE trial_ends_at = DATE(created_at) AND trial_ends_at IS NOT NULL AND created_at IS NOT NULL;", "output": "SELECT *\nFROM organizations\nWHERE trial_ends_at = DATE(created_at);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM pharmacies\nWHERE (SELECT COUNT(*) FROM pharmacies WHERE daye_enabled IS NOT NULL) > (SELECT COUNT(*) FROM pharmacies WHERE date_disabled IS NOT NULL);", "output": "SELECT *\nFROM pharmacies\nWHERE (SELECT COUNT() FROM pharmacies WHERE daye_enabled IS NOT NULL) > (SELECT COUNT() FROM pharmacies WHERE date_disabled IS NOT NULL);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM staff_directory\nWHERE LENGTH(full_name) = (SELECT MAX(LENGTH(full_name)) FROM staff_directory WHERE full_name IS NOT NULL) AND full_name IS NOT NULL;", "output": "SELECT *\nFROM staff_directory\nWHERE LENGTH(full_name) = (SELECT MAX(LENGTH(full_name)) FROM staff_directory);"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM assets\nWHERE CAST(updated_at AS TEXT) > CAST((CURRENT_TIMESTAMP - INTERVAL '1 day') AS TEXT) AND serial_number ~ '([A-Za-z0-9]{2})+' AND serial_number IS NOT NULL;", "output": "SELECT *\nFROM assets\nWHERE updated_at > (CURRENT_TIMESTAMP - INTERVAL 1 DAY) AND serial_number REGEXP '([A-Za-z0-9]{2})+';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM hazards\nWHERE UPPER(description) LIKE UPPER('%industry_keyword%') AND description IS NOT NULL;", "output": "SELECT *\nFROM hazards\nWHERE description LIKE '%industry_keyword%';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_staff_roles\nWHERE UPPER(name) LIKE UPPER('%Lead%')\nORDER BY \"order\" DESC AND name IS NOT NULL ;", "output": "SELECT *\nFROM event_staff_roles\nWHERE name LIKE '%Lead%'\nORDER BY ORDER DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM event_actions\nWHERE EXTRACT(DOW FROM action_date) IN (5, 6) AND date_done IS NOT NULL AND date_done <> NULL AND action_date IS NOT NULL;", "output": "SELECT *\nFROM event_actions\nWHERE WEEKDAY(action_date) IN (5, 6) AND date_done IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE UPPER(city) LIKE UPPER('M%') AND city IS NOT NULL) AND updated_by IN (SELECT name FROM organizations WHERE UPPER(name) LIKE UPPER('%Institute%') AND name IS NOT NULL);", "output": "SELECT *\nFROM formsettings_summarytools\nWHERE facility_id IN (SELECT facility_id FROM facilities WHERE city LIKE 'M%') AND updated_by IN (SELECT name FROM organizations WHERE name LIKE '%Institute%');"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE CAST(harmt AS TEXT) = CAST(prescribers_id AS TEXT) AND harmt IS NOT NULL AND harmt <> NULL AND prescribers_id IS NOT NULL;", "output": "SELECT *\nFROM EVENTS\nWHERE harmt = prescribers_id AND harmt IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE UPPER(username) = UPPER('john_doe') AND LENGTH(password) >= 8 AND created_at::text LIKE '2023-%' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'", "output": "SELECT *\nFROM users\nWHERE username = 'john_doe' AND LENGTH(password) >= 8 AND created_at >= '2023-01-01' AND created_at < '2024-01-01' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100\nOFFSET 0", "output": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50\nOFFSET 0", "output": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75\nOFFSET 0", "output": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nWHERE c.created_date > '2020-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum') AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2022-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nHAVING COUNT(o.order_id) > 5 AND SUM(o.total_amount) > 1000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 100\nOFFSET 0", "output": "SELECT c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nWHERE c.created_date > '2020-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum') AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2022-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nHAVING COUNT(o.order_id) > 5 AND SUM(o.total_amount) > 1000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE UPPER(username) = UPPER('john_doe') AND LENGTH(password) >= 8 AND created_at::text LIKE '2023-%' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'", "output": "SELECT *\nFROM users\nWHERE username = 'john_doe' AND LENGTH(password) >= 8 AND created_at >= '2023-01-01' AND created_at < '2024-01-01' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100\nOFFSET 0", "output": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50\nOFFSET 0", "output": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75\nOFFSET 0", "output": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nWHERE c.created_date > '2020-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum') AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2022-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nHAVING COUNT(o.order_id) > 5 AND SUM(o.total_amount) > 1000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 100\nOFFSET 0", "output": "SELECT c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nWHERE c.created_date > '2020-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum') AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2022-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nHAVING COUNT(o.order_id) > 5 AND SUM(o.total_amount) > 1000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT i.invoice_id, i.invoice_date, i.due_date, i.total_amount, i.status, c.customer_name, c.tax_id, a.address_line1, a.address_line2, a.city, a.postal_code, co.country_name, p.payment_terms, p.discount_percentage, b.bank_name, b.account_number, t.tax_rate, t.tax_amount, d.discount_amount, i.notes, i.po_number\nFROM invoices i\nJOIN customers c ON i.customer_id = c.customer_id\nJOIN addresses a ON i.billing_address_id = a.address_id\nJOIN countries co ON a.country_id = co.country_id\nJOIN payment_terms p ON i.payment_terms_id = p.terms_id\nLEFT JOIN bank_accounts b ON i.bank_account_id = b.account_id\nJOIN tax_calculations t ON i.invoice_id = t.invoice_id\nLEFT JOIN discount_applications d ON i.invoice_id = d.invoice_id\nWHERE i.invoice_date BETWEEN '2023-01-01' AND '2023-12-31' AND i.total_amount > 500.00 AND i.status IN ('paid', 'partially_paid') AND c.customer_type = 'business' AND co.country_name = 'United States' AND p.net_days > 30 AND t.tax_rate > 0.05 AND (d.discount_amount > 0 OR i.discount_percentage > 0) AND i.due_date > CURRENT_DATE AND i.po_number IS NOT NULL AND i.notes LIKE '%urgent%'\nORDER BY i.total_amount DESC, i.invoice_date DESC\nLIMIT 60\nOFFSET 0", "output": "SELECT i.invoice_id, i.invoice_date, i.due_date, i.total_amount, i.status, c.customer_name, c.tax_id, a.address_line1, a.address_line2, a.city, a.postal_code, co.country_name, p.payment_terms, p.discount_percentage, b.bank_name, b.account_number, t.tax_rate, t.tax_amount, d.discount_amount, i.notes, i.po_number\nFROM invoices i\nJOIN customers c ON i.customer_id = c.customer_id\nJOIN addresses a ON i.billing_address_id = a.address_id\nJOIN countries co ON a.country_id = co.country_id\nJOIN payment_terms p ON i.payment_terms_id = p.terms_id\nLEFT JOIN bank_accounts b ON i.bank_account_id = b.account_id\nJOIN tax_calculations t ON i.invoice_id = t.invoice_id\nLEFT JOIN discount_applications d ON i.invoice_id = d.invoice_id\nWHERE i.invoice_date BETWEEN '2023-01-01' AND '2023-12-31' AND i.total_amount > 500.00 AND i.status IN ('paid', 'partially_paid') AND c.customer_type = 'business' AND co.country_name = 'United States' AND p.net_days > 30 AND t.tax_rate > 0.05 AND (d.discount_amount > 0 OR i.discount_percentage > 0) AND i.due_date > CURRENT_DATE AND i.po_number IS NOT NULL AND i.notes LIKE '%urgent%'\nORDER BY i.total_amount DESC, i.invoice_date DESC\nLIMIT 60"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.status, c.client_name, c.industry, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, t.team_name, r.risk_level, r.risk_description, de.deliverable_name, de.status AS deliverable_status, res.resource_name, res.resource_type, res.cost_rate, times.hours_worked, times.overtime_hours\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nWHERE p.start_date > '2022-01-01' AND p.budget > 100000.00 AND p.status IN ('in_progress', 'on_hold') AND c.industry IN ('Technology', 'Finance', 'Healthcare') AND d.department_name = 'R&D' AND t.team_size > 5 AND r.risk_level IN ('high', 'medium') AND de.status = 'completed' AND res.resource_type = 'human' AND res.cost_rate > 50.00 AND times.hours_worked > 40 AND times.entry_date > '2023-01-01'\nORDER BY p.budget DESC, p.start_date ASC\nLIMIT 40\nOFFSET 0", "output": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.status, c.client_name, c.industry, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, t.team_name, r.risk_level, r.risk_description, de.deliverable_name, de.status AS deliverable_status, res.resource_name, res.resource_type, res.cost_rate, times.hours_worked, times.overtime_hours\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nWHERE p.start_date > '2022-01-01' AND p.budget > 100000.00 AND p.status IN ('in_progress', 'on_hold') AND c.industry IN ('Technology', 'Finance', 'Healthcare') AND d.department_name = 'R&D' AND t.team_size > 5 AND r.risk_level IN ('high', 'medium') AND de.status = 'completed' AND res.resource_type = 'human' AND res.cost_rate > 50.00 AND times.hours_worked > 40 AND times.entry_date > '2023-01-01'\nORDER BY p.budget DESC, p.start_date ASC\nLIMIT 40"}
{"instruction": "Optimize the SQL query", "input": "SELECT s.sale_id, s.sale_date, s.total_amount, s.payment_method, c.customer_name, c.membership_level, e.employee_name, st.store_name, st.location, p.product_name, p.category, sd.quantity, sd.unit_price, sd.discount_amount, prom.promotion_name, prom.discount_percentage, tax.tax_amount, tax.tax_rate, del.delivery_status, del.delivery_date\nFROM sales s\nJOIN customers c ON s.customer_id = c.customer_id\nJOIN employees e ON s.employee_id = e.employee_id\nJOIN stores st ON s.store_id = st.store_id\nJOIN sale_details sd ON s.sale_id = sd.sale_id\nJOIN products p ON sd.product_id = p.product_id\nLEFT JOIN promotions prom ON s.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON s.sale_id = tax.sale_id\nLEFT JOIN deliveries del ON s.sale_id = del.sale_id\nWHERE s.sale_date BETWEEN '2023-06-01' AND '2023-12-31' AND s.total_amount > 200.00 AND s.payment_method IN ('credit_card', 'digital_wallet') AND c.membership_level IN ('gold', 'platinum') AND e.position = 'sales_associate' AND st.location LIKE '%mall%' AND p.category = 'electronics' AND sd.quantity > 2 AND prom.discount_percentage > 10.00 AND tax.tax_rate BETWEEN 0.08 AND 0.15 AND del.delivery_status = 'delivered' AND del.delivery_date IS NOT NULL\nORDER BY s.total_amount DESC, s.sale_date DESC\nLIMIT 80\nOFFSET 0", "output": "SELECT s.sale_id, s.sale_date, s.total_amount, s.payment_method, c.customer_name, c.membership_level, e.employee_name, st.store_name, st.location, p.product_name, p.category, sd.quantity, sd.unit_price, sd.discount_amount, prom.promotion_name, prom.discount_percentage, tax.tax_amount, tax.tax_rate, del.delivery_status, del.delivery_date\nFROM sales s\nJOIN customers c ON s.customer_id = c.customer_id\nJOIN employees e ON s.employee_id = e.employee_id\nJOIN stores st ON s.store_id = st.store_id\nJOIN sale_details sd ON s.sale_id = sd.sale_id\nJOIN products p ON sd.product_id = p.product_id\nLEFT JOIN promotions prom ON s.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON s.sale_id = tax.sale_id\nLEFT JOIN deliveries del ON s.sale_id = del.sale_id\nWHERE s.sale_date BETWEEN '2023-06-01' AND '2023-12-31' AND s.total_amount > 200.00 AND s.payment_method IN ('credit_card', 'digital_wallet') AND c.membership_level IN ('gold', 'platinum') AND e.position = 'sales_associate' AND st.location LIKE '%mall%' AND p.category = 'electronics' AND sd.quantity > 2 AND prom.discount_percentage > 10.00 AND tax.tax_rate BETWEEN 0.08 AND 0.15 AND del.delivery_status = 'delivered' AND del.delivery_date IS NOT NULL\nORDER BY s.total_amount DESC, s.sale_date DESC\nLIMIT 80"}
{"instruction": "Optimize the SQL query", "input": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.current_stock, inv.min_stock_level, inv.max_stock_level, inv.unit_cost, inv.total_value, wh.warehouse_name, wh.location, wh.capacity, s.supplier_name, s.contact_email, cat.category_name, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reason, emp.employee_name, aud.audit_date, aud.audit_result, ord.reorder_quantity, ord.reorder_date, ord.expected_delivery\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN reorder_orders ord ON inv.inventory_id = ord.inventory_id\nWHERE inv.current_stock < inv.min_stock_level AND inv.unit_cost > 25.00 AND wh.capacity > 1000 AND s.rating >= 4.0 AND cat.category_name = 'raw_materials' AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-01-01' AND aud.audit_result = 'passed' AND ord.reorder_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND inv.total_value > 5000.00\nORDER BY inv.current_stock ASC, inv.unit_cost DESC\nLIMIT 55\nOFFSET 0", "output": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.current_stock, inv.min_stock_level, inv.max_stock_level, inv.unit_cost, inv.total_value, wh.warehouse_name, wh.location, wh.capacity, s.supplier_name, s.contact_email, cat.category_name, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reason, emp.employee_name, aud.audit_date, aud.audit_result, ord.reorder_quantity, ord.reorder_date, ord.expected_delivery\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN reorder_orders ord ON inv.inventory_id = ord.inventory_id\nWHERE inv.current_stock < inv.min_stock_level AND inv.unit_cost > 25.00 AND wh.capacity > 1000 AND s.rating >= 4.0 AND cat.category_name = 'raw_materials' AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-01-01' AND aud.audit_result = 'passed' AND ord.reorder_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND inv.total_value > 5000.00\nORDER BY inv.current_stock ASC, inv.unit_cost DESC\nLIMIT 55"}
{"instruction": "Optimize the SQL query", "input": "SELECT loan.loan_id, loan.amount, loan.interest_rate, loan.start_date, loan.end_date, loan.status, c.customer_name, c.credit_score, e.employee_name, br.branch_name, pt.payment_term, sch.due_date, sch.amount_due, sch.paid_amount, coll.collection_status, coll.collection_date, coll.collection_amount, risk.risk_level, risk.risk_description, doc.document_name, doc.document_status, ins.insurance_amount, ins.insurance_provider\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_term_id = pt.term_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nWHERE loan.amount > 50000.00 AND loan.interest_rate < 8.00 AND loan.start_date > '2022-01-01' AND loan.status = 'active' AND c.credit_score > 700 AND br.branch_region = 'northeast' AND pt.number_of_payments > 36 AND sch.due_date BETWEEN '2023-09-01' AND '2023-12-31' AND coll.collection_status = 'pending' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_amount > 0 AND ins.insurance_provider IS NOT NULL\nORDER BY loan.amount DESC, loan.start_date ASC\nLIMIT 70\nOFFSET 0", "output": "SELECT loan.loan_id, loan.amount, loan.interest_rate, loan.start_date, loan.end_date, loan.status, c.customer_name, c.credit_score, e.employee_name, br.branch_name, pt.payment_term, sch.due_date, sch.amount_due, sch.paid_amount, coll.collection_status, coll.collection_date, coll.collection_amount, risk.risk_level, risk.risk_description, doc.document_name, doc.document_status, ins.insurance_amount, ins.insurance_provider\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_term_id = pt.term_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nWHERE loan.amount > 50000.00 AND loan.interest_rate < 8.00 AND loan.start_date > '2022-01-01' AND loan.status = 'active' AND c.credit_score > 700 AND br.branch_region = 'northeast' AND pt.number_of_payments > 36 AND sch.due_date BETWEEN '2023-09-01' AND '2023-12-31' AND coll.collection_status = 'pending' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_amount > 0 AND ins.insurance_provider IS NOT NULL\nORDER BY loan.amount DESC, loan.start_date ASC\nLIMIT 70"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE UPPER(username) = UPPER('john_doe') AND LENGTH(password) >= 8 AND created_at::text LIKE '2023-%' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'", "output": "SELECT *\nFROM users\nWHERE username = 'john_doe' AND LENGTH(password) >= 8 AND created_at >= '2023-01-01' AND created_at < '2024-01-01' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100\nOFFSET 0", "output": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50\nOFFSET 0", "output": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75\nOFFSET 0", "output": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nWHERE c.created_date > '2020-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum') AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2022-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nHAVING COUNT(o.order_id) > 5 AND SUM(o.total_amount) > 1000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 100\nOFFSET 0", "output": "SELECT c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nWHERE c.created_date > '2020-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum') AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2022-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, l.loyalty_tier, l.points_balance\nHAVING COUNT(o.order_id) > 5 AND SUM(o.total_amount) > 1000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT i.invoice_id, i.invoice_date, i.due_date, i.total_amount, i.status, c.customer_name, c.tax_id, a.address_line1, a.address_line2, a.city, a.postal_code, co.country_name, p.payment_terms, p.discount_percentage, b.bank_name, b.account_number, t.tax_rate, t.tax_amount, d.discount_amount, i.notes, i.po_number\nFROM invoices i\nJOIN customers c ON i.customer_id = c.customer_id\nJOIN addresses a ON i.billing_address_id = a.address_id\nJOIN countries co ON a.country_id = co.country_id\nJOIN payment_terms p ON i.payment_terms_id = p.terms_id\nLEFT JOIN bank_accounts b ON i.bank_account_id = b.account_id\nJOIN tax_calculations t ON i.invoice_id = t.invoice_id\nLEFT JOIN discount_applications d ON i.invoice_id = d.invoice_id\nWHERE i.invoice_date BETWEEN '2023-01-01' AND '2023-12-31' AND i.total_amount > 500.00 AND i.status IN ('paid', 'partially_paid') AND c.customer_type = 'business' AND co.country_name = 'United States' AND p.net_days > 30 AND t.tax_rate > 0.05 AND (d.discount_amount > 0 OR i.discount_percentage > 0) AND i.due_date > CURRENT_DATE AND i.po_number IS NOT NULL AND i.notes LIKE '%urgent%'\nORDER BY i.total_amount DESC, i.invoice_date DESC\nLIMIT 60\nOFFSET 0", "output": "SELECT i.invoice_id, i.invoice_date, i.due_date, i.total_amount, i.status, c.customer_name, c.tax_id, a.address_line1, a.address_line2, a.city, a.postal_code, co.country_name, p.payment_terms, p.discount_percentage, b.bank_name, b.account_number, t.tax_rate, t.tax_amount, d.discount_amount, i.notes, i.po_number\nFROM invoices i\nJOIN customers c ON i.customer_id = c.customer_id\nJOIN addresses a ON i.billing_address_id = a.address_id\nJOIN countries co ON a.country_id = co.country_id\nJOIN payment_terms p ON i.payment_terms_id = p.terms_id\nLEFT JOIN bank_accounts b ON i.bank_account_id = b.account_id\nJOIN tax_calculations t ON i.invoice_id = t.invoice_id\nLEFT JOIN discount_applications d ON i.invoice_id = d.invoice_id\nWHERE i.invoice_date BETWEEN '2023-01-01' AND '2023-12-31' AND i.total_amount > 500.00 AND i.status IN ('paid', 'partially_paid') AND c.customer_type = 'business' AND co.country_name = 'United States' AND p.net_days > 30 AND t.tax_rate > 0.05 AND (d.discount_amount > 0 OR i.discount_percentage > 0) AND i.due_date > CURRENT_DATE AND i.po_number IS NOT NULL AND i.notes LIKE '%urgent%'\nORDER BY i.total_amount DESC, i.invoice_date DESC\nLIMIT 60"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.status, c.client_name, c.industry, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, t.team_name, r.risk_level, r.risk_description, de.deliverable_name, de.status AS deliverable_status, res.resource_name, res.resource_type, res.cost_rate, times.hours_worked, times.overtime_hours\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nWHERE p.start_date > '2022-01-01' AND p.budget > 100000.00 AND p.status IN ('in_progress', 'on_hold') AND c.industry IN ('Technology', 'Finance', 'Healthcare') AND d.department_name = 'R&D' AND t.team_size > 5 AND r.risk_level IN ('high', 'medium') AND de.status = 'completed' AND res.resource_type = 'human' AND res.cost_rate > 50.00 AND times.hours_worked > 40 AND times.entry_date > '2023-01-01'\nORDER BY p.budget DESC, p.start_date ASC\nLIMIT 40\nOFFSET 0", "output": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.status, c.client_name, c.industry, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, t.team_name, r.risk_level, r.risk_description, de.deliverable_name, de.status AS deliverable_status, res.resource_name, res.resource_type, res.cost_rate, times.hours_worked, times.overtime_hours\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nWHERE p.start_date > '2022-01-01' AND p.budget > 100000.00 AND p.status IN ('in_progress', 'on_hold') AND c.industry IN ('Technology', 'Finance', 'Healthcare') AND d.department_name = 'R&D' AND t.team_size > 5 AND r.risk_level IN ('high', 'medium') AND de.status = 'completed' AND res.resource_type = 'human' AND res.cost_rate > 50.00 AND times.hours_worked > 40 AND times.entry_date > '2023-01-01'\nORDER BY p.budget DESC, p.start_date ASC\nLIMIT 40"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE UPPER(username) = UPPER('john_doe') AND LENGTH(password) >= 8 AND created_at::text LIKE '2023-%' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'", "output": "SELECT *\nFROM users\nWHERE username = 'john_doe' AND LENGTH(password) >= 8 AND created_at >= '2023-01-01' AND created_at < '2024-01-01' AND updated_at IS NOT NULL AND is_active = TRUE AND email_verified = TRUE AND last_login > '2023-01-01' AND profile_complete = TRUE AND account_type IN ('premium', 'enterprise') AND login_count > 10 AND failed_login_attempts = 0 AND date_of_birth BETWEEN '1980-01-01' AND '2000-12-31' AND country_code = 'US' AND timezone = 'America/New_York' AND subscription_status = 'active' AND marketing_emails = TRUE AND two_factor_enabled = TRUE AND last_password_change > '2023-06-01'"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100\nOFFSET 0", "output": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, c.category_name, s.supplier_name, b.brand_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nWHERE p.price BETWEEN 50.00 AND 500.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.rating >= 4.5 AND p.weight < 5.0 AND p.dimensions LIKE '%cm%' AND p.warranty_period > 12 AND p.release_date > '2022-01-01' AND p.sku LIKE 'ELEC%' AND p.manufacturer_part_number IS NOT NULL\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50\nOFFSET 0", "output": "SELECT o.order_id, o.order_date, o.total_amount, o.status, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, p.payment_method, p.payment_status, s.shipping_method, s.tracking_number, s.estimated_delivery\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 100.00 AND o.status IN ('completed', 'shipped') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority') AND s.estimated_delivery > CURRENT_DATE AND o.items_count > 1 AND o.discount_amount > 0 AND o.tax_amount > 0\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75\nOFFSET 0", "output": "SELECT e.employee_id, e.first_name, e.last_name, e.email, e.phone, e.department, e.position, e.salary, e.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name\nFROM employees e\nLEFT JOIN employees m ON e.manager_id = m.employee_id\nJOIN departments d ON e.department_id = d.department_id\nJOIN locations l ON e.location_id = l.location_id\nJOIN employee_skills es ON e.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON e.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nWHERE e.salary BETWEEN 60000 AND 120000 AND e.hire_date > '2018-01-01' AND e.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND pa.start_date <= CURRENT_DATE AND (pa.end_date IS NULL OR pa.end_date > CURRENT_DATE) AND r.role_name IN ('Developer', 'Architect', 'Lead') AND e.performance_rating >= 3.5 AND e.vacation_days_used < 15\nORDER BY e.salary DESC, e.last_name ASC, e.first_name ASC\nLIMIT 75"}
{"instruction": "Optimize the SQL query", "input": "SELECT i.invoice_id, i.invoice_date, i.due_date, i.total_amount, i.status, c.customer_name, c.tax_id, a.address_line1, a.address_line2, a.city, a.postal_code, co.country_name, p.payment_terms, p.discount_percentage, b.bank_name, b.account_number, t.tax_rate, t.tax_amount, d.discount_amount, i.notes, i.po_number\nFROM invoices i\nJOIN customers c ON i.customer_id = c.customer_id\nJOIN addresses a ON i.billing_address_id = a.address_id\nJOIN countries co ON a.country_id = co.country_id\nJOIN payment_terms p ON i.payment_terms_id = p.terms_id\nLEFT JOIN bank_accounts b ON i.bank_account_id = b.account_id\nJOIN tax_calculations t ON i.invoice_id = t.invoice_id\nLEFT JOIN discount_applications d ON i.invoice_id = d.invoice_id\nWHERE i.invoice_date BETWEEN '2023-01-01' AND '2023-12-31' AND i.total_amount > 500.00 AND i.status IN ('paid', 'partially_paid') AND c.customer_type = 'business' AND co.country_name = 'United States' AND p.net_days > 30 AND t.tax_rate > 0.05 AND (d.discount_amount > 0 OR i.discount_percentage > 0) AND i.due_date > CURRENT_DATE AND i.po_number IS NOT NULL AND i.notes LIKE '%urgent%'\nORDER BY i.total_amount DESC, i.invoice_date DESC\nLIMIT 60\nOFFSET 0", "output": "SELECT i.invoice_id, i.invoice_date, i.due_date, i.total_amount, i.status, c.customer_name, c.tax_id, a.address_line1, a.address_line2, a.city, a.postal_code, co.country_name, p.payment_terms, p.discount_percentage, b.bank_name, b.account_number, t.tax_rate, t.tax_amount, d.discount_amount, i.notes, i.po_number\nFROM invoices i\nJOIN customers c ON i.customer_id = c.customer_id\nJOIN addresses a ON i.billing_address_id = a.address_id\nJOIN countries co ON a.country_id = co.country_id\nJOIN payment_terms p ON i.payment_terms_id = p.terms_id\nLEFT JOIN bank_accounts b ON i.bank_account_id = b.account_id\nJOIN tax_calculations t ON i.invoice_id = t.invoice_id\nLEFT JOIN discount_applications d ON i.invoice_id = d.invoice_id\nWHERE i.invoice_date BETWEEN '2023-01-01' AND '2023-12-31' AND i.total_amount > 500.00 AND i.status IN ('paid', 'partially_paid') AND c.customer_type = 'business' AND co.country_name = 'United States' AND p.net_days > 30 AND t.tax_rate > 0.05 AND (d.discount_amount > 0 OR i.discount_percentage > 0) AND i.due_date > CURRENT_DATE AND i.po_number IS NOT NULL AND i.notes LIKE '%urgent%'\nORDER BY i.total_amount DESC, i.invoice_date DESC\nLIMIT 60"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.status, c.client_name, c.industry, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, t.team_name, r.risk_level, r.risk_description, de.deliverable_name, de.status AS deliverable_status, res.resource_name, res.resource_type, res.cost_rate, times.hours_worked, times.overtime_hours\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nWHERE p.start_date > '2022-01-01' AND p.budget > 100000.00 AND p.status IN ('in_progress', 'on_hold') AND c.industry IN ('Technology', 'Finance', 'Healthcare') AND d.department_name = 'R&D' AND t.team_size > 5 AND r.risk_level IN ('high', 'medium') AND de.status = 'completed' AND res.resource_type = 'human' AND res.cost_rate > 50.00 AND times.hours_worked > 40 AND times.entry_date > '2023-01-01'\nORDER BY p.budget DESC, p.start_date ASC\nLIMIT 40\nOFFSET 0", "output": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.status, c.client_name, c.industry, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, t.team_name, r.risk_level, r.risk_description, de.deliverable_name, de.status AS deliverable_status, res.resource_name, res.resource_type, res.cost_rate, times.hours_worked, times.overtime_hours\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nWHERE p.start_date > '2022-01-01' AND p.budget > 100000.00 AND p.status IN ('in_progress', 'on_hold') AND c.industry IN ('Technology', 'Finance', 'Healthcare') AND d.department_name = 'R&D' AND t.team_size > 5 AND r.risk_level IN ('high', 'medium') AND de.status = 'completed' AND res.resource_type = 'human' AND res.cost_rate > 50.00 AND times.hours_worked > 40 AND times.entry_date > '2023-01-01'\nORDER BY p.budget DESC, p.start_date ASC\nLIMIT 40"}
{"instruction": "Optimize the SQL query", "input": "SELECT s.sale_id, s.sale_date, s.total_amount, s.payment_method, c.customer_name, c.membership_level, e.employee_name, st.store_name, st.location, p.product_name, p.category, sd.quantity, sd.unit_price, sd.discount_amount, prom.promotion_name, prom.discount_percentage, tax.tax_amount, tax.tax_rate, del.delivery_status, del.delivery_date\nFROM sales s\nJOIN customers c ON s.customer_id = c.customer_id\nJOIN employees e ON s.employee_id = e.employee_id\nJOIN stores st ON s.store_id = st.store_id\nJOIN sale_details sd ON s.sale_id = sd.sale_id\nJOIN products p ON sd.product_id = p.product_id\nLEFT JOIN promotions prom ON s.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON s.sale_id = tax.sale_id\nLEFT JOIN deliveries del ON s.sale_id = del.sale_id\nWHERE s.sale_date BETWEEN '2023-06-01' AND '2023-12-31' AND s.total_amount > 200.00 AND s.payment_method IN ('credit_card', 'digital_wallet') AND c.membership_level IN ('gold', 'platinum') AND e.position = 'sales_associate' AND st.location LIKE '%mall%' AND p.category = 'electronics' AND sd.quantity > 2 AND prom.discount_percentage > 10.00 AND tax.tax_rate BETWEEN 0.08 AND 0.15 AND del.delivery_status = 'delivered' AND del.delivery_date IS NOT NULL\nORDER BY s.total_amount DESC, s.sale_date DESC\nLIMIT 80\nOFFSET 0", "output": "SELECT s.sale_id, s.sale_date, s.total_amount, s.payment_method, c.customer_name, c.membership_level, e.employee_name, st.store_name, st.location, p.product_name, p.category, sd.quantity, sd.unit_price, sd.discount_amount, prom.promotion_name, prom.discount_percentage, tax.tax_amount, tax.tax_rate, del.delivery_status, del.delery_date\nFROM sales s\nJOIN customers c ON s.customer_id = c.customer_id\nJOIN employees e ON s.employee_id = e.employee_id\nJOIN stores st ON s.store_id = st.store_id\nJOIN sale_details sd ON s.sale_id = sd.sale_id\nJOIN products p ON sd.product_id = p.product_id\nLEFT JOIN promotions prom ON s.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON s.sale_id = tax.sale_id\nLEFT JOIN deliveries del ON s.sale_id = del.sale_id\nWHERE s.sale_date BETWEEN '2023-06-01' AND '2023-12-31' AND s.total_amount > 200.00 AND s.payment_method IN ('credit_card', 'digital_wallet') AND c.membership_level IN ('gold', 'platinum') AND e.position = 'sales_associate' AND st.location LIKE '%mall%' AND p.category = 'electronics' AND sd.quantity > 2 AND prom.discount_percentage > 10.00 AND tax.tax_rate BETWEEN 0.08 AND 0.15 AND del.delivery_status = 'delivered' AND del.delivery_date IS NOT NULL\nORDER BY s.total_amount DESC, s.sale_date DESC\nLIMIT 80"}
{"instruction": "Optimize the SQL query", "input": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.current_stock, inv.min_stock_level, inv.max_stock_level, inv.unit_cost, inv.total_value, wh.warehouse_name, wh.location, wh.capacity, s.supplier_name, s.contact_email, cat.category_name, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reason, emp.employee_name, aud.audit_date, aud.audit_result, ord.reorder_quantity, ord.reorder_date, ord.expected_delivery\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN reorder_orders ord ON inv.inventory_id = ord.inventory_id\nWHERE inv.current_stock < inv.min_stock_level AND inv.unit_cost > 25.00 AND wh.capacity > 1000 AND s.rating >= 4.0 AND cat.category_name = 'raw_materials' AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-01-01' AND aud.audit_result = 'passed' AND ord.reorder_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND inv.total_value > 5000.00\nORDER BY inv.current_stock ASC, inv.unit_cost DESC\nLIMIT 55\nOFFSET 0", "output": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.current_stock, inv.min_stock_level, inv.max_stock_level, inv.unit_cost, inv.total_value, wh.warehouse_name, wh.location, wh.capacity, s.supplier_name, s.contact_email, cat.category_name, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reason, emp.employee_name, aud.audit_date, aud.audit_result, ord.reorder_quantity, ord.reorder_date, ord.expected_delivery\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN reorder_orders ord ON inv.inventory_id = ord.inventory_id\nWHERE inv.current_stock < inv.min_stock_level AND inv.unit_cost > 25.00 AND wh.capacity > 1000 AND s.rating >= 4.0 AND cat.category_name = 'raw_materials' AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-01-01' AND aud.audit_result = 'passed' AND ord.reorder_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND inv.total_value > 5000.00\nORDER BY inv.current_stock ASC, inv.unit_cost DESC\nLIMIT 55"}
{"instruction": "Optimize the SQL query", "input": "SELECT loan.loan_id, loan.amount, loan.interest_rate, loan.start_date, loan.end_date, loan.status, c.customer_name, c.credit_score, e.employee_name, br.branch_name, pt.payment_term, sch.due_date, sch.amount_due, sch.paid_amount, coll.collection_status, coll.collection_date, coll.collection_amount, risk.risk_level, risk.risk_description, doc.document_name, doc.document_status, ins.insurance_amount, ins.insurance_provider\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_term_id = pt.term_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nWHERE loan.amount > 50000.00 AND loan.interest_rate < 8.00 AND loan.start_date > '2022-01-01' AND loan.status = 'active' AND c.credit_score > 700 AND br.branch_region = 'northeast' AND pt.number_of_payments > 36 AND sch.due_date BETWEEN '2023-09-01' AND '2023-12-31' AND coll.collection_status = 'pending' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_amount > 0 AND ins.insurance_provider IS NOT NULL\nORDER BY loan.amount DESC, loan.start_date ASC\nLIMIT 70\nOFFSET 0", "output": "SELECT loan.loan_id, loan.amount, loan.interest_rate, loan.start_date, loan.end_date, loan.status, c.customer_name, c.credit_score, e.employee_name, br.branch_name, pt.payment_term, sch.due_date, sch.amount_due, sch.paid_amount, coll.collection_status, coll.collection_date, coll.collection_amount, risk.risk_level, risk.risk_description, doc.document_name, doc.document_status, ins.insurance_amount, ins.insurance_provider\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_term_id = pt.term_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nWHERE loan.amount > 50000.00 AND loan.interest_rate < 8.00 AND loan.start_date > '2022-01-01' AND loan.status = 'active' AND c.credit_score > 700 AND br.branch_region = 'northeast' AND pt.number_of_payments > 36 AND sch.due_date BETWEEN '2023-09-01' AND '2023-12-31' AND coll.collection_status = 'pending' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_amount > 0 AND ins.insurance_provider IS NOT NULL\nORDER BY loan.amount DESC, loan.start_date ASC\nLIMIT 70"}
{"instruction": "Optimize the SQL query", "input": "SELECT emp.employee_id, emp.first_name, emp.last_name, emp.email, emp.department, emp.salary, emp.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name, t.team_name, per.performance_rating, per.review_date, sal.salary_amount, sal.effective_date, ben.benefit_type, ben.coverage_amount, att.attendance_date, att.hours_worked, att.overtime_hours, vac.vacation_days_used, vac.vacation_days_remaining\nFROM employees emp\nLEFT JOIN employees m ON emp.manager_id = m.employee_id\nJOIN departments d ON emp.department_id = d.department_id\nJOIN locations l ON emp.location_id = l.location_id\nJOIN employee_skills es ON emp.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON emp.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nJOIN teams t ON emp.team_id = t.team_id\nJOIN performance_reviews per ON emp.employee_id = per.employee_id\nJOIN salary_history sal ON emp.employee_id = sal.employee_id\nJOIN benefits ben ON emp.employee_id = ben.employee_id\nJOIN attendance_records att ON emp.employee_id = att.employee_id\nJOIN vacation_balances vac ON emp.employee_id = vac.employee_id\nWHERE emp.salary BETWEEN 70000 AND 150000 AND emp.hire_date > '2017-01-01' AND emp.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product Management') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND r.role_name IN ('Senior Developer', 'Architect', 'Team Lead') AND t.team_size > 8 AND per.performance_rating >= 4.0 AND sal.salary_amount > 75000 AND ben.coverage_amount > 100000 AND att.hours_worked > 160 AND vac.vacation_days_remaining > 5\nORDER BY emp.salary DESC, per.performance_rating DESC\nLIMIT 50\nOFFSET 0", "output": "SELECT emp.employee_id, emp.first_name, emp.last_name, emp.email, emp.department, emp.salary, emp.hire_date, m.first_name AS manager_first_name, m.last_name AS manager_last_name, d.department_name, l.city, l.country, s.skill_name, p.project_name, r.role_name, t.team_name, per.performance_rating, per.review_date, sal.salary_amount, sal.effective_date, ben.benefit_type, ben.coverage_amount, att.attendance_date, att.hours_worked, att.overtime_hours, vac.vacation_days_used, vac.vacation_days_remaining\nFROM employees emp\nLEFT JOIN employees m ON emp.manager_id = m.employee_id\nJOIN departments d ON emp.department_id = d.department_id\nJOIN locations l ON emp.location_id = l.location_id\nJOIN employee_skills es ON emp.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON emp.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nJOIN teams t ON emp.team_id = t.team_id\nJOIN performance_reviews per ON emp.employee_id = per.employee_id\nJOIN salary_history sal ON emp.employee_id = sal.employee_id\nJOIN benefits ben ON emp.employee_id = ben.employee_id\nJOIN attendance_records att ON emp.employee_id = att.employee_id\nJOIN vacation_balances vac ON emp.employee_id = vac.employee_id\nWHERE emp.salary BETWEEN 70000 AND 150000 AND emp.hire_date > '2017-01-01' AND emp.active = TRUE AND d.department_name IN ('Engineering', 'Data Science', 'Product Management') AND l.country = 'USA' AND s.skill_level >= 4 AND p.status = 'active' AND r.role_name IN ('Senior Developer', 'Architect', 'Team Lead') AND t.team_size > 8 AND per.performance_rating >= 4.0 AND sal.salary_amount > 75000 AND ben.coverage_amount > 100000 AND att.hours_worked > 160 AND vac.vacation_days_remaining > 5\nORDER BY emp.salary DESC, per.performance_rating DESC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.customer_id, c.customer_name, c.email, c.phone, c.membership_level, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, s.renewal_date, l.loyalty_tier, l.points_balance, l.reward_status, com.communication_type, com.communication_date, com.communication_status, fed.feedback_rating, fed.feedback_date, fed.feedback_comment, sup.support_ticket_id, sup.issue_type, sup.status AS support_status, pay.payment_method, pay.default_payment\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nLEFT JOIN customer_communications com ON c.customer_id = com.customer_id\nLEFT JOIN customer_feedback fed ON c.customer_id = fed.customer_id\nLEFT JOIN support_tickets sup ON c.customer_id = sup.customer_id\nLEFT JOIN payment_methods pay ON c.customer_id = pay.customer_id\nWHERE c.created_date > '2019-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum', 'diamond') AND com.communication_status = 'delivered' AND fed.feedback_rating >= 4 AND sup.status = 'resolved' AND pay.default_payment = TRUE AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2021-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, c.membership_level, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, s.renewal_date, l.loyalty_tier, l.points_balance, l.reward_status, com.communication_type, com.communication_date, com.communication_status, fed.feedback_rating, fed.feedback_date, fed.feedback_comment, sup.support_ticket_id, sup.issue_type, sup.status, pay.payment_method, pay.default_payment\nHAVING COUNT(o.order_id) > 10 AND SUM(o.total_amount) > 5000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 75\nOFFSET 0", "output": "SELECT c.customer_id, c.customer_name, c.email, c.phone, c.membership_level, a.street, a.city, a.state, a.zip_code, a.country, COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS lifetime_value, AVG(o.total_amount) AS avg_order_value, MAX(o.order_date) AS last_order_date, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, s.renewal_date, l.loyalty_tier, l.points_balance, l.reward_status, com.communication_type, com.communication_date, com.communication_status, fed.feedback_rating, fed.feedback_date, fed.feedback_comment, sup.support_ticket_id, sup.issue_type, sup.status AS support_status, pay.payment_method, pay.default_payment\nFROM customers c\nJOIN addresses a ON c.primary_address_id = a.address_id\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nLEFT JOIN customer_preferences p ON c.customer_id = p.customer_id\nLEFT JOIN subscriptions s ON c.customer_id = s.customer_id\nLEFT JOIN loyalty_programs l ON c.customer_id = l.customer_id\nLEFT JOIN customer_communications com ON c.customer_id = com.customer_id\nLEFT JOIN customer_feedback fed ON c.customer_id = fed.customer_id\nLEFT JOIN support_tickets sup ON c.customer_id = sup.customer_id\nLEFT JOIN payment_methods pay ON c.customer_id = pay.customer_id\nWHERE c.created_date > '2019-01-01' AND c.active = TRUE AND a.country = 'USA' AND o.status = 'completed' AND p.preference_category = 'product_category' AND s.subscription_status = 'active' AND l.loyalty_tier IN ('gold', 'platinum', 'diamond') AND com.communication_status = 'delivered' AND fed.feedback_rating >= 4 AND sup.status = 'resolved' AND pay.default_payment = TRUE AND c.email IS NOT NULL AND c.phone IS NOT NULL AND o.total_amount > 0 AND o.order_date > '2021-01-01'\nGROUP BY c.customer_id, c.customer_name, c.email, c.phone, c.membership_level, a.street, a.city, a.state, a.zip_code, a.country, p.preference_category, p.preference_value, s.subscription_type, s.subscription_status, s.renewal_date, l.loyalty_tier, l.points_balance, l.reward_status, com.communication_type, com.communication_date, com.communication_status, fed.feedback_rating, fed.feedback_date, fed.feedback_comment, sup.support_ticket_id, sup.issue_type, sup.status, pay.payment_method, pay.default_payment\nHAVING COUNT(o.order_id) > 10 AND SUM(o.total_amount) > 5000.00\nORDER BY lifetime_value DESC, total_orders DESC\nLIMIT 75"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, p.sku, p.upc, p.weight, p.dimensions, p.warranty_period, p.release_date, p.discontinued, c.category_name, c.category_description, s.supplier_name, s.contact_name, s.contact_email, s.phone, s.country, b.brand_name, b.brand_website, inv.warehouse_name, inv.location, inv.current_stock, inv.min_stock_level, inv.max_stock_level, rev.review_rating, rev.review_count, rev.average_rating, sale.sale_price, sale.sale_start_date, sale.sale_end_date, img.image_url, img.image_type, doc.document_name, doc.document_type, rel.related_product_id, rel.relation_type\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nJOIN inventory_levels inv ON p.product_id = inv.product_id\nLEFT JOIN product_reviews rev ON p.product_id = rev.product_id\nLEFT JOIN product_sales sale ON p.product_id = sale.product_id\nLEFT JOIN product_images img ON p.product_id = img.product_id\nLEFT JOIN product_documents doc ON p.product_id = doc.product_id\nLEFT JOIN product_relationships rel ON p.product_id = rel.product_id\nWHERE p.price BETWEEN 25.00 AND 1000.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.brand_rating >= 4.0 AND inv.current_stock > inv.min_stock_level AND rev.review_rating >= 4.5 AND sale.sale_price IS NOT NULL AND img.image_type = 'main' AND doc.document_type = 'manual' AND rel.relation_type = 'accessory' AND p.weight < 10.0 AND p.warranty_period > 12 AND p.release_date > '2021-01-01'\nORDER BY p.price DESC, rev.average_rating DESC\nLIMIT 60\nOFFSET 0", "output": "SELECT p.product_id, p.product_name, p.description, p.price, p.stock_quantity, p.sku, p.upc, p.weight, p.dimensions, p.warranty_period, p.release_date, p.discontinued, c.category_name, c.category_description, s.supplier_name, s.contact_name, s.contact_email, s.phone, s.country, b.brand_name, b.brand_website, inv.warehouse_name, inv.location, inv.current_stock, inv.min_stock_level, inv.max_stock_level, rev.review_rating, rev.review_count, rev.average_rating, sale.sale_price, sale.sale_start_date, sale.sale_end_date, img.image_url, img.image_type, doc.document_name, doc.document_type, rel.related_product_id, rel.relation_type\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nJOIN brands b ON p.brand_id = b.brand_id\nJOIN inventory_levels inv ON p.product_id = inv.product_id\nLEFT JOIN product_reviews rev ON p.product_id = rev.product_id\nLEFT JOIN product_sales sale ON p.product_id = sale.product_id\nLEFT JOIN product_images img ON p.product_id = img.product_id\nLEFT JOIN product_documents doc ON p.product_id = doc.product_id\nLEFT JOIN product_relationships rel ON p.product_id = rel.product_id\nWHERE p.price BETWEEN 25.00 AND 1000.00 AND p.stock_quantity > 0 AND p.discontinued = FALSE AND c.category_name ILIKE '%electronics%' AND s.country = 'USA' AND b.brand_rating >= 4.0 AND inv.current_stock > inv.min_stock_level AND rev.review_rating >= 4.5 AND sale.sale_price IS NOT NULL AND img.image_type = 'main' AND doc.document_type = 'manual' AND rel.relation_type = 'accessory' AND p.weight < 10.0 AND p.warranty_period > 12 AND p.release_date > '2021-01-01'\nORDER BY p.price DESC, rev.average_rating DESC\nLIMIT 60"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT u.user_id, u.username, u.email\nFROM users u\nWHERE u.user_id NOT IN (SELECT ul.user_id FROM user_logins ul WHERE ul.login_date > CURDATE() - INTERVAL 3 MONTH AND ul.login_type = 'mobile') AND u.created_at BETWEEN '2022-01-01' AND '2022-12-31' AND EXISTS (SELECT 1 FROM user_profiles up WHERE up.user_id = u.user_id AND up.preference = 'newsletter') AND u.status = 'active'\nORDER BY u.username\nLIMIT 50\nOFFSET 10 ;", "output": "SELECT u.user_id, u.username, u.email\nFROM users AS u\nLEFT JOIN user_logins AS ul ON u.user_id = ul.user_id AND ul.login_date > CURDATE() - INTERVAL 3 MONTH AND ul.login_type = 'mobile'\nJOIN user_profiles AS up ON u.user_id = up.user_id\nWHERE u.created_at BETWEEN '2022-01-01' AND '2022-12-31' AND up.preference = 'newsletter' AND u.status = 'active' AND ul.user_id IS NULL\nORDER BY u.username\nLIMIT 50\nOFFSET 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.customer_name, SUM(o.total_amount) AS total_spent, COUNT(o.order_id) AS total_orders\nFROM customers c\nLEFT JOIN orders o ON c.customer_id = o.customer_id\nWHERE c.registration_date > '2021-01-01' AND o.order_date > '2022-01-01' AND o.total_amount IS NOT NULL AND c.customer_id IN (SELECT DISTINCT customer_id FROM loyalty_programs WHERE LEVEL = 'Gold')\nGROUP BY c.customer_name\nHAVING SUM(o.total_amount) > 1000 AND COUNT(o.order_id) >= 5\nORDER BY total_spent DESC\nLIMIT 20 ;", "output": "SELECT c.customer_name, SUM(o.total_amount) AS total_spent, COUNT(o.order_id) AS total_orders\nFROM customers AS c\nLEFT JOIN orders AS o ON c.customer_id = o.customer_id\nJOIN loyalty_programs AS lp ON c.customer_id = lp.customer_id\nWHERE c.registration_date > '2021-01-01' AND o.order_date > '2022-01-01' AND o.total_amount IS NOT NULL AND lp.level = 'Gold'\nGROUP BY c.customer_name\nHAVING SUM(o.total_amount) > 1000 AND COUNT(o.order_id) >= 5\nORDER BY total_spent DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_name, p.price, (SELECT AVG(price) FROM products WHERE category_id = p.category_id) AS avg_category_price, (SELECT COUNT(DISTINCT customer_id) FROM order_items oi JOIN orders o ON oi.order_id = o.order_id WHERE oi.product_id = p.product_id AND o.order_date BETWEEN '2023-01-01' AND '2023-06-30') AS unique_buyers\nFROM products p\nWHERE p.category_id IN (SELECT category_id FROM categories WHERE category_name LIKE '%Electronic%') AND p.stock_quantity < 100 AND p.price > 500\nORDER BY unique_buyers DESC, p.price DESC\nLIMIT 15 ;", "output": "WITH CategoryAvgPrice AS (SELECT category_id, AVG(price) AS avg_category_price FROM products GROUP BY category_id), UniqueBuyers AS (SELECT oi.product_id, COUNT(DISTINCT o.customer_id) AS unique_buyers FROM order_items AS oi JOIN orders AS o ON oi.order_id = o.order_id WHERE o.order_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY oi.product_id)\nSELECT p.product_name, p.price, cap.avg_category_price, ub.unique_buyers\nFROM products AS p\nJOIN categories AS c ON p.category_id = c.category_id\nLEFT JOIN CategoryAvgPrice AS cap ON p.category_id = cap.category_id\nLEFT JOIN UniqueBuyers AS ub ON p.product_id = ub.product_id\nWHERE c.category_name LIKE '%Electronic%' AND p.stock_quantity < 100 AND p.price > 500\nORDER BY ub.unique_buyers DESC, p.price DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.employee_id, e.first_name, e.last_name, d.department_name, (SELECT COUNT(*) FROM employee_projects ep WHERE ep.employee_id = e.employee_id) AS projects_count, (SELECT AVG(feedback_score) FROM project_feedback pf WHERE pf.project_id IN (SELECT project_id FROM employee_projects WHERE employee_id = e.employee_id)) AS avg_feedback\nFROM employees e\nJOIN departments d ON e.department_id = d.department_id\nWHERE e.hire_date < '2020-01-01' AND e.salary > 70000 AND d.location = 'Headquarters' AND EXISTS (SELECT 1 FROM performance_reviews pr WHERE pr.employee_id = e.employee_id AND pr.review_date > '2023-01-01' AND pr.rating >= 4)\nORDER BY projects_count DESC, avg_feedback DESC\nLIMIT 10 ;", "output": "WITH EmployeeProjectsCount AS (SELECT employee_id, COUNT(*) AS projects_count FROM employee_projects GROUP BY employee_id), ProjectFeedbackAvg AS (SELECT ep.employee_id, AVG(pf.feedback_score) AS avg_feedback FROM employee_projects AS ep JOIN project_feedback AS pf ON ep.project_id = pf.project_id GROUP BY ep.employee_id)\nSELECT e.employee_id, e.first_name, e.last_name, d.department_name, epc.projects_count, pfa.avg_feedback\nFROM employees AS e\nJOIN departments AS d ON e.department_id = d.department_id\nLEFT JOIN EmployeeProjectsCount AS epc ON e.employee_id = epc.employee_id\nLEFT JOIN ProjectFeedbackAvg AS pfa ON e.employee_id = pfa.employee_id\nJOIN performance_reviews AS pr ON e.employee_id = pr.employee_id\nWHERE e.hire_date < '2020-01-01' AND e.salary > 70000 AND d.location = 'Headquarters' AND pr.review_date > '2023-01-01' AND pr.rating >= 4\nORDER BY epc.projects_count DESC, pfa.avg_feedback DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.student_name, s.student_email, c.course_name\nFROM students s\nJOIN enrollments en ON s.student_id = en.student_id\nJOIN courses c ON en.course_id = c.course_id\nWHERE s.graduation_year = 2025 AND s.major = 'Computer Science' AND c.course_credits > 3 AND c.course_id NOT IN (SELECT assignment_id FROM assignments WHERE grade < 60) AND EXISTS (SELECT 1 FROM student_awards sa WHERE sa.student_id = s.student_id AND sa.award_year = 2023)\nORDER BY s.student_name ASC\nLIMIT 25 ;", "output": "SELECT s.student_name, s.student_email, c.course_name\nFROM students AS s\nJOIN enrollments AS en ON s.student_id = en.student_id\nJOIN courses AS c ON en.course_id = c.course_id\nLEFT JOIN assignments AS a ON c.course_id = a.assignment_id AND a.grade < 60\nJOIN student_awards AS sa ON s.student_id = sa.student_id\nWHERE s.graduation_year = 2025 AND s.major = 'Computer Science' AND c.course_credits > 3 AND a.assignment_id IS NULL AND sa.award_year = 2023\nORDER BY s.student_name ASC\nLIMIT 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT a.artist_name, COUNT(t.track_id) AS total_tracks, SUM(t.duration) AS total_duration\nFROM artists a\nLEFT JOIN albums al ON a.artist_id = al.artist_id\nLEFT JOIN tracks t ON al.album_id = t.album_id\nWHERE a.country = 'USA' AND al.release_year BETWEEN 2010 AND 2020 AND t.genre = 'Rock' AND a.artist_id NOT IN (SELECT artist_id FROM artist_awards WHERE award_year = 2023)\nGROUP BY a.artist_name\nHAVING COUNT(t.track_id) > 100 AND SUM(t.duration) > 3600\nORDER BY total_tracks DESC\nLIMIT 10 ;", "output": "SELECT a.artist_name, COUNT(t.track_id) AS total_tracks, SUM(t.duration) AS total_duration\nFROM artists AS a\nLEFT JOIN albums AS al ON a.artist_id = al.artist_id\nLEFT JOIN tracks AS t ON al.album_id = t.album_id\nLEFT JOIN artist_awards AS aa ON a.artist_id = aa.artist_id AND aa.award_year = 2023\nWHERE a.country = 'USA' AND al.release_year BETWEEN 2010 AND 2020 AND t.genre = 'Rock' AND aa.artist_id IS NULL\nGROUP BY a.artist_name\nHAVING COUNT(t.track_id) > 100 AND SUM(t.duration) > 3600\nORDER BY total_tracks DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, c.customer_name, p.product_name, oi.quantity\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN order_items oi ON o.order_id = oi.order_id\nJOIN products p ON oi.product_id = p.product_id\nWHERE c.country = 'France' AND p.category_id IN (SELECT category_id FROM categories WHERE category_description LIKE '%Electronics%') AND o.order_date BETWEEN '2023-01-01' AND '2023-03-31' AND oi.price * oi.quantity > 500\nORDER BY o.order_date ASC, c.customer_name ASC\nLIMIT 50 ;", "output": "SELECT o.order_id, c.customer_name, p.product_name, oi.quantity\nFROM orders AS o\nJOIN customers AS c ON o.customer_id = c.customer_id\nJOIN order_items AS oi ON o.order_id = oi.order_id\nJOIN products AS p ON oi.product_id = p.product_id\nJOIN categories AS cat ON p.category_id = cat.category_id\nWHERE c.country = 'France' AND cat.category_description LIKE '%Electronics%' AND o.order_date BETWEEN '2023-01-01' AND '2023-03-31' AND oi.price * oi.quantity > 500\nORDER BY o.order_date ASC, c.customer_name ASC\nLIMIT 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT t.ticket_id, t.subject, u.username AS reporter_name, a.username AS assignee_name\nFROM tickets t\nJOIN users u ON t.reporter_id = u.user_id\nLEFT JOIN users a ON t.assignee_id = a.user_id\nWHERE t.status = 'Open' AND t.priority IN ('High', 'Critical') AND t.created_at > CURDATE() - INTERVAL 7 DAY AND t.ticket_id NOT IN (SELECT comment_ticket_id FROM ticket_comments WHERE comment_date > CURDATE() - INTERVAL 1 DAY)\nORDER BY t.priority DESC, t.created_at ASC\nLIMIT 20 ;", "output": "SELECT t.ticket_id, t.subject, u.username AS reporter_name, a.username AS assignee_name\nFROM tickets AS t\nJOIN users AS u ON t.reporter_id = u.user_id\nLEFT JOIN users AS a ON t.assignee_id = a.user_id\nLEFT JOIN ticket_comments AS tc ON t.ticket_id = tc.comment_ticket_id AND tc.comment_date > CURDATE() - INTERVAL 1 DAY\nWHERE t.status = 'Open' AND t.priority IN ('High', 'Critical') AND t.created_at > CURDATE() - INTERVAL 7 DAY AND tc.comment_ticket_id IS NULL\nORDER BY t.priority DESC, t.created_at ASC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT b.book_title, b.isbn, au.author_name\nFROM books b\nJOIN authors au ON b.author_id = au.author_id\nWHERE b.publication_year BETWEEN 2010 AND 2015 AND au.country = 'USA' AND EXISTS (SELECT 1 FROM book_reviews br WHERE br.book_id = b.book_id AND br.rating >= 4 AND br.review_date > '2023-01-01') AND b.genre IN ('Fiction', 'Science Fiction')\nORDER BY b.publication_year DESC, b.book_title ASC\nLIMIT 30 ;", "output": "SELECT b.book_title, b.isbn, au.author_name\nFROM books AS b\nJOIN authors AS au ON b.author_id = au.author_id\nJOIN book_reviews AS br ON b.book_id = br.book_id\nWHERE b.publication_year BETWEEN 2010 AND 2015 AND au.country = 'USA' AND br.rating >= 4 AND br.review_date > '2023-01-01' AND b.genre IN ('Fiction', 'Science Fiction')\nORDER BY b.publication_year DESC, b.book_title ASC\nLIMIT 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT s.store_name, s.city, SUM(t.sale_amount) AS total_sales, COUNT(t.transaction_id) AS total_transactions\nFROM stores s\nLEFT JOIN transactions t ON s.store_id = t.store_id\nWHERE s.region = 'East' AND t.transaction_date BETWEEN '2023-01-01' AND '2023-06-30' AND t.payment_method = 'Credit Card' AND s.store_id IN (SELECT store_id FROM store_employees WHERE employee_count > 50)\nGROUP BY s.store_name, s.city\nHAVING SUM(t.sale_amount) > 100000 AND COUNT(t.transaction_id) > 1000\nORDER BY total_sales DESC\nLIMIT 10 ;", "output": "SELECT s.store_name, s.city, SUM(t.sale_amount) AS total_sales, COUNT(t.transaction_id) AS total_transactions\nFROM stores AS s\nLEFT JOIN transactions AS t ON s.store_id = t.store_id\nJOIN store_employees AS se ON s.store_id = se.store_id\nWHERE s.region = 'East' AND t.transaction_date BETWEEN '2023-01-01' AND '2023-06-30' AND t.payment_method = 'Credit Card' AND se.employee_count > 50\nGROUP BY s.store_name, s.city\nHAVING SUM(t.sale_amount) > 100000 AND COUNT(t.transaction_id) > 1000\nORDER BY total_sales DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.company_name, c.industry, (SELECT COUNT(DISTINCT p.project_id) FROM projects p WHERE p.client_id = c.company_id AND p.status = 'Completed' AND p.end_date > '2022-01-01') AS completed_projects, (SELECT AVG(pr.rating) FROM project_reviews pr JOIN projects p ON pr.project_id = p.project_id WHERE p.client_id = c.company_id) AS avg_client_rating\nFROM companies c\nWHERE c.company_size > 100 AND c.industry IN ('Technology', 'Finance') AND EXISTS (SELECT 1 FROM company_partners cp WHERE cp.company_id = c.company_id AND cp.partnership_type = 'Strategic')\nORDER BY completed_projects DESC, avg_client_rating DESC\nLIMIT 10 ;", "output": "WITH CompletedProjects AS (SELECT p.client_id, COUNT(DISTINCT p.project_id) AS completed_projects FROM projects AS p WHERE p.status = 'Completed' AND p.end_date > '2022-01-01' GROUP BY p.client_id), AvgClientRating AS (SELECT p.client_id, AVG(pr.rating) AS avg_client_rating FROM project_reviews AS pr JOIN projects AS p ON pr.project_id = p.project_id GROUP BY p.client_id)\nSELECT c.company_name, c.industry, cp.completed_projects, acr.avg_client_rating\nFROM companies AS c\nLEFT JOIN CompletedProjects AS cp ON c.company_id = cp.client_id\nLEFT JOIN AvgClientRating AS acr ON c.company_id = acr.client_id\nJOIN company_partners AS CMP ON c.company_id = cmp.company_id\nWHERE c.company_size > 100 AND c.industry IN ('Technology', 'Finance') AND cmp.partnership_type = 'Strategic'\nORDER BY completed_projects DESC, avg_client_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.username, u.registration_date\nFROM users u\nWHERE u.registration_date BETWEEN '2022-01-01' AND '2022-12-31' AND u.user_id NOT IN (SELECT DISTINCT a.user_id FROM user_activity a WHERE a.activity_type = 'post_created' AND a.activity_date > '2023-01-01') AND EXISTS (SELECT 1 FROM user_roles ur JOIN ROLES r ON ur.role_id = r.role_id WHERE ur.user_id = u.user_id AND r.role_name = 'Admin')\nORDER BY u.registration_date DESC\nLIMIT 50 ;", "output": "SELECT u.username, u.registration_date\nFROM users AS u\nLEFT JOIN user_activity AS a ON u.user_id = a.user_id AND a.activity_type = 'post_created' AND a.activity_date > '2023-01-01'\nJOIN user_roles AS ur ON u.user_id = ur.user_id\nJOIN ROLES AS r ON ur.role_id = r.role_id\nWHERE u.registration_date BETWEEN '2022-01-01' AND '2022-12-31' AND a.user_id IS NULL AND r.role_name = 'Admin'\nORDER BY u.registration_date DESC\nLIMIT 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_name, c.category_name, s.supplier_name\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nWHERE p.price > 100 AND c.category_name NOT LIKE '%Food%' AND s.supplier_id IN (SELECT supplier_id FROM supplier_contracts WHERE contract_end_date > CURDATE()) AND p.stock_quantity < 500\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100 ;", "output": "SELECT p.product_name, c.category_name, s.supplier_name\nFROM products AS p\nJOIN categories AS c ON p.category_id = c.category_id\nJOIN suppliers AS s ON p.supplier_id = s.supplier_id\nJOIN supplier_contracts AS sc ON s.supplier_id = sc.supplier_id\nWHERE p.price > 100 AND c.category_name NOT LIKE '%Food%' AND sc.contract_end_date > CURDATE() AND p.stock_quantity < 500\nORDER BY p.price DESC, p.product_name ASC\nLIMIT 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, c.customer_name\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nWHERE o.order_date >= '2023-01-01' AND c.customer_id NOT IN (SELECT customer_id FROM customer_payments WHERE payment_status = 'Failed' AND payment_date > '2023-01-01') AND EXISTS (SELECT 1 FROM order_items oi WHERE oi.order_id = o.order_id AND oi.product_id IN (SELECT product_id FROM products WHERE product_type = 'Digital'))\nORDER BY o.order_date DESC\nLIMIT 20 ;", "output": "SELECT o.order_id, o.order_date, c.customer_name\nFROM orders AS o\nJOIN customers AS c ON o.customer_id = c.customer_id\nLEFT JOIN customer_payments AS cp ON c.customer_id = cp.customer_id AND cp.payment_status = 'Failed' AND cp.payment_date > '2023-01-01'\nJOIN order_items AS oi ON o.order_id = oi.order_id\nJOIN products AS p ON oi.product_id = p.product_id\nWHERE o.order_date >= '2023-01-01' AND cp.customer_id IS NULL AND p.product_type = 'Digital'\nORDER BY o.order_date DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT e.employee_id, e.first_name, e.last_name\nFROM employees e\nWHERE e.department_id IN (SELECT department_id FROM departments WHERE LOCATION = 'London' OR LOCATION = 'Paris') AND e.hire_date BETWEEN '2018-01-01' AND '2022-12-31' AND e.salary > (SELECT AVG(salary) FROM employees WHERE department_id = e.department_id) AND EXISTS (SELECT 1 FROM employee_certifications ec WHERE ec.employee_id = e.employee_id AND ec.certification_date > '2023-01-01')\nORDER BY e.last_name ASC, e.first_name ASC\nLIMIT 30 ;", "output": "WITH DepartmentLocations AS (SELECT department_id FROM departments WHERE LOCATION = 'London' OR LOCATION = 'Paris'), AvgDeptSalary AS (SELECT department_id, AVG(salary) AS avg_salary FROM employees GROUP BY department_id)\nSELECT e.employee_id, e.first_name, e.last_name\nFROM employees AS e\nJOIN DepartmentLocations AS dl ON e.department_id = dl.department_id\nJOIN AvgDeptSalary AS ads ON e.department_id = ads.department_id\nJOIN employee_certifications AS ec ON e.employee_id = ec.employee_id\nWHERE e.hire_date BETWEEN '2018-01-01' AND '2022-12-31' AND e.salary > ads.avg_salary AND ec.certification_date > '2023-01-01'\nORDER BY e.last_name ASC, e.first_name ASC\nLIMIT 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT t1.col1, t1.col2, t2.col3\nFROM table1 t1\nJOIN table2 t2 ON t1.id = t2.t1_id\nWHERE t1.col4 = 'Active' AND t2.col5 IN (SELECT col_x FROM another_table WHERE col_y > 100) AND t1.col6 LIKE '%pattern%' AND t2.col7 BETWEEN '2023-01-01' AND '2023-03-31'\nORDER BY t1.col1 DESC, t2.col3 ASC\nLIMIT 100 ;", "output": "SELECT t1.col1, t1.col2, t2.col3\nFROM table1 AS t1\nJOIN table2 AS t2 ON t1.id = t2.t1_id\nJOIN another_table AS AT ON t2.col5 = at.col_x\nWHERE t1.col4 = 'Active' AND at.col_y > 100 AND t1.col6 LIKE '%pattern%' AND t2.col7 BETWEEN '2023-01-01' AND '2023-03-31'\nORDER BY t1.col1 DESC, t2.col3 ASC\nLIMIT 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.username, COUNT(p.post_id) AS total_posts, AVG(c.comment_rating) AS avg_comment_rating\nFROM users u\nLEFT JOIN posts p ON u.user_id = p.user_id\nLEFT JOIN comments c ON p.post_id = c.post_id\nWHERE u.status = 'active' AND p.created_at > '2023-01-01' AND c.comment_text LIKE '%important%'\nGROUP BY u.username\nHAVING COUNT(p.post_id) > 5 AND AVG(c.comment_rating) > 3\nORDER BY total_posts DESC, avg_comment_rating DESC\nLIMIT 20 ;", "output": "SELECT u.username, COUNT(p.post_id) AS total_posts, AVG(c.comment_rating) AS avg_comment_rating\nFROM users AS u\nLEFT JOIN posts AS p ON u.user_id = p.user_id\nLEFT JOIN comments AS c ON p.post_id = c.post_id\nWHERE u.status = 'active' AND p.created_at > '2023-01-01' AND c.comment_text LIKE '%important%'\nGROUP BY u.username\nHAVING COUNT(p.post_id) > 5 AND AVG(c.comment_rating) > 3\nORDER BY total_posts DESC, avg_comment_rating DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT product_name, manufacturer, price\nFROM products\nWHERE category_id = (SELECT category_id FROM categories WHERE category_name = 'Electronics') AND price > (SELECT AVG(price) FROM products WHERE manufacturer = 'Sony') AND stock_quantity > 0 AND EXISTS (SELECT 1 FROM product_reviews pr WHERE pr.product_id = products.product_id AND pr.rating = 5)\nORDER BY price DESC\nLIMIT 20 ;", "output": "WITH AvgSonyPrice AS (SELECT AVG(price) AS avg_price FROM products WHERE manufacturer = 'Sony')\nSELECT p.product_name, p.manufacturer, p.price\nFROM products AS p\nJOIN categories AS cat ON p.category_id = cat.category_id\nJOIN product_reviews AS pr ON p.product_id = pr.product_id, AvgSonyPrice AS asp\nWHERE cat.category_name = 'Electronics' AND p.price > asp.avg_price AND p.stock_quantity > 0 AND pr.rating = 5\nORDER BY p.price DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT l.location_name, l.city, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.location_id = l.location_id) AS employee_count\nFROM locations l\nWHERE l.region = 'West' AND l.location_id NOT IN (SELECT office_id FROM office_rentals WHERE rental_end_date > CURDATE()) AND EXISTS (SELECT 1 FROM location_services ls WHERE ls.location_id = l.location_id AND ls.service_type = 'Premium')\nORDER BY employee_count DESC\nLIMIT 15 ;", "output": "SELECT l.location_name, l.city, COUNT(e.employee_id) AS employee_count\nFROM locations AS l\nLEFT JOIN employees AS e ON l.location_id = e.location_id\nLEFT JOIN office_rentals AS OR ON l.location_id = or.office_id AND or.rental_end_date > CURDATE()\nJOIN location_services AS ls ON l.location_id = ls.location_id\nWHERE l.region = 'West' AND or.office_id IS NULL AND ls.service_type = 'Premium'\nGROUP BY l.location_name, l.city\nORDER BY employee_count DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT a.agent_id, a.agent_name, COUNT(c.client_id) AS total_clients, SUM(t.transaction_amount) AS total_commissions\nFROM agents a\nLEFT JOIN clients c ON a.agent_id = c.agent_id\nLEFT JOIN transactions t ON c.client_id = t.client_id\nWHERE a.hire_date < '2015-01-01' AND c.client_status = 'Active' AND t.transaction_date BETWEEN '2023-01-01' AND '2023-12-31' AND a.agent_id NOT IN (SELECT agent_id FROM agent_warnings WHERE warning_date > '2023-01-01')\nGROUP BY a.agent_id, a.agent_name\nHAVING COUNT(c.client_id) > 10 AND SUM(t.transaction_amount) > 50000\nORDER BY total_commissions DESC\nLIMIT 10 ;", "output": "SELECT a.agent_id, a.agent_name, COUNT(c.client_id) AS total_clients, SUM(t.transaction_amount) AS total_commissions\nFROM agents AS a\nLEFT JOIN clients AS c ON a.agent_id = c.agent_id\nLEFT JOIN transactions AS t ON c.client_id = t.client_id\nLEFT JOIN agent_warnings AS aw ON a.agent_id = aw.agent_id AND aw.warning_date > '2023-01-01'\nWHERE a.hire_date < '2015-01-01' AND c.client_status = 'Active' AND t.transaction_date BETWEEN '2023-01-01' AND '2023-12-31' AND aw.agent_id IS NULL\nGROUP BY a.agent_id, a.agent_name\nHAVING COUNT(c.client_id) > 10 AND SUM(t.transaction_amount) > 50000\nORDER BY total_commissions DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.store_id, s.store_name, s.address\nFROM stores s\nWHERE s.city = 'Houston' AND s.store_id IN (SELECT store_id FROM daily_sales ds WHERE ds.sale_date = CURDATE() AND ds.total_sales > 10000) AND EXISTS (SELECT 1 FROM store_feedback sf WHERE sf.store_id = s.store_id AND sf.feedback_score >= 4.5) AND s.store_type = 'Supermarket'\nORDER BY s.store_name ASC\nLIMIT 10 ;", "output": "SELECT s.store_id, s.store_name, s.address\nFROM stores AS s\nJOIN daily_sales AS ds ON s.store_id = ds.store_id\nJOIN store_feedback AS sf ON s.store_id = sf.store_id\nWHERE s.city = 'Houston' AND ds.sale_date = CURDATE() AND ds.total_sales > 10000 AND sf.feedback_score >= 4.5 AND s.store_type = 'Supermarket'\nORDER BY s.store_name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT d.department_name, AVG(e.salary) AS avg_dept_salary, COUNT(e.employee_id) AS num_employees\nFROM departments d\nJOIN employees e ON d.department_id = e.department_id\nWHERE e.hire_date BETWEEN '2020-01-01' AND '2022-12-31' AND e.position NOT LIKE '%Trainee%' AND d.department_id NOT IN (SELECT department_id FROM department_budgets WHERE budget_year = 2023 AND actual_spend > allocated_budget)\nGROUP BY d.department_name\nHAVING AVG(e.salary) > 60000 AND COUNT(e.employee_id) > 5\nORDER BY avg_dept_salary DESC\nLIMIT 10 ;", "output": "SELECT d.department_name, AVG(e.salary) AS avg_dept_salary, COUNT(e.employee_id) AS num_employees\nFROM departments AS d\nJOIN employees AS e ON d.department_id = e.department_id\nLEFT JOIN department_budgets AS db ON d.department_id = db.department_id AND db.budget_year = 2023 AND db.actual_spend > db.allocated_budget\nWHERE e.hire_date BETWEEN '2020-01-01' AND '2022-12-31' AND e.position NOT LIKE '%Trainee%' AND db.department_id IS NULL\nGROUP BY d.department_name\nHAVING AVG(e.salary) > 60000 AND COUNT(e.employee_id) > 5\nORDER BY avg_dept_salary DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT c.campaign_name, c.start_date, c.end_date\nFROM campaigns c\nWHERE c.campaign_type = 'Email' AND c.status = 'Active' AND c.start_date > '2023-01-01' AND EXISTS (SELECT 1 FROM campaign_metrics cm WHERE cm.campaign_id = c.campaign_id AND cm.conversion_rate > 0.05 AND cm.cost_per_conversion < 10) AND c.campaign_id NOT IN (SELECT campaign_id FROM campaign_issues ci WHERE ci.issue_severity = 'Critical')\nORDER BY c.start_date DESC\nLIMIT 20 ;", "output": "SELECT c.campaign_name, c.start_date, c.end_date\nFROM campaigns AS c\nJOIN campaign_metrics AS cm ON c.campaign_id = cm.campaign_id\nLEFT JOIN campaign_issues AS ci ON c.campaign_id = ci.campaign_id AND ci.issue_severity = 'Critical'\nWHERE c.campaign_type = 'Email' AND c.status = 'Active' AND c.start_date > '2023-01-01' AND cm.conversion_rate > 0.05 AND cm.cost_per_conversion < 10 AND ci.campaign_id IS NULL\nORDER BY c.start_date DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, u.username, COUNT(p.photo_id) AS total_photos, SUM(p.views) AS total_views\nFROM users u\nLEFT JOIN photos p ON u.user_id = p.user_id\nWHERE u.country = 'Canada' AND u.registration_date BETWEEN '2021-01-01' AND '2022-12-31' AND p.upload_date > '2023-01-01' AND p.photo_id NOT IN (SELECT flag_photo_id FROM flagged_photos WHERE flag_reason = 'Inappropriate')\nGROUP BY u.user_id, u.username\nHAVING COUNT(p.photo_id) > 10 AND SUM(p.views) > 10000\nORDER BY total_views DESC\nLIMIT 15 ;", "output": "SELECT u.user_id, u.username, COUNT(p.photo_id) AS total_photos, SUM(p.views) AS total_views\nFROM users AS u\nLEFT JOIN photos AS p ON u.user_id = p.user_id\nLEFT JOIN flagged_photos AS fp ON p.photo_id = fp.flag_photo_id AND fp.flag_reason = 'Inappropriate'\nWHERE u.country = 'Canada' AND u.registration_date BETWEEN '2021-01-01' AND '2022-12-31' AND p.upload_date > '2023-01-01' AND fp.flag_photo_id IS NULL\nGROUP BY u.user_id, u.username\nHAVING COUNT(p.photo_id) > 10 AND SUM(p.views) > 10000\nORDER BY total_views DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, o.order_date, o.total_amount, o.status, o.shipping_cost, o.tax_amount, o.discount_amount, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.payment_method, p.payment_status, p.transaction_id, s.shipping_method, s.tracking_number, s.carrier, s.estimated_delivery, s.actual_delivery_date, i.item_name, i.quantity, i.unit_price, i.discount_percentage, prom.promotion_name, prom.discount_type, tax.tax_rate, tax.tax_amount, ref.referral_source, ref.campaign_name\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nJOIN order_items i ON o.order_id = i.order_id\nLEFT JOIN promotions prom ON o.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON o.order_id = tax.order_id\nLEFT JOIN referral_sources REF ON o.referral_id = ref.referral_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 150.00 AND o.status IN ('completed', 'shipped', 'delivered') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX', 'FL', 'IL') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority', 'overnight') AND s.estimated_delivery > CURRENT_DATE - INTERVAL '30 days' AND i.quantity > 1 AND prom.discount_type = 'percentage' AND tax.tax_rate BETWEEN 0.05 AND 0.15 AND ref.campaign_name IS NOT NULL\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 100\nOFFSET 0", "output": "SELECT o.order_id, o.order_date, o.total_amount, o.status, o.shipping_cost, o.tax_amount, o.discount_amount, c.customer_name, c.email, c.phone, a.street, a.city, a.state, a.zip_code, a.country, p.payment_method, p.payment_status, p.transaction_id, s.shipping_method, s.tracking_number, s.carrier, s.estimated_delivery, s.actual_delivery_date, i.item_name, i.quantity, i.unit_price, i.discount_percentage, prom.promotion_name, prom.discount_type, tax.tax_rate, tax.tax_amount, ref.referral_source, ref.campaign_name\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN addresses a ON o.shipping_address_id = a.address_id\nJOIN payments p ON o.order_id = p.order_id\nJOIN shipments s ON o.order_id = s.order_id\nJOIN order_items i ON o.order_id = i.order_id\nLEFT JOIN promotions prom ON o.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON o.order_id = tax.order_id\nLEFT JOIN referral_sources REF ON o.referral_id = ref.referral_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-12-31' AND o.total_amount > 150.00 AND o.status IN ('completed', 'shipped', 'delivered') AND c.country = 'USA' AND a.state IN ('CA', 'NY', 'TX', 'FL', 'IL') AND p.payment_status = 'completed' AND s.shipping_method IN ('express', 'priority', 'overnight') AND s.estimated_delivery > CURRENT_DATE - INTERVAL '30 days' AND i.quantity > 1 AND prom.discount_type = 'percentage' AND tax.tax_rate BETWEEN 0.05 AND 0.15 AND ref.campaign_name IS NOT NULL\nORDER BY o.total_amount DESC, o.order_date DESC\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.sku, inv.upc, inv.current_stock, inv.min_stock_level, inv.max_stock_level, inv.unit_cost, inv.total_value, inv.reorder_point, wh.warehouse_name, wh.location, wh.capacity, wh.manager_name, s.supplier_name, s.contact_email, s.phone, s.rating, cat.category_name, cat.category_description, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reason, emp.employee_name, aud.audit_date, aud.audit_result, aud.auditor_name, ord.reorder_quantity, ord.reorder_date, ord.expected_delivery, sup.supply_cost, sup.lead_time, qua.quality_score, qua.inspection_date\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN reorder_orders ord ON inv.inventory_id = ord.inventory_id\nLEFT JOIN supply_costs sup ON inv.supplier_id = sup.supplier_id\nLEFT JOIN quality_controls qua ON inv.inventory_id = qua.inventory_id\nWHERE inv.current_stock < inv.reorder_point AND inv.unit_cost > 20.00 AND wh.capacity > 5000 AND s.rating >= 4.2 AND cat.category_name IN ('raw_materials', 'components', 'finished_goods') AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-03-01' AND aud.audit_result = 'passed' AND ord.reorder_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND sup.lead_time < 14 AND qua.quality_score >= 90 AND inv.total_value > 3000.00\nORDER BY inv.current_stock ASC, inv.unit_cost DESC, sup.lead_time ASC\nLIMIT 80\nOFFSET 0", "output": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.sku, inv.upc, inv.current_stock, inv.min_stock_level, inv.max_stock_level, inv.unit_cost, inv.total_value, inv.reorder_point, wh.warehouse_name, wh.location, wh.capacity, wh.manager_name, s.supplier_name, s.contact_email, s.phone, s.rating, cat.category_name, cat.category_description, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reason, emp.employee_name, aud.audit_date, aud.audit_result, aud.auditor_name, ord.reorder_quantity, ord.reorder_date, ord.expected_delivery, sup.supply_cost, sup.lead_time, qua.quality_score, qua.inspection_date\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN reorder_orders ord ON inv.inventory_id = ord.inventory_id\nLEFT JOIN supply_costs sup ON inv.supplier_id = sup.supplier_id\nLEFT JOIN quality_controls qua ON inv.inventory_id = qua.inventory_id\nWHERE inv.current_stock < inv.reorder_point AND inv.unit_cost > 20.00 AND wh.capacity > 5000 AND s.rating >= 4.2 AND cat.category_name IN ('raw_materials', 'components', 'finished_goods') AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-03-01' AND aud.audit_result = 'passed' AND ord.reorder_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND sup.lead_time < 14 AND qua.quality_score >= 90 AND inv.total_value > 3000.00\nORDER BY inv.current_stock ASC, inv.unit_cost DESC, sup.lead_time ASC\nLIMIT 80"}
{"instruction": "Optimize the SQL query", "input": "SELECT loan.loan_id, loan.amount, loan.interest_rate, loan.start_date, loan.end_date, loan.term_months, loan.status, loan.purpose, c.customer_name, c.credit_score, c.annual_income, c.employment_status, e.employee_name, e.department, br.branch_name, br.branch_region, pt.payment_term, pt.number_of_payments, sch.due_date, sch.amount_due, sch.paid_amount, sch.payment_status, coll.collection_status, coll.collection_date, coll.collection_amount, coll.collector_name, risk.risk_level, risk.risk_score, risk.risk_description, doc.document_name, doc.document_status, doc.verification_date, ins.insurance_amount, ins.insurance_provider, ins.policy_number, g.guarantor_name, g.guarantor_relationship, g.guarantor_income\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_term_id = pt.term_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nLEFT JOIN guarantors g ON loan.loan_id = g.loan_id\nWHERE loan.amount > 30000.00 AND loan.interest_rate < 7.50 AND loan.start_date > '2021-01-01' AND loan.status = 'active' AND c.credit_score > 720 AND c.annual_income > 75000 AND e.department = 'lending' AND br.branch_region IN ('northeast', 'midwest') AND pt.number_of_payments > 24 AND sch.due_date BETWEEN '2023-10-01' AND '2023-12-31' AND coll.collection_status = 'pending' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_amount > loan.amount * 0.8 AND g.guarantor_income > 50000\nORDER BY loan.amount DESC, loan.interest_rate ASC, c.credit_score DESC\nLIMIT 65\nOFFSET 0", "output": "SELECT loan.loan_id, loan.amount, loan.interest_rate, loan.start_date, loan.end_date, loan.term_months, loan.status, loan.purpose, c.customer_name, c.credit_score, c.annual_income, c.employment_status, e.employee_name, e.department, br.branch_name, br.branch_region, pt.payment_term, pt.number_of_payments, sch.due_date, sch.amount_due, sch.paid_amount, sch.payment_status, coll.collection_status, coll.collection_date, coll.collection_amount, coll.collector_name, risk.risk_level, risk.risk_score, risk.risk_description, doc.document_name, doc.document_status, doc.verification_date, ins.insurance_amount, ins.insurance_provider, ins.policy_number, g.guarantor_name, g.guarantor_relationship, g.guarantor_income\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_term_id = pt.term_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nLEFT JOIN guarantors g ON loan.loan_id = g.loan_id\nWHERE loan.amount > 30000.00 AND loan.interest_rate < 7.50 AND loan.start_date > '2021-01-01' AND loan.status = 'active' AND c.credit_score > 720 AND c.annual_income > 75000 AND e.department = 'lending' AND br.branch_region IN ('northeast', 'midwest') AND pt.number_of_payments > 24 AND sch.due_date BETWEEN '2023-10-01' AND '2023-12-31' AND coll.collection_status = 'pending' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_amount > loan.amount * 0.8 AND g.guarantor_income > 50000\nORDER BY loan.amount DESC, loan.interest_rate ASC, c.credit_score DESC\nLIMIT 65"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.estimated_profit, p.status, p.priority, c.client_name, c.industry, c.client_rating, m.first_name AS manager_first, m.last_name AS manager_last, m.email AS manager_email, d.department_name, d.department_budget, t.team_name, t.team_size, t.team_location, r.risk_level, r.risk_description, r.impact_level, r.mitigation_plan, de.deliverable_name, de.description AS deliverable_desc, de.status AS deliverable_status, de.due_date, res.resource_name, res.resource_type, res.cost_rate, res.availability, times.hours_worked, times.overtime_hours, times.entry_date, exp.expense_type, exp.amount, exp.expense_date, mil.milestone_name, mil.completion_date, mil.status AS milestone_status\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nLEFT JOIN project_expenses exp ON p.project_id = exp.project_id\nLEFT JOIN project_milestones mil ON p.project_id = mil.project_id\nWHERE p.start_date > '2021-06-01' AND p.budget > 75000.00 AND p.status IN ('in_progress', 'planning') AND c.industry IN ('Technology', 'Finance', 'Healthcare', 'Manufacturing') AND c.client_rating >= 4.0 AND d.department_name = 'R&D' AND t.team_size > 6 AND r.risk_level IN ('medium', 'high') AND de.status = 'in_progress' AND res.resource_type = 'human' AND res.cost_rate > 45.00 AND times.hours_worked > 30 AND times.entry_date > '2023-02-01' AND exp.amount > 1000.00 AND mil.status = 'completed'\nORDER BY p.budget DESC, p.priority ASC, p.start_date ASC\nLIMIT 45\nOFFSET 0", "output": "SELECT p.project_id, p.project_name, p.description, p.start_date, p.end_date, p.budget, p.actual_cost, p.estimated_profit, p.status, p.priority, c.client_name, c.industry, c.client_rating, m.first_name AS manager_first, m.last_name AS manager_last, m.email AS manager_email, d.department_name, d.department_budget, t.team_name, t.team_size, t.team_location, r.risk_level, r.risk_description, r.impact_level, r.mitigation_plan, de.deliverable_name, de.description AS deliverable_desc, de.status AS deliverable_status, de.due_date, res.resource_name, res.resource_type, res.cost_rate, res.availability, times.hours_worked, times.overtime_hours, times.entry_date, exp.expense_type, exp.amount, exp.expense_date, mil.milestone_name, mil.completion_date, mil.status AS milestone_status\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables de ON p.project_id = de.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nLEFT JOIN project_expenses exp ON p.project_id = exp.project_id\nLEFT JOIN project_milestones mil ON p.project_id = mil.project_id\nWHERE p.start_date > '2021-06-01' AND p.budget > 75000.00 AND p.status IN ('in_progress', 'planning') AND c.industry IN ('Technology', 'Finance', 'Healthcare', 'Manufacturing') AND c.client_rating >= 4.0 AND d.department_name = 'R&D' AND t.team_size > 6 AND r.risk_level IN ('medium', 'high') AND de.status = 'in_progress' AND res.resource_type = 'human' AND res.cost_rate > 45.00 AND times.hours_worked > 30 AND times.entry_date > '2023-02-01' AND exp.amount > 1000.00 AND mil.status = 'completed'\nORDER BY p.budget DESC, p.priority ASC, p.start_date ASC\nLIMIT 45"}
{"instruction": "Optimize the SQL query", "input": "SELECT s.sale_id, s.sale_date, s.total_amount, s.tax_amount, s.discount_amount, s.shipping_cost, s.payment_method, s.transaction_id, c.customer_name, c.membership_level, c.loyalty_points, e.employee_name, e.department, st.store_name, st.location, st.store_size, p.product_name, p.category, p.brand, sd.quantity, sd.unit_price, sd.discount_percentage, prom.promotion_name, prom.discount_type, prom.start_date AS promo_start, prom.end_date AS promo_end, tax.tax_rate, tax.tax_amount, del.delivery_status, del.carrier, del.tracking_number, del.estimated_delivery, del.actual_delivery_date, ret.return_reason, ret.return_status, ret.refund_amount, pay.payment_status, pay.authorization_code, inv.inventory_level, sup.supplier_name\nFROM sales s\nJOIN customers c ON s.customer_id = c.customer_id\nJOIN employees e ON s.employee_id = e.employee_id\nJOIN stores st ON s.store_id = st.store_id\nJOIN sale_details sd ON s.sale_id = sd.sale_id\nJOIN products p ON sd.product_id = p.product_id\nLEFT JOIN promotions prom ON s.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON s.sale_id = tax.sale_id\nLEFT JOIN deliveries del ON s.sale_id = del.sale_id\nLEFT JOIN RETURNS ret ON s.sale_id = ret.sale_id\nJOIN payments pay ON s.sale_id = pay.sale_id\nJOIN inventory_levels inv ON p.product_id = inv.product_id\nJOIN suppliers sup ON p.supplier_id = sup.supplier_id\nWHERE s.sale_date BETWEEN '2023-07-01' AND '2023-12-31' AND s.total_amount > 250.00 AND s.payment_method IN ('credit_card', 'debit_card', 'digital_wallet') AND c.membership_level IN ('gold', 'platinum', 'diamond') AND e.department = 'sales' AND st.location LIKE '%shopping%' AND p.category = 'electronics' AND sd.quantity > 1 AND prom.discount_type = 'percentage' AND tax.tax_rate BETWEEN 0.06 AND 0.12 AND del.delivery_status = 'delivered' AND pay.payment_status = 'completed' AND inv.inventory_level > 10 AND sup.supplier_rating >= 4.3\nORDER BY s.total_amount DESC, s.sale_date DESC, c.loyalty_points DESC\nLIMIT 90\nOFFSET 0", "output": "SELECT s.sale_id, s.sale_date, s.total_amount, s.tax_amount, s.discount_amount, s.shipping_cost, s.payment_method, s.transaction_id, c.customer_name, c.membership_level, c.loyalty_points, e.employee_name, e.department, st.store_name, st.location, st.store_size, p.product_name, p.category, p.brand, sd.quantity, sd.unit_price, sd.discount_percentage, prom.promotion_name, prom.discount_type, prom.start_date AS promo_start, prom.end_date AS promo_end, tax.tax_rate, tax.tax_amount, del.delivery_status, del.carrier, del.tracking_number, del.estimated_delivery, del.actual_delivery_date, ret.return_reason, ret.return_status, ret.refund_amount, pay.payment_status, pay.authorization_code, inv.inventory_level, sup.supplier_name\nFROM sales s\nJOIN customers c ON s.customer_id = c.customer_id\nJOIN employees e ON s.employee_id = e.employee_id\nJOIN stores st ON s.store_id = st.store_id\nJOIN sale_details sd ON s.sale_id = sd.sale_id\nJOIN products p ON sd.product_id = p.product_id\nLEFT JOIN promotions prom ON s.promotion_id = prom.promotion_id\nJOIN tax_calculations tax ON s.sale_id = tax.sale_id\nLEFT JOIN deliveries del ON s.sale_id = del.sale_id\nLEFT JOIN RETURNS ret ON s.sale_id = ret.sale_id\nJOIN payments pay ON s.sale_id = pay.sale_id\nJOIN inventory_levels inv ON p.product_id = inv.product_id\nJOIN suppliers sup ON p.supplier_id = sup.supplier_id\nWHERE s.sale_date BETWEEN '2023-07-01' AND '2023-12-31' AND s.total_amount > 250.00 AND s.payment_method IN ('credit_card', 'debit_card', 'digital_wallet') AND c.membership_level IN ('gold', 'platinum', 'diamond') AND e.department = 'sales' AND st.location LIKE '%shopping%' AND p.category = 'electronics' AND sd.quantity > 1 AND prom.discount_type = 'percentage' AND tax.tax_rate BETWEEN 0.06 AND 0.12 AND del.delivery_status = 'delivered' AND pay.payment_status = 'completed' AND inv.inventory_level > 10 AND sup.supplier_rating >= 4.3\nORDER BY s.total_amount DESC, s.sale_date DESC, c.loyalty_points DESC\nLIMIT 90"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.store_id, s.store_name\nFROM stores s\nWHERE s.region = 'North' AND s.store_id IN (SELECT DISTINCT sales.store_id FROM sales WHERE sales.sale_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY sales.store_id HAVING SUM(sales.amount) > 100000) AND EXISTS (SELECT 1 FROM store_feedback sf WHERE sf.store_id = s.store_id AND sf.rating = 5 AND sf.feedback_date > '2023-01-01') AND s.establishment_date < '2010-01-01'\nORDER BY s.store_name ASC\nLIMIT 10 ;", "output": "SELECT s.store_id, s.store_name\nFROM stores AS s\nJOIN (SELECT store_id FROM sales WHERE sale_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY store_id HAVING SUM(amount) > 100000) AS recent_high_sales ON s.store_id = recent_high_sales.store_id\nJOIN store_feedback AS sf ON s.store_id = sf.store_id\nWHERE s.region = 'North' AND sf.rating = 5 AND sf.feedback_date > '2023-01-01' AND s.establishment_date < '2010-01-01'\nORDER BY s.store_name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_name, p.price, (SELECT COUNT(oi.order_item_id) FROM order_items oi WHERE oi.product_id = p.product_id) AS total_sold_items\nFROM products p\nWHERE p.category_id = (SELECT c.category_id FROM categories c WHERE c.category_name = 'Books') AND p.price > 20 AND p.stock_quantity > 0\nORDER BY total_sold_items DESC, p.price DESC\nLIMIT 20 ;", "output": "SELECT p.product_name, p.price, COALESCE(SUM(oi.order_item_id) OVER (PARTITION BY p.product_id), 0) AS total_sold_items\nFROM products AS p\nJOIN categories AS c ON p.category_id = c.category_id\nLEFT JOIN order_items AS oi ON p.product_id = oi.product_id\nWHERE c.category_name = 'Books' AND p.price > 20 AND p.stock_quantity > 0\nORDER BY total_sold_items DESC, p.price DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.employee_id, e.first_name, e.last_name, d.department_name, (SELECT MAX(pa.performance_score) FROM performance_appraisals pa WHERE pa.employee_id = e.employee_id AND pa.appraisal_date > '2023-01-01') AS latest_score\nFROM employees e\nJOIN departments d ON e.department_id = d.department_id\nWHERE e.hire_date BETWEEN '2018-01-01' AND '2022-12-31' AND e.status = 'active' AND d.department_name NOT IN ('HR', 'Legal')\nORDER BY latest_score DESC, e.last_name ASC\nLIMIT 15 ;", "output": "SELECT e.employee_id, e.first_name, e.last_name, d.department_name, MAX(pa.performance_score) AS latest_score\nFROM employees AS e\nJOIN departments AS d ON e.department_id = d.department_id\nLEFT JOIN performance_appraisals AS pa ON e.employee_id = pa.employee_id\nWHERE e.hire_date BETWEEN '2018-01-01' AND '2022-12-31' AND e.status = 'active' AND d.department_name NOT IN ('HR', 'Legal') AND pa.appraisal_date > '2023-01-01'\nGROUP BY e.employee_id, e.first_name, e.last_name, d.department_name\nORDER BY latest_score DESC, e.last_name ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.customer_id, c.customer_name, SUM(o.total_amount) AS total_spent\nFROM customers c\nJOIN orders o ON c.customer_id = o.customer_id\nWHERE c.registration_date > '2020-01-01' AND o.order_date > '2022-01-01' AND c.customer_id IN (SELECT customer_id FROM customer_preferences cp WHERE cp.marketing_opt_in = TRUE)\nGROUP BY c.customer_id, c.customer_name\nHAVING SUM(o.total_amount) > 5000 AND COUNT(o.order_id) >= 3\nORDER BY total_spent DESC\nLIMIT 25\nOFFSET 5 ;", "output": "SELECT c.customer_id, c.customer_name, SUM(o.total_amount) AS total_spent\nFROM customers AS c\nJOIN orders AS o ON c.customer_id = o.customer_id\nJOIN customer_preferences AS cp ON c.customer_id = cp.customer_id\nWHERE c.registration_date > '2020-01-01' AND o.order_date > '2022-01-01' AND cp.marketing_opt_in = TRUE\nGROUP BY c.customer_id, c.customer_name\nHAVING SUM(o.total_amount) > 5000 AND COUNT(o.order_id) >= 3\nORDER BY total_spent DESC\nLIMIT 25\nOFFSET 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT a.airport_name, a.city, (SELECT COUNT(f.flight_id) FROM flights f WHERE f.departure_airport_id = a.airport_id AND f.flight_date = CURDATE()) AS daily_departures, (SELECT COUNT(f2.flight_id) FROM flights f2 WHERE f2.arrival_airport_id = a.airport_id AND f2.flight_date = CURDATE()) AS daily_arrivals\nFROM airports a\nWHERE a.country = 'USA' AND a.airport_id NOT IN (SELECT r.airport_id FROM runway_issues r WHERE r.issue_date = CURDATE())\nORDER BY daily_departures DESC, daily_arrivals DESC\nLIMIT 10 ;", "output": "WITH DailyDepartures AS (SELECT departure_airport_id AS airport_id, COUNT(flight_id) AS daily_departures FROM flights WHERE flight_date = CURDATE() GROUP BY departure_airport_id), DailyArrivals AS (SELECT arrival_airport_id AS airport_id, COUNT(flight_id) AS daily_arrivals FROM flights WHERE flight_date = CURDATE() GROUP BY arrival_airport_id)\nSELECT a.airport_name, a.city, COALESCE(dd.daily_departures, 0) AS daily_departures, COALESCE(da.daily_arrivals, 0) AS daily_arrivals\nFROM airports AS a\nLEFT JOIN DailyDepartures AS dd ON a.airport_id = dd.airport_id\nLEFT JOIN DailyArrivals AS da ON a.airport_id = da.airport_id\nLEFT JOIN runway_issues AS ri ON a.airport_id = ri.airport_id AND ri.issue_date = CURDATE()\nWHERE a.country = 'USA' AND ri.airport_id IS NULL\nORDER BY daily_departures DESC, daily_arrivals DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.station_name, s.location, (SELECT AVG(CAST(pm.temperature AS DECIMAL(5,2))) FROM weather_readings pm WHERE pm.station_id = s.station_id AND pm.reading_date BETWEEN '2023-07-01' AND '2023-07-31') AS avg_july_temp, (SELECT MAX(pm2.humidity) FROM weather_readings pm2 WHERE pm2.station_id = s.station_id AND pm2.reading_date BETWEEN '2023-07-01' AND '2023-07-31') AS max_july_humidity\nFROM weather_stations s\nWHERE s.elevation > 1000 AND s.station_type = 'Automated'\nORDER BY avg_july_temp DESC, max_july_humidity DESC\nLIMIT 10 ;", "output": "WITH JulyReadings AS (SELECT station_id, AVG(CAST(temperature AS DECIMAL(5,2))) AS avg_july_temp, MAX(humidity) AS max_july_humidity FROM weather_readings WHERE reading_date BETWEEN '2023-07-01' AND '2023-07-31' GROUP BY station_id)\nSELECT s.station_name, s.location, jr.avg_july_temp, jr.max_july_humidity\nFROM weather_stations AS s\nJOIN JulyReadings AS jr ON s.station_id = jr.station_id\nWHERE s.elevation > 1000 AND s.station_type = 'Automated'\nORDER BY jr.avg_july_temp DESC, jr.max_july_humidity DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, u.username, COUNT(DISTINCT l.log_id) AS total_logins, SUM(l.duration_seconds) AS total_time_spent\nFROM users u\nLEFT JOIN user_logs l ON u.user_id = l.user_id\nWHERE u.status = 'active' AND l.log_date > '2023-01-01' AND l.log_type = 'session' AND u.user_id NOT IN (SELECT user_id FROM user_bans WHERE ban_end_date > CURDATE())\nGROUP BY u.user_id, u.username\nHAVING COUNT(DISTINCT l.log_id) > 50 AND SUM(l.duration_seconds) > 36000\nORDER BY total_time_spent DESC\nLIMIT 20 ;", "output": "SELECT u.user_id, u.username, COUNT(DISTINCT l.log_id) AS total_logins, SUM(l.duration_seconds) AS total_time_spent\nFROM users AS u\nLEFT JOIN user_logs AS l ON u.user_id = l.user_id\nLEFT JOIN user_bans AS ub ON u.user_id = ub.user_id AND ub.ban_end_date > CURDATE()\nWHERE u.status = 'active' AND l.log_date > '2023-01-01' AND l.log_type = 'session' AND ub.user_id IS NULL\nGROUP BY u.user_id, u.username\nHAVING COUNT(DISTINCT l.log_id) > 50 AND SUM(l.duration_seconds) > 36000\nORDER BY total_time_spent DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.policy_id, p.policy_holder_name, p.premium_amount\nFROM policies p\nWHERE p.policy_status = 'Active' AND p.issue_date BETWEEN '2020-01-01' AND '2023-12-31' AND p.policy_type = 'Life Insurance' AND p.policy_id IN (SELECT cl.policy_id FROM claims cl WHERE cl.claim_status = 'Approved' AND cl.claim_date > '2023-01-01') AND EXISTS (SELECT 1 FROM policy_renewals pr WHERE pr.policy_id = p.policy_id AND pr.renewal_date = '2024-01-01')\nORDER BY p.premium_amount DESC\nLIMIT 10 ;", "output": "SELECT p.policy_id, p.policy_holder_name, p.premium_amount\nFROM policies AS p\nJOIN claims AS cl ON p.policy_id = cl.policy_id\nJOIN policy_renewals AS pr ON p.policy_id = pr.policy_id\nWHERE p.policy_status = 'Active' AND p.issue_date BETWEEN '2020-01-01' AND '2023-12-31' AND p.policy_type = 'Life Insurance' AND cl.claim_status = 'Approved' AND cl.claim_date > '2023-01-01' AND pr.renewal_date = '2024-01-01'\nORDER BY p.premium_amount DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT d.drug_name, d.manufacturer, SUM(s.quantity_sold) AS total_quantity_sold\nFROM drugs d\nJOIN sales s ON d.drug_id = s.drug_id\nWHERE d.is_prescription_required = TRUE AND s.sale_date BETWEEN '2023-01-01' AND '2023-06-30' AND d.drug_id NOT IN (SELECT rd.drug_id FROM drug_recalls rd WHERE rd.recall_date > '2023-01-01')\nGROUP BY d.drug_name, d.manufacturer\nHAVING SUM(s.quantity_sold) > 10000\nORDER BY total_quantity_sold DESC\nLIMIT 10 ;", "output": "SELECT d.drug_name, d.manufacturer, SUM(s.quantity_sold) AS total_quantity_sold\nFROM drugs AS d\nJOIN sales AS s ON d.drug_id = s.drug_id\nLEFT JOIN drug_recalls AS dr ON d.drug_id = dr.drug_id AND dr.recall_date > '2023-01-01'\nWHERE d.is_prescription_required = TRUE AND s.sale_date BETWEEN '2023-01-01' AND '2023-06-30' AND dr.drug_id IS NULL\nGROUP BY d.drug_name, d.manufacturer\nHAVING SUM(s.quantity_sold) > 10000\nORDER BY total_quantity_sold DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT f.fund_name, f.fund_manager\nFROM funds f\nWHERE f.fund_type = 'Equity' AND f.inception_date < '2015-01-01' AND EXISTS (SELECT 1 FROM fund_performance fp WHERE fp.fund_id = f.fund_id AND fp.performance_year = 2023 AND fp.return_percentage > 10) AND f.fund_id NOT IN (SELECT ia.fund_id FROM investment_alerts ia WHERE ia.alert_type = 'High Risk' AND ia.alert_date > '2023-01-01')\nORDER BY f.fund_name ASC\nLIMIT 15 ;", "output": "SELECT f.fund_name, f.fund_manager\nFROM funds AS f\nJOIN fund_performance AS fp ON f.fund_id = fp.fund_id\nLEFT JOIN investment_alerts AS ia ON f.fund_id = ia.fund_id AND ia.alert_type = 'High Risk' AND ia.alert_date > '2023-01-01'\nWHERE f.fund_type = 'Equity' AND f.inception_date < '2015-01-01' AND fp.performance_year = 2023 AND fp.return_percentage > 10 AND ia.fund_id IS NULL\nORDER BY f.fund_name ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT a.author_name, COUNT(b.book_id) AS total_books, AVG(b.rating) AS avg_book_rating\nFROM authors a\nLEFT JOIN books b ON a.author_id = b.author_id\nWHERE a.country = 'UK' AND b.publication_year BETWEEN 2000 AND 2020 AND b.genre IN ('Fantasy', 'Mystery') AND a.author_id NOT IN (SELECT pa.author_id FROM author_penalties pa WHERE pa.penalty_date > '2023-01-01')\nGROUP BY a.author_name\nHAVING COUNT(b.book_id) > 5 AND AVG(b.rating) > 4.0\nORDER BY total_books DESC, avg_book_rating DESC\nLIMIT 10 ;", "output": "SELECT a.author_name, COUNT(b.book_id) AS total_books, AVG(b.rating) AS avg_book_rating\nFROM authors AS a\nLEFT JOIN books AS b ON a.author_id = b.author_id\nLEFT JOIN author_penalties AS ap ON a.author_id = ap.author_id AND ap.penalty_date > '2023-01-01'\nWHERE a.country = 'UK' AND b.publication_year BETWEEN 2000 AND 2020 AND b.genre IN ('Fantasy', 'Mystery') AND ap.author_id IS NULL\nGROUP BY a.author_name\nHAVING COUNT(b.book_id) > 5 AND AVG(b.rating) > 4.0\nORDER BY total_books DESC, avg_book_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.course_name, c.course_code, (SELECT COUNT(e.enrollment_id) FROM enrollments e WHERE e.course_id = c.course_id AND e.enrollment_date > '2023-01-01') AS recent_enrollments, (SELECT AVG(s.score) FROM student_scores s WHERE s.course_id = c.course_id) AS avg_score\nFROM courses c\nWHERE c.department = 'Computer Science' AND c.credits >= 3 AND c.course_id NOT IN (SELECT r.course_id FROM course_reviews r WHERE r.review_rating < 3 AND r.review_date > '2023-01-01')\nORDER BY recent_enrollments DESC, avg_score DESC\nLIMIT 10 ;", "output": "WITH RecentEnrollments AS (SELECT course_id, COUNT(enrollment_id) AS recent_enrollments FROM enrollments WHERE enrollment_date > '2023-01-01' GROUP BY course_id), AvgScores AS (SELECT course_id, AVG(score) AS avg_score FROM student_scores GROUP BY course_id)\nSELECT c.course_name, c.course_code, COALESCE(re.recent_enrollments, 0) AS recent_enrollments, COALESCE(asc.avg_score, 0) AS avg_score\nFROM courses AS c\nLEFT JOIN RecentEnrollments AS re ON c.course_id = re.course_id\nLEFT JOIN AvgScores AS ASC ON c.course_id = asc.course_id\nLEFT JOIN course_reviews AS cr ON c.course_id = cr.course_id AND cr.review_rating < 3 AND cr.review_date > '2023-01-01'\nWHERE c.department = 'Computer Science' AND c.credits >= 3 AND cr.course_id IS NULL\nORDER BY recent_enrollments DESC, avg_score DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT l.library_name, l.city, (SELECT COUNT(b.book_id) FROM books b WHERE b.library_id = l.library_id AND b.publication_year = 2023) AS new_books_2023\nFROM libraries l\nWHERE l.region = 'South' AND l.library_id NOT IN (SELECT bl.library_id FROM blocked_libraries bl WHERE bl.block_reason = 'Overdue Fines' AND bl.block_date > '2023-01-01') AND EXISTS (SELECT 1 FROM library_events le WHERE le.library_id = l.library_id AND le.event_type = 'Reading Club' AND le.event_date > '2023-06-01')\nORDER BY new_books_2023 DESC, l.library_name ASC\nLIMIT 10 ;", "output": "SELECT l.library_name, l.city, COALESCE(COUNT(b.book_id) OVER (PARTITION BY l.library_id), 0) AS new_books_2023\nFROM libraries AS l\nLEFT JOIN books AS b ON l.library_id = b.library_id AND b.publication_year = 2023\nLEFT JOIN blocked_libraries AS bl ON l.library_id = bl.library_id AND bl.block_reason = 'Overdue Fines' AND bl.block_date > '2023-01-01'\nJOIN library_events AS le ON l.library_id = le.library_id\nWHERE l.region = 'South' AND bl.library_id IS NULL AND le.event_type = 'Reading Club' AND le.event_date > '2023-06-01'\nGROUP BY l.library_name, l.city\nORDER BY new_books_2023 DESC, l.library_name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT inv.item_name, inv.quantity_on_hand, inv.last_restock_date\nFROM inventory inv\nWHERE inv.warehouse_id = (SELECT w.warehouse_id FROM warehouses w WHERE w.location = 'Central') AND inv.quantity_on_hand < 50 AND inv.item_id NOT IN (SELECT oi.item_id FROM outdated_items oi WHERE oi.obsolete_date < CURDATE()) AND EXISTS (SELECT 1 FROM item_suppliers isu WHERE isu.item_id = inv.item_id AND isu.supplier_name = 'MegaCorp')\nORDER BY inv.quantity_on_hand ASC, inv.last_restock_date DESC\nLIMIT 20 ;", "output": "SELECT inv.item_name, inv.quantity_on_hand, inv.last_restock_date\nFROM inventory AS inv\nJOIN warehouses AS w ON inv.warehouse_id = w.warehouse_id\nLEFT JOIN outdated_items AS oi ON inv.item_id = oi.item_id AND oi.obsolete_date < CURDATE()\nJOIN item_suppliers AS isu ON inv.item_id = isu.item_id\nWHERE w.location = 'Central' AND inv.quantity_on_hand < 50 AND oi.item_id IS NULL AND isu.supplier_name = 'MegaCorp'\nORDER BY inv.quantity_on_hand ASC, inv.last_restock_date DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT tr.trainer_name, tr.specialty, COUNT(cl.client_id) AS total_clients, AVG(cl.sessions_completed) AS avg_sessions\nFROM trainers tr\nLEFT JOIN clients cl ON tr.trainer_id = cl.trainer_id\nWHERE tr.experience_years > 5 AND tr.specialty IN ('Weightlifting', 'Cardio') AND cl.start_date > '2023-01-01' AND tr.trainer_id NOT IN (SELECT ta.trainer_id FROM trainer_absences ta WHERE ta.absence_date BETWEEN '2023-01-01' AND '2023-12-31')\nGROUP BY tr.trainer_name, tr.specialty\nHAVING COUNT(cl.client_id) > 10 AND AVG(cl.sessions_completed) > 20\nORDER BY total_clients DESC, avg_sessions DESC\nLIMIT 10 ;", "output": "SELECT tr.trainer_name, tr.specialty, COUNT(cl.client_id) AS total_clients, AVG(cl.sessions_completed) AS avg_sessions\nFROM trainers AS tr\nLEFT JOIN clients AS cl ON tr.trainer_id = cl.trainer_id\nLEFT JOIN trainer_absences AS ta ON tr.trainer_id = ta.trainer_id AND ta.absence_date BETWEEN '2023-01-01' AND '2023-12-31'\nWHERE tr.experience_years > 5 AND tr.specialty IN ('Weightlifting', 'Cardio') AND cl.start_date > '2023-01-01' AND ta.trainer_id IS NULL\nGROUP BY tr.trainer_name, tr.specialty\nHAVING COUNT(cl.client_id) > 10 AND AVG(cl.sessions_completed) > 20\nORDER BY total_clients DESC, avg_sessions DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT m.movie_title, m.release_year, d.director_name\nFROM movies m\nJOIN directors d ON m.director_id = d.director_id\nWHERE m.genre = 'Drama' AND m.release_year BETWEEN 2010 AND 2020 AND m.movie_id NOT IN (SELECT ur.movie_id FROM user_ratings ur WHERE ur.rating < 3 AND ur.rating_date > '2023-01-01') AND EXISTS (SELECT 1 FROM movie_awards ma WHERE ma.movie_id = m.movie_id AND ma.award_type = 'Oscar')\nORDER BY m.release_year DESC, m.movie_title ASC\nLIMIT 15 ;", "output": "SELECT m.movie_title, m.release_year, d.director_name\nFROM movies AS m\nJOIN directors AS d ON m.director_id = d.director_id\nLEFT JOIN user_ratings AS ur ON m.movie_id = ur.movie_id AND ur.rating < 3 AND ur.rating_date > '2023-01-01'\nJOIN movie_awards AS ma ON m.movie_id = ma.movie_id\nWHERE m.genre = 'Drama' AND m.release_year BETWEEN 2010 AND 2020 AND ur.movie_id IS NULL AND ma.award_type = 'Oscar'\nORDER BY m.release_year DESC, m.movie_title ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT v.vendor_name, v.contact_person\nFROM vendors v\nWHERE v.vendor_status = 'Approved' AND v.country = 'Germany' AND v.vendor_id IN (SELECT po.vendor_id FROM purchase_orders po WHERE po.order_date > '2023-01-01' AND po.total_amount > 5000) AND EXISTS (SELECT 1 FROM vendor_ratings vr WHERE vr.vendor_id = v.vendor_id AND vr.average_rating > 4.0)\nORDER BY v.vendor_name ASC\nLIMIT 10 ;", "output": "SELECT v.vendor_name, v.contact_person\nFROM vendors AS v\nJOIN purchase_orders AS po ON v.vendor_id = po.vendor_id\nJOIN vendor_ratings AS vr ON v.vendor_id = vr.vendor_id\nWHERE v.vendor_status = 'Approved' AND v.country = 'Germany' AND po.order_date > '2023-01-01' AND po.total_amount > 5000 AND vr.average_rating > 4.0\nORDER BY v.vendor_name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT ev.event_name, ev.event_date, ev.location\nFROM EVENTS ev\nWHERE ev.event_type = 'Conference' AND ev.event_date BETWEEN '2023-09-01' AND '2023-12-31' AND ev.event_id NOT IN (SELECT ec.event_id FROM event_cancellations ec WHERE ec.cancellation_date > '2023-09-01') AND EXISTS (SELECT 1 FROM event_sponsors es WHERE es.event_id = ev.event_id AND es.sponsor_level = 'Platinum')\nORDER BY ev.event_date ASC\nLIMIT 10 ;", "output": "SELECT ev.event_name, ev.event_date, ev.location\nFROM EVENTS AS ev\nLEFT JOIN event_cancellations AS ec ON ev.event_id = ec.event_id AND ec.cancellation_date > '2023-09-01'\nJOIN event_sponsors AS es ON ev.event_id = es.event_id\nWHERE ev.event_type = 'Conference' AND ev.event_date BETWEEN '2023-09-01' AND '2023-12-31' AND ec.event_id IS NULL AND es.sponsor_level = 'Platinum'\nORDER BY ev.event_date ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT cl.class_name, cl.class_code, t.teacher_name\nFROM classes cl\nJOIN teachers t ON cl.teacher_id = t.teacher_id\nWHERE cl.semester = 'Fall 2023' AND t.department = 'Mathematics' AND cl.class_id IN (SELECT en.class_id FROM enrollments en WHERE en.enrollment_date > '2023-08-01' AND en.status = 'Enrolled') AND EXISTS (SELECT 1 FROM class_rooms cr WHERE cr.class_id = cl.class_id AND cr.capacity > 30)\nORDER BY cl.class_name ASC\nLIMIT 15 ;", "output": "SELECT cl.class_name, cl.class_code, t.teacher_name\nFROM classes AS cl\nJOIN teachers AS t ON cl.teacher_id = t.teacher_id\nJOIN enrollments AS en ON cl.class_id = en.class_id\nJOIN class_rooms AS cr ON cl.class_id = cr.class_id\nWHERE cl.semester = 'Fall 2023' AND t.department = 'Mathematics' AND en.enrollment_date > '2023-08-01' AND en.status = 'Enrolled' AND cr.capacity > 30\nORDER BY cl.class_name ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT u.user_id, u.username, u.email, (SELECT COUNT(l.log_id) FROM user_logs l WHERE l.user_id = u.user_id AND l.log_type = 'login' AND l.log_date > '2023-01-01') AS logins_2023, (SELECT MAX(l.log_date) FROM user_logs l WHERE l.user_id = u.user_id AND l.log_type = 'login') AS last_login\nFROM users u\nWHERE u.status = 'active' AND u.registration_date BETWEEN '2020-01-01' AND '2021-12-31' AND u.user_id NOT IN (SELECT DISTINCT ub.user_id FROM user_bans ub WHERE ub.ban_end_date > CURDATE()) AND EXISTS (SELECT 1 FROM user_subscriptions us WHERE us.user_id = u.user_id AND us.subscription_status = 'active' AND us.plan_type = 'Premium')\nORDER BY logins_2023 DESC, last_login DESC\nLIMIT 20 ;", "output": "WITH UserLoginCounts AS (SELECT user_id, COUNT(log_id) AS logins_2023, MAX(log_date) AS last_login FROM user_logs WHERE log_type = 'login' AND log_date > '2023-01-01' GROUP BY user_id)\nSELECT u.user_id, u.username, u.email, COALESCE(ulc.logins_2023, 0) AS logins_2023, ulc.last_login\nFROM users AS u\nLEFT JOIN UserLoginCounts AS ulc ON u.user_id = ulc.user_id\nLEFT JOIN user_bans AS ub ON u.user_id = ub.user_id AND ub.ban_end_date > CURDATE()\nJOIN user_subscriptions AS us ON u.user_id = us.user_id\nWHERE u.status = 'active' AND u.registration_date BETWEEN '2020-01-01' AND '2021-12-31' AND ub.user_id IS NULL AND us.subscription_status = 'active' AND us.plan_type = 'Premium'\nORDER BY logins_2023 DESC, last_login DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.order_id, c.customer_name, o.order_date, SUM(oi.quantity * p.price) AS total_order_value\nFROM orders o\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN order_items oi ON o.order_id = oi.order_id\nJOIN products p ON oi.product_id = p.product_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-03-31' AND c.country = 'Germany' AND p.category_id IN (SELECT category_id FROM categories WHERE category_name LIKE '%Electronic%') AND o.customer_id IN (SELECT customer_id FROM customer_segments WHERE segment_type = 'High-Value')\nGROUP BY o.order_id, c.customer_name, o.order_date\nHAVING SUM(oi.quantity * p.price) > 500 AND COUNT(oi.order_item_id) > 1\nORDER BY total_order_value DESC, o.order_date ASC\nLIMIT 30 ;", "output": "SELECT o.order_id, c.customer_name, o.order_date, SUM(oi.quantity * p.price) AS total_order_value\nFROM orders AS o\nJOIN customers AS c ON o.customer_id = c.customer_id\nJOIN order_items AS oi ON o.order_id = oi.order_id\nJOIN products AS p ON oi.product_id = p.product_id\nJOIN categories AS cat ON p.category_id = cat.category_id\nJOIN customer_segments AS cs ON c.customer_id = cs.customer_id\nWHERE o.order_date BETWEEN '2023-01-01' AND '2023-03-31' AND c.country = 'Germany' AND cat.category_name LIKE '%Electronic%' AND cs.segment_type = 'High-Value'\nGROUP BY o.order_id, c.customer_name, o.order_date\nHAVING SUM(oi.quantity * p.price) > 500 AND COUNT(oi.order_item_id) > 1\nORDER BY total_order_value DESC, o.order_date ASC\nLIMIT 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT e.employee_id, e.first_name, e.last_name, d.department_name, (SELECT COUNT(pr.project_id) FROM employee_projects pr WHERE pr.employee_id = e.employee_id AND pr.project_status = 'Completed' AND pr.end_date > '2023-01-01') AS completed_projects_2023, (SELECT AVG(pr.duration_days) FROM employee_projects pr WHERE pr.employee_id = e.employee_id) AS avg_project_duration\nFROM employees e\nJOIN departments d ON e.department_id = d.department_id\nWHERE e.hire_date BETWEEN '2015-01-01' AND '2020-12-31' AND e.salary > 80000 AND d.location = 'New York' AND e.employee_id NOT IN (SELECT ex.employee_id FROM employee_exits ex WHERE ex.exit_date > '2023-01-01') AND EXISTS (SELECT 1 FROM employee_roles er JOIN ROLES r ON er.role_id = r.role_id WHERE er.employee_id = e.employee_id AND r.role_name = 'Senior Engineer')\nORDER BY completed_projects_2023 DESC, avg_project_duration DESC\nLIMIT 25 ;", "output": "WITH CompletedProjects AS (SELECT employee_id, COUNT(project_id) AS completed_projects_2023, AVG(duration_days) AS avg_project_duration FROM employee_projects WHERE project_status = 'Completed' AND end_date > '2023-01-01' GROUP BY employee_id)\nSELECT e.employee_id, e.first_name, e.last_name, d.department_name, COALESCE(cp.completed_projects_2023, 0) AS completed_projects_2023, COALESCE(cp.avg_project_duration, 0) AS avg_project_duration\nFROM employees AS e\nJOIN departments AS d ON e.department_id = d.department_id\nLEFT JOIN CompletedProjects AS cp ON e.employee_id = cp.employee_id\nLEFT JOIN employee_exits AS ex ON e.employee_id = ex.employee_id AND ex.exit_date > '2023-01-01'\nJOIN employee_roles AS er ON e.employee_id = er.employee_id\nJOIN ROLES AS r ON er.role_id = r.role_id\nWHERE e.hire_date BETWEEN '2015-01-01' AND '2020-12-31' AND e.salary > 80000 AND d.location = 'New York' AND ex.employee_id IS NULL AND r.role_name = 'Senior Engineer'\nORDER BY completed_projects_2023 DESC, avg_project_duration DESC\nLIMIT 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT product_name, manufacturer, price, (SELECT AVG(price) FROM products WHERE category_id = p.category_id) AS avg_category_price, (SELECT COUNT(DISTINCT customer_id) FROM order_items oi JOIN orders o ON oi.order_id = o.order_id WHERE oi.product_id = p.product_id AND o.order_date BETWEEN '2023-07-01' AND '2023-09-30') AS Q3_unique_buyers, (SELECT SUM(oi.quantity) FROM order_items oi WHERE oi.product_id = p.product_id AND oi.order_id IN (SELECT order_id FROM orders WHERE order_date BETWEEN '2023-07-01' AND '2023-09-30')) AS Q3_total_sold\nFROM products p\nWHERE p.stock_quantity < 50 AND p.price > 100 AND p.category_id IN (SELECT category_id FROM categories WHERE category_name NOT LIKE '%Food%') AND EXISTS (SELECT 1 FROM product_reviews pr WHERE pr.product_id = p.product_id AND pr.rating >= 4 AND pr.review_date > '2023-01-01')\nORDER BY Q3_unique_buyers DESC, Q3_total_sold DESC\nLIMIT 20 ;", "output": "WITH CategoryAvgPrice AS (SELECT category_id, AVG(price) AS avg_category_price FROM products GROUP BY category_id), Q3Sales AS (SELECT oi.product_id, COUNT(DISTINCT o.customer_id) AS Q3_unique_buyers, SUM(oi.quantity) AS Q3_total_sold FROM order_items AS oi JOIN orders AS o ON oi.order_id = o.order_id WHERE o.order_date BETWEEN '2023-07-01' AND '2023-09-30' GROUP BY oi.product_id)\nSELECT p.product_name, p.manufacturer, p.price, cap.avg_category_price, COALESCE(qs.Q3_unique_buyers, 0) AS Q3_unique_buyers, COALESCE(qs.Q3_total_sold, 0) AS Q3_total_sold\nFROM products AS p\nJOIN categories AS cat ON p.category_id = cat.category_id\nLEFT JOIN CategoryAvgPrice AS cap ON p.category_id = cap.category_id\nLEFT JOIN Q3Sales AS qs ON p.product_id = qs.product_id\nJOIN product_reviews AS pr ON p.product_id = pr.product_id\nWHERE p.stock_quantity < 50 AND p.price > 100 AND cat.category_name NOT LIKE '%Food%' AND pr.rating >= 4 AND pr.review_date > '2023-01-01'\nORDER BY Q3_unique_buyers DESC, Q3_total_sold DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT a.artist_name, a.country, (SELECT COUNT(al.album_id) FROM albums al WHERE al.artist_id = a.artist_id AND al.release_year > 2020) AS recent_albums_count, (SELECT AVG(t.duration) FROM tracks t JOIN albums al ON t.album_id = al.album_id WHERE al.artist_id = a.artist_id AND t.genre = 'Pop') AS avg_pop_track_duration\nFROM artists a\nWHERE a.genre_preference = 'Rock' AND a.artist_id NOT IN (SELECT DISTINCT aa.artist_id FROM artist_awards aa WHERE aa.award_year = 2023 AND aa.award_type = 'Grammy') AND EXISTS (SELECT 1 FROM artist_social_media asm WHERE asm.artist_id = a.artist_id AND asm.platform = 'Instagram' AND asm.followers > 100000)\nORDER BY recent_albums_count DESC, avg_pop_track_duration DESC\nLIMIT 15 ;", "output": "WITH RecentAlbums AS (SELECT artist_id, COUNT(album_id) AS recent_albums_count FROM albums WHERE release_year > 2020 GROUP BY artist_id), AvgPopTrackDuration AS (SELECT al.artist_id, AVG(t.duration) AS avg_pop_track_duration FROM tracks AS t JOIN albums AS al ON t.album_id = al.album_id WHERE t.genre = 'Pop' GROUP BY al.artist_id)\nSELECT a.artist_name, a.country, COALESCE(ra.recent_albums_count, 0) AS recent_albums_count, COALESCE(apt.avg_pop_track_duration, 0) AS avg_pop_track_duration\nFROM artists AS a\nLEFT JOIN RecentAlbums AS ra ON a.artist_id = ra.artist_id\nLEFT JOIN AvgPopTrackDuration AS apt ON a.artist_id = apt.artist_id\nLEFT JOIN artist_awards AS aa ON a.artist_id = aa.artist_id AND aa.award_year = 2023 AND aa.award_type = 'Grammy'\nJOIN artist_social_media AS asm ON a.artist_id = asm.artist_id\nWHERE a.genre_preference = 'Rock' AND aa.artist_id IS NULL AND asm.platform = 'Instagram' AND asm.followers > 100000\nORDER BY recent_albums_count DESC, avg_pop_track_duration DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT o.office_name, o.city, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.office_id = o.office_id AND e.status = 'active') AS active_employees, (SELECT AVG(p.power_consumption_kwh) FROM office_power_usage p WHERE p.office_id = o.office_id AND p.reading_date BETWEEN '2023-01-01' AND '2023-12-31') AS avg_annual_power\nFROM offices o\nWHERE o.country = 'USA' AND o.square_footage > 5000 AND o.office_id NOT IN (SELECT DISTINCT ir.office_id FROM incident_reports ir WHERE ir.incident_date > '2023-01-01' AND ir.severity = 'High') AND EXISTS (SELECT 1 FROM office_amenities oa WHERE oa.office_id = o.office_id AND oa.amenity_type = 'Gym')\nORDER BY active_employees DESC, avg_annual_power ASC\nLIMIT 10 ;", "output": "WITH ActiveEmployees AS (SELECT office_id, COUNT(employee_id) AS active_employees FROM employees WHERE status = 'active' GROUP BY office_id), AnnualPowerUsage AS (SELECT office_id, AVG(power_consumption_kwh) AS avg_annual_power FROM office_power_usage WHERE reading_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY office_id)\nSELECT o.office_name, o.city, COALESCE(ae.active_employees, 0) AS active_employees, COALESCE(apu.avg_annual_power, 0) AS avg_annual_power\nFROM offices AS o\nLEFT JOIN ActiveEmployees AS ae ON o.office_id = ae.office_id\nLEFT JOIN AnnualPowerUsage AS apu ON o.office_id = apu.office_id\nLEFT JOIN incident_reports AS ir ON o.office_id = ir.office_id AND ir.incident_date > '2023-01-01' AND ir.severity = 'High'\nJOIN office_amenities AS oa ON o.office_id = oa.office_id\nWHERE o.country = 'USA' AND o.square_footage > 5000 AND ir.office_id IS NULL AND oa.amenity_type = 'Gym'\nORDER BY active_employees DESC, avg_annual_power ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.continent_name, c.population, (SELECT AVG(gdp_per_capita) FROM countries co WHERE co.continent_id = c.continent_id) AS avg_gdp_continent, (SELECT MAX(life_expectancy) FROM countries co WHERE co.continent_id = c.continent_id) AS max_life_expectancy_continent\nFROM continents c\nWHERE c.area_sq_km > 10000000 AND c.continent_id NOT IN (SELECT DISTINCT dc.continent_id FROM disaster_events dc WHERE dc.event_date > '2023-01-01' AND dc.severity = 'High')\nORDER BY avg_gdp_continent DESC, max_life_expectancy_continent DESC\nLIMIT 5 ;", "output": "WITH ContinentStats AS (SELECT continent_id, AVG(gdp_per_capita) AS avg_gdp_continent, MAX(life_expectancy) AS max_life_expectancy_continent FROM countries GROUP BY continent_id)\nSELECT c.continent_name, c.population, cs.avg_gdp_continent, cs.max_life_expectancy_continent\nFROM continents AS c\nLEFT JOIN ContinentStats AS cs ON c.continent_id = cs.continent_id\nLEFT JOIN disaster_events AS de ON c.continent_id = de.continent_id AND de.event_date > '2023-01-01' AND de.severity = 'High'\nWHERE c.area_sq_km > 10000000 AND de.continent_id IS NULL\nORDER BY avg_gdp_continent DESC, max_life_expectancy_continent DESC\nLIMIT 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.server_name, s.ip_address, (SELECT COUNT(l.log_id) FROM server_logs l WHERE l.server_id = s.server_id AND l.log_level = 'ERROR' AND l.log_timestamp > CURDATE() - INTERVAL 1 DAY) AS daily_errors, (SELECT MAX(m.cpu_usage) FROM server_metrics m WHERE m.server_id = s.server_id AND m.metric_timestamp > CURDATE() - INTERVAL 1 DAY) AS daily_max_cpu\nFROM servers s\nWHERE s.status = 'Online' AND s.location = 'Datacenter A' AND s.server_id NOT IN (SELECT d.server_id FROM server_downtime d WHERE d.downtime_start > CURDATE() - INTERVAL 7 DAY) AND EXISTS (SELECT 1 FROM server_configs sc WHERE sc.server_id = s.server_id AND sc.config_version = '2.1')\nORDER BY daily_errors DESC, daily_max_cpu DESC\nLIMIT 10 ;", "output": "WITH DailyErrors AS (SELECT server_id, COUNT(log_id) AS daily_errors FROM server_logs WHERE log_level = 'ERROR' AND log_timestamp > CURDATE() - INTERVAL 1 DAY GROUP BY server_id), DailyMaxCpu AS (SELECT server_id, MAX(cpu_usage) AS daily_max_cpu FROM server_metrics WHERE metric_timestamp > CURDATE() - INTERVAL 1 DAY GROUP BY server_id)\nSELECT s.server_name, s.ip_address, COALESCE(de.daily_errors, 0) AS daily_errors, COALESCE(dmc.daily_max_cpu, 0) AS daily_max_cpu\nFROM servers AS s\nLEFT JOIN DailyErrors AS de ON s.server_id = de.server_id\nLEFT JOIN DailyMaxCpu AS dmc ON s.server_id = dmc.server_id\nLEFT JOIN server_downtime AS sd ON s.server_id = sd.server_id AND sd.downtime_start > CURDATE() - INTERVAL 7 DAY\nJOIN server_configs AS sc ON s.server_id = sc.server_id\nWHERE s.status = 'Online' AND s.location = 'Datacenter A' AND sd.server_id IS NULL AND sc.config_version = '2.1'\nORDER BY daily_errors DESC, daily_max_cpu DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT t.task_id, t.task_name, t.due_date, p.project_name\nFROM tasks t\nJOIN projects p ON t.project_id = p.project_id\nWHERE t.status = 'Pending' AND p.status = 'Active' AND t.due_date < CURDATE() + INTERVAL 7 DAY AND t.assigned_to_user_id IN (SELECT user_id FROM users WHERE department_id = (SELECT department_id FROM departments WHERE department_name = 'Development')) AND t.task_id NOT IN (SELECT sub.parent_task_id FROM subtasks sub WHERE sub.status = 'Blocked')\nORDER BY t.due_date ASC, t.task_name ASC\nLIMIT 20 ;", "output": "SELECT t.task_id, t.task_name, t.due_date, p.project_name\nFROM tasks AS t\nJOIN projects AS p ON t.project_id = p.project_id\nJOIN users AS u ON t.assigned_to_user_id = u.user_id\nJOIN departments AS d ON u.department_id = d.department_id\nLEFT JOIN subtasks AS sub ON t.task_id = sub.parent_task_id AND sub.status = 'Blocked'\nWHERE t.status = 'Pending' AND p.status = 'Active' AND t.due_date < CURDATE() + INTERVAL 7 DAY AND d.department_name = 'Development' AND sub.parent_task_id IS NULL\nORDER BY t.due_date ASC, t.task_name ASC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.student_id, s.student_name, s.major, (SELECT COUNT(e.enrollment_id) FROM enrollments e WHERE e.student_id = s.student_id AND e.enrollment_date > '2022-09-01') AS recent_enrollments, (SELECT AVG(g.grade_value) FROM grades g WHERE g.student_id = s.student_id AND g.grade_date > '2022-09-01') AS avg_recent_grade\nFROM students s\nWHERE s.graduation_year = 2024 AND s.student_status = 'Active' AND s.student_id NOT IN (SELECT sd.student_id FROM student_disciplinary_actions sd WHERE sd.action_date > '2023-01-01' AND sd.severity = 'High') AND EXISTS (SELECT 1 FROM student_scholarships ss WHERE ss.student_id = s.student_id AND ss.scholarship_amount > 1000)\nORDER BY recent_enrollments DESC, avg_recent_grade DESC\nLIMIT 15 ;", "output": "WITH RecentEnrollments AS (SELECT student_id, COUNT(enrollment_id) AS recent_enrollments FROM enrollments WHERE enrollment_date > '2022-09-01' GROUP BY student_id), AvgRecentGrade AS (SELECT student_id, AVG(grade_value) AS avg_recent_grade FROM grades WHERE grade_date > '2022-09-01' GROUP BY student_id)\nSELECT s.student_id, s.student_name, s.major, COALESCE(re.recent_enrollments, 0) AS recent_enrollments, COALESCE(arg.avg_recent_grade, 0) AS avg_recent_grade\nFROM students AS s\nLEFT JOIN RecentEnrollments AS re ON s.student_id = re.student_id\nLEFT JOIN AvgRecentGrade AS arg ON s.student_id = arg.student_id\nLEFT JOIN student_disciplinary_actions AS sda ON s.student_id = sda.student_id AND sda.action_date > '2023-01-01' AND sda.severity = 'High'\nJOIN student_scholarships AS ss ON s.student_id = ss.student_id\nWHERE s.graduation_year = 2024 AND s.student_status = 'Active' AND sda.student_id IS NULL AND ss.scholarship_amount > 1000\nORDER BY recent_enrollments DESC, avg_recent_grade DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT p.patient_id, p.first_name, p.last_name, (SELECT MAX(va.visit_date) FROM patient_visits va WHERE va.patient_id = p.patient_id) AS last_visit_date, (SELECT COUNT(t.test_id) FROM medical_tests t WHERE t.patient_id = p.patient_id AND t.test_date > '2023-01-01' AND t.result = 'Abnormal') AS recent_abnormal_tests\nFROM patients p\nWHERE p.gender = 'Female' AND p.date_of_birth BETWEEN '1960-01-01' AND '1980-12-31' AND p.patient_id NOT IN (SELECT ad.patient_id FROM admission_details ad WHERE ad.admission_date > '2023-01-01' AND ad.diagnosis_code = 'C50') AND EXISTS (SELECT 1 FROM patient_medications pm WHERE pm.patient_id = p.patient_id AND pm.medication_status = 'Active')\nORDER BY last_visit_date DESC, recent_abnormal_tests DESC\nLIMIT 10 ;", "output": "WITH LastVisit AS (SELECT patient_id, MAX(visit_date) AS last_visit_date FROM patient_visits GROUP BY patient_id), RecentAbnormalTests AS (SELECT patient_id, COUNT(test_id) AS recent_abnormal_tests FROM medical_tests WHERE test_date > '2023-01-01' AND RESULT = 'Abnormal' GROUP BY patient_id)\nSELECT p.patient_id, p.first_name, p.last_name, lv.last_visit_date, COALESCE(rat.recent_abnormal_tests, 0) AS recent_abnormal_tests\nFROM patients AS p\nLEFT JOIN LastVisit AS lv ON p.patient_id = lv.patient_id\nLEFT JOIN RecentAbnormalTests AS rat ON p.patient_id = rat.patient_id\nLEFT JOIN admission_details AS ad ON p.patient_id = ad.patient_id AND ad.admission_date > '2023-01-01' AND ad.diagnosis_code = 'C50'\nJOIN patient_medications AS pm ON p.patient_id = pm.patient_id\nWHERE p.gender = 'Female' AND p.date_of_birth BETWEEN '1960-01-01' AND '1980-12-31' AND ad.patient_id IS NULL AND pm.medication_status = 'Active'\nORDER BY last_visit_date DESC, recent_abnormal_tests DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT h.hotel_name, h.city, (SELECT AVG(r.rating_score) FROM reviews r WHERE r.hotel_id = h.hotel_id AND r.review_date > '2023-01-01') AS avg_recent_rating, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id AND b.check_in_date BETWEEN '2023-10-01' AND '2023-12-31') AS Q4_bookings\nFROM hotels h\nWHERE h.star_rating = 5 AND h.country = 'France' AND h.hotel_id NOT IN (SELECT co.hotel_id FROM hotel_closures co WHERE co.closure_end_date > CURDATE()) AND EXISTS (SELECT 1 FROM hotel_amenities ha WHERE ha.hotel_id = h.hotel_id AND ha.amenity_type = 'Swimming Pool')\nORDER BY avg_recent_rating DESC, Q4_bookings DESC\nLIMIT 10 ;", "output": "WITH RecentRatings AS (SELECT hotel_id, AVG(rating_score) AS avg_recent_rating FROM reviews WHERE review_date > '2023-01-01' GROUP BY hotel_id), Q4Bookings AS (SELECT hotel_id, COUNT(booking_id) AS Q4_bookings FROM bookings WHERE check_in_date BETWEEN '2023-10-01' AND '2023-12-31' GROUP BY hotel_id)\nSELECT h.hotel_name, h.city, COALESCE(rr.avg_recent_rating, 0) AS avg_recent_rating, COALESCE(qb.Q4_bookings, 0) AS Q4_bookings\nFROM hotels AS h\nLEFT JOIN RecentRatings AS rr ON h.hotel_id = rr.hotel_id\nLEFT JOIN Q4Bookings AS qb ON h.hotel_id = qb.hotel_id\nLEFT JOIN hotel_closures AS hc ON h.hotel_id = hc.hotel_id AND hc.closure_end_date > CURDATE()\nJOIN hotel_amenities AS ha ON h.hotel_id = ha.hotel_id\nWHERE h.star_rating = 5 AND h.country = 'France' AND hc.hotel_id IS NULL AND ha.amenity_type = 'Swimming Pool'\nORDER BY avg_recent_rating DESC, Q4_bookings DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT v.vehicle_make, v.vehicle_model, v.model_year, (SELECT COUNT(s.service_id) FROM service_records s WHERE s.vehicle_id = v.vehicle_id AND s.service_date > '2023-01-01') AS recent_services, (SELECT AVG(r.repair_cost) FROM repair_records r WHERE r.vehicle_id = v.vehicle_id AND r.repair_date > '2023-01-01') AS avg_recent_repair_cost\nFROM vehicles v\nWHERE v.mileage < 50000 AND v.vehicle_type = 'Sedan' AND v.model_year BETWEEN 2018 AND 2022 AND v.vehicle_id NOT IN (SELECT rr.vehicle_id FROM recall_records rr WHERE rr.recall_date > '2023-01-01') AND EXISTS (SELECT 1 FROM vehicle_owners vo WHERE vo.vehicle_id = v.vehicle_id AND vo.owner_type = 'First Owner')\nORDER BY recent_services DESC, avg_recent_repair_cost DESC\nLIMIT 10 ;", "output": "WITH RecentServices AS (SELECT vehicle_id, COUNT(service_id) AS recent_services FROM service_records WHERE service_date > '2023-01-01' GROUP BY vehicle_id), AvgRecentRepairCost AS (SELECT vehicle_id, AVG(repair_cost) AS avg_recent_repair_cost FROM repair_records WHERE repair_date > '2023-01-01' GROUP BY vehicle_id)\nSELECT v.vehicle_make, v.vehicle_model, v.model_year, COALESCE(rs.recent_services, 0) AS recent_services, COALESCE(arrc.avg_recent_repair_cost, 0) AS avg_recent_repair_cost\nFROM vehicles AS v\nLEFT JOIN RecentServices AS rs ON v.vehicle_id = rs.vehicle_id\nLEFT JOIN AvgRecentRepairCost AS arrc ON v.vehicle_id = arrc.vehicle_id\nLEFT JOIN recall_records AS rr ON v.vehicle_id = rr.vehicle_id AND rr.recall_date > '2023-01-01'\nJOIN vehicle_owners AS vo ON v.vehicle_id = vo.vehicle_id\nWHERE v.mileage < 50000 AND v.vehicle_type = 'Sedan' AND v.model_year BETWEEN 2018 AND 2022 AND rr.vehicle_id IS NULL AND vo.owner_type = 'First Owner'\nORDER BY recent_services DESC, avg_recent_repair_cost DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT inv.investor_name, inv.country, (SELECT SUM(t.amount) FROM transactions t WHERE t.investor_id = inv.investor_id AND t.transaction_type = 'Buy' AND t.transaction_date > '2023-01-01') AS total_buy_2023, (SELECT SUM(t.amount) FROM transactions t WHERE t.investor_id = inv.investor_id AND t.transaction_type = 'Sell' AND t.transaction_date > '2023-01-01') AS total_sell_2023\nFROM investors inv\nWHERE inv.investment_strategy = 'Growth' AND inv.registration_date < '2020-01-01' AND inv.investor_id NOT IN (SELECT bl.investor_id FROM blacklist_investors bl WHERE bl.reason = 'Fraud') AND EXISTS (SELECT 1 FROM investor_portfolios ip WHERE ip.investor_id = inv.investor_id AND ip.asset_class = 'Stocks')\nORDER BY total_buy_2023 DESC, total_sell_2023 DESC\nLIMIT 10 ;", "output": "WITH InvestorBuys AS (SELECT investor_id, SUM(amount) AS total_buy_2023 FROM transactions WHERE transaction_type = 'Buy' AND transaction_date > '2023-01-01' GROUP BY investor_id), InvestorSells AS (SELECT investor_id, SUM(amount) AS total_sell_2023 FROM transactions WHERE transaction_type = 'Sell' AND transaction_date > '2023-01-01' GROUP BY investor_id)\nSELECT inv.investor_name, inv.country, COALESCE(ib.total_buy_2023, 0) AS total_buy_2023, COALESCE(is.total_sell_2023, 0) AS total_sell_2023\nFROM investors AS inv\nLEFT JOIN InvestorBuys AS ib ON inv.investor_id = ib.investor_id\nLEFT JOIN InvestorSells AS IS ON inv.investor_id = is.investor_id\nLEFT JOIN blacklist_investors AS bl ON inv.investor_id = bl.investor_id AND bl.reason = 'Fraud'\nJOIN investor_portfolios AS ip ON inv.investor_id = ip.investor_id\nWHERE inv.investment_strategy = 'Growth' AND inv.registration_date < '2020-01-01' AND bl.investor_id IS NULL AND ip.asset_class = 'Stocks'\nORDER BY total_buy_2023 DESC, total_sell_2023 DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.sensor_id, s.sensor_type, s.location, (SELECT AVG(d.reading_value) FROM sensor_data d WHERE d.sensor_id = s.sensor_id AND d.reading_date > CURDATE() - INTERVAL 1 DAY) AS avg_daily_reading, (SELECT MAX(d.reading_value) FROM sensor_data d WHERE d.sensor_id = s.sensor_id AND d.reading_date > CURDATE() - INTERVAL 1 DAY) AS max_daily_reading\nFROM sensors s\nWHERE s.status = 'Operational' AND s.deployment_date < '2023-01-01' AND s.sensor_id NOT IN (SELECT al.sensor_id FROM sensor_alerts al WHERE al.alert_level = 'Critical' AND al.alert_date > CURDATE() - INTERVAL 7 DAY) AND EXISTS (SELECT 1 FROM sensor_maintenance sm WHERE sm.sensor_id = s.sensor_id AND sm.maintenance_type = 'Calibration' AND sm.next_maintenance_date < CURDATE() + INTERVAL 30 DAY)\nORDER BY avg_daily_reading DESC, max_daily_reading DESC\nLIMIT 10 ;", "output": "WITH DailyReadings AS (SELECT sensor_id, AVG(reading_value) AS avg_daily_reading, MAX(reading_value) AS max_daily_reading FROM sensor_data WHERE reading_date > CURDATE() - INTERVAL 1 DAY GROUP BY sensor_id)\nSELECT s.sensor_id, s.sensor_type, s.location, COALESCE(dr.avg_daily_reading, 0) AS avg_daily_reading, COALESCE(dr.max_daily_reading, 0) AS max_daily_reading\nFROM sensors AS s\nLEFT JOIN DailyReadings AS dr ON s.sensor_id = dr.sensor_id\nLEFT JOIN sensor_alerts AS sa ON s.sensor_id = sa.sensor_id AND sa.alert_level = 'Critical' AND sa.alert_date > CURDATE() - INTERVAL 7 DAY\nJOIN sensor_maintenance AS sm ON s.sensor_id = sm.sensor_id\nWHERE s.status = 'Operational' AND s.deployment_date < '2023-01-01' AND sa.sensor_id IS NULL AND sm.maintenance_type = 'Calibration' AND sm.next_maintenance_date < CURDATE() + INTERVAL 30 DAY\nORDER BY avg_daily_reading DESC, max_daily_reading DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT c.campaign_id, c.campaign_name, c.start_date, (SELECT SUM(cm.clicks) FROM campaign_metrics cm WHERE cm.campaign_id = c.campaign_id AND cm.metric_date BETWEEN '2023-01-01' AND '2023-06-30') AS Q2_clicks, (SELECT AVG(cm.conversion_rate) FROM campaign_metrics cm WHERE cm.campaign_id = c.campaign_id AND cm.metric_date BETWEEN '2023-01-01' AND '2023-06-30') AS Q2_avg_conversion_rate\nFROM campaigns c\nWHERE c.campaign_type = 'Social Media' AND c.status = 'Completed' AND c.budget > 10000 AND c.campaign_id NOT IN (SELECT fr.campaign_id FROM fraud_reports fr WHERE fr.report_date > '2023-01-01') AND EXISTS (SELECT 1 FROM campaign_goals cg WHERE cg.campaign_id = c.campaign_id AND cg.goal_met = TRUE)\nORDER BY Q2_clicks DESC, Q2_avg_conversion_rate DESC\nLIMIT 10 ;", "output": "WITH Q2Metrics AS (SELECT campaign_id, SUM(clicks) AS Q2_clicks, AVG(conversion_rate) AS Q2_avg_conversion_rate FROM campaign_metrics WHERE metric_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY campaign_id)\nSELECT c.campaign_id, c.campaign_name, c.start_date, COALESCE(qm.Q2_clicks, 0) AS Q2_clicks, COALESCE(qm.Q2_avg_conversion_rate, 0) AS Q2_avg_conversion_rate\nFROM campaigns AS c\nLEFT JOIN Q2Metrics AS qm ON c.campaign_id = qm.campaign_id\nLEFT JOIN fraud_reports AS fr ON c.campaign_id = fr.campaign_id AND fr.report_date > '2023-01-01'\nJOIN campaign_goals AS cg ON c.campaign_id = cg.campaign_id\nWHERE c.campaign_type = 'Social Media' AND c.status = 'Completed' AND c.budget > 10000 AND fr.campaign_id IS NULL AND cg.goal_met = TRUE\nORDER BY Q2_clicks DESC, Q2_avg_conversion_rate DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, u.username, u.registration_date, COUNT(p.post_id) AS total_posts, AVG(p.likes) AS avg_likes_per_post\nFROM users u\nLEFT JOIN posts p ON u.user_id = p.user_id\nWHERE u.status = 'active' AND u.registration_date > '2022-01-01' AND p.created_at > '2023-01-01' AND u.user_id NOT IN (SELECT sp.user_id FROM suspended_users sp WHERE sp.suspension_end_date > CURDATE()) AND EXISTS (SELECT 1 FROM user_roles ur JOIN ROLES r ON ur.role_id = r.role_id WHERE ur.user_id = u.user_id AND r.role_name = 'Content Creator')\nGROUP BY u.user_id, u.username, u.registration_date\nHAVING COUNT(p.post_id) > 10 AND AVG(p.likes) > 50\nORDER BY total_posts DESC, avg_likes_per_post DESC\nLIMIT 20 ;", "output": "SELECT u.user_id, u.username, u.registration_date, COUNT(p.post_id) AS total_posts, AVG(p.likes) AS avg_likes_per_post\nFROM users AS u\nLEFT JOIN posts AS p ON u.user_id = p.user_id\nLEFT JOIN suspended_users AS su ON u.user_id = su.user_id AND su.suspension_end_date > CURDATE()\nJOIN user_roles AS ur ON u.user_id = ur.user_id\nJOIN ROLES AS r ON ur.role_id = r.role_id\nWHERE u.status = 'active' AND u.registration_date > '2022-01-01' AND p.created_at > '2023-01-01' AND su.user_id IS NULL AND r.role_name = 'Content Creator'\nGROUP BY u.user_id, u.username, u.registration_date\nHAVING COUNT(p.post_id) > 10 AND AVG(p.likes) > 50\nORDER BY total_posts DESC, avg_likes_per_post DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, p.price, p.stock_quantity, c.category_name, (SELECT AVG(pr.rating) FROM product_reviews pr WHERE pr.product_id = p.product_id) AS average_rating, (SELECT COUNT(oi.order_item_id) FROM order_items oi WHERE oi.product_id = p.product_id AND oi.order_id IN (SELECT order_id FROM orders WHERE order_date > '2023-01-01')) AS sales_2023\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nWHERE p.price > 50 AND p.stock_quantity > 0 AND c.category_name IN ('Electronics', 'Home Goods') AND p.product_id NOT IN (SELECT cp.product_id FROM discontinued_products cp WHERE cp.discontinuation_date > '2023-01-01')\nORDER BY average_rating DESC, sales_2023 DESC\nLIMIT 25 ;", "output": "WITH ProductRatings AS (SELECT product_id, AVG(rating) AS average_rating FROM product_reviews GROUP BY product_id), Sales2023 AS (SELECT oi.product_id, COUNT(oi.order_item_id) AS sales_2023 FROM order_items AS oi JOIN orders AS o ON oi.order_id = o.order_id WHERE o.order_date > '2023-01-01' GROUP BY oi.product_id)\nSELECT p.product_id, p.product_name, p.price, p.stock_quantity, c.category_name, COALESCE(pr.average_rating, 0) AS average_rating, COALESCE(s23.sales_2023, 0) AS sales_2023\nFROM products AS p\nJOIN categories AS c ON p.category_id = c.category_id\nLEFT JOIN ProductRatings AS pr ON p.product_id = pr.product_id\nLEFT JOIN Sales2023 AS s23 ON p.product_id = s23.product_id\nLEFT JOIN discontinued_products AS dp ON p.product_id = dp.product_id AND dp.discontinuation_date > '2023-01-01'\nWHERE p.price > 50 AND p.stock_quantity > 0 AND c.category_name IN ('Electronics', 'Home Goods') AND dp.product_id IS NULL\nORDER BY average_rating DESC, sales_2023 DESC\nLIMIT 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.event_id, e.event_name, e.event_date, e.location, COUNT(t.ticket_id) AS total_tickets_sold, SUM(t.price) AS total_revenue\nFROM EVENTS e\nLEFT JOIN tickets t ON e.event_id = t.event_id\nWHERE e.event_date BETWEEN '2024-01-01' AND '2024-06-30' AND e.event_type = 'Concert' AND e.event_id NOT IN (SELECT ce.event_id FROM cancelled_events ce WHERE ce.cancellation_date < CURDATE()) AND EXISTS (SELECT 1 FROM event_performers ep JOIN performers p ON ep.performer_id = p.performer_id WHERE ep.event_id = e.event_id AND p.genre = 'Rock')\nGROUP BY e.event_id, e.event_name, e.event_date, e.location\nHAVING COUNT(t.ticket_id) > 100 AND SUM(t.price) > 5000\nORDER BY total_revenue DESC, total_tickets_sold DESC\nLIMIT 15 ;", "output": "SELECT e.event_id, e.event_name, e.event_date, e.location, COUNT(t.ticket_id) AS total_tickets_sold, SUM(t.price) AS total_revenue\nFROM EVENTS AS e\nLEFT JOIN tickets AS t ON e.event_id = t.event_id\nLEFT JOIN cancelled_events AS ce ON e.event_id = ce.event_id AND ce.cancellation_date < CURDATE()\nJOIN event_performers AS ep ON e.event_id = ep.event_id\nJOIN performers AS p ON ep.performer_id = p.performer_id\nWHERE e.event_date BETWEEN '2024-01-01' AND '2024-06-30' AND e.event_type = 'Concert' AND ce.event_id IS NULL AND p.genre = 'Rock'\nGROUP BY e.event_id, e.event_name, e.event_date, e.location\nHAVING COUNT(t.ticket_id) > 100 AND SUM(t.price) > 5000\nORDER BY total_revenue DESC, total_tickets_sold DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT d.drug_id, d.drug_name, d.manufacturer, d.expiration_date\nFROM drugs d\nWHERE d.is_controlled = TRUE AND d.stock_quantity < 100 AND d.expiration_date BETWEEN CURDATE() AND CURDATE() + INTERVAL 6 MONTH AND d.drug_id IN (SELECT DISTINCT rs.drug_id FROM drug_reorder_suggestions rs WHERE rs.suggestion_date > CURDATE() - INTERVAL 30 DAY AND rs.priority = 'High') AND NOT EXISTS (SELECT 1 FROM drug_approvals da WHERE da.drug_id = d.drug_id AND da.approval_status = 'Pending')\nORDER BY d.expiration_date ASC, d.drug_name ASC\nLIMIT 20 ;", "output": "SELECT d.drug_id, d.drug_name, d.manufacturer, d.expiration_date\nFROM drugs AS d\nJOIN drug_reorder_suggestions AS drs ON d.drug_id = drs.drug_id\nLEFT JOIN drug_approvals AS da ON d.drug_id = da.drug_id\nWHERE d.is_controlled = TRUE AND d.stock_quantity < 100 AND d.expiration_date BETWEEN CURDATE() AND CURDATE() + INTERVAL 6 MONTH AND drs.suggestion_date > CURDATE() - INTERVAL 30 DAY AND drs.priority = 'High' AND (da.drug_id IS NULL OR da.approval_status != 'Pending')\nORDER BY d.expiration_date ASC, d.drug_name ASC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT f.flight_number, f.departure_airport_code, f.arrival_airport_code, f.departure_time, (SELECT COUNT(p.passenger_id) FROM bookings b JOIN passengers p ON b.passenger_id = p.passenger_id WHERE b.flight_id = f.flight_id AND b.booking_status = 'Confirmed') AS confirmed_passengers, (SELECT AVG(pr.price) FROM prices pr WHERE pr.flight_id = f.flight_id AND pr.price_date = CURDATE()) AS current_avg_price\nFROM flights f\nWHERE f.flight_date = CURDATE() + INTERVAL 7 DAY AND f.status = 'Scheduled' AND f.airline_id IN (SELECT airline_id FROM airlines WHERE airline_country = 'USA') AND f.flight_id NOT IN (SELECT dl.flight_id FROM delayed_flights dl WHERE dl.delay_reason = 'Technical')\nORDER BY confirmed_passengers DESC, current_avg_price DESC\nLIMIT 15 ;", "output": "WITH ConfirmedPassengers AS (SELECT b.flight_id, COUNT(p.passenger_id) AS confirmed_passengers FROM bookings AS b JOIN passengers AS p ON b.passenger_id = p.passenger_id WHERE b.booking_status = 'Confirmed' GROUP BY b.flight_id), CurrentAvgPrice AS (SELECT flight_id, AVG(price) AS current_avg_price FROM prices WHERE price_date = CURDATE() GROUP BY flight_id)\nSELECT f.flight_number, f.departure_airport_code, f.arrival_airport_code, f.departure_time, COALESCE(cp.confirmed_passengers, 0) AS confirmed_passengers, COALESCE(cap.current_avg_price, 0) AS current_avg_price\nFROM flights AS f\nLEFT JOIN ConfirmedPassengers AS cp ON f.flight_id = cp.flight_id\nLEFT JOIN CurrentAvgPrice AS cap ON f.flight_id = cap.flight_id\nJOIN airlines AS al ON f.airline_id = al.airline_id\nLEFT JOIN delayed_flights AS df ON f.flight_id = df.flight_id AND df.delay_reason = 'Technical'\nWHERE f.flight_date = CURDATE() + INTERVAL 7 DAY AND f.status = 'Scheduled' AND al.airline_country = 'USA' AND df.flight_id IS NULL\nORDER BY confirmed_passengers DESC, current_avg_price DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT ch.chapter_title, ch.chapter_number, b.book_title, b.author\nFROM chapters ch\nJOIN books b ON ch.book_id = b.book_id\nWHERE b.publication_year BETWEEN 2010 AND 2020 AND b.genre = 'Fantasy' AND ch.chapter_id NOT IN (SELECT pr.chapter_id FROM problem_reports pr WHERE pr.report_date > '2023-01-01' AND pr.severity = 'High') AND EXISTS (SELECT 1 FROM chapter_keywords ck WHERE ck.chapter_id = ch.chapter_id AND ck.keyword = 'Magic')\nORDER BY ch.chapter_number ASC, b.book_title ASC\nLIMIT 20 ;", "output": "SELECT ch.chapter_title, ch.chapter_number, b.book_title, b.author\nFROM chapters AS ch\nJOIN books AS b ON ch.book_id = b.book_id\nLEFT JOIN problem_reports AS pr ON ch.chapter_id = pr.chapter_id AND pr.report_date > '2023-01-01' AND pr.severity = 'High'\nJOIN chapter_keywords AS ck ON ch.chapter_id = ck.chapter_id\nWHERE b.publication_year BETWEEN 2010 AND 2020 AND b.genre = 'Fantasy' AND pr.chapter_id IS NULL AND ck.keyword = 'Magic'\nORDER BY ch.chapter_number ASC, b.book_title ASC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT d.device_name, d.device_type, d.last_seen\nFROM devices d\nWHERE d.status = 'Online' AND d.location = 'Server Room 1' AND d.device_id NOT IN (SELECT ir.device_id FROM incident_reports ir WHERE ir.incident_date > '2023-01-01' AND ir.impact = 'Critical') AND EXISTS (SELECT 1 FROM device_firmware df WHERE df.device_id = d.device_id AND df.firmware_version = '1.2.0') AND d.last_seen > CURDATE() - INTERVAL 1 HOUR\nORDER BY d.last_seen DESC, d.device_name ASC\nLIMIT 10 ;", "output": "SELECT d.device_name, d.device_type, d.last_seen\nFROM devices AS d\nLEFT JOIN incident_reports AS ir ON d.device_id = ir.device_id AND ir.incident_date > '2023-01-01' AND ir.impact = 'Critical'\nJOIN device_firmware AS df ON d.device_id = df.device_id\nWHERE d.status = 'Online' AND d.location = 'Server Room 1' AND df.firmware_version = '1.2.0' AND d.last_seen > CURDATE() - INTERVAL 1 HOUR AND ir.device_id IS NULL\nORDER BY d.last_seen DESC, d.device_name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.sensor_id, s.sensor_type, s.deployment_date\nFROM sensors s\nWHERE s.status = 'Active' AND s.location = 'Outdoor' AND s.sensor_id IN (SELECT md.sensor_id FROM measurement_data md WHERE md.measurement_value > 100 AND md.measurement_date > '2023-01-01' GROUP BY md.sensor_id HAVING COUNT(md.data_id) > 1000) AND EXISTS (SELECT 1 FROM sensor_alerts sa WHERE sa.sensor_id = s.sensor_id AND sa.alert_type = 'High Value' AND sa.alert_date > '2023-01-01')\nORDER BY s.deployment_date ASC, s.sensor_type ASC\nLIMIT 15 ;", "output": "SELECT s.sensor_id, s.sensor_type, s.deployment_date\nFROM sensors AS s\nJOIN (SELECT sensor_id FROM measurement_data WHERE measurement_value > 100 AND measurement_date > '2023-01-01' GROUP BY sensor_id HAVING COUNT(data_id) > 1000) AS high_value_sensors ON s.sensor_id = high_value_sensors.sensor_id\nJOIN sensor_alerts AS sa ON s.sensor_id = sa.sensor_id\nWHERE s.status = 'Active' AND s.location = 'Outdoor' AND sa.alert_type = 'High Value' AND sa.alert_date > '2023-01-01'\nORDER BY s.deployment_date ASC, s.sensor_type ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT t.team_name, t.team_lead, (SELECT COUNT(p.player_id) FROM players p WHERE p.team_id = t.team_id AND p.status = 'Active') AS active_players_count, (SELECT AVG(p.skill_rating) FROM players p WHERE p.team_id = t.team_id) AS avg_team_skill_rating\nFROM teams t\nWHERE t.league = 'Premier League' AND t.founding_year < 2000 AND t.team_id NOT IN (SELECT fp.team_id FROM financial_penalties fp WHERE fp.penalty_date > '2023-01-01' AND fp.penalty_amount > 10000)\nORDER BY active_players_count DESC, avg_team_skill_rating DESC\nLIMIT 10 ;", "output": "WITH TeamStats AS (SELECT team_id, COUNT(player_id) AS active_players_count, AVG(skill_rating) AS avg_team_skill_rating FROM players WHERE status = 'Active' GROUP BY team_id)\nSELECT t.team_name, t.team_lead, COALESCE(ts.active_players_count, 0) AS active_players_count, COALESCE(ts.avg_team_skill_rating, 0) AS avg_team_skill_rating\nFROM teams AS t\nLEFT JOIN TeamStats AS ts ON t.team_id = ts.team_id\nLEFT JOIN financial_penalties AS fp ON t.team_id = fp.team_id AND fp.penalty_date > '2023-01-01' AND fp.penalty_amount > 10000\nWHERE t.league = 'Premier League' AND t.founding_year < 2000 AND fp.team_id IS NULL\nORDER BY active_players_count DESC, avg_team_skill_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT f.forum_name, f.category, (SELECT COUNT(th.thread_id) FROM forum_threads th WHERE th.forum_id = f.forum_id AND th.created_date > '2023-01-01') AS new_threads_2023, (SELECT MAX(th.last_post_date) FROM forum_threads th WHERE th.forum_id = f.forum_id) AS last_activity_date\nFROM forums f\nWHERE f.status = 'Active' AND f.creation_date < '2020-01-01' AND f.forum_id NOT IN (SELECT fa.forum_id FROM forum_abuse_reports fa WHERE fa.report_date > '2023-01-01' AND fa.severity = 'High') AND EXISTS (SELECT 1 FROM forum_moderators fm WHERE fm.forum_id = f.forum_id AND fm.moderator_level = 'Admin')\nORDER BY new_threads_2023 DESC, last_activity_date DESC\nLIMIT 10 ;", "output": "WITH ForumThreadStats AS (SELECT forum_id, COUNT(thread_id) AS new_threads_2023, MAX(last_post_date) AS last_activity_date FROM forum_threads WHERE created_date > '2023-01-01' GROUP BY forum_id)\nSELECT f.forum_name, f.category, COALESCE(fts.new_threads_2023, 0) AS new_threads_2023, fts.last_activity_date\nFROM forums AS f\nLEFT JOIN ForumThreadStats AS fts ON f.forum_id = fts.forum_id\nLEFT JOIN forum_abuse_reports AS far ON f.forum_id = far.forum_id AND far.report_date > '2023-01-01' AND far.severity = 'High'\nJOIN forum_moderators AS fm ON f.forum_id = fm.forum_id\nWHERE f.status = 'Active' AND f.creation_date < '2020-01-01' AND far.forum_id IS NULL AND fm.moderator_level = 'Admin'\nORDER BY new_threads_2023 DESC, last_activity_date DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.playlist_name, p.creation_date, u.username\nFROM playlists p\nJOIN users u ON p.user_id = u.user_id\nWHERE p.is_public = TRUE AND u.country = 'USA' AND p.creation_date > '2023-01-01' AND p.playlist_id IN (SELECT pt.playlist_id FROM playlist_tracks pt WHERE pt.track_id IN (SELECT t.track_id FROM tracks t WHERE t.genre = 'Electronic' AND t.duration > 300)) AND NOT EXISTS (SELECT 1 FROM playlist_reports pr WHERE pr.playlist_id = p.playlist_id AND pr.report_type = 'Copyright Infringement')\nORDER BY p.creation_date DESC, p.playlist_name ASC\nLIMIT 10 ;", "output": "SELECT p.playlist_name, p.creation_date, u.username\nFROM playlists AS p\nJOIN users AS u ON p.user_id = u.user_id\nJOIN playlist_tracks AS pt ON p.playlist_id = pt.playlist_id\nJOIN tracks AS t ON pt.track_id = t.track_id\nLEFT JOIN playlist_reports AS pr ON p.playlist_id = pr.playlist_id AND pr.report_type = 'Copyright Infringement'\nWHERE p.is_public = TRUE AND u.country = 'USA' AND p.creation_date > '2023-01-01' AND t.genre = 'Electronic' AND t.duration > 300 AND pr.playlist_id IS NULL\nORDER BY p.creation_date DESC, p.playlist_name ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, u.username, u.email, u.first_name, u.last_name, u.registration_date, u.last_login, u.account_status, p.phone_number, p.phone_type, a.address_line1, a.address_line2, a.city, a.state, a.postal_code, a.country, pref.preference_name, pref.preference_value, sub.subscription_type, sub.subscription_status, sub.renewal_date, pay.payment_method, pay.card_last_four, pay.expiry_date, ord.order_count, ord.total_spent, ord.last_order_date, rev.review_count, rev.average_rating, sup.support_tickets, sup.last_ticket_date, not.notification_preferences, not.marketing_consent\nFROM users u\nLEFT JOIN user_phones p ON u.user_id = p.user_id\nLEFT JOIN user_addresses a ON u.user_id = a.user_id\nLEFT JOIN user_preferences pref ON u.user_id = pref.user_id\nLEFT JOIN user_subscriptions sub ON u.user_id = sub.user_id\nLEFT JOIN user_payment_methods pay ON u.user_id = pay.user_id\nLEFT JOIN (SELECT user_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent, MAX(order_date) AS last_order_date FROM orders GROUP BY user_id) ord ON u.user_id = ord.user_id\nLEFT JOIN (SELECT user_id, COUNT(*) AS review_count, AVG(rating) AS average_rating FROM reviews GROUP BY user_id) rev ON u.user_id = rev.user_id\nLEFT JOIN (SELECT user_id, COUNT(*) AS support_tickets, MAX(created_date) AS last_ticket_date FROM support_tickets GROUP BY user_id) sup ON u.user_id = sup.user_id\nLEFT JOIN user_notifications NOT ON u.user_id = not.user_id\nWHERE u.registration_date > '2022-01-01' AND u.account_status = 'active' AND u.last_login > '2023-06-01' AND sub.subscription_status = 'active' AND pay.payment_method IS NOT NULL AND ord.order_count > 5 AND ord.total_spent > 1000 AND rev.average_rating >= 4.0 AND sup.support_tickets < 3 AND not.marketing_consent = TRUE\nORDER BY ord.total_spent DESC, u.registration_date DESC\nLIMIT 50\nOFFSET 0", "output": "SELECT u.user_id, u.username, u.email, u.first_name, u.last_name, u.registration_date, u.last_login, u.account_status, p.phone_number, p.phone_type, a.address_line1, a.address_line2, a.city, a.state, a.postal_code, a.country, pref.preference_name, pref.preference_value, sub.subscription_type, sub.subscription_status, sub.renewal_date, pay.payment_method, pay.card_last_four, pay.expiry_date, ord.order_count, ord.total_spent, ord.last_order_date, rev.review_count, rev.average_rating, sup.support_tickets, sup.last_ticket_date, not.notification_preferences, not.marketing_consent\nFROM users u\nLEFT JOIN user_phones p ON u.user_id = p.user_id\nLEFT JOIN user_addresses a ON u.user_id = a.user_id\nLEFT JOIN user_preferences pref ON u.user_id = pref.user_id\nLEFT JOIN user_subscriptions sub ON u.user_id = sub.user_id\nLEFT JOIN user_payment_methods pay ON u.user_id = pay.user_id\nLEFT JOIN (SELECT user_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent, MAX(order_date) AS last_order_date FROM orders GROUP BY user_id) ord ON u.user_id = ord.user_id\nLEFT JOIN (SELECT user_id, COUNT(*) AS review_count, AVG(rating) AS average_rating FROM reviews GROUP BY user_id) rev ON u.user_id = rev.user_id\nLEFT JOIN (SELECT user_id, COUNT(*) AS support_tickets, MAX(created_date) AS last_ticket_date FROM support_tickets GROUP BY user_id) sup ON u.user_id = sup.user_id\nLEFT JOIN user_notifications NOT ON u.user_id = not.user_id\nWHERE u.registration_date > '2022-01-01' AND u.account_status = 'active' AND u.last_login > '2023-06-01' AND sub.subscription_status = 'active' AND pay.payment_method IS NOT NULL AND ord.order_count > 5 AND ord.total_spent > 1000 AND rev.average_rating >= 4.0 AND sup.support_tickets < 3 AND not.marketing_consent = TRUE\nORDER BY ord.total_spent DESC, u.registration_date DESC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT emp.employee_id, emp.first_name, emp.last_name, emp.email, emp.department, emp.position, emp.salary, emp.hire_date, emp.employment_type, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, d.department_head, l.office_name, l.city, l.country, s.skill_name, s.skill_level, p.project_name, p.project_status, r.role_name, r.responsibilities, t.team_name, t.team_leader, per.performance_rating, per.review_date, per.reviewer_name, sal.salary_amount, sal.effective_date, sal.salary_type, ben.benefit_name, ben.coverage_amount, ben.provider, att.attendance_date, att.hours_worked, att.overtime_hours, att.absence_reason, vac.vacation_days_used, vac.vacation_days_remaining, vac.sick_days_used, train.training_name, train.completion_date, train.certification_status\nFROM employees emp\nLEFT JOIN employees m ON emp.manager_id = m.employee_id\nJOIN departments d ON emp.department_id = d.department_id\nJOIN locations l ON emp.location_id = l.location_id\nJOIN employee_skills es ON emp.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON emp.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nJOIN teams t ON emp.team_id = t.team_id\nJOIN performance_reviews per ON emp.employee_id = per.employee_id\nJOIN salary_history sal ON emp.employee_id = sal.employee_id\nJOIN benefits ben ON emp.employee_id = ben.employee_id\nJOIN attendance_records att ON emp.employee_id = att.employee_id\nJOIN vacation_balances vac ON emp.employee_id = vac.employee_id\nJOIN training_records train ON emp.employee_id = train.employee_id\nWHERE emp.salary > 80000 AND emp.hire_date > '2019-01-01' AND emp.employment_type = 'full_time' AND d.department_name IN ('Engineering', 'Data Science', 'Product', 'UX/UI') AND l.country = 'USA' AND s.skill_level >= 4 AND p.project_status = 'active' AND r.role_name IN ('Senior', 'Lead', 'Architect', 'Manager') AND t.team_size > 5 AND per.performance_rating >= 4.2 AND sal.salary_amount > 85000 AND ben.coverage_amount > 50000 AND att.hours_worked > 160 AND vac.vacation_days_remaining > 7 AND train.certification_status = 'completed'\nORDER BY emp.salary DESC, per.performance_rating DESC, emp.hire_date DESC\nLIMIT 40\nOFFSET 0", "output": "SELECT emp.employee_id, emp.first_name, emp.last_name, emp.email, emp.department, emp.position, emp.salary, emp.hire_date, emp.employment_type, m.first_name AS manager_first, m.last_name AS manager_last, d.department_name, d.department_head, l.office_name, l.city, l.country, s.skill_name, s.skill_level, p.project_name, p.project_status, r.role_name, r.responsibilities, t.team_name, t.team_leader, per.performance_rating, per.review_date, per.reviewer_name, sal.salary_amount, sal.effective_date, sal.salary_type, ben.benefit_name, ben.coverage_amount, ben.provider, att.attendance_date, att.hours_worked, att.overtime_hours, att.absence_reason, vac.vacation_days_used, vac.vacation_days_remaining, vac.sick_days_used, train.training_name, train.completion_date, train.certification_status\nFROM employees emp\nLEFT JOIN employees m ON emp.manager_id = m.employee_id\nJOIN departments d ON emp.department_id = d.department_id\nJOIN locations l ON emp.location_id = l.location_id\nJOIN employee_skills es ON emp.employee_id = es.employee_id\nJOIN skills s ON es.skill_id = s.skill_id\nJOIN project_assignments pa ON emp.employee_id = pa.employee_id\nJOIN projects p ON pa.project_id = p.project_id\nJOIN ROLES r ON pa.role_id = r.role_id\nJOIN teams t ON emp.team_id = t.team_id\nJOIN performance_reviews per ON emp.employee_id = per.employee_id\nJOIN salary_history sal ON emp.employee_id = sal.employee_id\nJOIN benefits ben ON emp.employee_id = ben.employee_id\nJOIN attendance_records att ON emp.employee_id = att.employee_id\nJOIN vacation_balances vac ON emp.employee_id = vac.employee_id\nJOIN training_records train ON emp.employee_id = train.employee_id\nWHERE emp.salary > 80000 AND emp.hire_date > '2019-01-01' AND emp.employment_type = 'full_time' AND d.department_name IN ('Engineering', 'Data Science', 'Product', 'UX/UI') AND l.country = 'USA' AND s.skill_level >= 4 AND p.project_status = 'active' AND r.role_name IN ('Senior', 'Lead', 'Architect', 'Manager') AND t.team_size > 5 AND per.performance_rating >= 4.2 AND sal.salary_amount > 85000 AND ben.coverage_amount > 50000 AND att.hours_worked > 160 AND vac.vacation_days_remaining > 7 AND train.certification_status = 'completed'\nORDER BY emp.salary DESC, per.performance_rating DESC, emp.hire_date DESC\nLIMIT 40"}
{"instruction": "Optimize the SQL query", "input": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.sku, inv.upc_code, inv.current_quantity, inv.min_quantity, inv.max_quantity, inv.unit_cost, inv.total_value, inv.reorder_point, wh.warehouse_name, wh.location, wh.capacity_sqft, wh.manager_name, s.supplier_name, s.contact_person, s.contact_email, s.phone_number, s.supplier_rating, cat.category_name, cat.category_description, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reference_number, emp.employee_name, aud.audit_date, aud.audit_result, aud.auditor_name, ord.po_number, ord.order_quantity, ord.order_date, ord.expected_delivery, sup.unit_cost AS supply_cost, sup.min_order_quantity, sup.lead_time_days, qua.quality_score, qua.inspection_date, qua.inspector_name, ser.service_history, ser.last_service_date, ser.next_service_date, war.warranty_period, war.warranty_status, war.warranty_expiry\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN purchase_orders ord ON inv.inventory_id = ord.inventory_id\nLEFT JOIN supplier_costs sup ON inv.supplier_id = sup.supplier_id\nLEFT JOIN quality_controls qua ON inv.inventory_id = qua.inventory_id\nLEFT JOIN service_history ser ON inv.inventory_id = ser.inventory_id\nLEFT JOIN warranty_info war ON inv.inventory_id = war.inventory_id\nWHERE inv.current_quantity < inv.reorder_point AND inv.unit_cost > 15.00 AND wh.capacity_sqft > 10000 AND s.supplier_rating >= 4.5 AND cat.category_name IN ('Electronics', 'Mechanical', 'Electrical') AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-04-01' AND aud.audit_result = 'passed' AND ord.order_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND sup.lead_time_days < 10 AND qua.quality_score >= 95 AND ser.next_service_date > CURRENT_DATE AND war.warranty_status = 'active'\nORDER BY inv.current_quantity ASC, inv.unit_cost DESC, sup.lead_time_days ASC\nLIMIT 70\nOFFSET 0", "output": "SELECT inv.inventory_id, inv.item_name, inv.description, inv.sku, inv.upc_code, inv.current_quantity, inv.min_quantity, inv.max_quantity, inv.unit_cost, inv.total_value, inv.reorder_point, wh.warehouse_name, wh.location, wh.capacity_sqft, wh.manager_name, s.supplier_name, s.contact_person, s.contact_email, s.phone_number, s.supplier_rating, cat.category_name, cat.category_description, sub.subcategory_name, mov.movement_type, mov.quantity, mov.movement_date, mov.reference_number, emp.employee_name, aud.audit_date, aud.audit_result, aud.auditor_name, ord.po_number, ord.order_quantity, ord.order_date, ord.expected_delivery, sup.unit_cost AS supply_cost, sup.min_order_quantity, sup.lead_time_days, qua.quality_score, qua.inspection_date, qua.inspector_name, ser.service_history, ser.last_service_date, ser.next_service_date, war.warranty_period, war.warranty_status, war.warranty_expiry\nFROM inventory inv\nJOIN warehouses wh ON inv.warehouse_id = wh.warehouse_id\nJOIN suppliers s ON inv.supplier_id = s.supplier_id\nJOIN categories cat ON inv.category_id = cat.category_id\nJOIN subcategories sub ON inv.subcategory_id = sub.subcategory_id\nLEFT JOIN inventory_movements mov ON inv.inventory_id = mov.inventory_id\nLEFT JOIN employees emp ON mov.employee_id = emp.employee_id\nLEFT JOIN inventory_audits aud ON inv.inventory_id = aud.inventory_id\nLEFT JOIN purchase_orders ord ON inv.inventory_id = ord.inventory_id\nLEFT JOIN supplier_costs sup ON inv.supplier_id = sup.supplier_id\nLEFT JOIN quality_controls qua ON inv.inventory_id = qua.inventory_id\nLEFT JOIN service_history ser ON inv.inventory_id = ser.inventory_id\nLEFT JOIN warranty_info war ON inv.inventory_id = war.inventory_id\nWHERE inv.current_quantity < inv.reorder_point AND inv.unit_cost > 15.00 AND wh.capacity_sqft > 10000 AND s.supplier_rating >= 4.5 AND cat.category_name IN ('Electronics', 'Mechanical', 'Electrical') AND mov.movement_type = 'outbound' AND mov.movement_date > '2023-04-01' AND aud.audit_result = 'passed' AND ord.order_date IS NOT NULL AND ord.expected_delivery > CURRENT_DATE AND sup.lead_time_days < 10 AND qua.quality_score >= 95 AND ser.next_service_date > CURRENT_DATE AND war.warranty_status = 'active'\nORDER BY inv.current_quantity ASC, inv.unit_cost DESC, sup.lead_time_days ASC\nLIMIT 70"}
{"instruction": "Optimize the SQL query", "input": "SELECT loan.loan_id, loan.loan_amount, loan.interest_rate, loan.start_date, loan.end_date, loan.term_months, loan.loan_purpose, loan.loan_status, c.customer_id, c.customer_name, c.credit_score, c.annual_income, c.employment_status, c.years_at_current_job, e.employee_id, e.employee_name, e.department, br.branch_id, br.branch_name, br.branch_region, pt.payment_terms, pt.number_of_payments, pt.payment_frequency, sch.due_date, sch.amount_due, sch.principal_amount, sch.interest_amount, sch.payment_status, coll.collection_stage, coll.collection_status, coll.collection_amount, coll.collector_name, risk.risk_level, risk.risk_score, risk.probability_of_default, doc.document_name, doc.document_status, doc.verification_date, ins.insurance_coverage, ins.insurance_provider, ins.policy_number, g.guarantor_name, g.guarantor_relationship, g.guarantor_income, g.guarantor_credit_score, sec.collateral_type, sec.collateral_value, sec.collateral_description\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.loan_officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_terms_id = pt.terms_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nLEFT JOIN guarantors g ON loan.loan_id = g.loan_id\nLEFT JOIN security_collateral sec ON loan.loan_id = sec.loan_id\nWHERE loan.loan_amount > 40000.00 AND loan.interest_rate < 6.75 AND loan.start_date > '2020-07-01' AND loan.loan_status = 'active' AND c.credit_score > 750 AND c.annual_income > 85000 AND e.department = 'consumer_lending' AND br.branch_region IN ('west', 'southwest') AND pt.number_of_payments > 36 AND sch.due_date BETWEEN '2023-11-01' AND '2024-02-29' AND coll.collection_status = 'in_progress' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_coverage > loan.loan_amount * 0.9 AND g.guarantor_credit_score > 700 AND sec.collateral_value > loan.loan_amount * 1.2\nORDER BY loan.loan_amount DESC, loan.interest_rate ASC, c.credit_score DESC\nLIMIT 55\nOFFSET 0", "output": "SELECT loan.loan_id, loan.loan_amount, loan.interest_rate, loan.start_date, loan.end_date, loan.term_months, loan.loan_purpose, loan.loan_status, c.customer_id, c.customer_name, c.credit_score, c.annual_income, c.employment_status, c.years_at_current_job, e.employee_id, e.employee_name, e.department, br.branch_id, br.branch_name, br.branch_region, pt.payment_terms, pt.number_of_payments, pt.payment_frequency, sch.due_date, sch.amount_due, sch.principal_amount, sch.interest_amount, sch.payment_status, coll.collection_stage, coll.collection_status, coll.collection_amount, coll.collector_name, risk.risk_level, risk.risk_score, risk.probability_of_default, doc.document_name, doc.document_status, doc.verification_date, ins.insurance_coverage, ins.insurance_provider, ins.policy_number, g.guarantor_name, g.guarantor_relationship, g.guarantor_income, g.guarantor_credit_score, sec.collateral_type, sec.collateral_value, sec.collateral_description\nFROM loans loan\nJOIN customers c ON loan.customer_id = c.customer_id\nJOIN employees e ON loan.loan_officer_id = e.employee_id\nJOIN branches br ON loan.branch_id = br.branch_id\nJOIN payment_terms pt ON loan.payment_terms_id = pt.terms_id\nJOIN payment_schedule sch ON loan.loan_id = sch.loan_id\nLEFT JOIN collection_efforts coll ON loan.loan_id = coll.loan_id\nLEFT JOIN risk_assessments risk ON loan.loan_id = risk.loan_id\nLEFT JOIN loan_documents doc ON loan.loan_id = doc.loan_id\nLEFT JOIN loan_insurance ins ON loan.loan_id = ins.loan_id\nLEFT JOIN guarantors g ON loan.loan_id = g.loan_id\nLEFT JOIN security_collateral sec ON loan.loan_id = sec.loan_id\nWHERE loan.loan_amount > 40000.00 AND loan.interest_rate < 6.75 AND loan.start_date > '2020-07-01' AND loan.loan_status = 'active' AND c.credit_score > 750 AND c.annual_income > 85000 AND e.department = 'consumer_lending' AND br.branch_region IN ('west', 'southwest') AND pt.number_of_payments > 36 AND sch.due_date BETWEEN '2023-11-01' AND '2024-02-29' AND coll.collection_status = 'in_progress' AND risk.risk_level = 'low' AND doc.document_status = 'verified' AND ins.insurance_coverage > loan.loan_amount * 0.9 AND g.guarantor_credit_score > 700 AND sec.collateral_value > loan.loan_amount * 1.2\nORDER BY loan.loan_amount DESC, loan.interest_rate ASC, c.credit_score DESC\nLIMIT 55"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.project_id, p.project_name, p.project_description, p.start_date, p.end_date, p.estimated_budget, p.actual_cost, p.estimated_profit, p.project_status, p.priority_level, c.client_id, c.client_name, c.industry_sector, c.client_rating, m.employee_id AS manager_id, m.first_name AS manager_first, m.last_name AS manager_last, d.department_id, d.department_name, d.department_budget, t.team_id, t.team_name, t.team_size, r.risk_id, r.risk_description, r.impact_level, r.likelihood, r.mitigation_strategy, del.deliverable_id, del.deliverable_name, del.deliverable_status, del.due_date, res.resource_id, res.resource_name, res.resource_type, res.hourly_rate, times.time_entry_id, times.hours_logged, times.overtime_hours, times.work_date, exp.expense_id, exp.expense_description, exp.amount, exp.expense_date, mil.milestone_id, mil.milestone_name, mil.completion_date, mil.milestone_status, sta.stakeholder_id, sta.stakeholder_name, sta.influence_level, sta.interest_level\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.project_manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables del ON p.project_id = del.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nLEFT JOIN project_expenses exp ON p.project_id = exp.project_id\nLEFT JOIN project_milestones mil ON p.project_id = mil.project_id\nLEFT JOIN project_stakeholders sta ON p.project_id = sta.project_id\nWHERE p.start_date > '2021-09-01' AND p.estimated_budget > 125000.00 AND p.project_status IN ('execution', 'monitoring') AND c.industry_sector IN ('Technology', 'Finance', 'Healthcare', 'Energy') AND c.client_rating >= 4.3 AND d.department_name = 'Innovation' AND t.team_size > 7 AND r.impact_level IN ('high', 'medium') AND del.deliverable_status = 'in_progress' AND res.resource_type = 'external' AND res.hourly_rate > 65.00 AND times.hours_logged > 25 AND times.work_date > '2023-05-01' AND exp.amount > 2500.00 AND mil.milestone_status = 'completed' AND sta.influence_level = 'high'\nORDER BY p.estimated_budget DESC, p.priority_level ASC, p.start_date ASC\nLIMIT 35\nOFFSET 0", "output": "SELECT p.project_id, p.project_name, p.project_description, p.start_date, p.end_date, p.estimated_budget, p.actual_cost, p.estimated_profit, p.project_status, p.priority_level, c.client_id, c.client_name, c.industry_sector, c.client_rating, m.employee_id AS manager_id, m.first_name AS manager_first, m.last_name AS manager_last, d.department_id, d.department_name, d.department_budget, t.team_id, t.team_name, t.team_size, r.risk_id, r.risk_description, r.impact_level, r.likelihood, r.mitigation_strategy, del.deliverable_id, del.deliverable_name, del.deliverable_status, del.due_date, res.resource_id, res.resource_name, res.resource_type, res.hourly_rate, times.time_entry_id, times.hours_logged, times.overtime_hours, times.work_date, exp.expense_id, exp.expense_description, exp.amount, exp.expense_date, mil.milestone_id, mil.milestone_name, mil.completion_date, mil.milestone_status, sta.stakeholder_id, sta.stakeholder_name, sta.influence_level, sta.interest_level\nFROM projects p\nJOIN clients c ON p.client_id = c.client_id\nJOIN employees m ON p.project_manager_id = m.employee_id\nJOIN departments d ON p.department_id = d.department_id\nJOIN teams t ON p.team_id = t.team_id\nLEFT JOIN project_risks r ON p.project_id = r.project_id\nLEFT JOIN project_deliverables del ON p.project_id = del.project_id\nLEFT JOIN project_resources res ON p.project_id = res.project_id\nLEFT JOIN time_entries times ON p.project_id = times.project_id\nLEFT JOIN project_expenses exp ON p.project_id = exp.project_id\nLEFT JOIN project_milestones mil ON p.project_id = mil.project_id\nLEFT JOIN project_stakeholders sta ON p.project_id = sta.project_id\nWHERE p.start_date > '2021-09-01' AND p.estimated_budget > 125000.00 AND p.project_status IN ('execution', 'monitoring') AND c.industry_sector IN ('Technology', 'Finance', 'Healthcare', 'Energy') AND c.client_rating >= 4.3 AND d.department_name = 'Innovation' AND t.team_size > 7 AND r.impact_level IN ('high', 'medium') AND del.deliverable_status = 'in_progress' AND res.resource_type = 'external' AND res.hourly_rate > 65.00 AND times.hours_logged > 25 AND times.work_date > '2023-05-01' AND exp.amount > 2500.00 AND mil.milestone_status = 'completed' AND sta.influence_level = 'high'\nORDER BY p.estimated_budget DESC, p.priority_level ASC, p.start_date ASC\nLIMIT 35"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, u.username, u.email, (SELECT COUNT(DISTINCT p.post_id) FROM posts p WHERE p.user_id = u.user_id AND p.created_at > '2023-01-01') AS posts_count_2023, (SELECT AVG(c.rating) FROM comments c JOIN posts p ON c.post_id = p.post_id WHERE p.user_id = u.user_id AND c.created_at > '2023-01-01') AS avg_comment_rating_2023\nFROM users u\nWHERE u.registration_date BETWEEN '2022-01-01' AND '2022-12-31' AND u.status = 'active' AND u.user_id NOT IN (SELECT bl.user_id FROM blacklist_users bl WHERE bl.reason = 'Spamming') AND EXISTS (SELECT 1 FROM user_groups ug JOIN groups g ON ug.group_id = g.group_id WHERE ug.user_id = u.user_id AND g.group_type = 'Premium')\nORDER BY posts_count_2023 DESC, avg_comment_rating_2023 DESC\nLIMIT 15 ;", "output": "WITH UserPostStats AS (SELECT p.user_id, COUNT(DISTINCT p.post_id) AS posts_count_2023, AVG(c.rating) AS avg_comment_rating_2023 FROM posts AS p LEFT JOIN comments AS c ON p.post_id = c.post_id WHERE p.created_at > '2023-01-01' AND c.created_at > '2023-01-01' GROUP BY p.user_id)\nSELECT u.user_id, u.username, u.email, COALESCE(ups.posts_count_2023, 0) AS posts_count_2023, COALESCE(ups.avg_comment_rating_2023, 0) AS avg_comment_rating_2023\nFROM users AS u\nLEFT JOIN UserPostStats AS ups ON u.user_id = ups.user_id\nLEFT JOIN blacklist_users AS bl ON u.user_id = bl.user_id AND bl.reason = 'Spamming'\nJOIN user_groups AS ug ON u.user_id = ug.user_id\nJOIN groups AS g ON ug.group_id = g.group_id\nWHERE u.registration_date BETWEEN '2022-01-01' AND '2022-12-31' AND u.status = 'active' AND bl.user_id IS NULL AND g.group_type = 'Premium'\nORDER BY posts_count_2023 DESC, avg_comment_rating_2023 DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT p.product_id, p.product_name, p.price, (SELECT COUNT(oi.order_item_id) FROM order_items oi WHERE oi.product_id = p.product_id AND oi.order_id IN (SELECT order_id FROM orders WHERE order_date BETWEEN '2023-01-01' AND '2023-06-30')) AS total_sales_H1_2023, (SELECT AVG(rr.rating) FROM product_reviews rr WHERE rr.product_id = p.product_id AND rr.review_date > '2023-01-01') AS avg_review_score\nFROM products p\nWHERE p.category_id = (SELECT c.category_id FROM categories c WHERE c.category_name = 'Electronics') AND p.stock_quantity > 10 AND p.price > 100 AND p.product_id NOT IN (SELECT dp.product_id FROM discontinued_products dp WHERE dp.discontinuation_date > '2023-01-01')\nORDER BY total_sales_H1_2023 DESC, avg_review_score DESC\nLIMIT 20 ;", "output": "WITH H1Sales AS (SELECT oi.product_id, COUNT(oi.order_item_id) AS total_sales_H1_2023 FROM order_items AS oi JOIN orders AS o ON oi.order_id = o.order_id WHERE o.order_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY oi.product_id), ReviewScores AS (SELECT product_id, AVG(rating) AS avg_review_score FROM product_reviews WHERE review_date > '2023-01-01' GROUP BY product_id)\nSELECT p.product_id, p.product_name, p.price, COALESCE(hs.total_sales_H1_2023, 0) AS total_sales_H1_2023, COALESCE(rs.avg_review_score, 0) AS avg_review_score\nFROM products AS p\nJOIN categories AS cat ON p.category_id = cat.category_id\nLEFT JOIN H1Sales AS hs ON p.product_id = hs.product_id\nLEFT JOIN ReviewScores AS rs ON p.product_id = rs.product_id\nLEFT JOIN discontinued_products AS dp ON p.product_id = dp.product_id AND dp.discontinuation_date > '2023-01-01'\nWHERE cat.category_name = 'Electronics' AND p.stock_quantity > 10 AND p.price > 100 AND dp.product_id IS NULL\nORDER BY total_sales_H1_2023 DESC, avg_review_score DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.company_id, c.company_name, c.industry, (SELECT COUNT(DISTINCT pr.project_id) FROM projects pr WHERE pr.client_company_id = c.company_id AND pr.status = 'Completed' AND pr.end_date BETWEEN '2022-01-01' AND '2023-12-31') AS completed_projects_last_2_years, (SELECT AVG(pr.budget) FROM projects pr WHERE pr.client_company_id = c.company_id AND pr.status = 'Completed') AS avg_project_budget\nFROM companies c\nWHERE c.company_size = 'Large' AND c.founded_year < 2000 AND c.company_id NOT IN (SELECT bp.company_id FROM bankrupt_companies bp WHERE bp.bankruptcy_date > '2023-01-01') AND EXISTS (SELECT 1 FROM company_partnerships cp WHERE cp.company_id = c.company_id AND cp.partnership_type = 'Strategic Alliance')\nORDER BY completed_projects_last_2_years DESC, avg_project_budget DESC\nLIMIT 10 ;", "output": "WITH ProjectStats AS (SELECT client_company_id AS company_id, COUNT(DISTINCT project_id) AS completed_projects_last_2_years, AVG(budget) AS avg_project_budget FROM projects WHERE status = 'Completed' AND end_date BETWEEN '2022-01-01' AND '2023-12-31' GROUP BY client_company_id)\nSELECT c.company_id, c.company_name, c.industry, COALESCE(ps.completed_projects_last_2_years, 0) AS completed_projects_last_2_years, COALESCE(ps.avg_project_budget, 0) AS avg_project_budget\nFROM companies AS c\nLEFT JOIN ProjectStats AS ps ON c.company_id = ps.company_id\nLEFT JOIN bankrupt_companies AS bc ON c.company_id = bc.company_id AND bc.bankruptcy_date > '2023-01-01'\nJOIN company_partnerships AS cp ON c.company_id = cp.company_id\nWHERE c.company_size = 'Large' AND c.founded_year < 2000 AND bc.company_id IS NULL AND cp.partnership_type = 'Strategic Alliance'\nORDER BY completed_projects_last_2_years DESC, avg_project_budget DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.station_id, s.station_name, s.city, (SELECT AVG(r.temperature) FROM weather_readings r WHERE r.station_id = s.station_id AND r.reading_date BETWEEN '2023-01-01' AND '2023-01-31') AS avg_jan_temp, (SELECT MAX(r.wind_speed) FROM weather_readings r WHERE r.station_id = s.station_id AND r.reading_date BETWEEN '2023-01-01' AND '2023-01-31') AS max_jan_wind_speed\nFROM weather_stations s\nWHERE s.country = 'Germany' AND s.elevation > 500 AND s.station_id NOT IN (SELECT ff.station_id FROM equipment_failures ff WHERE ff.failure_date BETWEEN '2023-01-01' AND '2023-06-30') AND EXISTS (SELECT 1 FROM station_sensors ss WHERE ss.station_id = s.station_id AND ss.sensor_type = 'Anemometer')\nORDER BY avg_jan_temp DESC, max_jan_wind_speed DESC\nLIMIT 10 ;", "output": "WITH JanWeatherStats AS (SELECT station_id, AVG(temperature) AS avg_jan_temp, MAX(wind_speed) AS max_jan_wind_speed FROM weather_readings WHERE reading_date BETWEEN '2023-01-01' AND '2023-01-31' GROUP BY station_id)\nSELECT s.station_id, s.station_name, s.city, COALESCE(jws.avg_jan_temp, 0) AS avg_jan_temp, COALESCE(jws.max_jan_wind_speed, 0) AS max_jan_wind_speed\nFROM weather_stations AS s\nLEFT JOIN JanWeatherStats AS jws ON s.station_id = jws.station_id\nLEFT JOIN equipment_failures AS ef ON s.station_id = ef.station_id AND ef.failure_date BETWEEN '2023-01-01' AND '2023-06-30'\nJOIN station_sensors AS ss ON s.station_id = ss.station_id\nWHERE s.country = 'Germany' AND s.elevation > 500 AND ef.station_id IS NULL AND ss.sensor_type = 'Anemometer'\nORDER BY avg_jan_temp DESC, max_jan_wind_speed DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.playlist_id, p.playlist_name, u.username, (SELECT COUNT(pt.track_id) FROM playlist_tracks pt WHERE pt.playlist_id = p.playlist_id) AS total_tracks, (SELECT SUM(t.duration_seconds) FROM playlist_tracks pt JOIN tracks t ON pt.track_id = t.track_id WHERE pt.playlist_id = p.playlist_id) AS total_duration_seconds\nFROM playlists p\nJOIN users u ON p.user_id = u.user_id\nWHERE p.is_public = TRUE AND u.country = 'USA' AND p.creation_date BETWEEN '2022-01-01' AND '2022-12-31' AND p.playlist_id NOT IN (SELECT DISTINCT rp.playlist_id FROM reported_playlists rp WHERE rp.report_type = 'Inappropriate Content')\nORDER BY total_tracks DESC, total_duration_seconds DESC\nLIMIT 10 ;", "output": "WITH PlaylistStats AS (SELECT pt.playlist_id, COUNT(pt.track_id) AS total_tracks, SUM(t.duration_seconds) AS total_duration_seconds FROM playlist_tracks AS pt JOIN tracks AS t ON pt.track_id = t.track_id GROUP BY pt.playlist_id)\nSELECT p.playlist_id, p.playlist_name, u.username, COALESCE(ps.total_tracks, 0) AS total_tracks, COALESCE(ps.total_duration_seconds, 0) AS total_duration_seconds\nFROM playlists AS p\nJOIN users AS u ON p.user_id = u.user_id\nLEFT JOIN PlaylistStats AS ps ON p.playlist_id = ps.playlist_id\nLEFT JOIN reported_playlists AS rp ON p.playlist_id = rp.playlist_id AND rp.report_type = 'Inappropriate Content'\nWHERE p.is_public = TRUE AND u.country = 'USA' AND p.creation_date BETWEEN '2022-01-01' AND '2022-12-31' AND rp.playlist_id IS NULL\nORDER BY total_tracks DESC, total_duration_seconds DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT a.article_id, a.title, au.author_name, a.publication_date, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.article_id = a.article_id) AS total_comments, (SELECT AVG(r.rating_score) FROM article_ratings r WHERE r.article_id = a.article_id) AS avg_rating\nFROM articles a\nJOIN authors au ON a.author_id = au.author_id\nWHERE a.category = 'Technology' AND a.publication_date BETWEEN '2023-01-01' AND '2023-06-30' AND a.article_id NOT IN (SELECT pr.article_id FROM flagged_articles pr WHERE pr.flag_reason = 'Misinformation') AND EXISTS (SELECT 1 FROM article_tags AT JOIN tags t ON at.tag_id = t.tag_id WHERE at.article_id = a.article_id AND t.tag_name = 'AI')\nORDER BY total_comments DESC, avg_rating DESC\nLIMIT 15 ;", "output": "WITH ArticleStats AS (SELECT a.article_id, COUNT(c.comment_id) AS total_comments, AVG(r.rating_score) AS avg_rating FROM articles AS a LEFT JOIN comments AS c ON a.article_id = c.article_id LEFT JOIN article_ratings AS r ON a.article_id = r.article_id GROUP BY a.article_id)\nSELECT a.article_id, a.title, au.author_name, a.publication_date, COALESCE(aps.total_comments, 0) AS total_comments, COALESCE(aps.avg_rating, 0) AS avg_rating\nFROM articles AS a\nJOIN authors AS au ON a.author_id = au.author_id\nLEFT JOIN ArticleStats AS aps ON a.article_id = aps.article_id\nLEFT JOIN flagged_articles AS fa ON a.article_id = fa.article_id AND fa.flag_reason = 'Misinformation'\nJOIN article_tags AS AT ON a.article_id = at.article_id\nJOIN tags AS t ON at.tag_id = t.tag_id\nWHERE a.category = 'Technology' AND a.publication_date BETWEEN '2023-01-01' AND '2023-06-30' AND fa.article_id IS NULL AND t.tag_name = 'AI'\nORDER BY total_comments DESC, avg_rating DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT v.vendor_id, v.vendor_name, v.country, (SELECT SUM(po.total_amount) FROM purchase_orders po WHERE po.vendor_id = v.vendor_id AND po.order_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_purchase_amount, (SELECT AVG(dr.delivery_time_days) FROM delivery_records dr WHERE dr.vendor_id = v.vendor_id AND dr.delivery_date > '2023-01-01') AS avg_delivery_time\nFROM vendors v\nWHERE v.vendor_status = 'Preferred' AND v.contract_start_date < '2020-01-01' AND v.vendor_id NOT IN (SELECT lp.vendor_id FROM late_payments lp WHERE lp.payment_date > '2023-01-01') AND EXISTS (SELECT 1 FROM vendor_certifications vc WHERE vc.vendor_id = v.vendor_id AND vc.certification_type = 'ISO 9001')\nORDER BY annual_purchase_amount DESC, avg_delivery_time ASC\nLIMIT 10 ;", "output": "WITH VendorPurchaseStats AS (SELECT vendor_id, SUM(total_amount) AS annual_purchase_amount FROM purchase_orders WHERE order_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY vendor_id), VendorDeliveryStats AS (SELECT vendor_id, AVG(delivery_time_days) AS avg_delivery_time FROM delivery_records WHERE delivery_date > '2023-01-01' GROUP BY vendor_id)\nSELECT v.vendor_id, v.vendor_name, v.country, COALESCE(vps.annual_purchase_amount, 0) AS annual_purchase_amount, COALESCE(vds.avg_delivery_time, 0) AS avg_delivery_time\nFROM vendors AS v\nLEFT JOIN VendorPurchaseStats AS vps ON v.vendor_id = vps.vendor_id\nLEFT JOIN VendorDeliveryStats AS vds ON v.vendor_id = vds.vendor_id\nLEFT JOIN late_payments AS lp ON v.vendor_id = lp.vendor_id AND lp.payment_date > '2023-01-01'\nJOIN vendor_certifications AS vc ON v.vendor_id = vc.vendor_id\nWHERE v.vendor_status = 'Preferred' AND v.contract_start_date < '2020-01-01' AND lp.vendor_id IS NULL AND vc.certification_type = 'ISO 9001'\nORDER BY annual_purchase_amount DESC, avg_delivery_time ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT h.hospital_id, h.hospital_name, h.city, (SELECT COUNT(p.patient_id) FROM patients p WHERE p.hospital_id = h.hospital_id AND p.admission_date > '2023-01-01') AS patients_admitted_2023, (SELECT AVG(s.satisfaction_score) FROM patient_surveys s WHERE s.hospital_id = h.hospital_id AND s.survey_date > '2023-01-01') AS avg_patient_satisfaction\nFROM hospitals h\nWHERE h.hospital_type = 'General' AND h.number_of_beds > 200 AND h.hospital_id NOT IN (SELECT ci.hospital_id FROM critical_incidents ci WHERE ci.incident_date > '2023-01-01' AND ci.severity = 'High') AND EXISTS (SELECT 1 FROM hospital_accreditations ha WHERE ha.hospital_id = h.hospital_id AND ha.accreditation_body = 'JCI')\nORDER BY patients_admitted_2023 DESC, avg_patient_satisfaction DESC\nLIMIT 10 ;", "output": "WITH HospitalPatientStats AS (SELECT hospital_id, COUNT(patient_id) AS patients_admitted_2023 FROM patients WHERE admission_date > '2023-01-01' GROUP BY hospital_id), PatientSatisfaction AS (SELECT hospital_id, AVG(satisfaction_score) AS avg_patient_satisfaction FROM patient_surveys WHERE survey_date > '2023-01-01' GROUP BY hospital_id)\nSELECT h.hospital_id, h.hospital_name, h.city, COALESCE(hps.patients_admitted_2023, 0) AS patients_admitted_2023, COALESCE(ps.avg_patient_satisfaction, 0) AS avg_patient_satisfaction\nFROM hospitals AS h\nLEFT JOIN HospitalPatientStats AS hps ON h.hospital_id = hps.hospital_id\nLEFT JOIN PatientSatisfaction AS ps ON h.hospital_id = ps.hospital_id\nLEFT JOIN critical_incidents AS ci ON h.hospital_id = ci.hospital_id AND ci.incident_date > '2023-01-01' AND ci.severity = 'High'\nJOIN hospital_accreditations AS ha ON h.hospital_id = ha.hospital_id\nWHERE h.hospital_type = 'General' AND h.number_of_beds > 200 AND ci.hospital_id IS NULL AND ha.accreditation_body = 'JCI'\nORDER BY patients_admitted_2023 DESC, avg_patient_satisfaction DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.software_id, s.software_name, s.version, (SELECT COUNT(il.installation_id) FROM installations il WHERE il.software_id = s.software_id AND il.installation_date > '2023-01-01') AS installations_2023, (SELECT AVG(ur.usability_score) FROM user_reviews ur WHERE ur.software_id = s.software_id AND ur.review_date > '2023-01-01') AS avg_usability_score\nFROM software s\nWHERE s.software_type = 'Productivity' AND s.release_date < '2022-01-01' AND s.software_id NOT IN (SELECT vd.software_id FROM vulnerability_reports vd WHERE vd.report_date > '2023-01-01' AND vd.severity = 'Critical') AND EXISTS (SELECT 1 FROM software_licenses sl WHERE sl.software_id = s.software_id AND sl.license_type = 'Enterprise')\nORDER BY installations_2023 DESC, avg_usability_score DESC\nLIMIT 10 ;", "output": "WITH SoftwareStats AS (SELECT il.software_id, COUNT(il.installation_id) AS installations_2023, AVG(ur.usability_score) AS avg_usability_score FROM installations AS il LEFT JOIN user_reviews AS ur ON il.software_id = ur.software_id WHERE il.installation_date > '2023-01-01' AND ur.review_date > '2023-01-01' GROUP BY il.software_id)\nSELECT s.software_id, s.software_name, s.version, COALESCE(ss.installations_2023, 0) AS installations_2023, COALESCE(ss.avg_usability_score, 0) AS avg_usability_score\nFROM software AS s\nLEFT JOIN SoftwareStats AS ss ON s.software_id = ss.software_id\nLEFT JOIN vulnerability_reports AS vr ON s.software_id = vr.software_id AND vr.report_date > '2023-01-01' AND vr.severity = 'Critical'\nJOIN software_licenses AS sl ON s.software_id = sl.software_id\nWHERE s.software_type = 'Productivity' AND s.release_date < '2022-01-01' AND vr.software_id IS NULL AND sl.license_type = 'Enterprise'\nORDER BY installations_2023 DESC, avg_usability_score DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT f.firm_id, f.firm_name, f.city, (SELECT COUNT(cl.client_id) FROM clients cl WHERE cl.firm_id = f.firm_id AND cl.onboarding_date > '2023-01-01') AS new_clients_2023, (SELECT AVG(fb.satisfaction_score) FROM client_feedback fb WHERE fb.firm_id = f.firm_id AND fb.feedback_date > '2023-01-01') AS avg_client_satisfaction\nFROM firms f\nWHERE f.firm_type = 'Legal' AND f.founding_year < 1990 AND f.firm_id NOT IN (SELECT lr.firm_id FROM lawsuit_records lr WHERE lr.case_status = 'Lost' AND lr.case_date > '2023-01-01') AND EXISTS (SELECT 1 FROM firm_specialties fs WHERE fs.firm_id = f.firm_id AND fs.specialty_area = 'Corporate Law')\nORDER BY new_clients_2023 DESC, avg_client_satisfaction DESC\nLIMIT 10 ;", "output": "WITH FirmClientStats AS (SELECT cl.firm_id, COUNT(cl.client_id) AS new_clients_2023, AVG(fb.satisfaction_score) AS avg_client_satisfaction FROM clients AS cl LEFT JOIN client_feedback AS fb ON cl.firm_id = fb.firm_id WHERE cl.onboarding_date > '2023-01-01' AND fb.feedback_date > '2023-01-01' GROUP BY cl.firm_id)\nSELECT f.firm_id, f.firm_name, f.city, COALESCE(fcs.new_clients_2023, 0) AS new_clients_2023, COALESCE(fcs.avg_client_satisfaction, 0) AS avg_client_satisfaction\nFROM firms AS f\nLEFT JOIN FirmClientStats AS fcs ON f.firm_id = fcs.firm_id\nLEFT JOIN lawsuit_records AS lr ON f.firm_id = lr.firm_id AND lr.case_status = 'Lost' AND lr.case_date > '2023-01-01'\nJOIN firm_specialties AS fs ON f.firm_id = fs.firm_id\nWHERE f.firm_type = 'Legal' AND f.founding_year < 1990 AND lr.firm_id IS NULL AND fs.specialty_area = 'Corporate Law'\nORDER BY new_clients_2023 DESC, avg_client_satisfaction DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT uni.university_id, uni.university_name, uni.city, (SELECT COUNT(st.student_id) FROM students st WHERE st.university_id = uni.university_id AND st.enrollment_date > '2023-01-01') AS new_enrollments_2023, (SELECT AVG(pr.research_citations) FROM professors pr WHERE pr.university_id = uni.university_id) AS avg_prof_citations\nFROM universities uni\nWHERE uni.country = 'USA' AND uni.ranking <= 50 AND uni.university_id NOT IN (SELECT ap.university_id FROM academic_penalties ap WHERE ap.penalty_date > '2023-01-01') AND EXISTS (SELECT 1 FROM university_programs up WHERE up.university_id = uni.university_id AND up.program_type = 'Doctorate')\nORDER BY new_enrollments_2023 DESC, avg_prof_citations DESC\nLIMIT 10 ;", "output": "WITH UniversityStats AS (SELECT st.university_id, COUNT(st.student_id) AS new_enrollments_2023 FROM students AS st WHERE st.enrollment_date > '2023-01-01' GROUP BY st.university_id), ProfessorCitations AS (SELECT university_id, AVG(research_citations) AS avg_prof_citations FROM professors GROUP BY university_id)\nSELECT uni.university_id, uni.university_name, uni.city, COALESCE(us.new_enrollments_2023, 0) AS new_enrollments_2023, COALESCE(pc.avg_prof_citations, 0) AS avg_prof_citations\nFROM universities AS uni\nLEFT JOIN UniversityStats AS us ON uni.university_id = us.university_id\nLEFT JOIN ProfessorCitations AS pc ON uni.university_id = pc.university_id\nLEFT JOIN academic_penalties AS ap ON uni.university_id = ap.university_id AND ap.penalty_date > '2023-01-01'\nJOIN university_programs AS up ON uni.university_id = up.university_id\nWHERE uni.country = 'USA' AND uni.ranking <= 50 AND ap.university_id IS NULL AND up.program_type = 'Doctorate'\nORDER BY new_enrollments_2023 DESC, avg_prof_citations DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.sensor_id, s.sensor_type, s.location, (SELECT AVG(d.value) FROM sensor_data d WHERE d.sensor_id = s.sensor_id AND d.timestamp BETWEEN '2023-01-01' AND '2023-01-31') AS avg_jan_value, (SELECT COUNT(a.alert_id) FROM sensor_alerts a WHERE a.sensor_id = s.sensor_id AND a.alert_date BETWEEN '2023-01-01' AND '2023-01-31') AS jan_alerts\nFROM sensors s\nWHERE s.status = 'Operational' AND s.deployment_date < '2022-01-01' AND s.sensor_id NOT IN (SELECT ce.sensor_id FROM sensor_critical_errors ce WHERE ce.error_date > '2023-01-01') AND EXISTS (SELECT 1 FROM sensor_calibration sc WHERE sc.sensor_id = s.sensor_id AND sc.last_calibration_date > '2023-01-01')\nORDER BY jan_alerts DESC, avg_jan_value DESC\nLIMIT 10 ;", "output": "WITH JanSensorStats AS (SELECT sensor_id, AVG(value) AS avg_jan_value, COUNT(alert_id) AS jan_alerts FROM sensor_data AS sd LEFT JOIN sensor_alerts AS sa ON sd.sensor_id = sa.sensor_id AND sa.alert_date BETWEEN '2023-01-01' AND '2023-01-31' WHERE sd.timestamp BETWEEN '2023-01-01' AND '2023-01-31' GROUP BY sensor_id)\nSELECT s.sensor_id, s.sensor_type, s.location, COALESCE(jss.avg_jan_value, 0) AS avg_jan_value, COALESCE(jss.jan_alerts, 0) AS jan_alerts\nFROM sensors AS s\nLEFT JOIN JanSensorStats AS jss ON s.sensor_id = jss.sensor_id\nLEFT JOIN sensor_critical_errors AS sce ON s.sensor_id = sce.sensor_id AND sce.error_date > '2023-01-01'\nJOIN sensor_calibration AS sc ON s.sensor_id = sc.sensor_id\nWHERE s.status = 'Operational' AND s.deployment_date < '2022-01-01' AND sce.sensor_id IS NULL AND sc.last_calibration_date > '2023-01-01'\nORDER BY jan_alerts DESC, avg_jan_value DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT c.campaign_name, c.start_date, c.end_date, (SELECT SUM(cm.spend) FROM campaign_metrics cm WHERE cm.campaign_id = c.campaign_id AND cm.metric_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_spend, (SELECT AVG(cm.roi) FROM campaign_metrics cm WHERE cm.campaign_id = c.campaign_id AND cm.metric_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_avg_roi\nFROM campaigns c\nWHERE c.campaign_type = 'Digital' AND c.status = 'Active' AND c.budget > 5000 AND c.campaign_id NOT IN (SELECT fr.campaign_id FROM fraud_reports fr WHERE fr.report_date > '2023-01-01' AND fr.severity = 'High') AND EXISTS (SELECT 1 FROM campaign_creatives cc WHERE cc.campaign_id = c.campaign_id AND cc.creative_type = 'Video Ad')\nORDER BY Q1_spend DESC, Q1_avg_roi DESC\nLIMIT 10 ;", "output": "WITH Q1CampaignMetrics AS (SELECT campaign_id, SUM(spend) AS Q1_spend, AVG(roi) AS Q1_avg_roi FROM campaign_metrics WHERE metric_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY campaign_id)\nSELECT c.campaign_name, c.start_date, c.end_date, COALESCE(qcm.Q1_spend, 0) AS Q1_spend, COALESCE(qcm.Q1_avg_roi, 0) AS Q1_avg_roi\nFROM campaigns AS c\nLEFT JOIN Q1CampaignMetrics AS qcm ON c.campaign_id = qcm.campaign_id\nLEFT JOIN fraud_reports AS fr ON c.campaign_id = fr.campaign_id AND fr.report_date > '2023-01-01' AND fr.severity = 'High'\nJOIN campaign_creatives AS cc ON c.campaign_id = cc.campaign_id\nWHERE c.campaign_type = 'Digital' AND c.status = 'Active' AND c.budget > 5000 AND fr.campaign_id IS NULL AND cc.creative_type = 'Video Ad'\nORDER BY Q1_spend DESC, Q1_avg_roi DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT a.ad_id, a.ad_title, a.platform, (SELECT SUM(am.impressions) FROM ad_metrics am WHERE am.ad_id = a.ad_id AND am.metric_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_impressions, (SELECT AVG(am.ctr) FROM ad_metrics am WHERE am.ad_id = a.ad_id AND am.metric_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_avg_ctr\nFROM ads a\nWHERE a.campaign_id = (SELECT cm.campaign_id FROM campaigns cm WHERE cm.campaign_name = 'Summer Sale 2023') AND a.status = 'Active' AND a.ad_type = 'Banner' AND a.ad_id NOT IN (SELECT ar.ad_id FROM ad_rejections ar WHERE ar.rejection_date > '2023-01-01')\nORDER BY H1_impressions DESC, H1_avg_ctr DESC\nLIMIT 20 ;", "output": "WITH H1AdMetrics AS (SELECT ad_id, SUM(impressions) AS H1_impressions, AVG(ctr) AS H1_avg_ctr FROM ad_metrics WHERE metric_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY ad_id)\nSELECT a.ad_id, a.ad_title, a.platform, COALESCE(ham.H1_impressions, 0) AS H1_impressions, COALESCE(ham.H1_avg_ctr, 0) AS H1_avg_ctr\nFROM ads AS a\nJOIN campaigns AS cm ON a.campaign_id = cm.campaign_id\nLEFT JOIN H1AdMetrics AS ham ON a.ad_id = ham.ad_id\nLEFT JOIN ad_rejections AS ar ON a.ad_id = ar.ad_id AND ar.rejection_date > '2023-01-01'\nWHERE cm.campaign_name = 'Summer Sale 2023' AND a.status = 'Active' AND a.ad_type = 'Banner' AND ar.ad_id IS NULL\nORDER BY H1_impressions DESC, H1_avg_ctr DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT l.location_id, l.location_name, l.city, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.location_id = l.location_id AND e.hire_date > '2023-01-01') AS new_hires_2023, (SELECT AVG(r.rating) FROM office_reviews r WHERE r.location_id = l.location_id) AS avg_office_rating\nFROM locations l\nWHERE l.country = 'Canada' AND l.location_type = 'Office' AND l.location_id NOT IN (SELECT co.location_id FROM construction_projects co WHERE co.end_date > CURDATE()) AND EXISTS (SELECT 1 FROM location_amenities la WHERE la.location_id = l.location_id AND la.amenity_type = 'Cafeteria')\nORDER BY new_hires_2023 DESC, avg_office_rating DESC\nLIMIT 10 ;", "output": "WITH LocationEmployeeStats AS (SELECT e.location_id, COUNT(e.employee_id) AS new_hires_2023 FROM employees AS e WHERE e.hire_date > '2023-01-01' GROUP BY e.location_id), OfficeRatings AS (SELECT location_id, AVG(rating) AS avg_office_rating FROM office_reviews GROUP BY location_id)\nSELECT l.location_id, l.location_name, l.city, COALESCE(les.new_hires_2023, 0) AS new_hires_2023, COALESCE(ors.avg_office_rating, 0) AS avg_office_rating\nFROM locations AS l\nLEFT JOIN LocationEmployeeStats AS les ON l.location_id = les.location_id\nLEFT JOIN OfficeRatings AS ors ON l.location_id = ors.location_id\nLEFT JOIN construction_projects AS cp ON l.location_id = cp.location_id AND cp.end_date > CURDATE()\nJOIN location_amenities AS la ON l.location_id = la.location_id\nWHERE l.country = 'Canada' AND l.location_type = 'Office' AND cp.location_id IS NULL AND la.amenity_type = 'Cafeteria'\nORDER BY new_hires_2023 DESC, avg_office_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT m.membership_id, m.member_name, m.membership_level, (SELECT COUNT(a.activity_id) FROM member_activities a WHERE a.membership_id = m.membership_id AND a.activity_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_activities, (SELECT MAX(a.activity_date) FROM member_activities a WHERE a.membership_id = m.membership_id) AS last_activity\nFROM memberships m\nWHERE m.status = 'Active' AND m.join_date < '2022-01-01' AND m.membership_id NOT IN (SELECT fp.membership_id FROM membership_violations fp WHERE fp.violation_date > '2023-01-01' AND fp.severity = 'High') AND EXISTS (SELECT 1 FROM member_benefits mb JOIN benefits b ON mb.benefit_id = b.benefit_id WHERE mb.membership_id = m.membership_id AND b.benefit_type = 'Exclusive Access')\nORDER BY annual_activities DESC, last_activity DESC\nLIMIT 15 ;", "output": "WITH MemberActivityStats AS (SELECT membership_id, COUNT(activity_id) AS annual_activities, MAX(activity_date) AS last_activity FROM member_activities WHERE activity_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY membership_id)\nSELECT m.membership_id, m.member_name, m.membership_level, COALESCE(mas.annual_activities, 0) AS annual_activities, mas.last_activity\nFROM memberships AS m\nLEFT JOIN MemberActivityStats AS mas ON m.membership_id = mas.membership_id\nLEFT JOIN membership_violations AS mv ON m.membership_id = mv.membership_id AND mv.violation_date > '2023-01-01' AND mv.severity = 'High'\nJOIN member_benefits AS mb ON m.membership_id = mb.membership_id\nJOIN benefits AS b ON mb.benefit_id = b.benefit_id\nWHERE m.status = 'Active' AND m.join_date < '2022-01-01' AND mv.membership_id IS NULL AND b.benefit_type = 'Exclusive Access'\nORDER BY annual_activities DESC, last_activity DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.supplier_id, s.supplier_name, s.country, (SELECT SUM(po.total_amount) FROM purchase_orders po WHERE po.supplier_id = s.supplier_id AND po.order_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_purchase_amount, (SELECT AVG(dp.delivery_rating) FROM delivery_performance dp WHERE dp.supplier_id = s.supplier_id AND dp.rating_date > '2023-01-01') AS avg_delivery_rating\nFROM suppliers s\nWHERE s.supplier_status = 'Approved' AND s.contract_start_date < '2021-01-01' AND s.supplier_id NOT IN (SELECT qr.supplier_id FROM quality_reports qr WHERE qr.report_date > '2023-01-01' AND qr.issue_type = 'Major') AND EXISTS (SELECT 1 FROM supplier_products sp WHERE sp.supplier_id = s.supplier_id AND sp.product_category = 'Raw Materials')\nORDER BY H1_purchase_amount DESC, avg_delivery_rating DESC\nLIMIT 10 ;", "output": "WITH SupplierPurchaseStats AS (SELECT supplier_id, SUM(total_amount) AS H1_purchase_amount FROM purchase_orders WHERE order_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY supplier_id), DeliveryRatings AS (SELECT supplier_id, AVG(delivery_rating) AS avg_delivery_rating FROM delivery_performance WHERE rating_date > '2023-01-01' GROUP BY supplier_id)\nSELECT s.supplier_id, s.supplier_name, s.country, COALESCE(sps.H1_purchase_amount, 0) AS H1_purchase_amount, COALESCE(dr.avg_delivery_rating, 0) AS avg_delivery_rating\nFROM suppliers AS s\nLEFT JOIN SupplierPurchaseStats AS sps ON s.supplier_id = sps.supplier_id\nLEFT JOIN DeliveryRatings AS dr ON s.supplier_id = dr.supplier_id\nLEFT JOIN quality_reports AS qr ON s.supplier_id = qr.supplier_id AND qr.report_date > '2023-01-01' AND qr.issue_type = 'Major'\nJOIN supplier_products AS sp ON s.supplier_id = sp.supplier_id\nWHERE s.supplier_status = 'Approved' AND s.contract_start_date < '2021-01-01' AND qr.supplier_id IS NULL AND sp.product_category = 'Raw Materials'\nORDER BY H1_purchase_amount DESC, avg_delivery_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT v.vessel_id, v.vessel_name, v.vessel_type, (SELECT MAX(sp.speed_knots) FROM voyage_segments vs JOIN speed_readings sp ON vs.segment_id = sp.segment_id WHERE vs.vessel_id = v.vessel_id AND vs.voyage_date > '2023-01-01') AS max_recent_speed, (SELECT AVG(fc.fuel_consumption_per_hour) FROM voyage_segments vs JOIN fuel_logs fc ON vs.segment_id = fc.segment_id WHERE vs.vessel_id = v.vessel_id AND vs.voyage_date > '2023-01-01') AS avg_recent_fuel_consumption\nFROM vessels v\nWHERE v.status = 'Operational' AND v.build_year < 2010 AND v.vessel_id NOT IN (SELECT md.vessel_id FROM maintenance_due md WHERE md.due_date < CURDATE() + INTERVAL 30 DAY) AND EXISTS (SELECT 1 FROM vessel_sensors vsn WHERE vsn.vessel_id = v.vessel_id AND vsn.sensor_type = 'Engine Monitoring')\nORDER BY max_recent_speed DESC, avg_recent_fuel_consumption ASC\nLIMIT 10 ;", "output": "WITH VesselSpeed AS (SELECT vs.vessel_id, MAX(sp.speed_knots) AS max_recent_speed FROM voyage_segments AS vs JOIN speed_readings AS sp ON vs.segment_id = sp.segment_id WHERE vs.voyage_date > '2023-01-01' GROUP BY vs.vessel_id), VesselFuel AS (SELECT vs.vessel_id, AVG(fc.fuel_consumption_per_hour) AS avg_recent_fuel_consumption FROM voyage_segments AS vs JOIN fuel_logs AS fc ON vs.segment_id = fc.segment_id WHERE vs.voyage_date > '2023-01-01' GROUP BY vs.vessel_id)\nSELECT v.vessel_id, v.vessel_name, v.vessel_type, COALESCE(vs.max_recent_speed, 0) AS max_recent_speed, COALESCE(vf.avg_recent_fuel_consumption, 0) AS avg_recent_fuel_consumption\nFROM vessels AS v\nLEFT JOIN VesselSpeed AS vs ON v.vessel_id = vs.vessel_id\nLEFT JOIN VesselFuel AS vf ON v.vessel_id = vf.vessel_id\nLEFT JOIN maintenance_due AS md ON v.vessel_id = md.vessel_id AND md.due_date < CURDATE() + INTERVAL 30 DAY\nJOIN vessel_sensors AS vsn ON v.vessel_id = vsn.vessel_id\nWHERE v.status = 'Operational' AND v.build_year < 2010 AND md.vessel_id IS NULL AND vsn.sensor_type = 'Engine Monitoring'\nORDER BY max_recent_speed DESC, avg_recent_fuel_consumption ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.project_id, p.project_name, p.start_date, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = p.project_id AND t.status = 'Completed') AS completed_tasks_count, (SELECT AVG(t.actual_duration_days) FROM tasks t WHERE t.project_id = p.project_id AND t.status = 'Completed') AS avg_task_completion_time\nFROM projects p\nWHERE p.status = 'Active' AND p.budget > 100000 AND p.project_id NOT IN (SELECT di.project_id FROM project_delays di WHERE di.delay_start_date > '2023-01-01' AND di.severity = 'High') AND EXISTS (SELECT 1 FROM project_managers pm JOIN employees e ON pm.employee_id = e.employee_id WHERE pm.project_id = p.project_id AND e.department_id = (SELECT department_id FROM departments WHERE department_name = 'Project Management'))\nORDER BY completed_tasks_count DESC, avg_task_completion_time ASC\nLIMIT 10 ;", "output": "WITH ProjectTaskStats AS (SELECT project_id, COUNT(task_id) AS completed_tasks_count, AVG(actual_duration_days) AS avg_task_completion_time FROM tasks WHERE status = 'Completed' GROUP BY project_id)\nSELECT p.project_id, p.project_name, p.start_date, COALESCE(pts.completed_tasks_count, 0) AS completed_tasks_count, COALESCE(pts.avg_task_completion_time, 0) AS avg_task_completion_time\nFROM projects AS p\nLEFT JOIN ProjectTaskStats AS pts ON p.project_id = pts.project_id\nLEFT JOIN project_delays AS pd ON p.project_id = pd.project_id AND pd.delay_start_date > '2023-01-01' AND pd.severity = 'High'\nJOIN project_managers AS pm ON p.project_id = pm.project_id\nJOIN employees AS e ON pm.employee_id = e.employee_id\nJOIN departments AS d ON e.department_id = d.department_id\nWHERE p.status = 'Active' AND p.budget > 100000 AND pd.project_id IS NULL AND d.department_name = 'Project Management'\nORDER BY completed_tasks_count DESC, avg_task_completion_time ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT cu.customer_id, cu.customer_name, cu.email, (SELECT COUNT(s.subscription_id) FROM subscriptions s WHERE s.customer_id = cu.customer_id AND s.status = 'Active') AS active_subscriptions, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = cu.customer_id) AS last_order_date\nFROM customers cu\nWHERE cu.registration_date > '2022-01-01' AND cu.customer_type = 'Premium' AND cu.customer_id NOT IN (SELECT cp.customer_id FROM churned_customers cp WHERE cp.churn_date > '2023-01-01') AND EXISTS (SELECT 1 FROM customer_feedback cf WHERE cf.customer_id = cu.customer_id AND cf.feedback_score = 5)\nORDER BY active_subscriptions DESC, last_order_date DESC\nLIMIT 15 ;", "output": "WITH CustomerSubscriptionStats AS (SELECT customer_id, COUNT(subscription_id) AS active_subscriptions FROM subscriptions WHERE status = 'Active' GROUP BY customer_id), LastOrderDate AS (SELECT customer_id, MAX(order_date) AS last_order_date FROM orders GROUP BY customer_id)\nSELECT cu.customer_id, cu.customer_name, cu.email, COALESCE(css.active_subscriptions, 0) AS active_subscriptions, lod.last_order_date\nFROM customers AS cu\nLEFT JOIN CustomerSubscriptionStats AS css ON cu.customer_id = css.customer_id\nLEFT JOIN LastOrderDate AS lod ON cu.customer_id = lod.customer_id\nLEFT JOIN churned_customers AS cc ON cu.customer_id = cc.customer_id AND cc.churn_date > '2023-01-01'\nJOIN customer_feedback AS cf ON cu.customer_id = cf.customer_id\nWHERE cu.registration_date > '2022-01-01' AND cu.customer_type = 'Premium' AND cc.customer_id IS NULL AND cf.feedback_score = 5\nORDER BY active_subscriptions DESC, last_order_date DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT b.building_id, b.building_name, b.address, (SELECT SUM(uf.utility_cost) FROM utility_bills uf WHERE uf.building_id = b.building_id AND uf.bill_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_utility_cost, (SELECT AVG(oc.occupancy_rate) FROM occupancy_data oc WHERE oc.building_id = b.building_id AND oc.data_date BETWEEN '2023-01-01' AND '2023-12-31') AS avg_annual_occupancy\nFROM buildings b\nWHERE b.building_type = 'Commercial' AND b.year_built < 2000 AND b.building_id NOT IN (SELECT rs.building_id FROM structural_issues rs WHERE rs.issue_date > '2023-01-01' AND rs.severity = 'High') AND EXISTS (SELECT 1 FROM building_certifications bc WHERE bc.building_id = b.building_id AND bc.certification_type = 'LEED Platinum')\nORDER BY annual_utility_cost DESC, avg_annual_occupancy DESC\nLIMIT 10 ;", "output": "WITH BuildingUtilityCosts AS (SELECT building_id, SUM(utility_cost) AS annual_utility_cost FROM utility_bills WHERE bill_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY building_id), AnnualOccupancy AS (SELECT building_id, AVG(occupancy_rate) AS avg_annual_occupancy FROM occupancy_data WHERE data_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY building_id)\nSELECT b.building_id, b.building_name, b.address, COALESCE(buc.annual_utility_cost, 0) AS annual_utility_cost, COALESCE(ao.avg_annual_occupancy, 0) AS avg_annual_occupancy\nFROM buildings AS b\nLEFT JOIN BuildingUtilityCosts AS buc ON b.building_id = buc.building_id\nLEFT JOIN AnnualOccupancy AS ao ON b.building_id = ao.building_id\nLEFT JOIN structural_issues AS si ON b.building_id = si.building_id AND si.issue_date > '2023-01-01' AND si.severity = 'High'\nJOIN building_certifications AS bc ON b.building_id = bc.building_id\nWHERE b.building_type = 'Commercial' AND b.year_built < 2000 AND si.building_id IS NULL AND bc.certification_type = 'LEED Platinum'\nORDER BY annual_utility_cost DESC, avg_annual_occupancy DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT inv.investor_id, inv.investor_name, inv.country, (SELECT SUM(tr.amount) FROM transactions tr WHERE tr.investor_id = inv.investor_id AND tr.transaction_type = 'Equity Buy' AND tr.transaction_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_equity_buys, (SELECT AVG(pr.return_percentage) FROM portfolio_returns pr WHERE pr.investor_id = inv.investor_id AND pr.period = 'YTD') AS YTD_avg_return\nFROM investors inv\nWHERE inv.investment_focus = 'Technology' AND inv.risk_tolerance = 'High' AND inv.investor_id NOT IN (SELECT ft.investor_id FROM fraudulent_transactions ft WHERE ft.transaction_date > '2023-01-01') AND EXISTS (SELECT 1 FROM investor_preferences ip WHERE ip.investor_id = inv.investor_id AND ip.preference_type = 'ESG Investing')\nORDER BY H1_equity_buys DESC, YTD_avg_return DESC\nLIMIT 10 ;", "output": "WITH H1EquityBuys AS (SELECT investor_id, SUM(amount) AS H1_equity_buys FROM transactions WHERE transaction_type = 'Equity Buy' AND transaction_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY investor_id), YTDReturns AS (SELECT investor_id, AVG(return_percentage) AS YTD_avg_return FROM portfolio_returns WHERE period = 'YTD' GROUP BY investor_id)\nSELECT inv.investor_id, inv.investor_name, inv.country, COALESCE(heb.H1_equity_buys, 0) AS H1_equity_buys, COALESCE(ytdr.YTD_avg_return, 0) AS YTD_avg_return\nFROM investors AS inv\nLEFT JOIN H1EquityBuys AS heb ON inv.investor_id = heb.investor_id\nLEFT JOIN YTDReturns AS ytdr ON inv.investor_id = ytdr.investor_id\nLEFT JOIN fraudulent_transactions AS ft ON inv.investor_id = ft.investor_id AND ft.transaction_date > '2023-01-01'\nJOIN investor_preferences AS ip ON inv.investor_id = ip.investor_id\nWHERE inv.investment_focus = 'Technology' AND inv.risk_tolerance = 'High' AND ft.investor_id IS NULL AND ip.preference_type = 'ESG Investing'\nORDER BY H1_equity_buys DESC, YTD_avg_return DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT d.division_id, d.division_name, d.head_count, (SELECT COUNT(p.project_id) FROM projects p WHERE p.division_id = d.division_id AND p.status = 'Completed' AND p.end_date BETWEEN '2023-01-01' AND '2023-12-31') AS completed_projects_2023, (SELECT AVG(e.salary) FROM employees e WHERE e.division_id = d.division_id AND e.status = 'Active') AS avg_division_salary\nFROM divisions d\nWHERE d.annual_revenue_usd > 100000000 AND d.location = 'Global' AND d.division_id NOT IN (SELECT rd.division_id FROM restructuring_data rd WHERE rd.start_date < CURDATE() AND rd.end_date > CURDATE()) AND EXISTS (SELECT 1 FROM division_goals dg WHERE dg.division_id = d.division_id AND dg.goal_year = 2023 AND dg.status = 'Achieved')\nORDER BY completed_projects_2023 DESC, avg_division_salary DESC\nLIMIT 10 ;", "output": "WITH CompletedProjects AS (SELECT project_id, division_id FROM projects WHERE status = 'Completed' AND end_date BETWEEN '2023-01-01' AND '2023-12-31'), DivisionProjectCounts AS (SELECT division_id, COUNT(project_id) AS completed_projects_2023 FROM CompletedProjects GROUP BY division_id), DivisionAvgSalary AS (SELECT division_id, AVG(salary) AS avg_division_salary FROM employees WHERE status = 'Active' GROUP BY division_id)\nSELECT d.division_id, d.division_name, d.head_count, COALESCE(dpc.completed_projects_2023, 0) AS completed_projects_2023, COALESCE(das.avg_division_salary, 0) AS avg_division_salary\nFROM divisions AS d\nLEFT JOIN DivisionProjectCounts AS dpc ON d.division_id = dpc.division_id\nLEFT JOIN DivisionAvgSalary AS das ON d.division_id = das.division_id\nLEFT JOIN restructuring_data AS rd ON d.division_id = rd.division_id AND rd.start_date < CURDATE() AND rd.end_date > CURDATE()\nJOIN division_goals AS dg ON d.division_id = dg.division_id\nWHERE d.annual_revenue_usd > 100000000 AND d.location = 'Global' AND rd.division_id IS NULL AND dg.goal_year = 2023 AND dg.status = 'Achieved'\nORDER BY completed_projects_2023 DESC, avg_division_salary DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.store_id, s.store_name, s.city, s.region, (SELECT SUM(t.total_amount) FROM transactions t WHERE t.store_id = s.store_id AND t.transaction_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_total_sales, (SELECT AVG(cr.customer_satisfaction_score) FROM customer_reviews cr WHERE cr.store_id = s.store_id AND cr.review_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_avg_satisfaction\nFROM stores s\nWHERE s.store_type = 'Retail' AND s.opening_date < '2015-01-01' AND s.store_id NOT IN (SELECT fa.store_id FROM facility_alerts fa WHERE fa.alert_date > '2023-01-01' AND fa.alert_type = 'Security Breach') AND EXISTS (SELECT 1 FROM store_products sp JOIN products p ON sp.product_id = p.product_id WHERE sp.store_id = s.store_id AND p.category_id = (SELECT category_id FROM categories WHERE category_name = 'Electronics'))\nORDER BY Q1_total_sales DESC, Q1_avg_satisfaction DESC\nLIMIT 10 ;", "output": "WITH Q1Sales AS (SELECT store_id, SUM(total_amount) AS Q1_total_sales FROM transactions WHERE transaction_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY store_id), Q1Satisfaction AS (SELECT store_id, AVG(customer_satisfaction_score) AS Q1_avg_satisfaction FROM customer_reviews WHERE review_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY store_id)\nSELECT s.store_id, s.store_name, s.city, s.region, COALESCE(qs.Q1_total_sales, 0) AS Q1_total_sales, COALESCE(qcs.Q1_avg_satisfaction, 0) AS Q1_avg_satisfaction\nFROM stores AS s\nLEFT JOIN Q1Sales AS qs ON s.store_id = qs.store_id\nLEFT JOIN Q1Satisfaction AS qcs ON s.store_id = qcs.store_id\nLEFT JOIN facility_alerts AS fa ON s.store_id = fa.store_id AND fa.alert_date > '2023-01-01' AND fa.alert_type = 'Security Breach'\nJOIN store_products AS sp ON s.store_id = sp.store_id\nJOIN products AS p ON sp.product_id = p.product_id\nJOIN categories AS cat ON p.category_id = cat.category_id\nWHERE s.store_type = 'Retail' AND s.opening_date < '2015-01-01' AND fa.store_id IS NULL AND cat.category_name = 'Electronics'\nGROUP BY s.store_id, s.store_name, s.city, s.region\nORDER BY Q1_total_sales DESC, Q1_avg_satisfaction DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT c.country_name, c.population, c.gdp_usd, (SELECT AVG(le.life_expectancy) FROM demographics le WHERE le.country_id = c.country_id AND le.year = 2023) AS avg_life_expectancy_2023, (SELECT SUM(co2.emissions_metric_tons) FROM carbon_emissions co2 WHERE co2.country_id = c.country_id AND co2.year BETWEEN 2020 AND 2022) AS last_3_year_emissions\nFROM countries c\nWHERE c.continent = 'Europe' AND c.gdp_per_capita_usd > 50000 AND c.country_id NOT IN (SELECT dr.country_id FROM disaster_relief dr WHERE dr.disaster_date > '2023-01-01' AND dr.relief_amount > 1000000) AND EXISTS (SELECT 1 FROM country_trade_agreements cta WHERE cta.country_id = c.country_id AND cta.partner_country_id IN (SELECT country_id FROM countries WHERE country_name = 'USA'))\nORDER BY avg_life_expectancy_2023 DESC, last_3_year_emissions ASC\nLIMIT 10 ;", "output": "WITH CountryDemographics AS (SELECT country_id, AVG(life_expectancy) AS avg_life_expectancy_2023 FROM demographics WHERE YEAR = 2023 GROUP BY country_id), CarbonEmissions AS (SELECT country_id, SUM(emissions_metric_tons) AS last_3_year_emissions FROM carbon_emissions WHERE YEAR BETWEEN 2020 AND 2022 GROUP BY country_id), USACountry AS (SELECT country_id FROM countries WHERE country_name = 'USA')\nSELECT c.country_name, c.population, c.gdp_usd, COALESCE(cd.avg_life_expectancy_2023, 0) AS avg_life_expectancy_2023, COALESCE(ce.last_3_year_emissions, 0) AS last_3_year_emissions\nFROM countries AS c\nLEFT JOIN CountryDemographics AS cd ON c.country_id = cd.country_id\nLEFT JOIN CarbonEmissions AS ce ON c.country_id = ce.country_id\nLEFT JOIN disaster_relief AS dr ON c.country_id = dr.country_id AND dr.disaster_date > '2023-01-01' AND dr.relief_amount > 1000000\nJOIN country_trade_agreements AS cta ON c.country_id = cta.country_id\nJOIN USACountry AS uc ON cta.partner_country_id = uc.country_id\nWHERE c.continent = 'Europe' AND c.gdp_per_capita_usd > 50000 AND dr.country_id IS NULL\nORDER BY avg_life_expectancy_2023 DESC, last_3_year_emissions ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.shipping_provider_id, s.provider_name, s.country, (SELECT AVG(dt.delivery_time_days) FROM delivery_tracking dt WHERE dt.shipping_provider_id = s.shipping_provider_id AND dt.delivery_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_avg_delivery_time, (SELECT COUNT(pkg.package_id) FROM packages pkg WHERE pkg.shipping_provider_id = s.shipping_provider_id AND pkg.status = 'Delivered' AND pkg.delivery_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_delivered_packages\nFROM shipping_providers s\nWHERE s.service_type = 'Express' AND s.rating > 4.0 AND s.shipping_provider_id NOT IN (SELECT is.provider_id FROM incident_shipments IS WHERE is.incident_date > '2023-01-01' AND is.severity = 'High') AND EXISTS (SELECT 1 FROM provider_coverage pc WHERE pc.shipping_provider_id = s.shipping_provider_id AND pc.coverage_area = 'International')\nORDER BY H1_avg_delivery_time ASC, H1_delivered_packages DESC\nLIMIT 10 ;", "output": "WITH H1DeliveryStats AS (SELECT dt.shipping_provider_id, AVG(dt.delivery_time_days) AS H1_avg_delivery_time FROM delivery_tracking AS dt WHERE dt.delivery_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY dt.shipping_provider_id), H1DeliveredPackages AS (SELECT pkg.shipping_provider_id, COUNT(pkg.package_id) AS H1_delivered_packages FROM packages AS pkg WHERE pkg.status = 'Delivered' AND pkg.delivery_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY pkg.shipping_provider_id)\nSELECT s.shipping_provider_id, s.provider_name, s.country, COALESCE(hds.H1_avg_delivery_time, 0) AS H1_avg_delivery_time, COALESCE(hdp.H1_delivered_packages, 0) AS H1_delivered_packages\nFROM shipping_providers AS s\nLEFT JOIN H1DeliveryStats AS hds ON s.shipping_provider_id = hds.shipping_provider_id\nLEFT JOIN H1DeliveredPackages AS hdp ON s.shipping_provider_id = hdp.shipping_provider_id\nLEFT JOIN incident_shipments AS ins ON s.shipping_provider_id = ins.provider_id AND ins.incident_date > '2023-01-01' AND ins.severity = 'High'\nJOIN provider_coverage AS pc ON s.shipping_provider_id = pc.shipping_provider_id\nWHERE s.service_type = 'Express' AND s.rating > 4.0 AND ins.provider_id IS NULL AND pc.coverage_area = 'International'\nORDER BY H1_avg_delivery_time ASC, H1_delivered_packages DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT cu.currency_code, cu.currency_name, (SELECT AVG(er.exchange_rate) FROM exchange_rates er WHERE er.to_currency_code = cu.currency_code AND er.exchange_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_avg_exchange_rate, (SELECT MAX(er.exchange_rate) FROM exchange_rates er WHERE er.to_currency_code = cu.currency_code AND er.exchange_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_max_exchange_rate\nFROM currencies cu\nWHERE cu.is_fiat = TRUE AND cu.country_code IN ('USD', 'EUR', 'GBP') AND cu.currency_code NOT IN (SELECT cr.currency_code FROM currency_restrictions cr WHERE cr.restriction_start_date < CURDATE() AND cr.restriction_end_date > CURDATE()) AND EXISTS (SELECT 1 FROM currency_trade_volumes ctv WHERE ctv.currency_code = cu.currency_code AND ctv.trade_date = CURDATE())\nORDER BY Q1_avg_exchange_rate DESC, Q1_max_exchange_rate DESC\nLIMIT 5 ;", "output": "WITH Q1ExchangeRates AS (SELECT to_currency_code AS currency_code, AVG(exchange_rate) AS Q1_avg_exchange_rate, MAX(exchange_rate) AS Q1_max_exchange_rate FROM exchange_rates WHERE exchange_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY to_currency_code)\nSELECT cu.currency_code, cu.currency_name, COALESCE(qer.Q1_avg_exchange_rate, 0) AS Q1_avg_exchange_rate, COALESCE(qer.Q1_max_exchange_rate, 0) AS Q1_max_exchange_rate\nFROM currencies AS cu\nLEFT JOIN Q1ExchangeRates AS qer ON cu.currency_code = qer.currency_code\nLEFT JOIN currency_restrictions AS cr ON cu.currency_code = cr.currency_code AND cr.restriction_start_date < CURDATE() AND cr.restriction_end_date > CURDATE()\nJOIN currency_trade_volumes AS ctv ON cu.currency_code = ctv.currency_code\nWHERE cu.is_fiat = TRUE AND cu.country_code IN ('USD', 'EUR', 'GBP') AND cr.currency_code IS NULL AND ctv.trade_date = CURDATE()\nORDER BY Q1_avg_exchange_rate DESC, Q1_max_exchange_rate DESC\nLIMIT 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT tr.trainer_id, tr.trainer_name, tr.specialty, (SELECT COUNT(cs.client_id) FROM client_sessions cs WHERE cs.trainer_id = tr.trainer_id AND cs.session_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_sessions_count, (SELECT AVG(cs.duration_minutes) FROM client_sessions cs WHERE cs.trainer_id = tr.trainer_id AND cs.session_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_avg_session_duration\nFROM trainers tr\nWHERE tr.experience_years > 10 AND tr.certifications LIKE '%NASM%' AND tr.trainer_id NOT IN (SELECT co.trainer_id FROM trainer_complaints co WHERE co.complaint_date > '2023-01-01' AND co.severity = 'High') AND EXISTS (SELECT 1 FROM trainer_availability ta WHERE ta.trainer_id = tr.trainer_id AND ta.day_of_week = 'Monday' AND ta.is_available = TRUE)\nORDER BY H1_sessions_count DESC, H1_avg_session_duration DESC\nLIMIT 10 ;", "output": "WITH H1TrainerStats AS (SELECT trainer_id, COUNT(client_id) AS H1_sessions_count, AVG(duration_minutes) AS H1_avg_session_duration FROM client_sessions WHERE session_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY trainer_id)\nSELECT tr.trainer_id, tr.trainer_name, tr.specialty, COALESCE(hts.H1_sessions_count, 0) AS H1_sessions_count, COALESCE(hts.H1_avg_session_duration, 0) AS H1_avg_session_duration\nFROM trainers AS tr\nLEFT JOIN H1TrainerStats AS hts ON tr.trainer_id = hts.trainer_id\nLEFT JOIN trainer_complaints AS tc ON tr.trainer_id = tc.trainer_id AND tc.complaint_date > '2023-01-01' AND tc.severity = 'High'\nJOIN trainer_availability AS ta ON tr.trainer_id = ta.trainer_id\nWHERE tr.experience_years > 10 AND tr.certifications LIKE '%NASM%' AND tc.trainer_id IS NULL AND ta.day_of_week = 'Monday' AND ta.is_available = TRUE\nORDER BY H1_sessions_count DESC, H1_avg_session_duration DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT crs.course_id, crs.course_name, crs.department, (SELECT AVG(e.grade) FROM enrollments e WHERE e.course_id = crs.course_id AND e.enrollment_date > '2023-01-01') AS avg_grade_2023, (SELECT COUNT(DISTINCT s.student_id) FROM enrollments e JOIN students s ON e.student_id = s.student_id WHERE e.course_id = crs.course_id AND s.student_status = 'Active') AS active_students\nFROM courses crs\nWHERE crs.credits >= 3 AND crs.course_level = 'Graduate' AND crs.course_id NOT IN (SELECT oc.course_id FROM course_cancellations oc WHERE oc.cancellation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM course_prerequisites cp JOIN courses pre_crs ON cp.prerequisite_course_id = pre_crs.course_id WHERE cp.course_id = crs.course_id AND pre_crs.course_code = 'CS101')\nORDER BY avg_grade_2023 DESC, active_students DESC\nLIMIT 15 ;", "output": "WITH CourseGradeStats AS (SELECT course_id, AVG(grade) AS avg_grade_2023 FROM enrollments WHERE enrollment_date > '2023-01-01' GROUP BY course_id), ActiveStudentsCount AS (SELECT e.course_id, COUNT(DISTINCT s.student_id) AS active_students FROM enrollments AS e JOIN students AS s ON e.student_id = s.student_id WHERE s.student_status = 'Active' GROUP BY e.course_id)\nSELECT crs.course_id, crs.course_name, crs.department, COALESCE(cgs.avg_grade_2023, 0) AS avg_grade_2023, COALESCE(asc.active_students, 0) AS active_students\nFROM courses AS crs\nLEFT JOIN CourseGradeStats AS cgs ON crs.course_id = cgs.course_id\nLEFT JOIN ActiveStudentsCount AS ASC ON crs.course_id = asc.course_id\nLEFT JOIN course_cancellations AS cc ON crs.course_id = cc.course_id AND cc.cancellation_date > '2023-01-01'\nJOIN course_prerequisites AS cp ON crs.course_id = cp.course_id\nJOIN courses AS pre_crs ON cp.prerequisite_course_id = pre_crs.course_id\nWHERE crs.credits >= 3 AND crs.course_level = 'Graduate' AND cc.course_id IS NULL AND pre_crs.course_code = 'CS101'\nORDER BY avg_grade_2023 DESC, active_students DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT l.listing_id, l.title, l.price, l.posted_date, (SELECT AVG(r.rating) FROM property_reviews r WHERE r.listing_id = l.listing_id) AS avg_listing_rating, (SELECT COUNT(i.inquiry_id) FROM property_inquiries i WHERE i.listing_id = l.listing_id AND i.inquiry_date > '2023-01-01') AS recent_inquiries\nFROM listings l\nWHERE l.status = 'Active' AND l.property_type = 'Apartment' AND l.city = 'San Francisco' AND l.listing_id NOT IN (SELECT dl.listing_id FROM delisted_properties dl WHERE dl.delist_date > '2023-01-01') AND EXISTS (SELECT 1 FROM listing_amenities la WHERE la.listing_id = l.listing_id AND la.amenity_name = 'Gym')\nORDER BY avg_listing_rating DESC, recent_inquiries DESC\nLIMIT 20 ;", "output": "WITH ListingRatings AS (SELECT listing_id, AVG(rating) AS avg_listing_rating FROM property_reviews GROUP BY listing_id), RecentInquiries AS (SELECT listing_id, COUNT(inquiry_id) AS recent_inquiries FROM property_inquiries WHERE inquiry_date > '2023-01-01' GROUP BY listing_id)\nSELECT l.listing_id, l.title, l.price, l.posted_date, COALESCE(lr.avg_listing_rating, 0) AS avg_listing_rating, COALESCE(ri.recent_inquiries, 0) AS recent_inquiries\nFROM listings AS l\nLEFT JOIN ListingRatings AS lr ON l.listing_id = lr.listing_id\nLEFT JOIN RecentInquiries AS ri ON l.listing_id = ri.listing_id\nLEFT JOIN delisted_properties AS dp ON l.listing_id = dp.listing_id AND dp.delist_date > '2023-01-01'\nJOIN listing_amenities AS la ON l.listing_id = la.listing_id\nWHERE l.status = 'Active' AND l.property_type = 'Apartment' AND l.city = 'San Francisco' AND dp.listing_id IS NULL AND la.amenity_name = 'Gym'\nORDER BY avg_listing_rating DESC, recent_inquiries DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT m.member_id, m.member_name, m.email, (SELECT COUNT(lp.loan_id) FROM loan_applications lp WHERE lp.member_id = m.member_id AND lp.application_date > '2023-01-01') AS loan_applications_2023, (SELECT SUM(lg.amount) FROM loan_grants lg WHERE lg.member_id = m.member_id AND lg.grant_date > '2023-01-01') AS total_loans_granted_2023\nFROM members m\nWHERE m.status = 'Active' AND m.join_date < '2020-01-01' AND m.member_id NOT IN (SELECT dm.member_id FROM delinquent_members dm WHERE dm.delinquency_start_date < CURDATE() AND dm.delinquency_end_date > CURDATE()) AND EXISTS (SELECT 1 FROM member_benefits mb JOIN benefits b ON mb.benefit_id = b.benefit_id WHERE mb.member_id = m.member_id AND b.benefit_type = 'Financial Counseling')\nORDER BY loan_applications_2023 DESC, total_loans_granted_2023 DESC\nLIMIT 10 ;", "output": "WITH MemberLoanStats AS (SELECT m.member_id, COUNT(lp.loan_id) AS loan_applications_2023, SUM(lg.amount) AS total_loans_granted_2023 FROM members AS m LEFT JOIN loan_applications AS lp ON m.member_id = lp.member_id AND lp.application_date > '2023-01-01' LEFT JOIN loan_grants AS lg ON m.member_id = lg.member_id AND lg.grant_date > '2023-01-01' GROUP BY m.member_id)\nSELECT m.member_id, m.member_name, m.email, COALESCE(mls.loan_applications_2023, 0) AS loan_applications_2023, COALESCE(mls.total_loans_granted_2023, 0) AS total_loans_granted_2023\nFROM members AS m\nLEFT JOIN MemberLoanStats AS mls ON m.member_id = mls.member_id\nLEFT JOIN delinquent_members AS dm ON m.member_id = dm.member_id AND dm.delinquency_start_date < CURDATE() AND dm.delinquency_end_date > CURDATE()\nJOIN member_benefits AS mb ON m.member_id = mb.member_id\nJOIN benefits AS b ON mb.benefit_id = b.benefit_id\nWHERE m.status = 'Active' AND m.join_date < '2020-01-01' AND dm.member_id IS NULL AND b.benefit_type = 'Financial Counseling'\nORDER BY loan_applications_2023 DESC, total_loans_granted_2023 DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.show_id, s.show_title, s.genre, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.show_id = s.show_id AND t.sale_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_tickets_sold, (SELECT AVG(r.rating_score) FROM show_reviews r WHERE r.show_id = s.show_id AND r.review_date > '2023-01-01') AS avg_show_rating\nFROM shows s\nWHERE s.status = 'Active' AND s.run_start_date < '2022-01-01' AND s.show_id NOT IN (SELECT cc.show_id FROM show_cancellations cc WHERE cc.cancellation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM show_venues sv JOIN venues v ON sv.venue_id = v.venue_id WHERE sv.show_id = s.show_id AND v.city = 'London')\nORDER BY H1_tickets_sold DESC, avg_show_rating DESC\nLIMIT 10 ;", "output": "WITH H1TicketSales AS (SELECT show_id, COUNT(ticket_id) AS H1_tickets_sold FROM tickets WHERE sale_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY show_id), ShowRatings AS (SELECT show_id, AVG(rating_score) AS avg_show_rating FROM show_reviews WHERE review_date > '2023-01-01' GROUP BY show_id)\nSELECT s.show_id, s.show_title, s.genre, COALESCE(hts.H1_tickets_sold, 0) AS H1_tickets_sold, COALESCE(sr.avg_show_rating, 0) AS avg_show_rating\nFROM shows AS s\nLEFT JOIN H1TicketSales AS hts ON s.show_id = hts.show_id\nLEFT JOIN ShowRatings AS sr ON s.show_id = sr.show_id\nLEFT JOIN show_cancellations AS sc ON s.show_id = sc.show_id AND sc.cancellation_date > '2023-01-01'\nJOIN show_venues AS sv ON s.show_id = sv.show_id\nJOIN venues AS v ON sv.venue_id = v.venue_id\nWHERE s.status = 'Active' AND s.run_start_date < '2022-01-01' AND sc.show_id IS NULL AND v.city = 'London'\nORDER BY H1_tickets_sold DESC, avg_show_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT art.artwork_id, art.title, art.artist_name, art.creation_year, (SELECT MAX(b.bid_amount) FROM bids b WHERE b.artwork_id = art.artwork_id AND b.bid_date > '2023-01-01') AS highest_recent_bid, (SELECT COUNT(v.visitor_id) FROM gallery_visits v WHERE v.artwork_id = art.artwork_id AND v.visit_date > '2023-01-01') AS total_recent_views\nFROM artworks art\nWHERE art.medium = 'Painting' AND art.style = 'Abstract' AND art.artwork_id NOT IN (SELECT cs.artwork_id FROM conservation_status cs WHERE cs.condition = 'Poor' AND cs.status_date > '2023-01-01') AND EXISTS (SELECT 1 FROM artwork_exhibitions ae JOIN exhibitions e ON ae.exhibition_id = e.exhibition_id WHERE ae.artwork_id = art.artwork_id AND e.start_date < CURDATE() AND e.end_date > CURDATE())\nORDER BY highest_recent_bid DESC, total_recent_views DESC\nLIMIT 10 ;", "output": "WITH ArtworkBidStats AS (SELECT artwork_id, MAX(bid_amount) AS highest_recent_bid FROM bids WHERE bid_date > '2023-01-01' GROUP BY artwork_id), ArtworkViewStats AS (SELECT artwork_id, COUNT(visitor_id) AS total_recent_views FROM gallery_visits WHERE visit_date > '2023-01-01' GROUP BY artwork_id)\nSELECT art.artwork_id, art.title, art.artist_name, art.creation_year, COALESCE(abs.highest_recent_bid, 0) AS highest_recent_bid, COALESCE(avs.total_recent_views, 0) AS total_recent_views\nFROM artworks AS art\nLEFT JOIN ArtworkBidStats AS ABS ON art.artwork_id = abs.artwork_id\nLEFT JOIN ArtworkViewStats AS avs ON art.artwork_id = avs.artwork_id\nLEFT JOIN conservation_status AS cs ON art.artwork_id = cs.artwork_id AND cs.condition = 'Poor' AND cs.status_date > '2023-01-01'\nJOIN artwork_exhibitions AS ae ON art.artwork_id = ae.artwork_id\nJOIN exhibitions AS e ON ae.exhibition_id = e.exhibition_id\nWHERE art.medium = 'Painting' AND art.style = 'Abstract' AND cs.artwork_id IS NULL AND e.start_date < CURDATE() AND e.end_date > CURDATE()\nORDER BY highest_recent_bid DESC, total_recent_views DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT sc.scenario_id, sc.scenario_name, sc.category, (SELECT COUNT(si.incident_id) FROM security_incidents si WHERE si.scenario_id = sc.scenario_id AND si.incident_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_incidents, (SELECT AVG(sir.resolution_time_hours) FROM security_incident_resolutions sir JOIN security_incidents si ON sir.incident_id = si.incident_id WHERE si.scenario_id = sc.scenario_id AND si.incident_date BETWEEN '2023-01-01' AND '2023-12-31') AS avg_resolution_time\nFROM security_scenarios sc\nWHERE sc.severity = 'Critical' AND sc.last_updated_date < '2023-01-01' AND sc.scenario_id NOT IN (SELECT ap.scenario_id FROM audit_failures ap WHERE ap.audit_date > '2023-01-01') AND EXISTS (SELECT 1 FROM scenario_threat_actors sta JOIN threat_actors ta ON sta.threat_actor_id = ta.threat_actor_id WHERE sta.scenario_id = sc.scenario_id AND ta.actor_type = 'Nation-State')\nORDER BY annual_incidents DESC, avg_resolution_time ASC\nLIMIT 10 ;", "output": "WITH AnnualIncidents AS (SELECT scenario_id, COUNT(incident_id) AS annual_incidents FROM security_incidents WHERE incident_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY scenario_id), AvgResolutionTime AS (SELECT si.scenario_id, AVG(sir.resolution_time_hours) AS avg_resolution_time FROM security_incident_resolutions AS sir JOIN security_incidents AS si ON sir.incident_id = si.incident_id WHERE si.incident_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY si.scenario_id)\nSELECT sc.scenario_id, sc.scenario_name, sc.category, COALESCE(ai.annual_incidents, 0) AS annual_incidents, COALESCE(art.avg_resolution_time, 0) AS avg_resolution_time\nFROM security_scenarios AS sc\nLEFT JOIN AnnualIncidents AS ai ON sc.scenario_id = ai.scenario_id\nLEFT JOIN AvgResolutionTime AS art ON sc.scenario_id = art.scenario_id\nLEFT JOIN audit_failures AS af ON sc.scenario_id = af.scenario_id AND af.audit_date > '2023-01-01'\nJOIN scenario_threat_actors AS sta ON sc.scenario_id = sta.scenario_id\nJOIN threat_actors AS ta ON sta.threat_actor_id = ta.threat_actor_id\nWHERE sc.severity = 'Critical' AND sc.last_updated_date < '2023-01-01' AND af.scenario_id IS NULL AND ta.actor_type = 'Nation-State'\nORDER BY annual_incidents DESC, avg_resolution_time ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT tr.transaction_id, tr.transaction_date, tr.amount, ac.account_number, (SELECT SUM(sf.fee_amount) FROM transaction_fees sf WHERE sf.transaction_id = tr.transaction_id) AS total_fees, (SELECT AVG(rt.response_time_ms) FROM transaction_responses rt WHERE rt.transaction_id = tr.transaction_id AND rt.response_date > '2023-01-01') AS avg_response_time\nFROM transactions tr\nJOIN accounts ac ON tr.account_id = ac.account_id\nWHERE tr.transaction_type = 'Payment' AND ac.account_status = 'Active' AND tr.transaction_date BETWEEN '2023-01-01' AND '2023-06-30' AND tr.transaction_id NOT IN (SELECT ft.transaction_id FROM fraudulent_transactions ft WHERE ft.fraud_detection_date > '2023-01-01') AND EXISTS (SELECT 1 FROM transaction_channels tc WHERE tc.transaction_id = tr.transaction_id AND tc.channel_type = 'Online')\nORDER BY total_fees DESC, avg_response_time ASC\nLIMIT 20 ;", "output": "WITH TransactionFees AS (SELECT transaction_id, SUM(fee_amount) AS total_fees FROM transaction_fees GROUP BY transaction_id), TransactionResponses AS (SELECT transaction_id, AVG(response_time_ms) AS avg_response_time FROM transaction_responses WHERE response_date > '2023-01-01' GROUP BY transaction_id)\nSELECT tr.transaction_id, tr.transaction_date, tr.amount, ac.account_number, COALESCE(tf.total_fees, 0) AS total_fees, COALESCE(tres.avg_response_time, 0) AS avg_response_time\nFROM transactions AS tr\nJOIN accounts AS ac ON tr.account_id = ac.account_id\nLEFT JOIN TransactionFees AS tf ON tr.transaction_id = tf.transaction_id\nLEFT JOIN TransactionResponses AS tres ON tr.transaction_id = tres.transaction_id\nLEFT JOIN fraudulent_transactions AS ft ON tr.transaction_id = ft.transaction_id AND ft.fraud_detection_date > '2023-01-01'\nJOIN transaction_channels AS tc ON tr.transaction_id = tc.transaction_id\nWHERE tr.transaction_type = 'Payment' AND ac.account_status = 'Active' AND tr.transaction_date BETWEEN '2023-01-01' AND '2023-06-30' AND ft.transaction_id IS NULL AND tc.channel_type = 'Online'\nORDER BY total_fees DESC, avg_response_time ASC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.sensor_id, s.sensor_type, s.location, s.deployment_date, (SELECT AVG(sd.reading_value) FROM sensor_data sd WHERE sd.sensor_id = s.sensor_id AND sd.reading_timestamp BETWEEN '2023-01-01' AND '2023-01-31') AS avg_jan_reading, (SELECT MAX(sd.reading_value) FROM sensor_data sd WHERE sd.sensor_id = s.sensor_id AND sd.reading_timestamp BETWEEN '2023-01-01' AND '2023-01-31') AS max_jan_reading\nFROM sensors s\nWHERE s.status = 'Active' AND s.power_source = 'Battery' AND s.sensor_id NOT IN (SELECT ce.sensor_id FROM calibration_errors ce WHERE ce.error_date > '2023-01-01') AND EXISTS (SELECT 1 FROM sensor_networks sn JOIN networks n ON sn.network_id = n.network_id WHERE sn.sensor_id = s.sensor_id AND n.network_type = 'Wireless Mesh')\nORDER BY avg_jan_reading DESC, max_jan_reading DESC\nLIMIT 10 ;", "output": "WITH JanReadings AS (SELECT sensor_id, AVG(reading_value) AS avg_jan_reading, MAX(reading_value) AS max_jan_reading FROM sensor_data WHERE reading_timestamp BETWEEN '2023-01-01' AND '2023-01-31' GROUP BY sensor_id)\nSELECT s.sensor_id, s.sensor_type, s.location, s.deployment_date, COALESCE(jr.avg_jan_reading, 0) AS avg_jan_reading, COALESCE(jr.max_jan_reading, 0) AS max_jan_reading\nFROM sensors AS s\nLEFT JOIN JanReadings AS jr ON s.sensor_id = jr.sensor_id\nLEFT JOIN calibration_errors AS ce ON s.sensor_id = ce.sensor_id AND ce.error_date > '2023-01-01'\nJOIN sensor_networks AS sn ON s.sensor_id = sn.sensor_id\nJOIN networks AS n ON sn.network_id = n.network_id\nWHERE s.status = 'Active' AND s.power_source = 'Battery' AND ce.sensor_id IS NULL AND n.network_type = 'Wireless Mesh'\nORDER BY avg_jan_reading DESC, max_jan_reading DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT proj.project_id, proj.project_name, proj.start_date, proj.end_date, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = proj.project_id AND t.status = 'Completed') AS completed_tasks, (SELECT AVG(ts.actual_hours) FROM task_submissions ts JOIN tasks t ON ts.task_id = t.task_id WHERE t.project_id = proj.project_id) AS avg_task_hours\nFROM projects proj\nWHERE proj.status = 'In Progress' AND proj.budget > 50000 AND proj.project_id NOT IN (SELECT pd.project_id FROM project_disputes pd WHERE pd.dispute_date > '2023-01-01' AND pd.severity = 'High') AND EXISTS (SELECT 1 FROM project_teams pt JOIN teams tm ON pt.team_id = tm.team_id WHERE pt.project_id = proj.project_id AND tm.team_type = 'Development')\nORDER BY completed_tasks DESC, avg_task_hours ASC\nLIMIT 15 ;", "output": "WITH ProjectTaskStats AS (SELECT t.project_id, COUNT(t.task_id) AS completed_tasks, AVG(ts.actual_hours) AS avg_task_hours FROM tasks AS t LEFT JOIN task_submissions AS ts ON t.task_id = ts.task_id WHERE t.status = 'Completed' GROUP BY t.project_id)\nSELECT proj.project_id, proj.project_name, proj.start_date, proj.end_date, COALESCE(pts.completed_tasks, 0) AS completed_tasks, COALESCE(pts.avg_task_hours, 0) AS avg_task_hours\nFROM projects AS proj\nLEFT JOIN ProjectTaskStats AS pts ON proj.project_id = pts.project_id\nLEFT JOIN project_disputes AS pd ON proj.project_id = pd.project_id AND pd.dispute_date > '2023-01-01' AND pd.severity = 'High'\nJOIN project_teams AS pt ON proj.project_id = pt.project_id\nJOIN teams AS tm ON pt.team_id = tm.team_id\nWHERE proj.status = 'In Progress' AND proj.budget > 50000 AND pd.project_id IS NULL AND tm.team_type = 'Development'\nORDER BY completed_tasks DESC, avg_task_hours ASC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT doc.document_id, doc.title, doc.author, doc.publish_date, (SELECT COUNT(re.read_event_id) FROM read_events re WHERE re.document_id = doc.document_id AND re.read_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_reads, (SELECT AVG(us.satisfaction_score) FROM user_feedback us WHERE us.document_id = doc.document_id) AS avg_feedback_score\nFROM documents doc\nWHERE doc.document_type = 'Research Paper' AND doc.publish_date > '2022-01-01' AND doc.document_id NOT IN (SELECT pr.document_id FROM plagiarism_reports pr WHERE pr.report_date > '2023-01-01') AND EXISTS (SELECT 1 FROM document_tags dt JOIN tags t ON dt.tag_id = t.tag_id WHERE dt.document_id = doc.document_id AND t.tag_name = 'AI Ethics')\nORDER BY H1_reads DESC, avg_feedback_score DESC\nLIMIT 10 ;", "output": "WITH DocumentReadStats AS (SELECT document_id, COUNT(read_event_id) AS H1_reads FROM read_events WHERE read_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY document_id), FeedbackScores AS (SELECT document_id, AVG(satisfaction_score) AS avg_feedback_score FROM user_feedback GROUP BY document_id)\nSELECT doc.document_id, doc.title, doc.author, doc.publish_date, COALESCE(drs.H1_reads, 0) AS H1_reads, COALESCE(fs.avg_feedback_score, 0) AS avg_feedback_score\nFROM documents AS doc\nLEFT JOIN DocumentReadStats AS drs ON doc.document_id = drs.document_id\nLEFT JOIN FeedbackScores AS fs ON doc.document_id = fs.document_id\nLEFT JOIN plagiarism_reports AS pr ON doc.document_id = pr.document_id AND pr.report_date > '2023-01-01'\nJOIN document_tags AS dt ON doc.document_id = dt.document_id\nJOIN tags AS t ON dt.tag_id = t.tag_id\nWHERE doc.document_type = 'Research Paper' AND doc.publish_date > '2022-01-01' AND pr.document_id IS NULL AND t.tag_name = 'AI Ethics'\nORDER BY H1_reads DESC, avg_feedback_score DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.school_id, s.school_name, s.city, (SELECT COUNT(st.student_id) FROM students st WHERE st.school_id = s.school_id AND st.enrollment_date > '2023-01-01') AS new_students_2023, (SELECT AVG(t.teacher_rating) FROM teachers t WHERE t.school_id = s.school_id) AS avg_teacher_rating\nFROM schools s\nWHERE s.school_type = 'Primary' AND s.founding_year < 1950 AND s.school_id NOT IN (SELECT cp.school_id FROM compliance_violations cp WHERE cp.violation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM school_programs sp WHERE sp.school_id = s.school_id AND sp.program_type = 'STEM')\nORDER BY new_students_2023 DESC, avg_teacher_rating DESC\nLIMIT 10 ;", "output": "WITH SchoolStudentStats AS (SELECT school_id, COUNT(student_id) AS new_students_2023 FROM students WHERE enrollment_date > '2023-01-01' GROUP BY school_id), TeacherRatings AS (SELECT school_id, AVG(teacher_rating) AS avg_teacher_rating FROM teachers GROUP BY school_id)\nSELECT s.school_id, s.school_name, s.city, COALESCE(sss.new_students_2023, 0) AS new_students_2023, COALESCE(tr.avg_teacher_rating, 0) AS avg_teacher_rating\nFROM schools AS s\nLEFT JOIN SchoolStudentStats AS sss ON s.school_id = sss.school_id\nLEFT JOIN TeacherRatings AS tr ON s.school_id = tr.school_id\nLEFT JOIN compliance_violations AS cv ON s.school_id = cv.school_id AND cv.violation_date > '2023-01-01'\nJOIN school_programs AS sp ON s.school_id = sp.school_id\nWHERE s.school_type = 'Primary' AND s.founding_year < 1950 AND cv.school_id IS NULL AND sp.program_type = 'STEM'\nORDER BY new_students_2023 DESC, avg_teacher_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.speaker_id, s.speaker_name, s.specialization, (SELECT COUNT(p.presentation_id) FROM presentations p WHERE p.speaker_id = s.speaker_id AND p.event_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_presentations, (SELECT AVG(fb.feedback_score) FROM presentation_feedback fb WHERE fb.speaker_id = s.speaker_id) AS avg_feedback\nFROM speakers s\nWHERE s.country = 'USA' AND s.speaking_experience_years > 5 AND s.speaker_id NOT IN (SELECT cc.speaker_id FROM conflict_of_interest_reports cc WHERE cc.report_date > '2023-01-01') AND EXISTS (SELECT 1 FROM speaker_topics st JOIN topics t ON st.topic_id = t.topic_id WHERE st.speaker_id = s.speaker_id AND t.topic_name = 'Machine Learning')\nORDER BY annual_presentations DESC, avg_feedback DESC\nLIMIT 10 ;", "output": "WITH SpeakerPresentationStats AS (SELECT p.speaker_id, COUNT(p.presentation_id) AS annual_presentations FROM presentations AS p WHERE p.event_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY p.speaker_id), SpeakerFeedbackStats AS (SELECT speaker_id, AVG(feedback_score) AS avg_feedback FROM presentation_feedback GROUP BY speaker_id)\nSELECT s.speaker_id, s.speaker_name, s.specialization, COALESCE(sps.annual_presentations, 0) AS annual_presentations, COALESCE(sfs.avg_feedback, 0) AS avg_feedback\nFROM speakers AS s\nLEFT JOIN SpeakerPresentationStats AS sps ON s.speaker_id = sps.speaker_id\nLEFT JOIN SpeakerFeedbackStats AS sfs ON s.speaker_id = sfs.speaker_id\nLEFT JOIN conflict_of_interest_reports AS coir ON s.speaker_id = coir.speaker_id AND coir.report_date > '2023-01-01'\nJOIN speaker_topics AS st ON s.speaker_id = st.speaker_id\nJOIN topics AS t ON st.topic_id = t.topic_id\nWHERE s.country = 'USA' AND s.speaking_experience_years > 5 AND coir.speaker_id IS NULL AND t.topic_name = 'Machine Learning'\nORDER BY annual_presentations DESC, avg_feedback DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT tr.trade_id, tr.trade_date, tr.symbol, tr.quantity, (SELECT AVG(tp.price) FROM trade_prices tp WHERE tp.trade_id = tr.trade_id AND tp.price_date = tr.trade_date) AS actual_trade_price, (SELECT MAX(tp.volume) FROM trade_prices tp WHERE tp.trade_id = tr.trade_id AND tp.price_date = tr.trade_date) AS max_trade_volume\nFROM trades tr\nWHERE tr.trade_type = 'Buy' AND tr.trade_date BETWEEN '2023-01-01' AND '2023-01-31' AND tr.account_id IN (SELECT DISTINCT ia.account_id FROM investor_accounts ia WHERE ia.status = 'Active') AND NOT EXISTS (SELECT 1 FROM trade_alerts ta WHERE ta.trade_id = tr.trade_id AND ta.alert_type = 'Unusual Volume')\nORDER BY actual_trade_price DESC, max_trade_volume DESC\nLIMIT 20 ;", "output": "SELECT tr.trade_id, tr.trade_date, tr.symbol, tr.quantity, COALESCE(tp.price, 0) AS actual_trade_price, COALESCE(tp.volume, 0) AS max_trade_volume\nFROM trades AS tr\nJOIN investor_accounts AS ia ON tr.account_id = ia.account_id\nLEFT JOIN trade_prices AS tp ON tr.trade_id = tp.trade_id AND tp.price_date = tr.trade_date\nLEFT JOIN trade_alerts AS ta ON tr.trade_id = ta.trade_id AND ta.alert_type = 'Unusual Volume'\nWHERE tr.trade_type = 'Buy' AND tr.trade_date BETWEEN '2023-01-01' AND '2023-01-31' AND ia.status = 'Active' AND ta.trade_id IS NULL\nORDER BY actual_trade_price DESC, max_trade_volume DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT c.campaign_id, c.campaign_name, c.start_date, (SELECT SUM(cm.conversions) FROM campaign_performance cm WHERE cm.campaign_id = c.campaign_id AND cm.metric_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_conversions, (SELECT AVG(cm.cpc) FROM campaign_performance cm WHERE cm.campaign_id = c.campaign_id AND cm.metric_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_avg_cpc\nFROM campaigns c\nWHERE c.campaign_type = 'Search' AND c.budget > 5000 AND c.campaign_id NOT IN (SELECT pr.campaign_id FROM policy_violations pr WHERE pr.violation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM campaign_audiences ca JOIN audiences a ON ca.audience_id = a.audience_id WHERE ca.campaign_id = c.campaign_id AND a.audience_segment = 'High Intent')\nORDER BY Q1_conversions DESC, Q1_avg_cpc ASC\nLIMIT 10 ;", "output": "WITH Q1CampaignPerformance AS (SELECT campaign_id, SUM(conversions) AS Q1_conversions, AVG(cpc) AS Q1_avg_cpc FROM campaign_performance WHERE metric_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY campaign_id)\nSELECT c.campaign_id, c.campaign_name, c.start_date, COALESCE(qcp.Q1_conversions, 0) AS Q1_conversions, COALESCE(qcp.Q1_avg_cpc, 0) AS Q1_avg_cpc\nFROM campaigns AS c\nLEFT JOIN Q1CampaignPerformance AS qcp ON c.campaign_id = qcp.campaign_id\nLEFT JOIN policy_violations AS pv ON c.campaign_id = pv.campaign_id AND pv.violation_date > '2023-01-01'\nJOIN campaign_audiences AS ca ON c.campaign_id = ca.campaign_id\nJOIN audiences AS a ON ca.audience_id = a.audience_id\nWHERE c.campaign_type = 'Search' AND c.budget > 5000 AND pv.campaign_id IS NULL AND a.audience_segment = 'High Intent'\nORDER BY Q1_conversions DESC, Q1_avg_cpc ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT pr.product_id, pr.product_name, pr.category_id, (SELECT SUM(s.quantity) FROM sales s WHERE s.product_id = pr.product_id AND s.sale_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_sales_quantity, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = pr.product_id AND r.review_date > '2023-01-01') AS avg_product_rating\nFROM products pr\nWHERE pr.price > 200 AND pr.stock_level > 0 AND pr.category_id IN (SELECT cat.category_id FROM categories cat WHERE cat.category_name LIKE '%Gaming%') AND pr.product_id NOT IN (SELECT ir.product_id FROM inventory_reconciliation ir WHERE ir.discrepancy_date > '2023-01-01')\nORDER BY H1_sales_quantity DESC, avg_product_rating DESC\nLIMIT 20 ;", "output": "WITH H1SalesQuantity AS (SELECT product_id, SUM(quantity) AS H1_sales_quantity FROM sales WHERE sale_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY product_id), ProductRatings AS (SELECT product_id, AVG(rating) AS avg_product_rating FROM reviews WHERE review_date > '2023-01-01' GROUP BY product_id)\nSELECT pr.product_id, pr.product_name, pr.category_id, COALESCE(hsq.H1_sales_quantity, 0) AS H1_sales_quantity, COALESCE(prt.avg_product_rating, 0) AS avg_product_rating\nFROM products AS pr\nJOIN categories AS cat ON pr.category_id = cat.category_id\nLEFT JOIN H1SalesQuantity AS hsq ON pr.product_id = hsq.product_id\nLEFT JOIN ProductRatings AS prt ON pr.product_id = prt.product_id\nLEFT JOIN inventory_reconciliation AS ir ON pr.product_id = ir.product_id AND ir.discrepancy_date > '2023-01-01'\nWHERE pr.price > 200 AND pr.stock_level > 0 AND cat.category_name LIKE '%Gaming%' AND ir.product_id IS NULL\nORDER BY H1_sales_quantity DESC, avg_product_rating DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.student_id, s.first_name, s.last_name, (SELECT AVG(g.score) FROM grades g WHERE g.student_id = s.student_id AND g.exam_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_avg_score, (SELECT COUNT(DISTINCT c.course_id) FROM enrollments e JOIN courses c ON e.course_id = c.course_id WHERE e.student_id = s.student_id AND c.department = 'Computer Science') AS cs_course_count\nFROM students s\nWHERE s.enrollment_year = 2022 AND s.major = 'Computer Science' AND s.student_id NOT IN (SELECT da.student_id FROM disciplinary_actions da WHERE da.action_date > '2023-01-01' AND da.severity = 'Expulsion') AND EXISTS (SELECT 1 FROM student_achievements sa WHERE sa.student_id = s.student_id AND sa.achievement_type = 'Dean''s List')\nORDER BY H1_avg_score DESC, cs_course_count DESC\nLIMIT 15 ;", "output": "WITH H1AvgScore AS (SELECT student_id, AVG(score) AS H1_avg_score FROM grades WHERE exam_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY student_id), CSCourseCount AS (SELECT e.student_id, COUNT(DISTINCT c.course_id) AS cs_course_count FROM enrollments AS e JOIN courses AS c ON e.course_id = c.course_id WHERE c.department = 'Computer Science' GROUP BY e.student_id)\nSELECT s.student_id, s.first_name, s.last_name, COALESCE(has.H1_avg_score, 0) AS H1_avg_score, COALESCE(cscc.cs_course_count, 0) AS cs_course_count\nFROM students AS s\nLEFT JOIN H1AvgScore AS has ON s.student_id = has.student_id\nLEFT JOIN CSCourseCount AS cscc ON s.student_id = cscc.student_id\nLEFT JOIN disciplinary_actions AS da ON s.student_id = da.student_id AND da.action_date > '2023-01-01' AND da.severity = 'Expulsion'\nJOIN student_achievements AS sa ON s.student_id = sa.student_id\nWHERE s.enrollment_year = 2022 AND s.major = 'Computer Science' AND da.student_id IS NULL AND sa.achievement_type = 'Dean''s List'\nORDER BY H1_avg_score DESC, cs_course_count DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT pa.patent_id, pa.title, pa.inventor, pa.filing_date, (SELECT COUNT(l.license_id) FROM licenses l WHERE l.patent_id = pa.patent_id AND l.license_start_date > '2023-01-01') AS new_licenses_2023, (SELECT SUM(r.royalty_amount) FROM royalties r WHERE r.patent_id = pa.patent_id AND r.payment_date > '2023-01-01') AS total_royalties_2023\nFROM patents pa\nWHERE pa.status = 'Granted' AND pa.filing_date BETWEEN '2010-01-01' AND '2020-12-31' AND pa.patent_id NOT IN (SELECT iv.patent_id FROM infringement_violations iv WHERE iv.violation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM patent_claims pc WHERE pc.patent_id = pa.patent_id AND pc.claim_type = 'Method')\nORDER BY new_licenses_2023 DESC, total_royalties_2023 DESC\nLIMIT 10 ;", "output": "WITH PatentLicenseStats AS (SELECT l.patent_id, COUNT(l.license_id) AS new_licenses_2023 FROM licenses AS l WHERE l.license_start_date > '2023-01-01' GROUP BY l.patent_id), PatentRoyalties AS (SELECT r.patent_id, SUM(r.royalty_amount) AS total_royalties_2023 FROM royalties AS r WHERE r.payment_date > '2023-01-01' GROUP BY r.patent_id)\nSELECT pa.patent_id, pa.title, pa.inventor, pa.filing_date, COALESCE(pls.new_licenses_2023, 0) AS new_licenses_2023, COALESCE(pr.total_royalties_2023, 0) AS total_royalties_2023\nFROM patents AS pa\nLEFT JOIN PatentLicenseStats AS pls ON pa.patent_id = pls.patent_id\nLEFT JOIN PatentRoyalties AS pr ON pa.patent_id = pr.patent_id\nLEFT JOIN infringement_violations AS iv ON pa.patent_id = iv.patent_id AND iv.violation_date > '2023-01-01'\nJOIN patent_claims AS pc ON pa.patent_id = pc.patent_id\nWHERE pa.status = 'Granted' AND pa.filing_date BETWEEN '2010-01-01' AND '2020-12-31' AND iv.patent_id IS NULL AND pc.claim_type = 'Method'\nORDER BY new_licenses_2023 DESC, total_royalties_2023 DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT co.country_code, co.country_name, co.continent, (SELECT AVG(gd.gdp_per_capita) FROM gdp_data gd WHERE gd.country_code = co.country_code AND gd.year BETWEEN 2020 AND 2022) AS avg_gdp_last_3_years, (SELECT SUM(tr.export_value) FROM trade_data tr WHERE tr.country_code = co.country_code AND tr.year = 2023) AS current_year_exports\nFROM countries co\nWHERE co.population > 10000000 AND co.gdp_usd > 100000000000 AND co.country_code NOT IN (SELECT sa.country_code FROM sanctions_list sa WHERE sa.start_date < CURDATE() AND sa.end_date > CURDATE()) AND EXISTS (SELECT 1 FROM country_alliances ca JOIN alliances al ON ca.alliance_id = al.alliance_id WHERE ca.country_code = co.country_code AND al.alliance_type = 'Economic')\nORDER BY avg_gdp_last_3_years DESC, current_year_exports DESC\nLIMIT 10 ;", "output": "WITH GDPStats AS (SELECT country_code, AVG(gdp_per_capita) AS avg_gdp_last_3_years FROM gdp_data WHERE YEAR BETWEEN 2020 AND 2022 GROUP BY country_code), TradeStats AS (SELECT country_code, SUM(export_value) AS current_year_exports FROM trade_data WHERE YEAR = 2023 GROUP BY country_code)\nSELECT co.country_code, co.country_name, co.continent, COALESCE(gs.avg_gdp_last_3_years, 0) AS avg_gdp_last_3_years, COALESCE(ts.current_year_exports, 0) AS current_year_exports\nFROM countries AS co\nLEFT JOIN GDPStats AS gs ON co.country_code = gs.country_code\nLEFT JOIN TradeStats AS ts ON co.country_code = ts.country_code\nLEFT JOIN sanctions_list AS sl ON co.country_code = sl.country_code AND sl.start_date < CURDATE() AND sl.end_date > CURDATE()\nJOIN country_alliances AS ca ON co.country_code = ca.country_code\nJOIN alliances AS al ON ca.alliance_id = al.alliance_id\nWHERE co.population > 10000000 AND co.gdp_usd > 100000000000 AND sl.country_code IS NULL AND al.alliance_type = 'Economic'\nORDER BY avg_gdp_last_3_years DESC, current_year_exports DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT tr.track_id, tr.track_name, tr.artist_id, ar.artist_name, (SELECT COUNT(pl.playlist_id) FROM playlist_tracks pl WHERE pl.track_id = tr.track_id AND pl.added_date > '2023-01-01') AS added_to_playlists_2023, (SELECT AVG(ur.rating) FROM user_track_ratings ur WHERE ur.track_id = tr.track_id AND ur.rating_date > '2023-01-01') AS avg_track_rating\nFROM tracks tr\nJOIN artists ar ON tr.artist_id = ar.artist_id\nWHERE tr.genre = 'Hip Hop' AND tr.release_date BETWEEN '2020-01-01' AND '2022-12-31' AND tr.track_id NOT IN (SELECT cr.track_id FROM copyright_violations cr WHERE cr.violation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM track_features tf WHERE tf.track_id = tr.track_id AND tf.feature_type = 'Explicit Lyrics')\nORDER BY added_to_playlists_2023 DESC, avg_track_rating DESC\nLIMIT 15 ;", "output": "WITH PlaylistAdds AS (SELECT track_id, COUNT(playlist_id) AS added_to_playlists_2023 FROM playlist_tracks WHERE added_date > '2023-01-01' GROUP BY track_id), TrackRatings AS (SELECT track_id, AVG(rating) AS avg_track_rating FROM user_track_ratings WHERE rating_date > '2023-01-01' GROUP BY track_id)\nSELECT tr.track_id, tr.track_name, tr.artist_id, ar.artist_name, COALESCE(pa.added_to_playlists_2023, 0) AS added_to_playlists_2023, COALESCE(trr.avg_track_rating, 0) AS avg_track_rating\nFROM tracks AS tr\nJOIN artists AS ar ON tr.artist_id = ar.artist_id\nLEFT JOIN PlaylistAdds AS pa ON tr.track_id = pa.track_id\nLEFT JOIN TrackRatings AS trr ON tr.track_id = trr.track_id\nLEFT JOIN copyright_violations AS cv ON tr.track_id = cv.track_id AND cv.violation_date > '2023-01-01'\nJOIN track_features AS tf ON tr.track_id = tf.track_id\nWHERE tr.genre = 'Hip Hop' AND tr.release_date BETWEEN '2020-01-01' AND '2022-12-31' AND cv.track_id IS NULL AND tf.feature_type = 'Explicit Lyrics'\nORDER BY added_to_playlists_2023 DESC, avg_track_rating DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.stock_id, s.symbol, s.company_name, (SELECT AVG(sh.high_price) FROM stock_history sh WHERE sh.stock_id = s.stock_id AND sh.trade_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_avg_high_price, (SELECT SUM(sh.volume) FROM stock_history sh WHERE sh.stock_id = s.stock_id AND sh.trade_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_total_volume\nFROM stocks s\nWHERE s.sector = 'Technology' AND s.market_cap_usd > 10000000000 AND s.stock_id NOT IN (SELECT del.stock_id FROM delisted_stocks del WHERE del.delist_date > '2023-01-01') AND EXISTS (SELECT 1 FROM analyst_ratings ar WHERE ar.stock_id = s.stock_id AND ar.rating = 'Buy')\nORDER BY Q1_total_volume DESC, Q1_avg_high_price DESC\nLIMIT 15 ;", "output": "WITH Q1StockStats AS (SELECT stock_id, AVG(high_price) AS Q1_avg_high_price, SUM(volume) AS Q1_total_volume FROM stock_history WHERE trade_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY stock_id)\nSELECT s.stock_id, s.symbol, s.company_name, COALESCE(qss.Q1_avg_high_price, 0) AS Q1_avg_high_price, COALESCE(qss.Q1_total_volume, 0) AS Q1_total_volume\nFROM stocks AS s\nLEFT JOIN Q1StockStats AS qss ON s.stock_id = qss.stock_id\nLEFT JOIN delisted_stocks AS ds ON s.stock_id = ds.stock_id AND ds.delist_date > '2023-01-01'\nJOIN analyst_ratings AS ar ON s.stock_id = ar.stock_id\nWHERE s.sector = 'Technology' AND s.market_cap_usd > 10000000000 AND ds.stock_id IS NULL AND ar.rating = 'Buy'\nORDER BY Q1_total_volume DESC, Q1_avg_high_price DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT ve.voter_id, ve.first_name, ve.last_name, (SELECT MAX(vp.vote_date) FROM voter_participations vp WHERE vp.voter_id = ve.voter_id) AS last_vote_date, (SELECT COUNT(vp.vote_id) FROM voter_participations vp WHERE vp.voter_id = ve.voter_id AND vp.election_year = 2022) AS votes_2022\nFROM voters ve\nWHERE ve.registration_date > '2020-01-01' AND ve.party_affiliation = 'Independent' AND ve.voter_id NOT IN (SELECT vr.voter_id FROM voter_registrations_removed vr WHERE vr.removal_date > '2023-01-01') AND EXISTS (SELECT 1 FROM voter_donations vd WHERE vd.voter_id = ve.voter_id AND vd.donation_amount > 500)\nORDER BY last_vote_date DESC, votes_2022 DESC\nLIMIT 10 ;", "output": "WITH VoterParticipationStats AS (SELECT voter_id, MAX(vote_date) AS last_vote_date, COUNT(CASE WHEN election_year = 2022 THEN vote_id END) AS votes_2022 FROM voter_participations GROUP BY voter_id)\nSELECT ve.voter_id, ve.first_name, ve.last_name, vps.last_vote_date, COALESCE(vps.votes_2022, 0) AS votes_2022\nFROM voters AS ve\nLEFT JOIN VoterParticipationStats AS vps ON ve.voter_id = vps.voter_id\nLEFT JOIN voter_registrations_removed AS vrr ON ve.voter_id = vrr.voter_id AND vrr.removal_date > '2023-01-01'\nJOIN voter_donations AS vd ON ve.voter_id = vd.voter_id\nWHERE ve.registration_date > '2020-01-01' AND ve.party_affiliation = 'Independent' AND vrr.voter_id IS NULL AND vd.donation_amount > 500\nORDER BY last_vote_date DESC, votes_2022 DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT c.campaign_id, c.campaign_name, c.start_date, (SELECT SUM(ad.spend) FROM ad_data ad WHERE ad.campaign_id = c.campaign_id AND ad.date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_ad_spend, (SELECT AVG(ad.cpm) FROM ad_data ad WHERE ad.campaign_id = c.campaign_id AND ad.date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_avg_cpm\nFROM campaigns c\nWHERE c.status = 'Running' AND c.target_audience = 'Youth' AND c.campaign_id NOT IN (SELECT iv.campaign_id FROM invalid_traffic_reports iv WHERE iv.report_date > '2023-01-01') AND EXISTS (SELECT 1 FROM campaign_platforms cp JOIN platforms p ON cp.platform_id = p.platform_id WHERE cp.campaign_id = c.campaign_id AND p.platform_name = 'TikTok')\nORDER BY Q1_ad_spend DESC, Q1_avg_cpm DESC\nLIMIT 10 ;", "output": "WITH Q1AdMetrics AS (SELECT campaign_id, SUM(spend) AS Q1_ad_spend, AVG(cpm) AS Q1_avg_cpm FROM ad_data WHERE date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY campaign_id)\nSELECT c.campaign_id, c.campaign_name, c.start_date, COALESCE(qam.Q1_ad_spend, 0) AS Q1_ad_spend, COALESCE(qam.Q1_avg_cpm, 0) AS Q1_avg_cpm\nFROM campaigns AS c\nLEFT JOIN Q1AdMetrics AS qam ON c.campaign_id = qam.campaign_id\nLEFT JOIN invalid_traffic_reports AS itr ON c.campaign_id = itr.campaign_id AND itr.report_date > '2023-01-01'\nJOIN campaign_platforms AS cp ON c.campaign_id = cp.campaign_id\nJOIN platforms AS p ON cp.platform_id = p.platform_id\nWHERE c.status = 'Running' AND c.target_audience = 'Youth' AND itr.campaign_id IS NULL AND p.platform_name = 'TikTok'\nORDER BY Q1_ad_spend DESC, Q1_avg_cpm DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT u.user_id, u.username, u.last_login_date, (SELECT COUNT(f.follow_id) FROM followers f WHERE f.following_id = u.user_id AND f.follow_date > '2023-01-01') AS new_followers_2023, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id AND p.created_at > '2023-01-01' AND p.likes > 100) AS high_engagement_posts\nFROM users u\nWHERE u.account_status = 'Active' AND u.registration_date BETWEEN '2021-01-01' AND '2022-12-31' AND u.user_id NOT IN (SELECT pr.user_id FROM privacy_violations pr WHERE pr.violation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM user_settings us WHERE us.user_id = u.user_id AND us.setting_name = 'Public Profile' AND us.setting_value = 'True')\nORDER BY new_followers_2023 DESC, high_engagement_posts DESC\nLIMIT 15 ;", "output": "WITH UserFollowerStats AS (SELECT following_id AS user_id, COUNT(follow_id) AS new_followers_2023 FROM followers WHERE follow_date > '2023-01-01' GROUP BY following_id), UserPostEngagement AS (SELECT user_id, COUNT(post_id) AS high_engagement_posts FROM posts WHERE created_at > '2023-01-01' AND likes > 100 GROUP BY user_id)\nSELECT u.user_id, u.username, u.last_login_date, COALESCE(ufs.new_followers_2023, 0) AS new_followers_2023, COALESCE(upe.high_engagement_posts, 0) AS high_engagement_posts\nFROM users AS u\nLEFT JOIN UserFollowerStats AS ufs ON u.user_id = ufs.user_id\nLEFT JOIN UserPostEngagement AS upe ON u.user_id = upe.user_id\nLEFT JOIN privacy_violations AS pv ON u.user_id = pv.user_id AND pv.violation_date > '2023-01-01'\nJOIN user_settings AS us ON u.user_id = us.user_id\nWHERE u.account_status = 'Active' AND u.registration_date BETWEEN '2021-01-01' AND '2022-12-31' AND pv.user_id IS NULL AND us.setting_name = 'Public Profile' AND us.setting_value = 'True'\nORDER BY new_followers_2023 DESC, high_engagement_posts DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT tr.transaction_id, tr.transaction_type, tr.amount, tr.transaction_date, (SELECT ba.balance_after_transaction FROM bank_accounts ba WHERE ba.account_id = tr.account_id AND ba.transaction_id = tr.transaction_id) AS post_transaction_balance, (SELECT COUNT(al.alert_id) FROM security_alerts al WHERE al.transaction_id = tr.transaction_id AND al.alert_type = 'Fraudulent Activity') AS fraud_alerts_count\nFROM transactions tr\nWHERE tr.account_id IN (SELECT DISTINCT ca.account_id FROM customer_accounts ca WHERE ca.customer_id IN (SELECT customer_id FROM customers WHERE country = 'USA')) AND tr.transaction_date BETWEEN '2023-01-01' AND '2023-03-31' AND tr.status = 'Completed' AND tr.transaction_id NOT IN (SELECT rv.transaction_id FROM reversed_transactions rv WHERE rv.reversal_date > '2023-01-01')\nORDER BY fraud_alerts_count DESC, post_transaction_balance DESC\nLIMIT 20 ;", "output": "WITH TransactionBalance AS (SELECT account_id, transaction_id, balance_after_transaction FROM bank_accounts), FraudAlerts AS (SELECT transaction_id, COUNT(alert_id) AS fraud_alerts_count FROM security_alerts WHERE alert_type = 'Fraudulent Activity' GROUP BY transaction_id)\nSELECT tr.transaction_id, tr.transaction_type, tr.amount, tr.transaction_date, tbal.balance_after_transaction AS post_transaction_balance, COALESCE(fa.fraud_alerts_count, 0) AS fraud_alerts_count\nFROM transactions AS tr\nJOIN customer_accounts AS ca ON tr.account_id = ca.account_id\nJOIN customers AS cust ON ca.customer_id = cust.customer_id\nLEFT JOIN TransactionBalance AS tbal ON tr.account_id = tbal.account_id AND tr.transaction_id = tbal.transaction_id\nLEFT JOIN FraudAlerts AS fa ON tr.transaction_id = fa.transaction_id\nLEFT JOIN reversed_transactions AS rt ON tr.transaction_id = rt.transaction_id AND rt.reversal_date > '2023-01-01'\nWHERE cust.country = 'USA' AND tr.transaction_date BETWEEN '2023-01-01' AND '2023-03-31' AND tr.status = 'Completed' AND rt.transaction_id IS NULL\nORDER BY fraud_alerts_count DESC, post_transaction_balance DESC\nLIMIT 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT s.server_id, s.hostname, s.ip_address, (SELECT AVG(cpu.usage_percent) FROM cpu_metrics cpu WHERE cpu.server_id = s.server_id AND cpu.metric_date BETWEEN '2023-01-01' AND '2023-01-31') AS avg_jan_cpu, (SELECT SUM(mem.memory_used_gb) FROM memory_metrics mem WHERE mem.server_id = s.server_id AND mem.metric_date BETWEEN '2023-01-01' AND '2023-01-31') AS total_jan_memory_used\nFROM servers s\nWHERE s.status = 'Operational' AND s.environment = 'Production' AND s.server_id NOT IN (SELECT ofl.server_id FROM outage_failures ofl WHERE ofl.outage_date > '2023-01-01') AND EXISTS (SELECT 1 FROM server_roles sr JOIN ROLES r ON sr.role_id = r.role_id WHERE sr.server_id = s.server_id AND r.role_name = 'Web Server')\nORDER BY avg_jan_cpu DESC, total_jan_memory_used DESC\nLIMIT 10 ;", "output": "WITH JanCPUMetrics AS (SELECT server_id, AVG(usage_percent) AS avg_jan_cpu FROM cpu_metrics WHERE metric_date BETWEEN '2023-01-01' AND '2023-01-31' GROUP BY server_id), JanMemoryMetrics AS (SELECT server_id, SUM(memory_used_gb) AS total_jan_memory_used FROM memory_metrics WHERE metric_date BETWEEN '2023-01-01' AND '2023-01-31' GROUP BY server_id)\nSELECT s.server_id, s.hostname, s.ip_address, COALESCE(jcm.avg_jan_cpu, 0) AS avg_jan_cpu, COALESCE(jmm.total_jan_memory_used, 0) AS total_jan_memory_used\nFROM servers AS s\nLEFT JOIN JanCPUMetrics AS jcm ON s.server_id = jcm.server_id\nLEFT JOIN JanMemoryMetrics AS jmm ON s.server_id = jmm.server_id\nLEFT JOIN outage_failures AS ofl ON s.server_id = ofl.server_id AND ofl.outage_date > '2023-01-01'\nJOIN server_roles AS sr ON s.server_id = sr.server_id\nJOIN ROLES AS r ON sr.role_id = r.role_id\nWHERE s.status = 'Operational' AND s.environment = 'Production' AND ofl.server_id IS NULL AND r.role_name = 'Web Server'\nORDER BY avg_jan_cpu DESC, total_jan_memory_used DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT p.patient_id, p.first_name, p.last_name, (SELECT COUNT(v.visit_id) FROM visits v WHERE v.patient_id = p.patient_id AND v.visit_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_visits, (SELECT MAX(v.diagnosis_code) FROM visits v WHERE v.patient_id = p.patient_id) AS last_diagnosis\nFROM patients p\nWHERE p.gender = 'Male' AND p.age BETWEEN 50 AND 70 AND p.patient_id NOT IN (SELECT pr.patient_id FROM prescription_refills pr WHERE pr.refill_date > '2023-01-01' AND pr.medication_id IN (SELECT drug_id FROM drugs WHERE is_controlled = TRUE)) AND EXISTS (SELECT 1 FROM patient_conditions pc JOIN conditions c ON pc.condition_id = c.condition_id WHERE pc.patient_id = p.patient_id AND c.condition_name = 'Diabetes')\nORDER BY H1_visits DESC, last_diagnosis ASC\nLIMIT 10 ;", "output": "WITH PatientVisitStats AS (SELECT patient_id, COUNT(visit_id) AS H1_visits, MAX(diagnosis_code) AS last_diagnosis FROM visits WHERE visit_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY patient_id)\nSELECT p.patient_id, p.first_name, p.last_name, COALESCE(pvs.H1_visits, 0) AS H1_visits, pvs.last_diagnosis\nFROM patients AS p\nLEFT JOIN PatientVisitStats AS pvs ON p.patient_id = pvs.patient_id\nLEFT JOIN prescription_refills AS pr ON p.patient_id = pr.patient_id AND pr.refill_date > '2023-01-01'\nLEFT JOIN drugs AS d ON pr.medication_id = d.drug_id AND d.is_controlled = TRUE\nJOIN patient_conditions AS pc ON p.patient_id = pc.patient_id\nJOIN conditions AS c ON pc.condition_id = c.condition_id\nWHERE p.gender = 'Male' AND p.age BETWEEN 50 AND 70 AND pr.patient_id IS NULL AND c.condition_name = 'Diabetes'\nORDER BY H1_visits DESC, last_diagnosis ASC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT c.class_id, c.class_name, c.instructor_name, (SELECT COUNT(e.enrollment_id) FROM enrollments e WHERE e.class_id = c.class_id AND e.enrollment_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_enrollments, (SELECT AVG(g.grade_value) FROM grades g WHERE g.class_id = c.class_id AND g.grade_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_avg_grade\nFROM classes c\nWHERE c.semester = 'Spring 2023' AND c.department = 'Arts' AND c.class_id NOT IN (SELECT wc.class_id FROM waitlist_classes wc WHERE wc.waitlist_count > 10) AND EXISTS (SELECT 1 FROM class_materials cm WHERE cm.class_id = c.class_id AND cm.material_type = 'Textbook')\nORDER BY H1_enrollments DESC, H1_avg_grade DESC\nLIMIT 10 ;", "output": "WITH H1Enrollments AS (SELECT class_id, COUNT(enrollment_id) AS H1_enrollments FROM enrollments WHERE enrollment_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY class_id), H1AvgGrade AS (SELECT class_id, AVG(grade_value) AS H1_avg_grade FROM grades WHERE grade_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY class_id)\nSELECT c.class_id, c.class_name, c.instructor_name, COALESCE(he.H1_enrollments, 0) AS H1_enrollments, COALESCE(hag.H1_avg_grade, 0) AS H1_avg_grade\nFROM classes AS c\nLEFT JOIN H1Enrollments AS he ON c.class_id = he.class_id\nLEFT JOIN H1AvgGrade AS hag ON c.class_id = hag.class_id\nLEFT JOIN waitlist_classes AS wc ON c.class_id = wc.class_id AND wc.waitlist_count > 10\nJOIN class_materials AS cm ON c.class_id = cm.class_id\nWHERE c.semester = 'Spring 2023' AND c.department = 'Arts' AND wc.class_id IS NULL AND cm.material_type = 'Textbook'\nORDER BY H1_enrollments DESC, H1_avg_grade DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT pub.publisher_id, pub.publisher_name, pub.country, (SELECT COUNT(b.book_id) FROM books b WHERE b.publisher_id = pub.publisher_id AND b.publication_year = 2023) AS new_books_2023, (SELECT SUM(s.royalty_amount) FROM sales_royalty s WHERE s.publisher_id = pub.publisher_id AND s.sale_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_royalties_2023\nFROM publishers pub\nWHERE pub.founding_year < 1980 AND pub.publisher_id NOT IN (SELECT cr.publisher_id FROM copyright_infringements cr WHERE cr.infringement_date > '2023-01-01') AND EXISTS (SELECT 1 FROM publisher_genres pg JOIN genres g ON pg.genre_id = g.genre_id WHERE pg.publisher_id = pub.publisher_id AND g.genre_name = 'Fantasy')\nORDER BY new_books_2023 DESC, annual_royalties_2023 DESC\nLIMIT 10 ;", "output": "WITH PublisherBookStats AS (SELECT publisher_id, COUNT(book_id) AS new_books_2023 FROM books WHERE publication_year = 2023 GROUP BY publisher_id), PublisherRoyalties AS (SELECT publisher_id, SUM(royalty_amount) AS annual_royalties_2023 FROM sales_royalty WHERE sale_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY publisher_id)\nSELECT pub.publisher_id, pub.publisher_name, pub.country, COALESCE(pbs.new_books_2023, 0) AS new_books_2023, COALESCE(pr.annual_royalties_2023, 0) AS annual_royalties_2023\nFROM publishers AS pub\nLEFT JOIN PublisherBookStats AS pbs ON pub.publisher_id = pbs.publisher_id\nLEFT JOIN PublisherRoyalties AS pr ON pub.publisher_id = pr.publisher_id\nLEFT JOIN copyright_infringements AS ci ON pub.publisher_id = ci.publisher_id AND ci.infringement_date > '2023-01-01'\nJOIN publisher_genres AS pg ON pub.publisher_id = pg.publisher_id\nJOIN genres AS g ON pg.genre_id = g.genre_id\nWHERE pub.founding_year < 1980 AND ci.publisher_id IS NULL AND g.genre_name = 'Fantasy'\nORDER BY new_books_2023 DESC, annual_royalties_2023 DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT co.customer_id, co.customer_name, co.city, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = co.customer_id AND o.order_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_orders, (SELECT SUM(o.total_amount) FROM orders o WHERE o.customer_id = co.customer_id AND o.order_date BETWEEN '2023-01-01' AND '2023-03-31') AS Q1_total_spend\nFROM customers co\nWHERE co.registration_date > '2022-01-01' AND co.customer_type = 'Business' AND co.customer_id NOT IN (SELECT cb.customer_id FROM customer_blacklists cb WHERE cb.blacklist_date > '2023-01-01') AND EXISTS (SELECT 1 FROM customer_contracts cc WHERE cc.customer_id = co.customer_id AND cc.contract_status = 'Active')\nORDER BY Q1_total_spend DESC, Q1_orders DESC\nLIMIT 15 ;", "output": "WITH Q1CustomerStats AS (SELECT customer_id, COUNT(order_id) AS Q1_orders, SUM(total_amount) AS Q1_total_spend FROM orders WHERE order_date BETWEEN '2023-01-01' AND '2023-03-31' GROUP BY customer_id)\nSELECT co.customer_id, co.customer_name, co.city, COALESCE(qcs.Q1_orders, 0) AS Q1_orders, COALESCE(qcs.Q1_total_spend, 0) AS Q1_total_spend\nFROM customers AS co\nLEFT JOIN Q1CustomerStats AS qcs ON co.customer_id = qcs.customer_id\nLEFT JOIN customer_blacklists AS cb ON co.customer_id = cb.customer_id AND cb.blacklist_date > '2023-01-01'\nJOIN customer_contracts AS cc ON co.customer_id = cc.customer_id\nWHERE co.registration_date > '2022-01-01' AND co.customer_type = 'Business' AND cb.customer_id IS NULL AND cc.contract_status = 'Active'\nORDER BY Q1_total_spend DESC, Q1_orders DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT ev.event_id, ev.event_name, ev.event_date, (SELECT COUNT(reg.registration_id) FROM event_registrations reg WHERE reg.event_id = ev.event_id AND reg.registration_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_registrations, (SELECT AVG(fb.satisfaction_score) FROM event_feedback fb WHERE fb.event_id = ev.event_id AND fb.feedback_date > '2023-01-01') AS avg_feedback_score\nFROM EVENTS ev\nWHERE ev.event_type = 'Webinar' AND ev.status = 'Completed' AND ev.event_date BETWEEN '2023-01-01' AND '2023-12-31' AND ev.event_id NOT IN (SELECT tech.event_id FROM technical_issues tech WHERE tech.issue_date > '2023-01-01') AND EXISTS (SELECT 1 FROM event_speakers es JOIN speakers s ON es.speaker_id = s.speaker_id WHERE es.event_id = ev.event_id AND s.specialization = 'Data Science')\nORDER BY H1_registrations DESC, avg_feedback_score DESC\nLIMIT 10 ;", "output": "WITH H1Registrations AS (SELECT event_id, COUNT(registration_id) AS H1_registrations FROM event_registrations WHERE registration_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY event_id), EventFeedback AS (SELECT event_id, AVG(satisfaction_score) AS avg_feedback_score FROM event_feedback WHERE feedback_date > '2023-01-01' GROUP BY event_id)\nSELECT ev.event_id, ev.event_name, ev.event_date, COALESCE(hr.H1_registrations, 0) AS H1_registrations, COALESCE(ef.avg_feedback_score, 0) AS avg_feedback_score\nFROM EVENTS AS ev\nLEFT JOIN H1Registrations AS hr ON ev.event_id = hr.event_id\nLEFT JOIN EventFeedback AS ef ON ev.event_id = ef.event_id\nLEFT JOIN technical_issues AS ti ON ev.event_id = ti.event_id AND ti.issue_date > '2023-01-01'\nJOIN event_speakers AS es ON ev.event_id = es.event_id\nJOIN speakers AS s ON es.speaker_id = s.speaker_id\nWHERE ev.event_type = 'Webinar' AND ev.status = 'Completed' AND ev.event_date BETWEEN '2023-01-01' AND '2023-12-31' AND ti.event_id IS NULL AND s.specialization = 'Data Science'\nORDER BY H1_registrations DESC, avg_feedback_score DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT rep.report_id, rep.report_name, rep.report_type, rep.generation_date, (SELECT COUNT(dist.distribution_id) FROM report_distributions dist WHERE dist.report_id = rep.report_id AND dist.distribution_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_distributions, (SELECT AVG(usg.usage_count) FROM report_usage usg WHERE usg.report_id = rep.report_id AND usg.usage_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_avg_usage\nFROM reports rep\nWHERE rep.status = 'Published' AND rep.visibility = 'Public' AND rep.generation_date > '2022-01-01' AND rep.report_id NOT IN (SELECT err.report_id FROM report_errors err WHERE err.error_date > '2023-01-01') AND EXISTS (SELECT 1 FROM report_categories rc JOIN categories cat ON rc.category_id = cat.category_id WHERE rc.report_id = rep.report_id AND cat.category_name = 'Financial')\nORDER BY H1_distributions DESC, H1_avg_usage DESC\nLIMIT 10 ;", "output": "WITH H1Distributions AS (SELECT report_id, COUNT(distribution_id) AS H1_distributions FROM report_distributions WHERE distribution_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY report_id), H1Usage AS (SELECT report_id, AVG(usage_count) AS H1_avg_usage FROM report_usage WHERE usage_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY report_id)\nSELECT rep.report_id, rep.report_name, rep.report_type, rep.generation_date, COALESCE(hd.H1_distributions, 0) AS H1_distributions, COALESCE(hu.H1_avg_usage, 0) AS H1_avg_usage\nFROM reports AS rep\nLEFT JOIN H1Distributions AS hd ON rep.report_id = hd.report_id\nLEFT JOIN H1Usage AS hu ON rep.report_id = hu.report_id\nLEFT JOIN report_errors AS re ON rep.report_id = re.report_id AND re.error_date > '2023-01-01'\nJOIN report_categories AS rc ON rep.report_id = rc.report_id\nJOIN categories AS cat ON rc.category_id = cat.category_id\nWHERE rep.status = 'Published' AND rep.visibility = 'Public' AND rep.generation_date > '2022-01-01' AND re.report_id IS NULL AND cat.category_name = 'Financial'\nORDER BY H1_distributions DESC, H1_avg_usage DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT em.employee_id, em.first_name, em.last_name, em.department_id, (SELECT COUNT(t.training_id) FROM employee_trainings t WHERE t.employee_id = em.employee_id AND t.completion_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_trainings_completed, (SELECT AVG(pf.score) FROM performance_feedback pf WHERE pf.employee_id = em.employee_id AND pf.feedback_date BETWEEN '2023-01-01' AND '2023-12-31') AS avg_performance_score\nFROM employees em\nWHERE em.status = 'Active' AND em.hire_date < '2020-01-01' AND em.employee_id NOT IN (SELECT cp.employee_id FROM disciplinary_cases cp WHERE cp.case_date > '2023-01-01' AND cp.severity = 'Termination') AND EXISTS (SELECT 1 FROM employee_skills es JOIN skills s ON es.skill_id = s.skill_id WHERE es.employee_id = em.employee_id AND s.skill_name = 'Project Management')\nORDER BY annual_trainings_completed DESC, avg_performance_score DESC\nLIMIT 15 ;", "output": "WITH AnnualTrainings AS (SELECT employee_id, COUNT(training_id) AS annual_trainings_completed FROM employee_trainings WHERE completion_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY employee_id), PerformanceScores AS (SELECT employee_id, AVG(score) AS avg_performance_score FROM performance_feedback WHERE feedback_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY employee_id)\nSELECT em.employee_id, em.first_name, em.last_name, em.department_id, COALESCE(at.annual_trainings_completed, 0) AS annual_trainings_completed, COALESCE(ps.avg_performance_score, 0) AS avg_performance_score\nFROM employees AS em\nLEFT JOIN AnnualTrainings AS AT ON em.employee_id = at.employee_id\nLEFT JOIN PerformanceScores AS ps ON em.employee_id = ps.employee_id\nLEFT JOIN disciplinary_cases AS dc ON em.employee_id = dc.employee_id AND dc.case_date > '2023-01-01' AND dc.severity = 'Termination'\nJOIN employee_skills AS es ON em.employee_id = es.employee_id\nJOIN skills AS s ON es.skill_id = s.skill_id\nWHERE em.status = 'Active' AND em.hire_date < '2020-01-01' AND dc.employee_id IS NULL AND s.skill_name = 'Project Management'\nORDER BY annual_trainings_completed DESC, avg_performance_score DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT pub.publication_id, pub.title, pub.publisher, (SELECT COUNT(cit.citation_id) FROM citations cit WHERE cit.publication_id = pub.publication_id AND cit.citation_year = 2023) AS citations_2023, (SELECT AVG(met.impact_factor) FROM journal_metrics met WHERE met.publication_id = pub.publication_id AND met.metric_year = 2023) AS avg_impact_factor\nFROM publications pub\nWHERE pub.publication_type = 'Journal Article' AND pub.publication_year BETWEEN 2010 AND 2022 AND pub.publication_id NOT IN (SELECT pr.publication_id FROM retraction_notices pr WHERE pr.retraction_date > '2023-01-01') AND EXISTS (SELECT 1 FROM publication_authors pa JOIN authors au ON pa.author_id = au.author_id WHERE pa.publication_id = pub.publication_id AND au.academic_rank = 'Professor')\nORDER BY citations_2023 DESC, avg_impact_factor DESC\nLIMIT 10 ;", "output": "WITH PublicationCitationStats AS (SELECT publication_id, COUNT(citation_id) AS citations_2023 FROM citations WHERE citation_year = 2023 GROUP BY publication_id), ImpactFactors AS (SELECT publication_id, AVG(impact_factor) AS avg_impact_factor FROM journal_metrics WHERE metric_year = 2023 GROUP BY publication_id)\nSELECT pub.publication_id, pub.title, pub.publisher, COALESCE(pcs.citations_2023, 0) AS citations_2023, COALESCE(imf.avg_impact_factor, 0) AS avg_impact_factor\nFROM publications AS pub\nLEFT JOIN PublicationCitationStats AS pcs ON pub.publication_id = pcs.publication_id\nLEFT JOIN ImpactFactors AS imf ON pub.publication_id = imf.publication_id\nLEFT JOIN retraction_notices AS rn ON pub.publication_id = rn.publication_id AND rn.retraction_date > '2023-01-01'\nJOIN publication_authors AS pa ON pub.publication_id = pa.publication_id\nJOIN authors AS au ON pa.author_id = au.author_id\nWHERE pub.publication_type = 'Journal Article' AND pub.publication_year BETWEEN 2010 AND 2022 AND rn.publication_id IS NULL AND au.academic_rank = 'Professor'\nORDER BY citations_2023 DESC, avg_impact_factor DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT pat.patient_id, pat.first_name, pat.last_name, pat.date_of_birth, (SELECT COUNT(diag.diagnosis_id) FROM diagnoses diag WHERE diag.patient_id = pat.patient_id AND diag.diagnosis_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_diagnoses_count, (SELECT MAX(med.prescription_date) FROM prescriptions med WHERE med.patient_id = pat.patient_id) AS last_prescription_date\nFROM patients pat\nWHERE pat.gender = 'Female' AND pat.age BETWEEN 30 AND 50 AND pat.patient_id NOT IN (SELECT adm.patient_id FROM admissions adm WHERE adm.admission_date > '2023-01-01' AND adm.reason = 'Emergency') AND EXISTS (SELECT 1 FROM patient_allergies pa WHERE pa.patient_id = pat.patient_id AND pa.allergy_type = 'Drug')\nORDER BY H1_diagnoses_count DESC, last_prescription_date DESC\nLIMIT 10 ;", "output": "WITH H1Diagnoses AS (SELECT patient_id, COUNT(diagnosis_id) AS H1_diagnoses_count FROM diagnoses WHERE diagnosis_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY patient_id), LastPrescription AS (SELECT patient_id, MAX(prescription_date) AS last_prescription_date FROM prescriptions GROUP BY patient_id)\nSELECT pat.patient_id, pat.first_name, pat.last_name, pat.date_of_birth, COALESCE(hd.H1_diagnoses_count, 0) AS H1_diagnoses_count, lpr.last_prescription_date\nFROM patients AS pat\nLEFT JOIN H1Diagnoses AS hd ON pat.patient_id = hd.patient_id\nLEFT JOIN LastPrescription AS lpr ON pat.patient_id = lpr.patient_id\nLEFT JOIN admissions AS adm ON pat.patient_id = adm.patient_id AND adm.admission_date > '2023-01-01' AND adm.reason = 'Emergency'\nJOIN patient_allergies AS pa ON pat.patient_id = pa.patient_id\nWHERE pat.gender = 'Female' AND pat.age BETWEEN 30 AND 50 AND adm.patient_id IS NULL AND pa.allergy_type = 'Drug'\nORDER BY H1_diagnoses_count DESC, last_prescription_date DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT res.resource_id, res.resource_name, res.resource_type, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.resource_id = res.resource_id AND b.booking_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_bookings, (SELECT SUM(b.duration_hours) FROM bookings b WHERE b.resource_id = res.resource_id AND b.booking_date BETWEEN '2023-01-01' AND '2023-12-31') AS total_booking_hours\nFROM resources res\nWHERE res.status = 'Available' AND res.location = 'Main Campus' AND res.resource_id NOT IN (SELECT br.resource_id FROM breakage_reports br WHERE br.report_date > '2023-01-01') AND EXISTS (SELECT 1 FROM resource_tags rt JOIN tags t ON rt.tag_id = t.tag_id WHERE rt.resource_id = res.resource_id AND t.tag_name = 'High Demand')\nORDER BY annual_bookings DESC, total_booking_hours DESC\nLIMIT 15 ;", "output": "WITH ResourceBookingStats AS (SELECT resource_id, COUNT(booking_id) AS annual_bookings, SUM(duration_hours) AS total_booking_hours FROM bookings WHERE booking_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY resource_id)\nSELECT res.resource_id, res.resource_name, res.resource_type, COALESCE(rbs.annual_bookings, 0) AS annual_bookings, COALESCE(rbs.total_booking_hours, 0) AS total_booking_hours\nFROM resources AS res\nLEFT JOIN ResourceBookingStats AS rbs ON res.resource_id = rbs.resource_id\nLEFT JOIN breakage_reports AS br ON res.resource_id = br.resource_id AND br.report_date > '2023-01-01'\nJOIN resource_tags AS rt ON res.resource_id = rt.resource_id\nJOIN tags AS t ON rt.tag_id = t.tag_id\nWHERE res.status = 'Available' AND res.location = 'Main Campus' AND br.resource_id IS NULL AND t.tag_name = 'High Demand'\nORDER BY annual_bookings DESC, total_booking_hours DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT tr.track_id, tr.track_name, tr.artist_name, tr.album_name, (SELECT COUNT(us.stream_id) FROM user_streams us WHERE us.track_id = tr.track_id AND us.stream_date BETWEEN '2023-01-01' AND '2023-06-30') AS H1_streams, (SELECT AVG(ur.rating_score) FROM user_ratings ur WHERE ur.track_id = tr.track_id AND ur.rating_date > '2023-01-01') AS avg_user_rating\nFROM tracks tr\nWHERE tr.genre = 'Pop' AND tr.release_year = 2023 AND tr.track_id NOT IN (SELECT pv.track_id FROM piracy_violations pv WHERE pv.violation_date > '2023-01-01') AND EXISTS (SELECT 1 FROM track_playlists tp JOIN playlists p ON tp.playlist_id = p.playlist_id WHERE tp.track_id = tr.track_id AND p.playlist_type = 'Editorial')\nORDER BY H1_streams DESC, avg_user_rating DESC\nLIMIT 15 ;", "output": "WITH H1Streams AS (SELECT track_id, COUNT(stream_id) AS H1_streams FROM user_streams WHERE stream_date BETWEEN '2023-01-01' AND '2023-06-30' GROUP BY track_id), AvgUserRating AS (SELECT track_id, AVG(rating_score) AS avg_user_rating FROM user_ratings WHERE rating_date > '2023-01-01' GROUP BY track_id)\nSELECT tr.track_id, tr.track_name, tr.artist_name, tr.album_name, COALESCE(hs.H1_streams, 0) AS H1_streams, COALESCE(aur.avg_user_rating, 0) AS avg_user_rating\nFROM tracks AS tr\nLEFT JOIN H1Streams AS hs ON tr.track_id = hs.track_id\nLEFT JOIN AvgUserRating AS aur ON tr.track_id = aur.track_id\nLEFT JOIN piracy_violations AS pv ON tr.track_id = pv.track_id AND pv.violation_date > '2023-01-01'\nJOIN track_playlists AS tp ON tr.track_id = tp.track_id\nJOIN playlists AS p ON tp.playlist_id = p.playlist_id\nWHERE tr.genre = 'Pop' AND tr.release_year = 2023 AND pv.track_id IS NULL AND p.playlist_type = 'Editorial'\nORDER BY H1_streams DESC, avg_user_rating DESC\nLIMIT 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT dev.developer_id, dev.developer_name, dev.specialty, (SELECT COUNT(app.app_id) FROM applications app WHERE app.developer_id = dev.developer_id AND app.release_date BETWEEN '2023-01-01' AND '2023-12-31') AS annual_app_releases, (SELECT AVG(ur.average_rating) FROM app_user_ratings ur JOIN applications app ON ur.app_id = app.app_id WHERE app.developer_id = dev.developer_id) AS avg_app_rating\nFROM developers dev\nWHERE dev.country = 'Japan' AND dev.years_experience > 5 AND dev.developer_id NOT IN (SELECT pr.developer_id FROM code_review_penalties pr WHERE pr.penalty_date > '2023-01-01') AND EXISTS (SELECT 1 FROM developer_platforms dp JOIN platforms p ON dp.platform_id = p.platform_id WHERE dp.developer_id = dev.developer_id AND p.platform_name = 'iOS')\nORDER BY annual_app_releases DESC, avg_app_rating DESC\nLIMIT 10 ;", "output": "WITH AnnualAppReleases AS (SELECT developer_id, COUNT(app_id) AS annual_app_releases FROM applications WHERE release_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY developer_id), AvgAppRating AS (SELECT app.developer_id, AVG(ur.average_rating) AS avg_app_rating FROM app_user_ratings AS ur JOIN applications AS app ON ur.app_id = app.app_id GROUP BY app.developer_id)\nSELECT dev.developer_id, dev.developer_name, dev.specialty, COALESCE(aar.annual_app_releases, 0) AS annual_app_releases, COALESCE(aar_avg.avg_app_rating, 0) AS avg_app_rating\nFROM developers AS dev\nLEFT JOIN AnnualAppReleases AS aar ON dev.developer_id = aar.developer_id\nLEFT JOIN AvgAppRating AS aar_avg ON dev.developer_id = aar_avg.developer_id\nLEFT JOIN code_review_penalties AS crp ON dev.developer_id = crp.developer_id AND crp.penalty_date > '2023-01-01'\nJOIN developer_platforms AS dp ON dev.developer_id = dp.developer_id\nJOIN platforms AS p ON dp.platform_id = p.platform_id\nWHERE dev.country = 'Japan' AND dev.years_experience > 5 AND crp.developer_id IS NULL AND p.platform_name = 'iOS'\nORDER BY annual_app_releases DESC, avg_app_rating DESC\nLIMIT 10 ;"}
{"instruction": "Optimize the SQL query", "input": "WITH RECURSIVE category_tree AS (SELECT category_id, category_name, parent_category_id, 1 AS LEVEL FROM categories WHERE parent_category_id IS NULL UNION ALL SELECT c.category_id, c.category_name, c.parent_category_id, ct.level + 1 FROM categories c INNER JOIN category_tree ct ON c.parent_category_id = ct.category_id)\nSELECT ct.category_id, ct.category_name, ct.level, p.product_count, COALESCE(SUM(s.sales_amount), 0) AS total_sales\nFROM category_tree ct\nLEFT JOIN (SELECT category_id, COUNT(*) AS product_count FROM products WHERE discontinued = FALSE GROUP BY category_id) p ON ct.category_id = p.category_id\nLEFT JOIN (SELECT p.category_id, SUM(sd.quantity * sd.unit_price) AS sales_amount FROM sales_details sd JOIN products p ON sd.product_id = p.product_id JOIN sales s ON sd.sale_id = s.sale_id WHERE s.sale_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY p.category_id) s ON ct.category_id = s.category_id\nWHERE ct.level <= 4 AND p.product_count > 0\nORDER BY ct.level, total_sales DESC", "output": "WITH RECURSIVE category_tree AS (SELECT category_id, category_name, parent_category_id, 1 AS LEVEL FROM categories WHERE parent_category_id IS NULL UNION ALL SELECT c.category_id, c.category_name, c.parent_category_id, ct.level + 1 FROM categories c INNER JOIN category_tree ct ON c.parent_category_id = ct.category_id)\nSELECT ct.category_id, ct.category_name, ct.level, p.product_count, COALESCE(SUM(s.sales_amount), 0) AS total_sales\nFROM category_tree ct\nLEFT JOIN (SELECT category_id, COUNT(*) AS product_count FROM products WHERE discontinued = FALSE GROUP BY category_id) p ON ct.category_id = p.category_id\nLEFT JOIN (SELECT p.category_id, SUM(sd.quantity * sd.unit_price) AS sales_amount FROM sales_details sd JOIN products p ON sd.product_id = p.product_id JOIN sales s ON sd.sale_id = s.sale_id WHERE s.sale_date BETWEEN '2023-01-01' AND '2023-12-31' GROUP BY p.category_id) s ON ct.category_id = s.category_id\nWHERE ct.level <= 4 AND p.product_count > 0\nORDER BY ct.level, total_sales DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id, customer_name, email, registration_date, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.customer_id AND o.order_date >= CURRENT_DATE - INTERVAL '365 days') AS orders_last_year, (SELECT SUM(total_amount) FROM orders o WHERE o.customer_id = c.customer_id AND o.status = 'completed') AS lifetime_value, (SELECT MAX(order_date) FROM orders o WHERE o.customer_id = c.customer_id) AS last_order_date, EXISTS(SELECT 1 FROM subscriptions s WHERE s.customer_id = c.customer_id AND s.status = 'active') AS has_active_subscription, (SELECT STRING_AGG(DISTINCT category_name, ', ') FROM orders o JOIN order_items oi ON o.order_id = oi.order_id JOIN products p ON oi.product_id = p.product_id JOIN categories cat ON p.category_id = cat.category_id WHERE o.customer_id = c.customer_id) AS purchased_categories\nFROM customers c\nWHERE registration_date > '2020-01-01' AND customer_id IN (SELECT customer_id FROM orders GROUP BY customer_id HAVING COUNT(*) > 3 AND SUM(total_amount) > 500)\nORDER BY lifetime_value DESC NULLS LAST\nLIMIT 100", "output": "SELECT customer_id, customer_name, email, registration_date, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.customer_id AND o.order_date >= CURRENT_DATE - INTERVAL '365 days') AS orders_last_year, (SELECT SUM(total_amount) FROM orders o WHERE o.customer_id = c.customer_id AND o.status = 'completed') AS lifetime_value, (SELECT MAX(order_date) FROM orders o WHERE o.customer_id = c.customer_id) AS last_order_date, EXISTS(SELECT 1 FROM subscriptions s WHERE s.customer_id = c.customer_id AND s.status = 'active') AS has_active_subscription, (SELECT STRING_AGG(DISTINCT category_name, ', ') FROM orders o JOIN order_items oi ON o.order_id = oi.order_id JOIN products p ON oi.product_id = p.product_id JOIN categories cat ON p.category_id = cat.category_id WHERE o.customer_id = c.customer_id) AS purchased_categories\nFROM customers c\nWHERE registration_date > '2020-01-01' AND customer_id IN (SELECT customer_id FROM orders GROUP BY customer_id HAVING COUNT(*) > 3 AND SUM(total_amount) > 500)\nORDER BY lifetime_value DESC NULLS LAST\nLIMIT 100"}
{"instruction": "Optimize the SQL query", "input": "SELECT date_trunc('month', sale_date) AS sales_month, product_category, region, SUM(sales_amount) AS monthly_sales, AVG(SUM(sales_amount)) OVER (PARTITION BY product_category, region ORDER BY date_trunc('month', sale_date) ROWS BETWEEN 3 PRECEDING AND 1 PRECEDING) AS avg_prev_3_months, (SUM(sales_amount) - LAG(SUM(sales_amount), 1) OVER (PARTITION BY product_category, region ORDER BY date_trunc('month', sale_date))) / LAG(SUM(sales_amount), 1) OVER (PARTITION BY product_category, region ORDER BY date_trunc('month', sale_date)) ) * 100 AS growth_rate, RANK() OVER (PARTITION BY date_trunc('month', sale_date), region ORDER BY SUM(sales_amount) DESC) AS category_rank\nFROM sales_data\nWHERE sale_date BETWEEN '2023-01-01' AND '2023-12-31' AND sales_amount > 0\nGROUP BY date_trunc('month', sale_date), product_category, region\nHAVING SUM(sales_amount) > 10000\nORDER BY sales_month DESC, region, category_rank", "output": "SELECT date_trunc('month', sale_date) AS sales_month, product_category, region, SUM(sales_amount) AS monthly_sales, AVG(SUM(sales_amount)) OVER (PARTITION BY product_category, region ORDER BY date_trunc('month', sale_date) ROWS BETWEEN 3 PRECEDING AND 1 PRECEDING) AS avg_prev_3_months, (SUM(sales_amount) - LAG(SUM(sales_amount), 1) OVER (PARTITION BY product_category, region ORDER BY date_trunc('month', sale_date))) / LAG(SUM(sales_amount), 1) OVER (PARTITION BY product_category, region ORDER BY date_trunc('month', sale_date)) ) * 100 AS growth_rate, RANK() OVER (PARTITION BY date_trunc('month', sale_date), region ORDER BY SUM(sales_amount) DESC) AS category_rank\nFROM sales_data\nWHERE sale_date BETWEEN '2023-01-01' AND '2023-12-31' AND sales_amount > 0\nGROUP BY date_trunc('month', sale_date), product_category, region\nHAVING SUM(sales_amount) > 10000\nORDER BY sales_month DESC, region, category_rank"}
{"instruction": "Optimize the SQL query", "input": "SELECT employee_id, project_id, SUM(hours_worked) AS total_hours, CASE WHEN SUM(hours_worked) > 160 THEN SUM(hours_worked) - 160 ELSE 0 END AS overtime_hours, SUM(CASE WHEN billable = TRUE THEN hours_worked ELSE 0 END) AS billable_hours, SUM(hours_worked * hourly_rate) AS total_cost, SUM(CASE WHEN billable = TRUE THEN hours_worked * hourly_rate ELSE 0 END) AS billable_cost, COUNT(DISTINCT task_id) AS unique_tasks, MIN(work_date) AS first_work_date, MAX(work_date) AS last_work_date\nFROM time_entries\nWHERE work_date BETWEEN '2023-01-01' AND '2023-12-31' AND approved = TRUE\nGROUP BY employee_id, project_id\nHAVING SUM(hours_worked) > 0 AND COUNT(DISTINCT work_date) > 5\nUNION ALL\nSELECT employee_id, NULL AS project_id, SUM(hours_worked) AS total_hours, CASE WHEN SUM(hours_worked) > 160 THEN SUM(hours_worked) - 160 ELSE 0 END AS overtime_hours, SUM(CASE WHEN billable = TRUE THEN hours_worked ELSE 0 END) AS billable_hours, SUM(hours_worked * hourly_rate) AS total_cost, SUM(CASE WHEN billable = TRUE THEN hours_worked * hourly_rate ELSE 0 END) AS billable_cost, COUNT(DISTINCT task_id) AS unique_tasks, MIN(work_date) AS first_work_date, MAX(work_date) AS last_work_date\nFROM time_entries\nWHERE work_date BETWEEN '2023-01-01' AND '2023-12-31' AND approved = TRUE\nGROUP BY employee_id\nHAVING SUM(hours_worked) > 100\nORDER BY total_hours DESC", "output": "SELECT employee_id, project_id, SUM(hours_worked) AS total_hours, CASE WHEN SUM(hours_worked) > 160 THEN SUM(hours_worked) - 160 ELSE 0 END AS overtime_hours, SUM(CASE WHEN billable = TRUE THEN hours_worked ELSE 0 END) AS billable_hours, SUM(hours_worked * hourly_rate) AS total_cost, SUM(CASE WHEN billable = TRUE THEN hours_worked * hourly_rate ELSE 0 END) AS billable_cost, COUNT(DISTINCT task_id) AS unique_tasks, MIN(work_date) AS first_work_date, MAX(work_date) AS last_work_date\nFROM time_entries\nWHERE work_date BETWEEN '2023-01-01' AND '2023-12-31' AND approved = TRUE\nGROUP BY employee_id, project_id\nHAVING SUM(hours_worked) > 0 AND COUNT(DISTINCT work_date) > 5\nUNION ALL\nSELECT employee_id, NULL AS project_id, SUM(hours_worked) AS total_hours, CASE WHEN SUM(hours_worked) > 160 THEN SUM(hours_worked) - 160 ELSE 0 END AS overtime_hours, SUM(CASE WHEN billable = TRUE THEN hours_worked ELSE 0 END) AS billable_hours, SUM(hours_worked * hourly_rate) AS total_cost, SUM(CASE WHEN billable = TRUE THEN hours_worked * hourly_rate ELSE 0 END) AS billable_cost, COUNT(DISTINCT task_id) AS unique_tasks, MIN(work_date) AS first_work_date, MAX(work_date) AS last_work_date\nFROM time_entries\nWHERE work_date BETWEEN '2023-01-01' AND '2023-12-31' AND approved = TRUE\nGROUP BY employee_id\nHAVING SUM(hours_worked) > 100\nORDER BY total_hours DESC"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.product_name, p.category_id, p.current_price, p.stock_quantity, COALESCE(SUM(oi.quantity), 0) AS total_sold, COALESCE(SUM(oi.quantity * oi.unit_price), 0) AS total_revenue, COALESCE(AVG(r.rating), 0) AS avg_rating, COUNT(r.review_id) AS review_count, COALESCE((SELECT STRING_AGG(DISTINCT s.supplier_name, ', ' ORDER BY s.supplier_name) FROM product_suppliers ps JOIN suppliers s ON ps.supplier_id = s.supplier_id WHERE ps.product_id = p.product_id), 'No supplier') AS suppliers, EXISTS(SELECT 1 FROM product_discounts pd WHERE pd.product_id = p.product_id AND pd.start_date <= CURRENT_DATE AND pd.end_date >= CURRENT_DATE) AS has_current_discount, (SELECT COUNT(*) FROM order_items oi2 JOIN orders o ON oi2.order_id = o.order_id WHERE oi2.product_id = p.product_id AND o.order_date >= CURRENT_DATE - INTERVAL '30 days') AS last_30_days_sales\nFROM products p\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id\nLEFT JOIN reviews r ON p.product_id = r.product_id\nWHERE p.discontinued = FALSE AND p.stock_quantity > 0\nGROUP BY p.product_id, p.product_name, p.category_id, p.current_price, p.stock_quantity\nHAVING COALESCE(SUM(oi.quantity), 0) > 10 AND COALESCE(AVG(r.rating), 0) >= 3.5\nORDER BY total_revenue DESC, avg_rating DESC\nLIMIT 50", "output": "SELECT p.product_id, p.product_name, p.category_id, p.current_price, p.stock_quantity, COALESCE(SUM(oi.quantity), 0) AS total_sold, COALESCE(SUM(oi.quantity * oi.unit_price), 0) AS total_revenue, COALESCE(AVG(r.rating), 0) AS avg_rating, COUNT(r.review_id) AS review_count, COALESCE((SELECT STRING_AGG(DISTINCT s.supplier_name, ', ' ORDER BY s.supplier_name) FROM product_suppliers ps JOIN suppliers s ON ps.supplier_id = s.supplier_id WHERE ps.product_id = p.product_id), 'No supplier') AS suppliers, EXISTS(SELECT 1 FROM product_discounts pd WHERE pd.product_id = p.product_id AND pd.start_date <= CURRENT_DATE AND pd.end_date >= CURRENT_DATE) AS has_current_discount, (SELECT COUNT(*) FROM order_items oi2 JOIN orders o ON oi2.order_id = o.order_id WHERE oi2.product_id = p.product_id AND o.order_date >= CURRENT_DATE - INTERVAL '30 days') AS last_30_days_sales\nFROM products p\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id\nLEFT JOIN reviews r ON p.product_id = r.product_id\nWHERE p.discontinued = FALSE AND p.stock_quantity > 0\nGROUP BY p.product_id, p.product_name, p.category_id, p.current_price, p.stock_quantity\nHAVING COALESCE(SUM(oi.quantity), 0) > 10 AND COALESCE(AVG(r.rating), 0) >= 3.5\nORDER BY total_revenue DESC, avg_rating DESC\nLIMIT 50"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM employees ;", "output": "SELECT employee_id, first_name, last_name, department_id, salary\nFROM employees ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT id\nFROM orders\nWHERE status = 'completed' OR status = 'shipped' OR status = 'returned';", "output": "SELECT id\nFROM orders\nWHERE status IN ('completed', 'shipped', 'returned');"}
{"instruction": "Optimize the SQL query", "input": "SELECT COUNT(id)\nFROM products\nWHERE price * 1 = price;", "output": "SELECT COUNT(id)\nFROM products ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT customer_id\nFROM orders\nWHERE customer_id IN (SELECT customer_id FROM orders WHERE order_date > '2023-01-01');", "output": "SELECT DISTINCT customer_id\nFROM orders\nWHERE order_date > '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT name, salary\nFROM employees\nORDER BY salary DESC ;", "output": "SELECT name, salary\nFROM employees\nORDER BY salary DESC\nLIMIT 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM sales\nWHERE CAST(order_date AS TEXT) LIKE '2022%';", "output": "SELECT *\nFROM sales\nWHERE order_date >= '2022-01-01' AND order_date < '2023-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT department_id, AVG(salary)\nFROM employees\nGROUP BY department_id\nHAVING AVG(salary) > 50000\nORDER BY AVG(salary) ;", "output": "SELECT department_id, AVG(salary) AS avg_salary\nFROM employees\nGROUP BY department_id\nHAVING AVG(salary) > 50000\nORDER BY avg_salary ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id\nFROM orders\nWHERE order_date >= '2023-01-01' AND order_date <= '2023-12-31';", "output": "SELECT customer_id\nFROM orders\nWHERE order_date BETWEEN '2023-01-01' AND '2023-12-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT id, name\nFROM products\nWHERE price > 100\nORDER BY price ;", "output": "SELECT id, name\nFROM products\nWHERE price > 100\nORDER BY price ASC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT order_id, ROW_NUMBER() OVER (ORDER BY order_date) AS rn\nFROM orders ;", "output": "SELECT order_id, ROW_NUMBER() OVER (ORDER BY order_date) AS rn\nFROM orders ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id\nFROM orders\nGROUP BY customer_id\nHAVING COUNT(*) > 5\nORDER BY COUNT(*) DESC ;", "output": "SELECT customer_id, COUNT(*) AS order_count\nFROM orders\nGROUP BY customer_id\nHAVING COUNT(*) > 5\nORDER BY order_count DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM employees\nWHERE salary + 0 > 50000;", "output": "SELECT *\nFROM employees\nWHERE salary > 50000;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT country\nFROM customers\nWHERE country IS NOT NULL;", "output": "SELECT country\nFROM customers\nWHERE country IS NOT NULL\nGROUP BY country ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT id, (SELECT MAX(order_date) FROM orders WHERE customer_id = c.id) AS last_order\nFROM customers c ;", "output": "SELECT c.id, MAX(o.order_date) AS last_order\nFROM customers c\nLEFT JOIN orders o ON c.id = o.customer_id\nGROUP BY c.id ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, o.customer_id, c.name, (SELECT COUNT(*) FROM payments p WHERE p.order_id = o.id) AS payment_count FROM orders o LEFT JOIN customers c ON o.customer_id = c.id) t\nWHERE payment_count > 2;", "output": "SELECT o.id, o.customer_id, c.name, COUNT(p.id) AS payment_count\nFROM orders o\nLEFT JOIN customers c ON o.customer_id = c.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id, o.customer_id, c.name\nHAVING COUNT(p.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT e.department_id, e.job_id, (SELECT AVG(salary) FROM employees WHERE job_id = e.job_id) AS avg_job_salary, (SELECT MAX(salary) FROM employees WHERE department_id = e.department_id) AS max_dept_salary\nFROM employees e ;", "output": "SELECT e.department_id, e.job_id, AVG(e.salary) OVER (PARTITION BY e.job_id) AS avg_job_salary, MAX(e.salary) OVER (PARTITION BY e.department_id) AS max_dept_salary\nFROM employees e ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.id, c.name, SUM(o.amount) total_amount\nFROM customers c\nJOIN orders o ON c.id = o.customer_id\nWHERE o.status = 'completed' AND o.order_date BETWEEN '2022-01-01' AND '2023-01-01' AND o.id IN (SELECT id FROM orders WHERE amount > 1000)\nGROUP BY c.id, c.name\nHAVING SUM(o.amount) > 5000\nORDER BY total_amount DESC ;", "output": "SELECT c.id, c.name, SUM(o.amount) AS total_amount\nFROM customers c\nJOIN orders o ON c.id = o.customer_id\nWHERE o.status = 'completed' AND o.order_date >= '2022-01-01' AND o.order_date < '2023-01-01' AND o.amount > 1000\nGROUP BY c.id, c.name\nHAVING SUM(o.amount) > 5000\nORDER BY total_amount DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, e.name, e.salary, d.department_name, RANK() OVER (PARTITION BY d.id ORDER BY e.salary DESC) AS rnk FROM employees e LEFT JOIN departments d ON e.department_id = d.id) t\nWHERE rnk <= 3;", "output": "SELECT e.id, e.name, e.salary, d.department_name, RANK() OVER (PARTITION BY d.id ORDER BY e.salary DESC) AS rnk\nFROM employees e\nLEFT JOIN departments d ON e.department_id = d.id\nWHERE RANK() OVER (PARTITION BY d.id ORDER BY e.salary DESC) <= 3;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.country, COUNT(DISTINCT o.id) AS orders_count, (SELECT AVG(amount) FROM orders o2 WHERE o2.customer_id = o.customer_id) AS avg_customer_amount\nFROM customers c\nJOIN orders o ON c.id = o.customer_id\nGROUP BY c.country ;", "output": "SELECT c.country, COUNT(DISTINCT o.id) AS orders_count, AVG(o.amount) AS avg_customer_amount\nFROM customers c\nJOIN orders o ON c.id = o.customer_id\nGROUP BY c.country ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT product_id, SUM(quantity) total_quantity\nFROM (SELECT product_id, quantity FROM order_items WHERE quantity > 0 UNION ALL SELECT product_id, quantity FROM RETURNS WHERE quantity > 0) t\nGROUP BY product_id\nHAVING SUM(quantity) > 100 ;", "output": "SELECT product_id, SUM(quantity) AS total_quantity\nFROM (SELECT product_id, quantity FROM order_items WHERE quantity > 0 UNION ALL SELECT product_id, quantity FROM RETURNS WHERE quantity > 0) t\nGROUP BY product_id\nHAVING SUM(quantity) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.id, e.name, e.department_id, (SELECT AVG(salary) FROM employees WHERE department_id = e.department_id AND hire_date >= '2020-01-01') AS avg_recent_salary\nFROM employees e\nWHERE e.salary > (SELECT AVG(salary) FROM employees);", "output": "SELECT e.id, e.name, e.department_id, AVG(e.salary) OVER (PARTITION BY e.department_id) FILTER (WHERE hire_date >= '2020-01-01') AS avg_recent_salary\nFROM employees e\nWHERE e.salary > (SELECT AVG(salary) FROM employees);"}
{"instruction": "Optimize the SQL query", "input": "SELECT customer_id\nFROM orders\nGROUP BY customer_id\nHAVING COUNT(*) > 10 INTERSECT\nSELECT customer_id\nFROM payments\nGROUP BY customer_id\nHAVING SUM(amount) > 1000 ;", "output": "SELECT o.customer_id\nFROM orders o\nJOIN payments p ON o.customer_id = p.customer_id\nGROUP BY o.customer_id\nHAVING COUNT(o.id) > 10 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT order_id, customer_id, order_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date DESC) rn FROM orders) t\nWHERE rn = 1;", "output": "SELECT order_id, customer_id, order_date\nFROM (SELECT order_id, customer_id, order_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date DESC) rn FROM orders) t\nWHERE rn = 1;"}
{"instruction": "Optimize the SQL query", "input": "SELECT c.id, c.name, SUM(o.amount) total_amount, CASE WHEN SUM(o.amount) > 10000 THEN 'VIP' ELSE 'Regular' END AS customer_type\nFROM customers c\nLEFT JOIN orders o ON c.id = o.customer_id\nGROUP BY c.id, c.name\nHAVING SUM(o.amount) > 1000\nORDER BY total_amount DESC ;", "output": "SELECT c.id, c.name, SUM(o.amount) AS total_amount, CASE WHEN SUM(o.amount) > 10000 THEN 'VIP' ELSE 'Regular' END AS customer_type\nFROM customers c\nLEFT JOIN orders o ON c.id = o.customer_id\nGROUP BY c.id, c.name\nHAVING SUM(o.amount) > 1000\nORDER BY total_amount DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, c.name, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.id AND o.status IN ('completed','shipped')) AS order_count, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = c.id) AS total_paid, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating FROM customers c WHERE c.active = TRUE) t\nWHERE order_count > 10 AND total_paid > 5000 AND avg_rating >= 4\nORDER BY total_paid DESC ;", "output": "SELECT c.id, c.name, COUNT(o.id) AS order_count, SUM(p.amount) AS total_paid, AVG(r.rating) AS avg_rating\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id AND o.status IN ('completed','shipped')\nLEFT JOIN payments p ON p.customer_id = c.id\nLEFT JOIN reviews r ON r.customer_id = c.id\nWHERE c.active = TRUE\nGROUP BY c.id, c.name\nHAVING COUNT(o.id) > 10 AND SUM(p.amount) > 5000 AND AVG(r.rating) >= 4\nORDER BY total_paid DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, e.name, e.department_id, (SELECT MAX(salary) FROM employees e2 WHERE e2.department_id = e.department_id) AS max_salary, (SELECT MIN(salary) FROM employees e3 WHERE e3.department_id = e.department_id) AS min_salary, (SELECT AVG(salary) FROM employees e4 WHERE e4.department_id = e.department_id AND e4.hire_date > '2020-01-01') AS avg_recent_salary FROM employees e) t\nWHERE avg_recent_salary > 60000 AND max_salary - min_salary > 20000;", "output": "SELECT e.id, e.name, e.department_id, MAX(e.salary) OVER (PARTITION BY e.department_id) AS max_salary, MIN(e.salary) OVER (PARTITION BY e.department_id) AS min_salary, AVG(e.salary) FILTER (WHERE e.hire_date > '2020-01-01') OVER (PARTITION BY e.department_id) AS avg_recent_salary\nFROM employees e\nWHERE AVG(e.salary) FILTER (WHERE e.hire_date > '2020-01-01') OVER (PARTITION BY e.department_id) > 60000 AND (MAX(e.salary) OVER (PARTITION BY e.department_id) - MIN(e.salary) OVER (PARTITION BY e.department_id)) > 20000;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id AS dept_id, d.department_name, (SELECT COUNT(*) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT COUNT(*) FROM employees e2 WHERE e2.department_id = d.id AND e2.salary > 70000) AS high_paid, (SELECT AVG(p.amount) FROM payments p WHERE p.employee_id IN (SELECT id FROM employees e3 WHERE e3.department_id = d.id)) AS avg_bonus FROM departments d) t\nWHERE emp_count > 5 AND high_paid >= 2 AND avg_bonus > 2000;", "output": "SELECT d.id AS dept_id, d.department_name, COUNT(e.id) AS emp_count, COUNT(CASE WHEN e.salary > 70000 THEN 1 END) AS high_paid, AVG(p.amount) AS avg_bonus\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY d.id, d.department_name\nHAVING COUNT(e.id) > 5 AND COUNT(CASE WHEN e.salary > 70000 THEN 1 END) >= 2 AND AVG(p.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, o.customer_id, (SELECT COUNT(*) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT SUM(oi2.quantity*oi2.price) FROM order_items oi2 WHERE oi2.order_id = o.id) AS order_value, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS paid_amount FROM orders o WHERE o.order_date BETWEEN '2021-01-01' AND '2022-01-01') t\nWHERE item_count > 2 AND order_value > 500 AND paid_amount < order_value;", "output": "SELECT o.id, o.customer_id, COUNT(oi.id) AS item_count, SUM(oi.quantity*oi.price) AS order_value, SUM(p.amount) AS paid_amount\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nWHERE o.order_date >= '2021-01-01' AND o.order_date < '2022-01-01'\nGROUP BY o.id, o.customer_id\nHAVING COUNT(oi.id) > 2 AND SUM(oi.quantity*oi.price) > 500 AND SUM(p.amount) < SUM(oi.quantity*oi.price) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, c.country, (SELECT COUNT(DISTINCT o.id) FROM orders o WHERE o.customer_id = c.id) AS order_count, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS total_refunds, (SELECT AVG(p.amount) FROM payments p WHERE p.customer_id = c.id) AS avg_payment FROM customers c) t\nWHERE order_count > 20 AND total_refunds > 1000 AND avg_payment > 200;", "output": "SELECT c.id, c.country, COUNT(DISTINCT o.id) AS order_count, SUM(r.refund_amount) AS total_refunds, AVG(p.amount) AS avg_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id, c.country\nHAVING COUNT(DISTINCT o.id) > 20 AND SUM(r.refund_amount) > 1000 AND AVG(p.amount) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, e.name, (SELECT AVG(salary) FROM employees e2 WHERE e2.department_id = e.department_id) AS dept_avg, (SELECT AVG(salary) FROM employees e3 WHERE e3.job_id = e.job_id) AS job_avg, (SELECT MAX(b.bonus) FROM bonuses b WHERE b.employee_id = e.id) AS max_bonus FROM employees e) t\nWHERE dept_avg > 50000 AND job_avg > 60000 AND max_bonus > 1000;", "output": "SELECT e.id, e.name, AVG(e.salary) OVER (PARTITION BY e.department_id) AS dept_avg, AVG(e.salary) OVER (PARTITION BY e.job_id) AS job_avg, MAX(b.bonus) AS max_bonus\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id, e.name\nHAVING AVG(e.salary) OVER (PARTITION BY e.department_id) > 50000 AND AVG(e.salary) OVER (PARTITION BY e.job_id) > 60000 AND MAX(b.bonus) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, o.customer_id, (SELECT COUNT(*) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT AVG(oi2.price) FROM order_items oi2 WHERE oi2.order_id = o.id) AS avg_item_price, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE item_count > 5 AND avg_item_price > 100 AND total_paid > 1000;", "output": "SELECT o.id, o.customer_id, COUNT(oi.id) AS item_count, AVG(oi.price) AS avg_item_price, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id, o.customer_id\nHAVING COUNT(oi.id) > 5 AND AVG(oi.price) > 100 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, c.name, (SELECT COUNT(DISTINCT o.id) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_orders, (SELECT COUNT(DISTINCT o2.id) FROM orders o2 WHERE o2.customer_id = c.id AND o2.status = 'returned') AS returned_orders, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = c.id) AS total_payments FROM customers c) t\nWHERE completed_orders > 5 AND returned_orders < 2 AND total_payments > 3000;", "output": "SELECT c.id, c.name, COUNT(DISTINCT CASE WHEN o.status = 'completed' THEN o.id END) AS completed_orders, COUNT(DISTINCT CASE WHEN o.status = 'returned' THEN o.id END) AS returned_orders, SUM(p.amount) AS total_payments\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id, c.name\nHAVING COUNT(DISTINCT CASE WHEN o.status = 'completed' THEN o.id END) > 5 AND COUNT(DISTINCT CASE WHEN o.status = 'returned' THEN o.id END) < 2 AND SUM(p.amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, d.department_name, (SELECT COUNT(*) FROM employees e WHERE e.department_id = d.id AND e.salary > 50000) AS high_salary_count, (SELECT COUNT(*) FROM employees e2 WHERE e2.department_id = d.id AND e2.hire_date > '2021-01-01') AS recent_hires FROM departments d) t\nWHERE high_salary_count > 3 AND recent_hires > 2;", "output": "SELECT d.id, d.department_name, COUNT(CASE WHEN e.salary > 50000 THEN 1 END) AS high_salary_count, COUNT(CASE WHEN e.hire_date > '2021-01-01' THEN 1 END) AS recent_hires\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id, d.department_name\nHAVING COUNT(CASE WHEN e.salary > 50000 THEN 1 END) > 3 AND COUNT(CASE WHEN e.hire_date > '2021-01-01' THEN 1 END) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, c.country, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = c.id) AS last_order_date, (SELECT MIN(p.amount) FROM payments p WHERE p.customer_id = c.id) AS min_payment, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating FROM customers c) t\nWHERE avg_rating > 3.5;", "output": "SELECT c.id, c.country, MAX(o.order_date) AS last_order_date, MIN(p.amount) AS min_payment, AVG(r.rating) AS avg_rating\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id, c.country\nHAVING AVG(r.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, o.customer_id, (SELECT SUM(oi.quantity*oi.price) FROM order_items oi WHERE oi.order_id = o.id) AS order_total, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS paid_total FROM orders o) t\nWHERE order_total > 200 AND paid_total < order_total;", "output": "SELECT o.id, o.customer_id, SUM(oi.quantity*oi.price) AS order_total, SUM(p.amount) AS paid_total\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id, o.customer_id\nHAVING SUM(oi.quantity*oi.price) > 200 AND SUM(p.amount) < SUM(oi.quantity*oi.price) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, e.department_id, (SELECT MAX(salary) FROM employees e2 WHERE e2.department_id = e.department_id) AS max_salary, (SELECT MIN(salary) FROM employees e3 WHERE e3.department_id = e.department_id) AS min_salary FROM employees e) t\nWHERE max_salary - min_salary > 10000;", "output": "SELECT e.id, e.department_id, MAX(e.salary) OVER (PARTITION BY e.department_id) AS max_salary, MIN(e.salary) OVER (PARTITION BY e.department_id) AS min_salary\nFROM employees e\nWHERE MAX(e.salary) OVER (PARTITION BY e.department_id) - MIN(e.salary) OVER (PARTITION BY e.department_id) > 10000;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, c.name, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.id) AS total_orders, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = c.id) AS total_payments FROM customers c) t\nWHERE total_orders > 2 AND total_payments > 1000;", "output": "SELECT c.id, c.name, COUNT(o.id) AS total_orders, SUM(p.amount) AS total_payments\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id, c.name\nHAVING COUNT(o.id) > 2 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, d.department_name, (SELECT AVG(e.salary) FROM employees e WHERE e.department_id = d.id) AS avg_salary, (SELECT COUNT(e2.id) FROM employees e2 WHERE e2.department_id = d.id) AS emp_count FROM departments d) t\nWHERE avg_salary > 50000 AND emp_count > 10;", "output": "SELECT d.id, d.department_name, AVG(e.salary) AS avg_salary, COUNT(e.id) AS emp_count\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id, d.department_name\nHAVING AVG(e.salary) > 50000 AND COUNT(e.id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.customer_id, (SELECT SUM(amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE total_paid > 2000;", "output": "SELECT o.customer_id, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.customer_id\nHAVING SUM(p.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.id) AS order_count FROM customers c) t\nWHERE avg_rating > 4 AND order_count > 3;", "output": "SELECT c.id, AVG(r.rating) AS avg_rating, COUNT(o.id) AS order_count\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nHAVING AVG(r.rating) > 4 AND COUNT(o.id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM bonuses b WHERE b.employee_id = e.id) AS bonus_count, (SELECT SUM(b2.amount) FROM bonuses b2 WHERE b2.employee_id = e.id) AS total_bonus FROM employees e) t\nWHERE bonus_count > 1 AND total_bonus > 500;", "output": "SELECT e.id, COUNT(b.id) AS bonus_count, SUM(b.amount) AS total_bonus\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(b.id) > 1 AND SUM(b.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT SUM(oi.quantity) FROM order_items oi WHERE oi.order_id = o.id) AS total_items, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE total_items > 10 AND total_paid > 1000;", "output": "SELECT o.id, SUM(oi.quantity) AS total_items, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING SUM(oi.quantity) > 10 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM projects pr WHERE pr.lead_id = e.id) AS lead_projects, (SELECT COUNT(*) FROM projects pr2 WHERE pr2.member_id = e.id) AS member_projects FROM employees e) t\nWHERE lead_projects > 1 AND member_projects > 3;", "output": "SELECT e.id, COUNT(DISTINCT CASE WHEN pr.lead_id = e.id THEN pr.id END) AS lead_projects, COUNT(DISTINCT CASE WHEN pr.member_id = e.id THEN pr.id END) AS member_projects\nFROM employees e\nLEFT JOIN projects pr ON pr.lead_id = e.id OR pr.member_id = e.id\nGROUP BY e.id\nHAVING COUNT(DISTINCT CASE WHEN pr.lead_id = e.id THEN pr.id END) > 1 AND COUNT(DISTINCT CASE WHEN pr.member_id = e.id THEN pr.id END) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(*) FROM tickets t WHERE t.customer_id = c.id) AS total_tickets, (SELECT COUNT(*) FROM tickets t2 WHERE t2.customer_id = c.id AND t2.status = 'closed') AS closed_tickets FROM customers c) t\nWHERE total_tickets > 2 AND closed_tickets > 1;", "output": "SELECT c.id, COUNT(t.id) AS total_tickets, COUNT(CASE WHEN t.status = 'closed' THEN 1 END) AS closed_tickets\nFROM customers c\nLEFT JOIN tickets t ON t.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(t.id) > 2 AND COUNT(CASE WHEN t.status = 'closed' THEN 1 END) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT SUM(e.salary) FROM employees e WHERE e.department_id = d.id) AS total_salary, (SELECT MAX(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS max_salary FROM departments d) t\nWHERE total_salary > 200000 AND max_salary > 80000;", "output": "SELECT d.id, SUM(e.salary) AS total_salary, MAX(e.salary) AS max_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING SUM(e.salary) > 200000 AND MAX(e.salary) > 80000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.customer_id, (SELECT COUNT(*) FROM orders o2 WHERE o2.customer_id = o.customer_id) AS total_orders, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = o.customer_id) AS total_paid FROM orders o) t\nWHERE total_orders > 5 AND total_paid > 3000;", "output": "SELECT o.customer_id, COUNT(DISTINCT o2.id) AS total_orders, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN orders o2 ON o2.customer_id = o.customer_id\nLEFT JOIN payments p ON p.customer_id = o.customer_id\nGROUP BY o.customer_id\nHAVING COUNT(DISTINCT o2.id) > 5 AND SUM(p.amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM certifications c WHERE c.employee_id = e.id) AS cert_count, (SELECT MAX(c2.date) FROM certifications c2 WHERE c2.employee_id = e.id) AS last_cert FROM employees e) t\nWHERE cert_count > 2;", "output": "SELECT e.id, COUNT(c.id) AS cert_count, MAX(c.date) AS last_cert\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(c.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id) AS total_spent, (SELECT COUNT(r.id) FROM RETURNS r WHERE r.customer_id = c.id) AS return_count FROM customers c) t\nWHERE total_spent > 10000 AND return_count < 3;", "output": "SELECT c.id, SUM(o.amount) AS total_spent, COUNT(r.id) AS return_count\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN RETURNS r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(o.amount) > 10000 AND COUNT(r.id) < 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(*) FROM reviews r WHERE r.product_id = p.id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE review_count > 10 AND avg_rating > 4;", "output": "SELECT p.id, COUNT(r.id) AS review_count, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 10 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(*) FROM employees e WHERE e.department_id = d.id AND e.salary > 60000) AS high_paid, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE high_paid > 3 AND avg_salary > 50000;", "output": "SELECT d.id, COUNT(CASE WHEN e.salary > 60000 THEN 1 END) AS high_paid, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.salary > 60000 THEN 1 END) > 3 AND AVG(e.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(*) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT AVG(oi2.price) FROM order_items oi2 WHERE oi2.order_id = o.id) AS avg_price FROM orders o) t\nWHERE item_count > 5 AND avg_price > 100;", "output": "SELECT o.id, COUNT(oi.id) AS item_count, AVG(oi.price) AS avg_price\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(oi.id) > 5 AND AVG(oi.price) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(p.amount) FROM payments p WHERE p.employee_id = e.id) AS total_bonus, (SELECT MAX(p2.date) FROM payments p2 WHERE p2.employee_id = e.id) AS last_bonus_date FROM employees e) t\nWHERE total_bonus > 1000;", "output": "SELECT e.id, SUM(p.amount) AS total_bonus, MAX(p.date) AS last_bonus_date\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = c.id) AS last_order, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = c.id) AS total_paid FROM customers c) t\nWHERE total_paid > 5000;", "output": "SELECT c.id, MAX(o.order_date) AS last_order, SUM(p.amount) AS total_paid\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(p.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(*) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT MIN(e2.hire_date) FROM employees e2 WHERE e2.department_id = d.id) AS earliest_hire FROM departments d) t\nWHERE emp_count > 5;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, MIN(e.hire_date) AS earliest_hire\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM projects p WHERE p.manager_id = e.id) AS managed_projects, (SELECT SUM(p2.budget) FROM projects p2 WHERE p2.manager_id = e.id) AS total_budget FROM employees e) t\nWHERE managed_projects > 2 AND total_budget > 100000;", "output": "SELECT e.id, COUNT(p.id) AS managed_projects, SUM(p.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects p ON p.manager_id = e.id\nGROUP BY e.id\nHAVING COUNT(p.id) > 2 AND SUM(p.budget) > 100000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.id AND o.status = 'pending') AS pending_orders, (SELECT COUNT(*) FROM orders o2 WHERE o2.customer_id = c.id AND o2.status = 'completed') AS completed_orders FROM customers c) t\nWHERE pending_orders > 0 AND completed_orders > 5;", "output": "SELECT c.id, COUNT(CASE WHEN o.status = 'pending' THEN 1 END) AS pending_orders, COUNT(CASE WHEN o.status = 'completed' THEN 1 END) AS completed_orders\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN o.status = 'pending' THEN 1 END) > 0 AND COUNT(CASE WHEN o.status = 'completed' THEN 1 END) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(*) FROM order_items oi WHERE oi.order_id = o.id AND oi.price > 50) AS expensive_items, (SELECT SUM(oi2.price) FROM order_items oi2 WHERE oi2.order_id = o.id) AS total_value FROM orders o) t\nWHERE expensive_items > 1 AND total_value > 500;", "output": "SELECT o.id, COUNT(CASE WHEN oi.price > 50 THEN 1 END) AS expensive_items, SUM(oi.price) AS total_value\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.price > 50 THEN 1 END) > 1 AND SUM(oi.price) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT AVG(p.amount) FROM payments p WHERE p.employee_id = e.id) AS avg_bonus, (SELECT COUNT(p2.id) FROM payments p2 WHERE p2.employee_id = e.id) AS bonus_count FROM employees e) t\nWHERE avg_bonus > 300 AND bonus_count > 2;", "output": "SELECT e.id, AVG(p.amount) AS avg_bonus, COUNT(p.id) AS bonus_count\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING AVG(p.amount) > 300 AND COUNT(p.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.customer_id = c.id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.customer_id = c.id) AS avg_rating FROM customers c) t\nWHERE review_count > 5 AND avg_rating > 4;", "output": "SELECT c.id, COUNT(r.id) AS review_count, AVG(r.rating) AS avg_rating\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(r.id) > 5 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(*) FROM reviews r WHERE r.product_id = p.id AND r.rating = 5) AS five_star_reviews, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE five_star_reviews > 10 AND avg_rating > 3.5;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 10 AND AVG(r.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(p.amount) FROM payments p WHERE p.employee_id = e.id AND p.type = 'bonus') AS total_bonus, (SELECT SUM(p2.amount) FROM payments p2 WHERE p2.employee_id = e.id AND p2.type = 'salary') AS total_salary FROM employees e) t\nWHERE total_bonus > 500 AND total_salary > 2000;", "output": "SELECT e.id, SUM(CASE WHEN p.type = 'bonus' THEN p.amount END) AS total_bonus, SUM(CASE WHEN p.type = 'salary' THEN p.amount END) AS total_salary\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(CASE WHEN p.type = 'bonus' THEN p.amount END) > 500 AND SUM(CASE WHEN p.type = 'salary' THEN p.amount END) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.id) AS order_count, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS refund_total FROM customers c) t\nWHERE order_count > 5 AND refund_total < 1000;", "output": "SELECT c.id, COUNT(o.id) AS order_count, SUM(r.refund_amount) AS refund_total\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 5 AND SUM(r.refund_amount) < 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT MAX(e.salary) FROM employees e WHERE e.department_id = d.id) AS max_salary, (SELECT MIN(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS min_salary FROM departments d) t\nWHERE max_salary > 70000 AND min_salary < 30000;", "output": "SELECT d.id, MAX(e.salary) AS max_salary, MIN(e.salary) AS min_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING MAX(e.salary) > 70000 AND MIN(e.salary) < 30000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(*) FROM order_items oi WHERE oi.order_id = o.id AND oi.quantity > 1) AS multi_items, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE multi_items > 2 AND total_paid > 500;", "output": "SELECT o.id, COUNT(CASE WHEN oi.quantity > 1 THEN 1 END) AS multi_items, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.quantity > 1 THEN 1 END) > 2 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM bonuses b WHERE b.employee_id = e.id AND b.amount > 100) AS high_bonus_count, (SELECT SUM(b2.amount) FROM bonuses b2 WHERE b2.employee_id = e.id) AS total_bonus FROM employees e) t\nWHERE high_bonus_count > 1 AND total_bonus > 1000;", "output": "SELECT e.id, COUNT(CASE WHEN b.amount > 100 THEN 1 END) AS high_bonus_count, SUM(b.amount) AS total_bonus\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN b.amount > 100 THEN 1 END) > 1 AND SUM(b.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.customer_id = c.id) AS review_count FROM customers c) t\nWHERE avg_rating > 3 AND review_count > 5;", "output": "SELECT c.id, AVG(r.rating) AS avg_rating, COUNT(r.id) AS review_count\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING AVG(r.rating) > 3 AND COUNT(r.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT SUM(r.rating) FROM reviews r WHERE r.product_id = p.id) AS rating_sum, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.product_id = p.id) AS rating_count FROM products p) t\nWHERE rating_count > 0 AND rating_sum / rating_count > 4;", "output": "SELECT p.id, SUM(r.rating) AS rating_sum, COUNT(r.id) AS rating_count\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 0 AND SUM(r.rating) / COUNT(r.id) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(*) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE emp_count > 10 AND avg_salary > 55000;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 10 AND AVG(e.salary) > 55000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.customer_id, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = o.customer_id) AS total_paid, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = o.customer_id) AS order_count FROM orders o) t\nWHERE total_paid > 2000 AND order_count > 3;", "output": "SELECT o.customer_id, SUM(p.amount) AS total_paid, COUNT(o2.id) AS order_count\nFROM orders o\nLEFT JOIN payments p ON p.customer_id = o.customer_id\nLEFT JOIN orders o2 ON o2.customer_id = o.customer_id\nGROUP BY o.customer_id\nHAVING SUM(p.amount) > 2000 AND COUNT(o2.id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM certifications c WHERE c.employee_id = e.id AND c.valid_until > CURRENT_DATE) AS valid_certs, (SELECT MAX(c2.valid_until) FROM certifications c2 WHERE c2.employee_id = e.id) AS last_valid_until FROM employees e) t\nWHERE valid_certs > 1;", "output": "SELECT e.id, COUNT(CASE WHEN c.valid_until > CURRENT_DATE THEN 1 END) AS valid_certs, MAX(c.valid_until) AS last_valid_until\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN c.valid_until > CURRENT_DATE THEN 1 END) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_total, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS refund_total FROM customers c) t\nWHERE completed_total - refund_total > 5000;", "output": "SELECT c.id, SUM(CASE WHEN o.status = 'completed' THEN o.amount END) AS completed_total, SUM(r.refund_amount) AS refund_total\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(CASE WHEN o.status = 'completed' THEN o.amount END) - SUM(r.refund_amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(*) FROM reviews r WHERE r.product_id = p.id AND r.rating = 1) AS one_star, (SELECT COUNT(*) FROM reviews r2 WHERE r2.product_id = p.id AND r2.rating = 5) AS five_star FROM products p) t\nWHERE five_star > one_star;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 1 THEN 1 END) AS one_star, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > COUNT(CASE WHEN r.rating = 1 THEN 1 END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT AVG(h2.hours) FROM hours h2 WHERE h2.employee_id = e.id) AS avg_hours FROM employees e) t\nWHERE total_hours > 100 AND avg_hours > 5;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, AVG(h.hours) AS avg_hours\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 100 AND AVG(h.hours) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(*) FROM tickets t WHERE t.customer_id = c.id AND t.status = 'open') AS open_tickets, (SELECT COUNT(*) FROM tickets t2 WHERE t2.customer_id = c.id AND t2.status = 'closed') AS closed_tickets FROM customers c) t\nWHERE open_tickets > 1 AND closed_tickets > 2;", "output": "SELECT c.id, COUNT(CASE WHEN t.status = 'open' THEN 1 END) AS open_tickets, COUNT(CASE WHEN t.status = 'closed' THEN 1 END) AS closed_tickets\nFROM customers c\nLEFT JOIN tickets t ON t.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN t.status = 'open' THEN 1 END) > 1 AND COUNT(CASE WHEN t.status = 'closed' THEN 1 END) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(*) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE item_count > 3 AND total_paid > 1000;", "output": "SELECT o.id, COUNT(oi.id) AS item_count, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(oi.id) > 3 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(*) FROM employees e WHERE e.department_id = d.id AND e.hire_date > '2020-01-01') AS recent_hires, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE recent_hires > 2 AND avg_salary > 50000;", "output": "SELECT d.id, COUNT(CASE WHEN e.hire_date > '2020-01-01' THEN 1 END) AS recent_hires, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.hire_date > '2020-01-01' THEN 1 END) > 2 AND AVG(e.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = c.id) AS last_order, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS total_refunds FROM customers c) t\nWHERE total_refunds < 500;", "output": "SELECT c.id, MAX(o.order_date) AS last_order, SUM(r.refund_amount) AS total_refunds\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(r.refund_amount) < 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(*) FROM reviews r WHERE r.product_id = p.id) AS review_count, (SELECT MAX(r2.date) FROM reviews r2 WHERE r2.product_id = p.id) AS last_review FROM products p) t\nWHERE review_count > 0;", "output": "SELECT p.id, COUNT(r.id) AS review_count, MAX(r.date) AS last_review\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM tasks t WHERE t.employee_id = e.id AND t.status = 'done') AS done_tasks, (SELECT COUNT(*) FROM tasks t2 WHERE t2.employee_id = e.id AND t2.status = 'in_progress') AS in_progress_tasks FROM employees e) t\nWHERE done_tasks > 5 AND in_progress_tasks < 3;", "output": "SELECT e.id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS done_tasks, COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) AS in_progress_tasks\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) > 5 AND COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) < 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, e.name, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT MAX(h2.date) FROM hours h2 WHERE h2.employee_id = e.id) AS last_logged FROM employees e) t\nWHERE total_hours > 40;", "output": "SELECT e.id, e.name, SUM(h.hours) AS total_hours, MAX(h.date) AS last_logged\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id, e.name\nHAVING SUM(h.hours) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, c.country, (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_orders, (SELECT COUNT(*) FROM RETURNS r WHERE r.customer_id = c.id) AS return_count FROM customers c) t\nWHERE completed_orders > 5 AND return_count < 2;", "output": "SELECT c.id, c.country, COUNT(CASE WHEN o.status = 'completed' THEN 1 END) AS completed_orders, COUNT(r.id) AS return_count\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN RETURNS r ON r.customer_id = c.id\nGROUP BY c.id, c.country\nHAVING COUNT(CASE WHEN o.status = 'completed' THEN 1 END) > 5 AND COUNT(r.id) < 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, o.customer_id, (SELECT SUM(oi.price*oi.quantity) FROM order_items oi WHERE oi.order_id = o.id) AS order_value, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS paid_amount FROM orders o) t\nWHERE order_value > 1000 AND paid_amount < order_value;", "output": "SELECT o.id, o.customer_id, SUM(oi.price*oi.quantity) AS order_value, SUM(p.amount) AS paid_amount\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id, o.customer_id\nHAVING SUM(oi.price*oi.quantity) > 1000 AND SUM(p.amount) < SUM(oi.price*oi.quantity) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, d.department_name, (SELECT COUNT(*) FROM employees e WHERE e.department_id = d.id AND e.salary > 80000) AS high_salary_count, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE high_salary_count > 2 AND avg_salary > 60000;", "output": "SELECT d.id, d.department_name, COUNT(CASE WHEN e.salary > 80000 THEN 1 END) AS high_salary_count, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id, d.department_name\nHAVING COUNT(CASE WHEN e.salary > 80000 THEN 1 END) > 2 AND AVG(e.salary) > 60000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id) AS total_orders, (SELECT AVG(p.amount) FROM payments p WHERE p.customer_id = c.id) AS avg_payment FROM customers c) t\nWHERE total_orders > 10 AND avg_payment > 200;", "output": "SELECT c.id, COUNT(o.id) AS total_orders, AVG(p.amount) AS avg_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 10 AND AVG(p.amount) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 5) AS five_star_reviews, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.product_id = p.id) AS total_reviews FROM products p) t\nWHERE five_star_reviews > 10 AND total_reviews > 20;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, COUNT(r.id) AS total_reviews\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 10 AND COUNT(r.id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(p.amount) FROM payments p WHERE p.employee_id = e.id) AS total_payments, (SELECT COUNT(p2.id) FROM payments p2 WHERE p2.employee_id = e.id) AS payment_count FROM employees e) t\nWHERE total_payments > 1000 AND payment_count > 2;", "output": "SELECT e.id, SUM(p.amount) AS total_payments, COUNT(p.id) AS payment_count\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(p.amount) > 1000 AND COUNT(p.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = c.id) AS last_order, (SELECT MIN(p.amount) FROM payments p WHERE p.customer_id = c.id) AS min_payment FROM customers c) t\nWHERE min_payment > 0;", "output": "SELECT c.id, MAX(o.order_date) AS last_order, MIN(p.amount) AS min_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING MIN(p.amount) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.hire_date > '2020-01-01') AS recent_hires, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE recent_hires > 3 AND avg_salary > 55000;", "output": "SELECT d.id, COUNT(CASE WHEN e.hire_date > '2020-01-01' THEN 1 END) AS recent_hires, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.hire_date > '2020-01-01' THEN 1 END) > 3 AND AVG(e.salary) > 55000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT AVG(oi2.price) FROM order_items oi2 WHERE oi2.order_id = o.id) AS avg_price FROM orders o) t\nWHERE item_count > 2 AND avg_price > 100;", "output": "SELECT o.id, COUNT(oi.id) AS item_count, AVG(oi.price) AS avg_price\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(oi.id) > 2 AND AVG(oi.price) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(*) FROM tasks t WHERE t.employee_id = e.id AND t.status = 'done') AS done_tasks, (SELECT COUNT(*) FROM tasks t2 WHERE t2.employee_id = e.id AND t2.status = 'in_progress') AS in_progress_tasks FROM employees e) t\nWHERE done_tasks > 5 AND in_progress_tasks < 2;", "output": "SELECT e.id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS done_tasks, COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) AS in_progress_tasks\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) > 5 AND COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) < 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_total, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS total_refunds FROM customers c) t\nWHERE completed_total - total_refunds > 3000;", "output": "SELECT c.id, SUM(CASE WHEN o.status = 'completed' THEN o.amount END) AS completed_total, SUM(r.refund_amount) AS total_refunds\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(CASE WHEN o.status = 'completed' THEN o.amount END) - SUM(r.refund_amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE review_count > 10 AND avg_rating > 3;", "output": "SELECT p.id, COUNT(r.id) AS review_count, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 10 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(b.amount) FROM bonuses b WHERE b.employee_id = e.id) AS total_bonus, (SELECT MAX(b2.date) FROM bonuses b2 WHERE b2.employee_id = e.id) AS last_bonus FROM employees e) t\nWHERE total_bonus > 500;", "output": "SELECT e.id, SUM(b.amount) AS total_bonus, MAX(b.date) AS last_bonus\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(b.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.salary > 70000) AS high_salary_count, (SELECT SUM(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS total_salary FROM departments d) t\nWHERE high_salary_count > 2 AND total_salary > 200000;", "output": "SELECT d.id, COUNT(CASE WHEN e.salary > 70000 THEN 1 END) AS high_salary_count, SUM(e.salary) AS total_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.salary > 70000 THEN 1 END) > 2 AND SUM(e.salary) > 200000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id) AS order_count, (SELECT MAX(p.amount) FROM payments p WHERE p.customer_id = c.id) AS max_payment FROM customers c) t\nWHERE order_count > 3 AND max_payment > 500;", "output": "SELECT c.id, COUNT(o.id) AS order_count, MAX(p.amount) AS max_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 3 AND MAX(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(pr.id) FROM projects pr WHERE pr.manager_id = e.id) AS managed_projects, (SELECT SUM(pr2.budget) FROM projects pr2 WHERE pr2.manager_id = e.id) AS total_budget FROM employees e) t\nWHERE managed_projects > 1 AND total_budget > 100000;", "output": "SELECT e.id, COUNT(pr.id) AS managed_projects, SUM(pr.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects pr ON pr.manager_id = e.id\nGROUP BY e.id\nHAVING COUNT(pr.id) > 1 AND SUM(pr.budget) > 100000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 1) AS one_star, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.product_id = p.id AND r2.rating = 5) AS five_star FROM products p) t\nWHERE five_star > one_star;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 1 THEN 1 END) AS one_star, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > COUNT(CASE WHEN r.rating = 1 THEN 1 END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id AND oi.price > 100) AS expensive_items, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE expensive_items > 1 AND total_paid > 500;", "output": "SELECT o.id, COUNT(CASE WHEN oi.price > 100 THEN 1 END) AS expensive_items, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.price > 100 THEN 1 END) > 1 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.id) AS avg_salary, (SELECT COUNT(s2.id) FROM salaries s2 WHERE s2.employee_id = e.id) AS salary_count FROM employees e) t\nWHERE avg_salary > 50000 AND salary_count > 2;", "output": "SELECT e.id, AVG(s.salary) AS avg_salary, COUNT(s.id) AS salary_count\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.id\nGROUP BY e.id\nHAVING AVG(s.salary) > 50000 AND COUNT(s.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id AND o.status = 'pending') AS pending_orders, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = c.id AND o2.status = 'completed') AS completed_orders FROM customers c) t\nWHERE pending_orders > 0 AND completed_orders > 5;", "output": "SELECT c.id, COUNT(CASE WHEN o.status = 'pending' THEN 1 END) AS pending_orders, COUNT(CASE WHEN o.status = 'completed' THEN 1 END) AS completed_orders\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN o.status = 'pending' THEN 1 END) > 0 AND COUNT(CASE WHEN o.status = 'completed' THEN 1 END) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT COUNT(h2.id) FROM hours h2 WHERE h2.employee_id = e.id) AS log_count FROM employees e) t\nWHERE total_hours > 100 AND log_count > 10;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, COUNT(h.id) AS log_count\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 100 AND COUNT(h.id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT MAX(e.salary) FROM employees e WHERE e.department_id = d.id) AS max_salary, (SELECT MIN(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS min_salary FROM departments d) t\nWHERE max_salary > 90000 AND min_salary < 40000;", "output": "SELECT d.id, MAX(e.salary) AS max_salary, MIN(e.salary) AS min_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING MAX(e.salary) > 90000 AND MIN(e.salary) < 40000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT SUM(oi2.price) FROM order_items oi2 WHERE oi2.order_id = o.id) AS total_value FROM orders o) t\nWHERE item_count > 5 AND total_value > 500;", "output": "SELECT o.id, COUNT(oi.id) AS item_count, SUM(oi.price) AS total_value\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(oi.id) > 5 AND SUM(oi.price) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(p.id) FROM projects p WHERE p.lead_id = e.id) AS lead_projects, (SELECT COUNT(p2.id) FROM projects p2 WHERE p2.member_id = e.id) AS member_projects FROM employees e) t\nWHERE lead_projects > 1 AND member_projects > 2;", "output": "SELECT e.id, COUNT(CASE WHEN p.lead_id = e.id THEN 1 END) AS lead_projects, COUNT(CASE WHEN p.member_id = e.id THEN 1 END) AS member_projects\nFROM employees e\nLEFT JOIN projects p ON p.lead_id = e.id OR p.member_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN p.lead_id = e.id THEN 1 END) > 1 AND COUNT(CASE WHEN p.member_id = e.id THEN 1 END) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.customer_id = c.id) AS review_count FROM customers c) t\nWHERE avg_rating > 3.5 AND review_count > 4;", "output": "SELECT c.id, AVG(r.rating) AS avg_rating, COUNT(r.id) AS review_count\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING AVG(r.rating) > 3.5 AND COUNT(r.id) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 5) AS five_star_reviews, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE five_star_reviews > 3 AND avg_rating > 4;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 3 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(p.amount) FROM payments p WHERE p.employee_id = e.id) AS total_payments, (SELECT MAX(p2.date) FROM payments p2 WHERE p2.employee_id = e.id) AS last_payment FROM employees e) t\nWHERE total_payments > 2000;", "output": "SELECT e.id, SUM(p.amount) AS total_payments, MAX(p.date) AS last_payment\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(p.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT SUM(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS total_salary FROM departments d) t\nWHERE emp_count > 5 AND total_salary > 300000;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, SUM(e.salary) AS total_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 5 AND SUM(e.salary) > 300000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id) AS total_orders, (SELECT MAX(o2.order_date) FROM orders o2 WHERE o2.customer_id = c.id) AS last_order FROM customers c) t\nWHERE total_orders > 2;", "output": "SELECT c.id, COUNT(o.id) AS total_orders, MAX(o.order_date) AS last_order\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(c.id) FROM certifications c WHERE c.employee_id = e.id) AS cert_count, (SELECT MAX(c2.valid_until) FROM certifications c2 WHERE c2.employee_id = e.id) AS last_cert FROM employees e) t\nWHERE cert_count > 1;", "output": "SELECT e.id, COUNT(c.id) AS cert_count, MAX(c.valid_until) AS last_cert\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(c.id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT SUM(oi.price*oi.quantity) FROM order_items oi WHERE oi.product_id = p.id) AS total_sales, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.id) AS avg_rating FROM products p) t\nWHERE total_sales > 10000 AND avg_rating > 3;", "output": "SELECT p.id, SUM(oi.price*oi.quantity) AS total_sales, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN order_items oi ON oi.product_id = p.id\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING SUM(oi.price*oi.quantity) > 10000 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id AND oi.quantity > 1) AS multi_items, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE multi_items > 2 AND total_paid > 500;", "output": "SELECT o.id, COUNT(CASE WHEN oi.quantity > 1 THEN 1 END) AS multi_items, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.quantity > 1 THEN 1 END) > 2 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT AVG(h2.hours) FROM hours h2 WHERE h2.employee_id = e.id) AS avg_hours FROM employees e) t\nWHERE total_hours > 50 AND avg_hours > 4;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, AVG(h.hours) AS avg_hours\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 50 AND AVG(h.hours) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(t.id) FROM tickets t WHERE t.customer_id = c.id AND t.status = 'open') AS open_tickets, (SELECT COUNT(t2.id) FROM tickets t2 WHERE t2.customer_id = c.id AND t2.status = 'closed') AS closed_tickets FROM customers c) t\nWHERE open_tickets > 1 AND closed_tickets > 3;", "output": "SELECT c.id, COUNT(CASE WHEN t.status = 'open' THEN 1 END) AS open_tickets, COUNT(CASE WHEN t.status = 'closed' THEN 1 END) AS closed_tickets\nFROM customers c\nLEFT JOIN tickets t ON t.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN t.status = 'open' THEN 1 END) > 1 AND COUNT(CASE WHEN t.status = 'closed' THEN 1 END) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.hire_date > '2021-01-01') AS new_hires, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE new_hires > 2 AND avg_salary > 50000;", "output": "SELECT d.id, COUNT(CASE WHEN e.hire_date > '2021-01-01' THEN 1 END) AS new_hires, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.hire_date > '2021-01-01' THEN 1 END) > 2 AND AVG(e.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.customer_id, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = o.customer_id) AS total_paid, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = o.customer_id) AS order_count FROM orders o) t\nWHERE total_paid > 5000 AND order_count > 10;", "output": "SELECT o.customer_id, SUM(p.amount) AS total_paid, COUNT(o2.id) AS order_count\nFROM orders o\nLEFT JOIN payments p ON p.customer_id = o.customer_id\nLEFT JOIN orders o2 ON o2.customer_id = o.customer_id\nGROUP BY o.customer_id\nHAVING SUM(p.amount) > 5000 AND COUNT(o2.id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(b.id) FROM bonuses b WHERE b.employee_id = e.id AND b.amount > 100) AS high_bonus_count, (SELECT SUM(b2.amount) FROM bonuses b2 WHERE b2.employee_id = e.id) AS total_bonus FROM employees e) t\nWHERE high_bonus_count > 1 AND total_bonus > 1000;", "output": "SELECT e.id, COUNT(CASE WHEN b.amount > 100 THEN 1 END) AS high_bonus_count, SUM(b.amount) AS total_bonus\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN b.amount > 100 THEN 1 END) > 1 AND SUM(b.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.customer_id = c.id) AS review_count FROM customers c) t\nWHERE avg_rating > 4 AND review_count > 5;", "output": "SELECT c.id, AVG(r.rating) AS avg_rating, COUNT(r.id) AS review_count\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING AVG(r.rating) > 4 AND COUNT(r.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE review_count > 20 AND avg_rating > 3.5;", "output": "SELECT p.id, COUNT(r.id) AS review_count, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 20 AND AVG(r.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(p.amount) FROM payments p WHERE p.employee_id = e.id) AS total_payments, (SELECT COUNT(p2.id) FROM payments p2 WHERE p2.employee_id = e.id) AS payment_count FROM employees e) t\nWHERE total_payments > 5000 AND payment_count > 5;", "output": "SELECT e.id, SUM(p.amount) AS total_payments, COUNT(p.id) AS payment_count\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(p.amount) > 5000 AND COUNT(p.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE emp_count > 20 AND avg_salary > 60000;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 20 AND AVG(e.salary) > 60000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id AND oi.price > 200) AS expensive_items, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE expensive_items > 2 AND total_paid > 1000;", "output": "SELECT o.id, COUNT(CASE WHEN oi.price > 200 THEN 1 END) AS expensive_items, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.price > 200 THEN 1 END) > 2 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(pr.id) FROM projects pr WHERE pr.manager_id = e.id) AS managed_projects, (SELECT SUM(pr2.budget) FROM projects pr2 WHERE pr2.manager_id = e.id) AS total_budget FROM employees e) t\nWHERE managed_projects > 2 AND total_budget > 200000;", "output": "SELECT e.id, COUNT(pr.id) AS managed_projects, SUM(pr.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects pr ON pr.manager_id = e.id\nGROUP BY e.id\nHAVING COUNT(pr.id) > 2 AND SUM(pr.budget) > 200000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_orders, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS refund_total FROM customers c) t\nWHERE completed_orders > 5 AND refund_total < 1000;", "output": "SELECT c.id, COUNT(CASE WHEN o.status = 'completed' THEN 1 END) AS completed_orders, SUM(r.refund_amount) AS refund_total\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN o.status = 'completed' THEN 1 END) > 5 AND SUM(r.refund_amount) < 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT MAX(e.salary) FROM employees e WHERE e.department_id = d.id) AS max_salary, (SELECT MIN(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS min_salary FROM departments d) t\nWHERE max_salary > 100000 AND min_salary < 30000;", "output": "SELECT d.id, MAX(e.salary) AS max_salary, MIN(e.salary) AS min_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING MAX(e.salary) > 100000 AND MIN(e.salary) < 30000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.customer_id, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = o.customer_id) AS total_orders, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = o.customer_id) AS total_paid FROM orders o) t\nWHERE total_orders > 10 AND total_paid > 5000;", "output": "SELECT o.customer_id, COUNT(o2.id) AS total_orders, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN orders o2 ON o2.customer_id = o.customer_id\nLEFT JOIN payments p ON p.customer_id = o.customer_id\nGROUP BY o.customer_id\nHAVING COUNT(o2.id) > 10 AND SUM(p.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(c.id) FROM certifications c WHERE c.employee_id = e.id AND c.valid_until > CURRENT_DATE) AS valid_certs, (SELECT MAX(c2.valid_until) FROM certifications c2 WHERE c2.employee_id = e.id) AS last_valid_until FROM employees e) t\nWHERE valid_certs > 2;", "output": "SELECT e.id, COUNT(CASE WHEN c.valid_until > CURRENT_DATE THEN 1 END) AS valid_certs, MAX(c.valid_until) AS last_valid_until\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN c.valid_until > CURRENT_DATE THEN 1 END) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id) AS total_spent, (SELECT COUNT(r.id) FROM RETURNS r WHERE r.customer_id = c.id) AS return_count FROM customers c) t\nWHERE total_spent > 10000 AND return_count < 3;", "output": "SELECT c.id, SUM(o.amount) AS total_spent, COUNT(r.id) AS return_count\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN RETURNS r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(o.amount) > 10000 AND COUNT(r.id) < 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 5) AS five_star_reviews, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE five_star_reviews > 10 AND avg_rating > 4;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 10 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(b.amount) FROM bonuses b WHERE b.employee_id = e.id) AS total_bonus, (SELECT MAX(b2.date) FROM bonuses b2 WHERE b2.employee_id = e.id) AS last_bonus_date FROM employees e) t\nWHERE total_bonus > 2000;", "output": "SELECT e.id, SUM(b.amount) AS total_bonus, MAX(b.date) AS last_bonus_date\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(b.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT MIN(e2.hire_date) FROM employees e2 WHERE e2.department_id = d.id) AS earliest_hire FROM departments d) t\nWHERE emp_count > 5;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, MIN(e.hire_date) AS earliest_hire\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id AND o.status = 'pending') AS pending_orders, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = c.id AND o2.status = 'completed') AS completed_orders FROM customers c) t\nWHERE pending_orders > 1 AND completed_orders > 5;", "output": "SELECT c.id, COUNT(CASE WHEN o.status = 'pending' THEN 1 END) AS pending_orders, COUNT(CASE WHEN o.status = 'completed' THEN 1 END) AS completed_orders\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN o.status = 'pending' THEN 1 END) > 1 AND COUNT(CASE WHEN o.status = 'completed' THEN 1 END) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id AND oi.quantity > 1) AS multi_items, (SELECT SUM(oi2.price*oi2.quantity) FROM order_items oi2 WHERE oi2.order_id = o.id) AS total_value FROM orders o) t\nWHERE multi_items > 2 AND total_value > 1000;", "output": "SELECT o.id, COUNT(CASE WHEN oi.quantity > 1 THEN 1 END) AS multi_items, SUM(oi.price*oi.quantity) AS total_value\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.quantity > 1 THEN 1 END) > 2 AND SUM(oi.price*oi.quantity) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT AVG(h.hours) FROM hours h WHERE h.employee_id = e.id) AS avg_hours, (SELECT SUM(h2.hours) FROM hours h2 WHERE h2.employee_id = e.id) AS total_hours FROM employees e) t\nWHERE avg_hours > 5 AND total_hours > 50;", "output": "SELECT e.id, AVG(h.hours) AS avg_hours, SUM(h.hours) AS total_hours\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING AVG(h.hours) > 5 AND SUM(h.hours) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(t.id) FROM tickets t WHERE t.customer_id = c.id AND t.status = 'open') AS open_tickets, (SELECT COUNT(t2.id) FROM tickets t2 WHERE t2.customer_id = c.id AND t2.status = 'closed') AS closed_tickets FROM customers c) t\nWHERE open_tickets > 2 AND closed_tickets > 3;", "output": "SELECT c.id, COUNT(CASE WHEN t.status = 'open' THEN 1 END) AS open_tickets, COUNT(CASE WHEN t.status = 'closed' THEN 1 END) AS closed_tickets\nFROM customers c\nLEFT JOIN tickets t ON t.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN t.status = 'open' THEN 1 END) > 2 AND COUNT(CASE WHEN t.status = 'closed' THEN 1 END) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.salary > 60000) AS high_salary_count, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE high_salary_count > 3 AND avg_salary > 55000;", "output": "SELECT d.id, COUNT(CASE WHEN e.salary > 60000 THEN 1 END) AS high_salary_count, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.salary > 60000 THEN 1 END) > 3 AND AVG(e.salary) > 55000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT SUM(oi.price*oi.quantity) FROM order_items oi WHERE oi.order_id = o.id) AS order_value, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE order_value > 1500 AND total_paid < order_value;", "output": "SELECT o.id, SUM(oi.price*oi.quantity) AS order_value, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING SUM(oi.price*oi.quantity) > 1500 AND SUM(p.amount) < SUM(oi.price*oi.quantity) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(p.id) FROM projects p WHERE p.lead_id = e.id) AS lead_projects, (SELECT SUM(p2.budget) FROM projects p2 WHERE p2.lead_id = e.id) AS total_budget FROM employees e) t\nWHERE lead_projects > 2 AND total_budget > 500000;", "output": "SELECT e.id, COUNT(p.id) AS lead_projects, SUM(p.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects p ON p.lead_id = e.id\nGROUP BY e.id\nHAVING COUNT(p.id) > 2 AND SUM(p.budget) > 500000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id) AS total_orders, (SELECT AVG(p.amount) FROM payments p WHERE p.customer_id = c.id) AS avg_payment FROM customers c) t\nWHERE total_orders > 20 AND avg_payment > 250;", "output": "SELECT c.id, COUNT(o.id) AS total_orders, AVG(p.amount) AS avg_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 20 AND AVG(p.amount) > 250 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT MAX(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS max_salary FROM departments d) t\nWHERE emp_count > 10 AND max_salary > 80000;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, MAX(e.salary) AS max_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 10 AND MAX(e.salary) > 80000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.customer_id, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = o.customer_id AND o2.status = 'completed') AS completed_orders, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = o.customer_id) AS total_paid FROM orders o) t\nWHERE completed_orders > 5 AND total_paid > 2000;", "output": "SELECT o.customer_id, COUNT(CASE WHEN o2.status = 'completed' THEN 1 END) AS completed_orders, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN orders o2 ON o2.customer_id = o.customer_id\nLEFT JOIN payments p ON p.customer_id = o.customer_id\nGROUP BY o.customer_id\nHAVING COUNT(CASE WHEN o2.status = 'completed' THEN 1 END) > 5 AND SUM(p.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(c.id) FROM certifications c WHERE c.employee_id = e.id) AS cert_count, (SELECT MAX(c2.valid_until) FROM certifications c2 WHERE c2.employee_id = e.id) AS last_cert FROM employees e) t\nWHERE cert_count > 2;", "output": "SELECT e.id, COUNT(c.id) AS cert_count, MAX(c.valid_until) AS last_cert\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(c.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT SUM(oi.quantity) FROM order_items oi WHERE oi.product_id = p.id) AS total_sold, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.id) AS avg_rating FROM products p) t\nWHERE total_sold > 100 AND avg_rating > 4;", "output": "SELECT p.id, SUM(oi.quantity) AS total_sold, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN order_items oi ON oi.product_id = p.id\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING SUM(oi.quantity) > 100 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT COUNT(h2.id) FROM hours h2 WHERE h2.employee_id = e.id) AS entry_count FROM employees e) t\nWHERE total_hours > 200 AND entry_count > 20;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, COUNT(h.id) AS entry_count\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 200 AND COUNT(h.id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.customer_id = c.id AND r.rating = 5) AS five_star_reviews, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.customer_id = c.id) AS total_reviews FROM customers c) t\nWHERE five_star_reviews > 2 AND total_reviews > 5;", "output": "SELECT c.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, COUNT(r.id) AS total_reviews\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 2 AND COUNT(r.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.hire_date > '2020-01-01') AS recent_hires, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE recent_hires > 3 AND avg_salary > 55000;", "output": "SELECT d.id, COUNT(CASE WHEN e.hire_date > '2020-01-01' THEN 1 END) AS recent_hires, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.hire_date > '2020-01-01' THEN 1 END) > 3 AND AVG(e.salary) > 55000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT AVG(oi2.price) FROM order_items oi2 WHERE oi2.order_id = o.id) AS avg_price FROM orders o) t\nWHERE item_count > 5 AND avg_price > 100;", "output": "SELECT o.id, COUNT(oi.id) AS item_count, AVG(oi.price) AS avg_price\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(oi.id) > 5 AND AVG(oi.price) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(t.id) FROM tasks t WHERE t.employee_id = e.id AND t.status = 'done') AS done_tasks, (SELECT COUNT(t2.id) FROM tasks t2 WHERE t2.employee_id = e.id AND t2.status = 'in_progress') AS in_progress_tasks FROM employees e) t\nWHERE done_tasks > 5 AND in_progress_tasks < 3;", "output": "SELECT e.id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS done_tasks, COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) AS in_progress_tasks\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) > 5 AND COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) < 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_total, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS total_refunds FROM customers c) t\nWHERE completed_total - total_refunds > 5000;", "output": "SELECT c.id, SUM(CASE WHEN o.status = 'completed' THEN o.amount END) AS completed_total, SUM(r.refund_amount) AS total_refunds\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(CASE WHEN o.status = 'completed' THEN o.amount END) - SUM(r.refund_amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id) AS review_count, (SELECT MAX(r2.date) FROM reviews r2 WHERE r2.product_id = p.id) AS last_review FROM products p) t\nWHERE review_count > 0;", "output": "SELECT p.id, COUNT(r.id) AS review_count, MAX(r.date) AS last_review\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(s.salary) FROM salaries s WHERE s.employee_id = e.id) AS total_salary, (SELECT AVG(s2.salary) FROM salaries s2 WHERE s2.employee_id = e.id) AS avg_salary FROM employees e) t\nWHERE total_salary > 100000 AND avg_salary > 40000;", "output": "SELECT e.id, SUM(s.salary) AS total_salary, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(s.salary) > 100000 AND AVG(s.salary) > 40000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.salary > 70000) AS high_salary_count, (SELECT SUM(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS total_salary FROM departments d) t\nWHERE high_salary_count > 2 AND total_salary > 200000;", "output": "SELECT d.id, COUNT(CASE WHEN e.salary > 70000 THEN 1 END) AS high_salary_count, SUM(e.salary) AS total_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.salary > 70000 THEN 1 END) > 2 AND SUM(e.salary) > 200000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id) AS order_count, (SELECT MAX(p.amount) FROM payments p WHERE p.customer_id = c.id) AS max_payment FROM customers c) t\nWHERE order_count > 3 AND max_payment > 1000;", "output": "SELECT c.id, COUNT(o.id) AS order_count, MAX(p.amount) AS max_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 3 AND MAX(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(pr.id) FROM projects pr WHERE pr.manager_id = e.id) AS managed_projects, (SELECT SUM(pr2.budget) FROM projects pr2 WHERE pr2.manager_id = e.id) AS total_budget FROM employees e) t\nWHERE managed_projects > 1 AND total_budget > 150000;", "output": "SELECT e.id, COUNT(pr.id) AS managed_projects, SUM(pr.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects pr ON pr.manager_id = e.id\nGROUP BY e.id\nHAVING COUNT(pr.id) > 1 AND SUM(pr.budget) > 150000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(t.id) FROM tasks t WHERE t.employee_id = e.id AND t.status = 'done') AS done_tasks, (SELECT COUNT(t2.id) FROM tasks t2 WHERE t2.employee_id = e.id AND t2.status = 'open') AS open_tasks FROM employees e) t\nWHERE done_tasks > 3 AND open_tasks < 5;", "output": "SELECT e.id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS done_tasks, COUNT(CASE WHEN t.status = 'open' THEN 1 END) AS open_tasks\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) > 3 AND COUNT(CASE WHEN t.status = 'open' THEN 1 END) < 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id) AS total_orders, (SELECT SUM(r.amount) FROM refunds r WHERE r.customer_id = c.id) AS total_refunds FROM customers c) t\nWHERE total_orders - total_refunds > 10000;", "output": "SELECT c.id, SUM(o.amount) AS total_orders, SUM(r.amount) AS total_refunds\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(o.amount) - SUM(r.amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT MAX(e.salary) FROM employees e WHERE e.department_id = d.id) AS max_salary, (SELECT MIN(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS min_salary FROM departments d) t\nWHERE max_salary > 120000 AND min_salary < 25000;", "output": "SELECT d.id, MAX(e.salary) AS max_salary, MIN(e.salary) AS min_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING MAX(e.salary) > 120000 AND MIN(e.salary) < 25000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id AND oi.quantity > 5) AS bulk_items, (SELECT SUM(oi2.price*oi2.quantity) FROM order_items oi2 WHERE oi2.order_id = o.id) AS total_value FROM orders o) t\nWHERE bulk_items > 1 AND total_value > 2000;", "output": "SELECT o.id, COUNT(CASE WHEN oi.quantity > 5 THEN 1 END) AS bulk_items, SUM(oi.price*oi.quantity) AS total_value\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.quantity > 5 THEN 1 END) > 1 AND SUM(oi.price*oi.quantity) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT AVG(p.amount) FROM payments p WHERE p.employee_id = e.id) AS avg_payment, (SELECT COUNT(p2.id) FROM payments p2 WHERE p2.employee_id = e.id) AS payment_count FROM employees e) t\nWHERE avg_payment > 300 AND payment_count > 2;", "output": "SELECT e.id, AVG(p.amount) AS avg_payment, COUNT(p.id) AS payment_count\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING AVG(p.amount) > 300 AND COUNT(p.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id) AS order_count, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating FROM customers c) t\nWHERE order_count > 5 AND avg_rating > 4;", "output": "SELECT c.id, COUNT(o.id) AS order_count, AVG(r.rating) AS avg_rating\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 5 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 1) AS one_star, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.product_id = p.id AND r2.rating = 5) AS five_star FROM products p) t\nWHERE five_star > one_star;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 1 THEN 1 END) AS one_star, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > COUNT(CASE WHEN r.rating = 1 THEN 1 END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(b.amount) FROM bonuses b WHERE b.employee_id = e.id) AS total_bonus, (SELECT COUNT(b2.id) FROM bonuses b2 WHERE b2.employee_id = e.id) AS bonus_count FROM employees e) t\nWHERE total_bonus > 500 AND bonus_count > 2;", "output": "SELECT e.id, SUM(b.amount) AS total_bonus, COUNT(b.id) AS bonus_count\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(b.amount) > 500 AND COUNT(b.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.hire_date > '2022-01-01') AS new_hires, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE new_hires > 1 AND avg_salary > 45000;", "output": "SELECT d.id, COUNT(CASE WHEN e.hire_date > '2022-01-01' THEN 1 END) AS new_hires, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.hire_date > '2022-01-01' THEN 1 END) > 1 AND AVG(e.salary) > 45000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_total, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS total_refunds FROM customers c) t\nWHERE completed_total - total_refunds > 2000;", "output": "SELECT c.id, SUM(CASE WHEN o.status = 'completed' THEN o.amount END) AS completed_total, SUM(r.refund_amount) AS total_refunds\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(CASE WHEN o.status = 'completed' THEN o.amount END) - SUM(r.refund_amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE review_count > 15 AND avg_rating > 3;", "output": "SELECT p.id, COUNT(r.id) AS review_count, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 15 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT MAX(h2.date) FROM hours h2 WHERE h2.employee_id = e.id) AS last_entry FROM employees e) t\nWHERE total_hours > 80;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, MAX(h.date) AS last_entry\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 80 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT SUM(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS total_salary FROM departments d) t\nWHERE emp_count > 8 AND total_salary > 250000;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, SUM(e.salary) AS total_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 8 AND SUM(e.salary) > 250000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = c.id) AS last_order, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = c.id) AS total_paid FROM customers c) t\nWHERE total_paid > 3000;", "output": "SELECT c.id, MAX(o.order_date) AS last_order, SUM(p.amount) AS total_paid\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(p.amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(pr.id) FROM projects pr WHERE pr.manager_id = e.id) AS managed_projects, (SELECT SUM(pr2.budget) FROM projects pr2 WHERE pr2.manager_id = e.id) AS total_budget FROM employees e) t\nWHERE managed_projects > 2 AND total_budget > 100000;", "output": "SELECT e.id, COUNT(pr.id) AS managed_projects, SUM(pr.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects pr ON pr.manager_id = e.id\nGROUP BY e.id\nHAVING COUNT(pr.id) > 2 AND SUM(pr.budget) > 100000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 5) AS five_star_reviews, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.product_id = p.id) AS total_reviews FROM products p) t\nWHERE five_star_reviews > 5 AND total_reviews > 15;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, COUNT(r.id) AS total_reviews\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 5 AND COUNT(r.id) > 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.id) AS avg_salary, (SELECT COUNT(s2.id) FROM salaries s2 WHERE s2.employee_id = e.id) AS salary_count FROM employees e) t\nWHERE avg_salary > 40000 AND salary_count > 1;", "output": "SELECT e.id, AVG(s.salary) AS avg_salary, COUNT(s.id) AS salary_count\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.id\nGROUP BY e.id\nHAVING AVG(s.salary) > 40000 AND COUNT(s.id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(t.id) FROM tickets t WHERE t.customer_id = c.id AND t.status = 'open') AS open_tickets, (SELECT COUNT(t2.id) FROM tickets t2 WHERE t2.customer_id = c.id AND t2.status = 'closed') AS closed_tickets FROM customers c) t\nWHERE open_tickets > 0 AND closed_tickets > 2;", "output": "SELECT c.id, COUNT(CASE WHEN t.status = 'open' THEN 1 END) AS open_tickets, COUNT(CASE WHEN t.status = 'closed' THEN 1 END) AS closed_tickets\nFROM customers c\nLEFT JOIN tickets t ON t.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN t.status = 'open' THEN 1 END) > 0 AND COUNT(CASE WHEN t.status = 'closed' THEN 1 END) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE item_count > 3 AND total_paid > 800;", "output": "SELECT o.id, COUNT(oi.id) AS item_count, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(oi.id) > 3 AND SUM(p.amount) > 800 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.salary > 60000) AS high_salary_count, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE high_salary_count > 2 AND avg_salary > 50000;", "output": "SELECT d.id, COUNT(CASE WHEN e.salary > 60000 THEN 1 END) AS high_salary_count, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.salary > 60000 THEN 1 END) > 2 AND AVG(e.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(pr.id) FROM projects pr WHERE pr.lead_id = e.id) AS lead_projects, (SELECT COUNT(pr2.id) FROM projects pr2 WHERE pr2.member_id = e.id) AS member_projects FROM employees e) t\nWHERE lead_projects > 1 AND member_projects > 3;", "output": "SELECT e.id, COUNT(CASE WHEN pr.lead_id = e.id THEN 1 END) AS lead_projects, COUNT(CASE WHEN pr.member_id = e.id THEN 1 END) AS member_projects\nFROM employees e\nLEFT JOIN projects pr ON pr.lead_id = e.id OR pr.member_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN pr.lead_id = e.id THEN 1 END) > 1 AND COUNT(CASE WHEN pr.member_id = e.id THEN 1 END) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id) AS total_spent, (SELECT COUNT(r.id) FROM RETURNS r WHERE r.customer_id = c.id) AS return_count FROM customers c) t\nWHERE total_spent > 5000 AND return_count < 5;", "output": "SELECT c.id, SUM(o.amount) AS total_spent, COUNT(r.id) AS return_count\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN RETURNS r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(o.amount) > 5000 AND COUNT(r.id) < 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE review_count > 20 AND avg_rating > 4;", "output": "SELECT p.id, COUNT(r.id) AS review_count, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(r.id) > 20 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(p.amount) FROM payments p WHERE p.employee_id = e.id) AS total_payments, (SELECT MAX(p2.date) FROM payments p2 WHERE p2.employee_id = e.id) AS last_payment FROM employees e) t\nWHERE total_payments > 1000;", "output": "SELECT e.id, SUM(p.amount) AS total_payments, MAX(p.date) AS last_payment\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE emp_count > 15 AND avg_salary > 50000;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 15 AND AVG(e.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id) AS item_count, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE item_count > 2 AND total_paid > 300;", "output": "SELECT o.id, COUNT(oi.id) AS item_count, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(oi.id) > 2 AND SUM(p.amount) > 300 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(c.id) FROM certifications c WHERE c.employee_id = e.id) AS cert_count, (SELECT MAX(c2.valid_until) FROM certifications c2 WHERE c2.employee_id = e.id) AS last_cert FROM employees e) t\nWHERE cert_count > 2;", "output": "SELECT e.id, COUNT(c.id) AS cert_count, MAX(c.valid_until) AS last_cert\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(c.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = c.id) AS last_order, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = c.id) AS total_paid FROM customers c) t\nWHERE total_paid > 4000;", "output": "SELECT c.id, MAX(o.order_date) AS last_order, SUM(p.amount) AS total_paid\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(p.amount) > 4000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 5) AS five_star_reviews, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.product_id = p.id) AS total_reviews FROM products p) t\nWHERE five_star_reviews > 8 AND total_reviews > 20;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, COUNT(r.id) AS total_reviews\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 8 AND COUNT(r.id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT AVG(h2.hours) FROM hours h2 WHERE h2.employee_id = e.id) AS avg_hours FROM employees e) t\nWHERE total_hours > 150 AND avg_hours > 5;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, AVG(h.hours) AS avg_hours\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 150 AND AVG(h.hours) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.salary > 60000) AS high_salary_count, (SELECT SUM(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS total_salary FROM departments d) t\nWHERE high_salary_count > 2 AND total_salary > 300000;", "output": "SELECT d.id, COUNT(CASE WHEN e.salary > 60000 THEN 1 END) AS high_salary_count, SUM(e.salary) AS total_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.salary > 60000 THEN 1 END) > 2 AND SUM(e.salary) > 300000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id AND o.status = 'pending') AS pending_orders, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = c.id AND o2.status = 'completed') AS completed_orders FROM customers c) t\nWHERE pending_orders > 0 AND completed_orders > 10;", "output": "SELECT c.id, COUNT(CASE WHEN o.status = 'pending' THEN 1 END) AS pending_orders, COUNT(CASE WHEN o.status = 'completed' THEN 1 END) AS completed_orders\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN o.status = 'pending' THEN 1 END) > 0 AND COUNT(CASE WHEN o.status = 'completed' THEN 1 END) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id AND oi.price > 50) AS expensive_items, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE expensive_items > 1 AND total_paid > 500;", "output": "SELECT o.id, COUNT(CASE WHEN oi.price > 50 THEN 1 END) AS expensive_items, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.price > 50 THEN 1 END) > 1 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(t.id) FROM tasks t WHERE t.employee_id = e.id AND t.status = 'done') AS done_tasks, (SELECT COUNT(t2.id) FROM tasks t2 WHERE t2.employee_id = e.id AND t2.status = 'in_progress') AS in_progress_tasks FROM employees e) t\nWHERE done_tasks > 4 AND in_progress_tasks < 3;", "output": "SELECT e.id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS done_tasks, COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) AS in_progress_tasks\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) > 4 AND COUNT(CASE WHEN t.status = 'in_progress' THEN 1 END) < 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.customer_id = c.id) AS review_count FROM customers c) t\nWHERE avg_rating > 3.5 AND review_count > 5;", "output": "SELECT c.id, AVG(r.rating) AS avg_rating, COUNT(r.id) AS review_count\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING AVG(r.rating) > 3.5 AND COUNT(r.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 5) AS five_star_reviews, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.id) AS avg_rating FROM products p) t\nWHERE five_star_reviews > 10 AND avg_rating > 4;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 10 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(b.amount) FROM bonuses b WHERE b.employee_id = e.id) AS total_bonus, (SELECT MAX(b2.date) FROM bonuses b2 WHERE b2.employee_id = e.id) AS last_bonus FROM employees e) t\nWHERE total_bonus > 2000;", "output": "SELECT e.id, SUM(b.amount) AS total_bonus, MAX(b.date) AS last_bonus\nFROM employees e\nLEFT JOIN bonuses b ON b.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(b.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id) AS emp_count, (SELECT MIN(e2.hire_date) FROM employees e2 WHERE e2.department_id = d.id) AS earliest_hire FROM departments d) t\nWHERE emp_count > 10;", "output": "SELECT d.id, COUNT(e.id) AS emp_count, MIN(e.hire_date) AS earliest_hire\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(e.id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT SUM(oi.price*oi.quantity) FROM order_items oi WHERE oi.order_id = o.id) AS order_value, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.id) AS total_paid FROM orders o) t\nWHERE order_value > 1200 AND total_paid < order_value;", "output": "SELECT o.id, SUM(oi.price*oi.quantity) AS order_value, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nLEFT JOIN payments p ON p.order_id = o.id\nGROUP BY o.id\nHAVING SUM(oi.price*oi.quantity) > 1200 AND SUM(p.amount) < SUM(oi.price*oi.quantity) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(pr.id) FROM projects pr WHERE pr.manager_id = e.id) AS managed_projects, (SELECT SUM(pr2.budget) FROM projects pr2 WHERE pr2.manager_id = e.id) AS total_budget FROM employees e) t\nWHERE managed_projects > 2 AND total_budget > 150000;", "output": "SELECT e.id, COUNT(pr.id) AS managed_projects, SUM(pr.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects pr ON pr.manager_id = e.id\nGROUP BY e.id\nHAVING COUNT(pr.id) > 2 AND SUM(pr.budget) > 150000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_orders, (SELECT AVG(r.rating) FROM reviews r WHERE r.customer_id = c.id) AS avg_rating FROM customers c) t\nWHERE completed_orders > 10 AND avg_rating > 4;", "output": "SELECT c.id, COUNT(CASE WHEN o.status = 'completed' THEN 1 END) AS completed_orders, AVG(r.rating) AS avg_rating\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN o.status = 'completed' THEN 1 END) > 10 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT SUM(e.salary) FROM employees e WHERE e.department_id = d.id) AS total_salary, (SELECT COUNT(e2.id) FROM employees e2 WHERE e2.department_id = d.id AND e2.salary > 60000) AS high_salary_count FROM departments d) t\nWHERE total_salary > 500000 AND high_salary_count > 3;", "output": "SELECT d.id, SUM(e.salary) AS total_salary, COUNT(CASE WHEN e.salary > 60000 THEN 1 END) AS high_salary_count\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING SUM(e.salary) > 500000 AND COUNT(CASE WHEN e.salary > 60000 THEN 1 END) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.product_id = p.id AND r.rating = 1) AS one_star_reviews, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.product_id = p.id AND r2.rating = 5) AS five_star_reviews FROM products p) t\nWHERE five_star_reviews > one_star_reviews;", "output": "SELECT p.id, COUNT(CASE WHEN r.rating = 1 THEN 1 END) AS one_star_reviews, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > COUNT(CASE WHEN r.rating = 1 THEN 1 END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(p.amount) FROM payments p WHERE p.employee_id = e.id) AS total_payment, (SELECT COUNT(p2.id) FROM payments p2 WHERE p2.employee_id = e.id) AS payment_count FROM employees e) t\nWHERE total_payment > 2000 AND payment_count > 2;", "output": "SELECT e.id, SUM(p.amount) AS total_payment, COUNT(p.id) AS payment_count\nFROM employees e\nLEFT JOIN payments p ON p.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(p.amount) > 2000 AND COUNT(p.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(t.id) FROM tickets t WHERE t.customer_id = c.id AND t.status = 'open') AS open_tickets, (SELECT COUNT(t2.id) FROM tickets t2 WHERE t2.customer_id = c.id AND t2.status = 'closed') AS closed_tickets FROM customers c) t\nWHERE open_tickets > 1 AND closed_tickets > 3;", "output": "SELECT c.id, COUNT(CASE WHEN t.status = 'open' THEN 1 END) AS open_tickets, COUNT(CASE WHEN t.status = 'closed' THEN 1 END) AS closed_tickets\nFROM customers c\nLEFT JOIN tickets t ON t.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN t.status = 'open' THEN 1 END) > 1 AND COUNT(CASE WHEN t.status = 'closed' THEN 1 END) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT SUM(oi.price*oi.quantity) FROM order_items oi WHERE oi.order_id = o.id) AS order_value, (SELECT COUNT(oi2.id) FROM order_items oi2 WHERE oi2.order_id = o.id AND oi2.quantity > 10) AS bulk_items FROM orders o) t\nWHERE order_value > 1000 AND bulk_items > 0;", "output": "SELECT o.id, SUM(oi.price*oi.quantity) AS order_value, COUNT(CASE WHEN oi.quantity > 10 THEN 1 END) AS bulk_items\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING SUM(oi.price*oi.quantity) > 1000 AND COUNT(CASE WHEN oi.quantity > 10 THEN 1 END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT MAX(s.salary) FROM salaries s WHERE s.employee_id = e.id) AS max_salary, (SELECT MIN(s2.salary) FROM salaries s2 WHERE s2.employee_id = e.id) AS min_salary FROM employees e) t\nWHERE max_salary > 80000 AND min_salary > 20000;", "output": "SELECT e.id, MAX(s.salary) AS max_salary, MIN(s.salary) AS min_salary\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.id\nGROUP BY e.id\nHAVING MAX(s.salary) > 80000 AND MIN(s.salary) > 20000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(o.id) FROM orders o WHERE o.customer_id = c.id) AS order_count, (SELECT AVG(p.amount) FROM payments p WHERE p.customer_id = c.id) AS avg_payment FROM customers c) t\nWHERE order_count > 10 AND avg_payment > 500;", "output": "SELECT c.id, COUNT(o.id) AS order_count, AVG(p.amount) AS avg_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN payments p ON p.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(o.id) > 10 AND AVG(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.hire_date > '2021-01-01') AS new_hires, (SELECT AVG(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS avg_salary FROM departments d) t\nWHERE new_hires > 5 AND avg_salary > 45000;", "output": "SELECT d.id, COUNT(CASE WHEN e.hire_date > '2021-01-01' THEN 1 END) AS new_hires, AVG(e.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.hire_date > '2021-01-01' THEN 1 END) > 5 AND AVG(e.salary) > 45000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.customer_id, (SELECT COUNT(o2.id) FROM orders o2 WHERE o2.customer_id = o.customer_id AND o2.status = 'completed') AS completed_orders, (SELECT SUM(p.amount) FROM payments p WHERE p.customer_id = o.customer_id) AS total_paid FROM orders o) t\nWHERE completed_orders > 3 AND total_paid > 1500;", "output": "SELECT o.customer_id, COUNT(CASE WHEN o2.status = 'completed' THEN 1 END) AS completed_orders, SUM(p.amount) AS total_paid\nFROM orders o\nLEFT JOIN orders o2 ON o2.customer_id = o.customer_id\nLEFT JOIN payments p ON p.customer_id = o.customer_id\nGROUP BY o.customer_id\nHAVING COUNT(CASE WHEN o2.status = 'completed' THEN 1 END) > 3 AND SUM(p.amount) > 1500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT COUNT(h2.id) FROM hours h2 WHERE h2.employee_id = e.id) AS entry_count FROM employees e) t\nWHERE total_hours > 100 AND entry_count > 5;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, COUNT(h.id) AS entry_count\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 100 AND COUNT(h.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT COUNT(r.id) FROM reviews r WHERE r.customer_id = c.id AND r.rating = 5) AS five_star_reviews, (SELECT COUNT(r2.id) FROM reviews r2 WHERE r2.customer_id = c.id) AS total_reviews FROM customers c) t\nWHERE five_star_reviews > 2 AND total_reviews > 5;", "output": "SELECT c.id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, COUNT(r.id) AS total_reviews\nFROM customers c\nLEFT JOIN reviews r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 2 AND COUNT(r.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.id, (SELECT COUNT(e.id) FROM employees e WHERE e.department_id = d.id AND e.salary > 70000) AS high_salary_count, (SELECT SUM(e2.salary) FROM employees e2 WHERE e2.department_id = d.id) AS total_salary FROM departments d) t\nWHERE high_salary_count > 2 AND total_salary > 200000;", "output": "SELECT d.id, COUNT(CASE WHEN e.salary > 70000 THEN 1 END) AS high_salary_count, SUM(e.salary) AS total_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.id\nGROUP BY d.id\nHAVING COUNT(CASE WHEN e.salary > 70000 THEN 1 END) > 2 AND SUM(e.salary) > 200000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.id, (SELECT SUM(oi.quantity) FROM order_items oi WHERE oi.product_id = p.id) AS total_sold, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.id) AS avg_rating FROM products p) t\nWHERE total_sold > 500 AND avg_rating > 3.5;", "output": "SELECT p.id, SUM(oi.quantity) AS total_sold, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN order_items oi ON oi.product_id = p.id\nLEFT JOIN reviews r ON r.product_id = p.id\nGROUP BY p.id\nHAVING SUM(oi.quantity) > 500 AND AVG(r.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(c.id) FROM certifications c WHERE c.employee_id = e.id) AS cert_count, (SELECT MAX(c2.valid_until) FROM certifications c2 WHERE c2.employee_id = e.id) AS last_cert FROM employees e) t\nWHERE cert_count > 1;", "output": "SELECT e.id, COUNT(c.id) AS cert_count, MAX(c.valid_until) AS last_cert\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(c.id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id AND o.status = 'completed') AS completed_total, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.customer_id = c.id) AS total_refunds FROM customers c) t\nWHERE completed_total - total_refunds > 3000;", "output": "SELECT c.id, SUM(CASE WHEN o.status = 'completed' THEN o.amount END) AS completed_total, SUM(r.refund_amount) AS total_refunds\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nLEFT JOIN refunds r ON r.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(CASE WHEN o.status = 'completed' THEN o.amount END) - SUM(r.refund_amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT COUNT(oi.id) FROM order_items oi WHERE oi.order_id = o.id AND oi.price > 100) AS expensive_items, (SELECT SUM(oi2.price*oi2.quantity) FROM order_items oi2 WHERE oi2.order_id = o.id) AS total_value FROM orders o) t\nWHERE expensive_items > 0 AND total_value > 200;", "output": "SELECT o.id, COUNT(CASE WHEN oi.price > 100 THEN 1 END) AS expensive_items, SUM(oi.price*oi.quantity) AS total_value\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING COUNT(CASE WHEN oi.price > 100 THEN 1 END) > 0 AND SUM(oi.price*oi.quantity) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(pr.id) FROM projects pr WHERE pr.manager_id = e.id) AS managed_projects, (SELECT SUM(pr2.budget) FROM projects pr2 WHERE pr2.manager_id = e.id) AS total_budget FROM employees e) t\nWHERE managed_projects > 1 AND total_budget > 120000;", "output": "SELECT e.id, COUNT(pr.id) AS managed_projects, SUM(pr.budget) AS total_budget\nFROM employees e\nLEFT JOIN projects pr ON pr.manager_id = e.id\nGROUP BY e.id\nHAVING COUNT(pr.id) > 1 AND SUM(pr.budget) > 120000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT i.invoice_id, (SELECT SUM(il.line_total) FROM invoice_lines il WHERE il.invoice_id = i.invoice_id) AS total_amount, (SELECT MAX(p.payment_date) FROM payments p WHERE p.invoice_id = i.invoice_id) AS last_payment_date FROM invoices i) t\nWHERE total_amount > 1000 AND last_payment_date IS NOT NULL;", "output": "SELECT i.invoice_id, SUM(il.line_total) AS total_amount, MAX(p.payment_date) AS last_payment_date\nFROM invoices i\nLEFT JOIN invoice_lines il ON il.invoice_id = i.invoice_id\nLEFT JOIN payments p ON p.invoice_id = i.invoice_id\nGROUP BY i.invoice_id\nHAVING SUM(il.line_total) > 1000 AND MAX(p.payment_date) IS NOT NULL ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.shipment_id, (SELECT COUNT(sp.id) FROM shipment_packages sp WHERE sp.shipment_id = s.shipment_id) AS package_count, (SELECT SUM(sp2.weight) FROM shipment_packages sp2 WHERE sp2.shipment_id = s.shipment_id) AS total_weight FROM shipments s) t\nWHERE package_count > 5 AND total_weight > 100;", "output": "SELECT s.shipment_id, COUNT(sp.id) AS package_count, SUM(sp.weight) AS total_weight\nFROM shipments s\nLEFT JOIN shipment_packages sp ON sp.shipment_id = s.shipment_id\nGROUP BY s.shipment_id\nHAVING COUNT(sp.id) > 5 AND SUM(sp.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, u.username\nFROM users u\nWHERE EXISTS (SELECT * FROM sessions s WHERE s.user_id = u.user_id AND s.last_active > NOW() - INTERVAL '7 day') AND u.user_id IN (SELECT f.user_id FROM features f WHERE f.enabled = TRUE);", "output": "SELECT DISTINCT u.user_id, u.username\nFROM users u\nJOIN sessions s ON s.user_id = u.user_id\nJOIN features f ON f.user_id = u.user_id\nWHERE s.last_active > NOW() - INTERVAL '7 day' AND f.enabled = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.article_id, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.article_id = a.article_id) AS comment_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.article_id = a.article_id) AS avg_rating FROM articles a) t\nWHERE comment_count > 50 AND avg_rating > 3.5;", "output": "SELECT a.article_id, COUNT(c.comment_id) AS comment_count, AVG(r.rating) AS avg_rating\nFROM articles a\nLEFT JOIN comments c ON c.article_id = a.article_id\nLEFT JOIN ratings r ON r.article_id = a.article_id\nGROUP BY a.article_id\nHAVING COUNT(c.comment_id) > 50 AND AVG(r.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT e.event_id, e.event_name\nFROM EVENTS e\nWHERE e.event_id IN (SELECT DISTINCT t.event_id FROM tickets t WHERE t.purchase_date > '2023-01-01') AND EXISTS (SELECT 1 FROM organizers o WHERE o.organizer_id = e.organizer_id AND o.active = TRUE);", "output": "SELECT DISTINCT e.event_id, e.event_name\nFROM EVENTS e\nJOIN tickets t ON t.event_id = e.event_id\nJOIN organizers o ON o.organizer_id = e.organizer_id\nWHERE t.purchase_date > '2023-01-01' AND o.active = TRUE;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sub.id, (SELECT SUM(p.amount) FROM subscription_payments p WHERE p.subscription_id = sub.id) AS total_paid, (SELECT MAX(p2.payment_date) FROM subscription_payments p2 WHERE p2.subscription_id = sub.id) AS last_payment FROM subscriptions sub) t\nWHERE total_paid > 200 AND last_payment > '2023-06-01';", "output": "SELECT sub.id, SUM(p.amount) AS total_paid, MAX(p.payment_date) AS last_payment\nFROM subscriptions sub\nLEFT JOIN subscription_payments p ON p.subscription_id = sub.id\nGROUP BY sub.id\nHAVING SUM(p.amount) > 200 AND MAX(p.payment_date) > '2023-06-01' ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.session_id, (SELECT COUNT(l.id) FROM logs l WHERE l.session_id = s.session_id AND l.level = 'ERROR') AS error_logs, (SELECT COUNT(l2.id) FROM logs l2 WHERE l2.session_id = s.session_id AND l2.level = 'WARNING') AS warning_logs FROM sessions s) t\nWHERE error_logs > 5 OR warning_logs > 10;", "output": "SELECT s.session_id, COUNT(CASE WHEN l.level = 'ERROR' THEN 1 END) AS error_logs, COUNT(CASE WHEN l.level = 'WARNING' THEN 1 END) AS warning_logs\nFROM sessions s\nLEFT JOIN logs l ON l.session_id = s.session_id\nGROUP BY s.session_id\nHAVING COUNT(CASE WHEN l.level = 'ERROR' THEN 1 END) > 5 OR COUNT(CASE WHEN l.level = 'WARNING' THEN 1 END) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = p.project_id AND t.status = 'done') AS completed_tasks, (SELECT SUM(t2.estimated_hours) FROM tasks t2 WHERE t2.project_id = p.project_id) AS estimated_hours FROM projects p) t\nWHERE completed_tasks > 10 AND estimated_hours > 500;", "output": "SELECT p.project_id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS completed_tasks, SUM(t.estimated_hours) AS estimated_hours\nFROM projects p\nLEFT JOIN tasks t ON t.project_id = p.project_id\nGROUP BY p.project_id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) > 10 AND SUM(t.estimated_hours) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.id, (SELECT COUNT(m.id) FROM messages m WHERE m.sender_id = u.id) AS sent_messages, (SELECT COUNT(m2.id) FROM messages m2 WHERE m2.receiver_id = u.id) AS received_messages FROM users u) t\nWHERE sent_messages > 100 AND received_messages > 200;", "output": "SELECT u.id, COUNT(m.id) FILTER (WHERE m.sender_id = u.id) AS sent_messages, COUNT(m.id) FILTER (WHERE m.receiver_id = u.id) AS received_messages\nFROM users u\nLEFT JOIN messages m ON m.sender_id = u.id OR m.receiver_id = u.id\nGROUP BY u.id\nHAVING COUNT(m.id) FILTER (WHERE m.sender_id = u.id) > 100 AND COUNT(m.id) FILTER (WHERE m.receiver_id = u.id) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(p.amount) FROM payments p WHERE p.order_id = o.order_id) AS paid, (SELECT SUM(r.refund_amount) FROM refunds r WHERE r.order_id = o.order_id) AS refunded FROM orders o) t\nWHERE paid - refunded > 100;", "output": "SELECT o.order_id, SUM(p.amount) AS paid, SUM(r.refund_amount) AS refunded\nFROM orders o\nLEFT JOIN payments p ON p.order_id = o.order_id\nLEFT JOIN refunds r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(p.amount) - SUM(r.refund_amount) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.emp_id, (SELECT COUNT(a.attendance_id) FROM attendance a WHERE a.emp_id = e.emp_id AND a.status = 'present') AS present_days, (SELECT COUNT(a2.attendance_id) FROM attendance a2 WHERE a2.emp_id = e.emp_id AND a2.status = 'absent') AS absent_days FROM employees e) t\nWHERE present_days > 200 AND absent_days < 20;", "output": "SELECT e.emp_id, COUNT(CASE WHEN a.status = 'present' THEN 1 END) AS present_days, COUNT(CASE WHEN a.status = 'absent' THEN 1 END) AS absent_days\nFROM employees e\nLEFT JOIN attendance a ON a.emp_id = e.emp_id\nGROUP BY e.emp_id\nHAVING COUNT(CASE WHEN a.status = 'present' THEN 1 END) > 200 AND COUNT(CASE WHEN a.status = 'absent' THEN 1 END) < 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.cart_id, (SELECT COUNT(ci.item_id) FROM cart_items ci WHERE ci.cart_id = c.cart_id) AS item_count, (SELECT SUM(ci2.price*ci2.qty) FROM cart_items ci2 WHERE ci2.cart_id = c.cart_id) AS cart_value FROM carts c) t\nWHERE item_count > 3 AND cart_value > 100;", "output": "SELECT c.cart_id, COUNT(ci.item_id) AS item_count, SUM(ci.price*ci.qty) AS cart_value\nFROM carts c\nLEFT JOIN cart_items ci ON ci.cart_id = c.cart_id\nGROUP BY c.cart_id\nHAVING COUNT(ci.item_id) > 3 AND SUM(ci.price*ci.qty) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.id, (SELECT COUNT(a.id) FROM attendees a WHERE a.event_id = ev.id) AS attendees_count, (SELECT MAX(a2.registered_at) FROM attendees a2 WHERE a2.event_id = ev.id) AS last_registered FROM EVENTS ev) t\nWHERE attendees_count > 50;", "output": "SELECT ev.id, COUNT(a.id) AS attendees_count, MAX(a.registered_at) AS last_registered\nFROM EVENTS ev\nLEFT JOIN attendees a ON a.event_id = ev.id\nGROUP BY ev.id\nHAVING COUNT(a.id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.booking_id, (SELECT SUM(p.amount) FROM payments p WHERE p.booking_id = b.booking_id) AS total_paid, (SELECT COUNT(r.id) FROM reviews r WHERE r.booking_id = b.booking_id) AS review_count FROM bookings b) t\nWHERE total_paid > 500 AND review_count > 2;", "output": "SELECT b.booking_id, SUM(p.amount) AS total_paid, COUNT(r.id) AS review_count\nFROM bookings b\nLEFT JOIN payments p ON p.booking_id = b.booking_id\nLEFT JOIN reviews r ON r.booking_id = b.booking_id\nGROUP BY b.booking_id\nHAVING SUM(p.amount) > 500 AND COUNT(r.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id AND l.success = TRUE) AS successful_logins, (SELECT COUNT(l2.login_id) FROM logins l2 WHERE l2.user_id = u.user_id AND l2.success = FALSE) AS failed_logins FROM users u) t\nWHERE successful_logins > 5 AND failed_logins < 3;", "output": "SELECT u.user_id, COUNT(CASE WHEN l.success = TRUE THEN 1 END) AS successful_logins, COUNT(CASE WHEN l.success = FALSE THEN 1 END) AS failed_logins\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(CASE WHEN l.success = TRUE THEN 1 END) > 5 AND COUNT(CASE WHEN l.success = FALSE THEN 1 END) < 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT tr.transaction_id, (SELECT SUM(td.amount) FROM transaction_details td WHERE td.transaction_id = tr.transaction_id) AS total_amount, (SELECT COUNT(td2.id) FROM transaction_details td2 WHERE td2.transaction_id = tr.transaction_id AND td2.amount > 100) AS big_items FROM transactions tr) t\nWHERE total_amount > 1000 AND big_items > 2;", "output": "SELECT tr.transaction_id, SUM(td.amount) AS total_amount, COUNT(CASE WHEN td.amount > 100 THEN 1 END) AS big_items\nFROM transactions tr\nLEFT JOIN transaction_details td ON td.transaction_id = tr.transaction_id\nGROUP BY tr.transaction_id\nHAVING SUM(td.amount) > 1000 AND COUNT(CASE WHEN td.amount > 100 THEN 1 END) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade, (SELECT COUNT(g2.id) FROM grades g2 WHERE g2.student_id = s.student_id AND g2.grade < 60) AS failed_courses FROM students s) t\nWHERE avg_grade > 75 AND failed_courses < 3;", "output": "SELECT s.student_id, AVG(g.grade) AS avg_grade, COUNT(CASE WHEN g.grade < 60 THEN 1 END) AS failed_courses\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING AVG(g.grade) > 75 AND COUNT(CASE WHEN g.grade < 60 THEN 1 END) < 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT v.vehicle_id, (SELECT COUNT(m.maintenance_id) FROM maintenance m WHERE m.vehicle_id = v.vehicle_id) AS maintenance_count, (SELECT MAX(m2.date) FROM maintenance m2 WHERE m2.vehicle_id = v.vehicle_id) AS last_maintenance FROM vehicles v) t\nWHERE maintenance_count > 2;", "output": "SELECT v.vehicle_id, COUNT(m.maintenance_id) AS maintenance_count, MAX(m.date) AS last_maintenance\nFROM vehicles v\nLEFT JOIN maintenance m ON m.vehicle_id = v.vehicle_id\nGROUP BY v.vehicle_id\nHAVING COUNT(m.maintenance_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled_students, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled_students > 20 AND avg_grade > 70;", "output": "SELECT c.course_id, COUNT(e.id) AS enrolled_students, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.id) > 20 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.product_id = p.product_id AND r.rating = 5) AS five_star_reviews, (SELECT SUM(oi.quantity) FROM order_items oi WHERE oi.product_id = p.product_id) AS total_sold FROM products p) t\nWHERE five_star_reviews > 10 AND total_sold > 500;", "output": "SELECT p.product_id, COUNT(CASE WHEN r.rating = 5 THEN 1 END) AS five_star_reviews, SUM(oi.quantity) AS total_sold\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.product_id\nLEFT JOIN order_items oi ON oi.product_id = p.product_id\nGROUP BY p.product_id\nHAVING COUNT(CASE WHEN r.rating = 5 THEN 1 END) > 10 AND SUM(oi.quantity) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM users\nWHERE email = 'test@example.com';", "output": "SELECT user_id, username, email\nFROM users\nWHERE email = 'test@example.com';"}
{"instruction": "Optimize the SQL query", "input": "SELECT order_id, customer_id, total\nFROM orders\nWHERE total > 1000\nORDER BY total DESC ;", "output": "SELECT order_id, customer_id, total\nFROM orders\nWHERE total > 1000\nORDER BY total DESC\nLIMIT 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM employees ;", "output": "SELECT *\nFROM employees ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT p.product_id, p.name, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.product_id = p.product_id) AS review_count\nFROM products p\nWHERE EXISTS (SELECT 1 FROM order_items oi WHERE oi.product_id = p.product_id);", "output": "SELECT p.product_id, p.name, COUNT(r.review_id) AS review_count\nFROM products p\nJOIN order_items oi ON oi.product_id = p.product_id\nLEFT JOIN reviews r ON r.product_id = p.product_id\nGROUP BY p.product_id, p.name ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.id) FROM orders o WHERE o.user_id = u.user_id) AS order_count, (SELECT MAX(o2.order_date) FROM orders o2 WHERE o2.user_id = u.user_id) AS last_order FROM users u) t\nWHERE order_count > 5;", "output": "SELECT u.user_id, COUNT(o.id) AS order_count, MAX(o.order_date) AS last_order\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(o.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE avg_grade > 75;", "output": "SELECT s.student_id, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING AVG(g.grade) > 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT SUM(h.hours) FROM hours h WHERE h.employee_id = e.id) AS total_hours, (SELECT COUNT(p.id) FROM projects p WHERE p.lead_id = e.id) AS managed_projects FROM employees e) t\nWHERE total_hours > 200 AND managed_projects > 3;", "output": "SELECT e.id, SUM(h.hours) AS total_hours, COUNT(p.id) AS managed_projects\nFROM employees e\nLEFT JOIN hours h ON h.employee_id = e.id\nLEFT JOIN projects p ON p.lead_id = e.id\nGROUP BY e.id\nHAVING SUM(h.hours) > 200 AND COUNT(p.id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.id, (SELECT SUM(oi.price*oi.quantity) FROM order_items oi WHERE oi.order_id = o.id) AS total_value FROM orders o) t\nWHERE total_value > 500;", "output": "SELECT o.id, SUM(oi.price*oi.quantity) AS total_value\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.id\nGROUP BY o.id\nHAVING SUM(oi.price*oi.quantity) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.id, (SELECT COUNT(c.id) FROM certifications c WHERE c.employee_id = e.id) AS cert_count, (SELECT MAX(c.valid_until) FROM certifications c WHERE c.employee_id = e.id) AS last_cert FROM employees e) t\nWHERE cert_count > 1;", "output": "SELECT e.id, COUNT(c.id) AS cert_count, MAX(c.valid_until) AS last_cert\nFROM employees e\nLEFT JOIN certifications c ON c.employee_id = e.id\nGROUP BY e.id\nHAVING COUNT(c.id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM payments\nWHERE amount > 100;", "output": "SELECT payment_id, order_id, amount, payment_date\nFROM payments\nWHERE amount > 100;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.id, (SELECT COUNT(a.id) FROM attendees a WHERE a.event_id = ev.id) AS attendees_count, (SELECT MAX(a2.registered_at) FROM attendees a2 WHERE a2.event_id = ev.id) AS last_registered FROM EVENTS ev) t\nWHERE attendees_count > 100;", "output": "SELECT ev.id, COUNT(a.id) AS attendees_count, MAX(a.registered_at) AS last_registered\nFROM EVENTS ev\nLEFT JOIN attendees a ON a.event_id = ev.id\nGROUP BY ev.id\nHAVING COUNT(a.id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM orders o\nWHERE o.customer_id IN (SELECT c.id FROM customers c WHERE c.country = 'USA');", "output": "SELECT o.*\nFROM orders o\nJOIN customers c ON c.id = o.customer_id\nWHERE c.country = 'USA';"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, u.username, (SELECT COUNT(s.id) FROM sessions s WHERE s.user_id = u.user_id) AS sessions_count\nFROM users u\nWHERE u.status = 'active';", "output": "SELECT u.user_id, u.username, COUNT(s.id) AS sessions_count\nFROM users u\nLEFT JOIN sessions s ON s.user_id = u.user_id\nWHERE u.status = 'active'\nGROUP BY u.user_id, u.username ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM logs\nWHERE LEVEL = 'ERROR'\nORDER BY created_at DESC ;", "output": "SELECT log_id, message, LEVEL, created_at\nFROM logs\nWHERE LEVEL = 'ERROR'\nORDER BY created_at DESC\nLIMIT 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.id, (SELECT SUM(o.amount) FROM orders o WHERE o.customer_id = c.id) AS total_spent, (SELECT MAX(o.order_date) FROM orders o WHERE o.customer_id = c.id) AS last_order FROM customers c) t\nWHERE total_spent > 1000;", "output": "SELECT c.id, SUM(o.amount) AS total_spent, MAX(o.order_date) AS last_order\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nHAVING SUM(o.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM inventory ;", "output": "SELECT *\nFROM inventory ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.shipment_id, (SELECT COUNT(sp.id) FROM shipment_packages sp WHERE sp.shipment_id = s.shipment_id) AS package_count FROM shipments s) t\nWHERE package_count > 5;", "output": "SELECT s.shipment_id, COUNT(sp.id) AS package_count\nFROM shipments s\nLEFT JOIN shipment_packages sp ON sp.shipment_id = s.shipment_id\nGROUP BY s.shipment_id\nHAVING COUNT(sp.id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.article_id, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.article_id = a.article_id) AS comment_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.article_id = a.article_id) AS avg_rating FROM articles a) t\nWHERE comment_count > 20 AND avg_rating > 4;", "output": "SELECT a.article_id, COUNT(c.comment_id) AS comment_count, AVG(r.rating) AS avg_rating\nFROM articles a\nLEFT JOIN comments c ON c.article_id = a.article_id\nLEFT JOIN ratings r ON r.article_id = a.article_id\nGROUP BY a.article_id\nHAVING COUNT(c.comment_id) > 20 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM sessions s\nWHERE EXISTS (SELECT 1 FROM logs l WHERE l.session_id = s.session_id AND l.level = 'ERROR');", "output": "SELECT DISTINCT s.*\nFROM sessions s\nJOIN logs l ON l.session_id = s.session_id\nWHERE l.level = 'ERROR';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT v.vehicle_id, (SELECT COUNT(m.maintenance_id) FROM maintenance m WHERE m.vehicle_id = v.vehicle_id) AS maintenance_count, (SELECT MAX(m2.date) FROM maintenance m2 WHERE m2.vehicle_id = v.vehicle_id) AS last_maintenance FROM vehicles v) t\nWHERE maintenance_count > 2;", "output": "SELECT v.vehicle_id, COUNT(m.maintenance_id) AS maintenance_count, MAX(m.date) AS last_maintenance\nFROM vehicles v\nLEFT JOIN maintenance m ON m.vehicle_id = v.vehicle_id\nGROUP BY v.vehicle_id\nHAVING COUNT(m.maintenance_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM tickets ;", "output": "SELECT *\nFROM tickets ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id AND l.success = TRUE) AS successful_logins FROM users u) t\nWHERE successful_logins > 10;", "output": "SELECT u.user_id, COUNT(CASE WHEN l.success = TRUE THEN 1 END) AS successful_logins\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(CASE WHEN l.success = TRUE THEN 1 END) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.session_id, (SELECT COUNT(l.id) FROM logs l WHERE l.session_id = s.session_id AND l.level = 'INFO') AS info_logs FROM sessions s) t\nWHERE info_logs > 100;", "output": "SELECT s.session_id, COUNT(CASE WHEN l.level = 'INFO' THEN 1 END) AS info_logs\nFROM sessions s\nLEFT JOIN logs l ON l.session_id = s.session_id\nGROUP BY s.session_id\nHAVING COUNT(CASE WHEN l.level = 'INFO' THEN 1 END) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM categories ;", "output": "SELECT *\nFROM categories ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT tr.transaction_id, (SELECT SUM(td.amount) FROM transaction_details td WHERE td.transaction_id = tr.transaction_id) AS total_amount, (SELECT COUNT(td2.id) FROM transaction_details td2 WHERE td2.transaction_id = tr.transaction_id AND td2.amount > 50) AS large_items FROM transactions tr) t\nWHERE total_amount > 500;", "output": "SELECT tr.transaction_id, SUM(td.amount) AS total_amount, COUNT(CASE WHEN td.amount > 50 THEN 1 END) AS large_items\nFROM transactions tr\nLEFT JOIN transaction_details td ON td.transaction_id = tr.transaction_id\nGROUP BY tr.transaction_id\nHAVING SUM(td.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT m.member_id, (SELECT COUNT(*) FROM messages ms WHERE ms.member_id = m.member_id AND ms.created_at >= '2024-01-01') AS msg_count, (SELECT MAX(ms2.created_at) FROM messages ms2 WHERE ms2.member_id = m.member_id) AS last_msg\nFROM members m\nWHERE EXISTS (SELECT 1 FROM memberships mb WHERE mb.member_id = m.member_id AND mb.active = TRUE)\nORDER BY msg_count DESC ;", "output": "SELECT m.member_id, COUNT(ms.message_id) AS msg_count, MAX(ms.created_at) AS last_msg\nFROM members m\nJOIN memberships mb ON mb.member_id = m.member_id AND mb.active = TRUE\nLEFT JOIN messages ms ON ms.member_id = m.member_id AND ms.created_at >= '2024-01-01'\nGROUP BY m.member_id\nORDER BY msg_count DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.purchase_id, p.user_id, (SELECT SUM(pi.quantity * pi.unit_price) FROM purchase_items pi WHERE pi.purchase_id = p.purchase_id) AS gross_amount, (SELECT COALESCE(SUM(d.amount),0) FROM discounts d WHERE d.purchase_id = p.purchase_id) AS discount_amount FROM purchases p WHERE p.created_at BETWEEN '2024-01-01' AND '2024-12-31') t\nWHERE gross_amount - discount_amount > 500;", "output": "SELECT p.purchase_id, p.user_id, SUM(pi.quantity * pi.unit_price) AS gross_amount, COALESCE(SUM(d.amount),0) AS discount_amount\nFROM purchases p\nLEFT JOIN purchase_items pi ON pi.purchase_id = p.purchase_id\nLEFT JOIN discounts d ON d.purchase_id = p.purchase_id\nWHERE p.created_at >= '2024-01-01' AND p.created_at <= '2024-12-31'\nGROUP BY p.purchase_id, p.user_id\nHAVING SUM(pi.quantity * pi.unit_price) - COALESCE(SUM(d.amount),0) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT u.user_id\nFROM users u\nWHERE u.user_id IN (SELECT ad.user_id FROM ad_clicks ad WHERE ad.clicked_at >= '2025-01-01') AND EXISTS (SELECT 1 FROM pageviews pv WHERE pv.user_id = u.user_id AND pv.url LIKE '%/checkout%');", "output": "SELECT DISTINCT u.user_id\nFROM users u\nJOIN ad_clicks ad ON ad.user_id = u.user_id AND ad.clicked_at >= '2025-01-01'\nJOIN pageviews pv ON pv.user_id = u.user_id AND pv.url LIKE '%/checkout%' ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT w.warehouse_id, (SELECT SUM(CASE WHEN im.direction = 'IN' THEN im.quantity ELSE -im.quantity END) FROM inventory_movements im WHERE im.warehouse_id = w.warehouse_id) AS stock_level, (SELECT COUNT(*) FROM inventory_movements im2 WHERE im2.warehouse_id = w.warehouse_id AND im2.moved_at >= '2025-01-01') AS tx_count FROM warehouses w) t\nWHERE stock_level > 0 AND tx_count > 50;", "output": "SELECT w.warehouse_id, SUM(CASE WHEN im.direction = 'IN' THEN im.quantity ELSE -im.quantity END) AS stock_level, COUNT(CASE WHEN im.moved_at >= '2025-01-01' THEN 1 END) AS tx_count\nFROM warehouses w\nLEFT JOIN inventory_movements im ON im.warehouse_id = w.warehouse_id\nGROUP BY w.warehouse_id\nHAVING SUM(CASE WHEN im.direction = 'IN' THEN im.quantity ELSE -im.quantity END) > 0 AND COUNT(CASE WHEN im.moved_at >= '2025-01-01' THEN 1 END) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.delivery_id, (SELECT MAX(s.status_time) FROM delivery_status s WHERE s.delivery_id = d.delivery_id) AS last_status_time, (SELECT COUNT(*) FROM delivery_status s2 WHERE s2.delivery_id = d.delivery_id AND s2.status = 'FAILED') AS fails FROM deliveries d) x\nWHERE fails = 0;", "output": "SELECT d.delivery_id, MAX(s.status_time) AS last_status_time, COUNT(CASE WHEN s.status = 'FAILED' THEN 1 END) AS fails\nFROM deliveries d\nLEFT JOIN delivery_status s ON s.delivery_id = d.delivery_id\nGROUP BY d.delivery_id\nHAVING COUNT(CASE WHEN s.status = 'FAILED' THEN 1 END) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM sensor_readings ;", "output": "SELECT *\nFROM sensor_readings ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT s.sensor_id, (SELECT AVG(r.value) FROM readings r WHERE r.sensor_id = s.sensor_id AND r.recorded_at >= '2025-01-01') AS avg_recent, (SELECT MAX(r2.value) FROM readings r2 WHERE r2.sensor_id = s.sensor_id) AS max_val\nFROM sensors s\nHAVING avg_recent IS NOT NULL ;", "output": "SELECT s.sensor_id, AVG(r.value) AS avg_recent, MAX(r.value) AS max_val\nFROM sensors s\nLEFT JOIN readings r ON r.sensor_id = s.sensor_id AND r.recorded_at >= '2025-01-01'\nGROUP BY s.sensor_id\nHAVING AVG(r.value) IS NOT NULL ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.alert_id, (SELECT COUNT(*) FROM alert_events ae WHERE ae.alert_id = a.alert_id AND ae.event_type = 'TRIGGER') AS TRIGGERS, (SELECT COUNT(*) FROM alert_events ae2 WHERE ae2.alert_id = a.alert_id AND ae2.event_type = 'RESOLVE') AS resolves FROM alerts a) t\nWHERE TRIGGERS > resolves;", "output": "SELECT a.alert_id, COUNT(CASE WHEN ae.event_type = 'TRIGGER' THEN 1 END) AS TRIGGERS, COUNT(CASE WHEN ae.event_type = 'RESOLVE' THEN 1 END) AS resolves\nFROM alerts a\nLEFT JOIN alert_events ae ON ae.alert_id = a.alert_id\nGROUP BY a.alert_id\nHAVING COUNT(CASE WHEN ae.event_type = 'TRIGGER' THEN 1 END) > COUNT(CASE WHEN ae.event_type = 'RESOLVE' THEN 1 END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT inv.invoice_id, (SELECT SUM(il.amount) FROM invoice_lines il WHERE il.invoice_id = inv.invoice_id) AS total_lines, (SELECT SUM(p.amount) FROM payments p WHERE p.invoice_id = inv.invoice_id) AS total_paid\nFROM invoices inv\nWHERE (SELECT SUM(il2.amount) FROM invoice_lines il2 WHERE il2.invoice_id = inv.invoice_id) - (SELECT COALESCE(SUM(p2.amount),0) FROM payments p2 WHERE p2.invoice_id = inv.invoice_id) > 0;", "output": "SELECT inv.invoice_id, SUM(il.amount) AS total_lines, COALESCE(SUM(p.amount),0) AS total_paid\nFROM invoices inv\nLEFT JOIN invoice_lines il ON il.invoice_id = inv.invoice_id\nLEFT JOIN payments p ON p.invoice_id = inv.invoice_id\nGROUP BY inv.invoice_id\nHAVING SUM(il.amount) - COALESCE(SUM(p.amount),0) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pr.repo_id, (SELECT COUNT(c.commit_id) FROM commits c WHERE c.repo_id = pr.repo_id AND c.authored_at >= '2024-01-01') AS commits_year, (SELECT COUNT(p.pr_id) FROM pull_requests p WHERE p.repo_id = pr.repo_id AND p.state = 'open') AS open_prs, (SELECT COUNT(st.star_id) FROM stars st WHERE st.repo_id = pr.repo_id) AS stars FROM repos pr) t\nWHERE commits_year > 100 AND open_prs < 20;", "output": "SELECT pr.repo_id, COUNT(CASE WHEN c.authored_at >= '2024-01-01' THEN 1 END) AS commits_year, COUNT(CASE WHEN p.state = 'open' THEN 1 END) AS open_prs, COUNT(st.star_id) AS stars\nFROM repos pr\nLEFT JOIN commits c ON c.repo_id = pr.repo_id\nLEFT JOIN pull_requests p ON p.repo_id = pr.repo_id\nLEFT JOIN stars st ON st.repo_id = pr.repo_id\nGROUP BY pr.repo_id\nHAVING COUNT(CASE WHEN c.authored_at >= '2024-01-01' THEN 1 END) > 100 AND COUNT(CASE WHEN p.state = 'open' THEN 1 END) < 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id\nFROM users u\nWHERE (SELECT COUNT(*) FROM followers f WHERE f.followee_id = u.user_id) > 1000 AND (SELECT COUNT(*) FROM followers f2 WHERE f2.follower_id = u.user_id) > 100;", "output": "SELECT u.user_id\nFROM users u\nLEFT JOIN followers f1 ON f1.followee_id = u.user_id\nLEFT JOIN followers f2 ON f2.follower_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(f1.followee_id) > 1000 AND COUNT(f2.follower_id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.playlist_id, (SELECT COUNT(pt.track_id) FROM playlist_tracks pt WHERE pt.playlist_id = pl.playlist_id) AS tracks, (SELECT SUM(t.duration_sec) FROM tracks t WHERE t.track_id IN (SELECT pt2.track_id FROM playlist_tracks pt2 WHERE pt2.playlist_id = pl.playlist_id)) AS duration FROM playlists pl) t\nWHERE tracks > 20 AND duration > 3600;", "output": "SELECT pl.playlist_id, COUNT(pt.track_id) AS tracks, SUM(t.duration_sec) AS duration\nFROM playlists pl\nLEFT JOIN playlist_tracks pt ON pt.playlist_id = pl.playlist_id\nLEFT JOIN tracks t ON t.track_id = pt.track_id\nGROUP BY pl.playlist_id\nHAVING COUNT(pt.track_id) > 20 AND SUM(t.duration_sec) > 3600 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.device_id, (SELECT COUNT(u.update_id) FROM firmware_updates u WHERE u.device_id = d.device_id) AS update_count, (SELECT MAX(u2.applied_at) FROM firmware_updates u2 WHERE u2.device_id = d.device_id) AS last_update FROM devices d) t\nWHERE update_count > 0;", "output": "SELECT d.device_id, COUNT(u.update_id) AS update_count, MAX(u.applied_at) AS last_update\nFROM devices d\nLEFT JOIN firmware_updates u ON u.device_id = d.device_id\nGROUP BY d.device_id\nHAVING COUNT(u.update_id) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.bug_id, (SELECT COUNT(t.test_id) FROM test_runs t WHERE t.bug_id = b.bug_id AND t.status = 'failed') AS fails, (SELECT COUNT(t2.test_id) FROM test_runs t2 WHERE t2.bug_id = b.bug_id AND t2.status = 'passed') AS passes FROM bugs b) t\nWHERE fails > passes;", "output": "SELECT b.bug_id, COUNT(CASE WHEN t.status = 'failed' THEN 1 END) AS fails, COUNT(CASE WHEN t.status = 'passed' THEN 1 END) AS passes\nFROM bugs b\nLEFT JOIN test_runs t ON t.bug_id = b.bug_id\nGROUP BY b.bug_id\nHAVING COUNT(CASE WHEN t.status = 'failed' THEN 1 END) > COUNT(CASE WHEN t.status = 'passed' THEN 1 END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT a.artifact_id, a.pipeline_id\nFROM build_artifacts a\nWHERE a.created_at = a.created_at;", "output": "SELECT a.artifact_id, a.pipeline_id\nFROM build_artifacts a ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT m.host_id, (SELECT AVG(c.usage_percent) FROM cpu_metrics c WHERE c.host_id = m.host_id AND c.recorded_at >= '2025-01-01') AS avg_cpu, (SELECT AVG(mm.usage_percent) FROM memory_metrics mm WHERE mm.host_id = m.host_id AND mm.recorded_at >= '2025-01-01') AS avg_mem FROM machines m) t\nWHERE avg_cpu > 70 AND avg_mem > 75;", "output": "SELECT m.host_id, AVG(c.usage_percent) AS avg_cpu, AVG(mm.usage_percent) AS avg_mem\nFROM machines m\nLEFT JOIN cpu_metrics c ON c.host_id = m.host_id AND c.recorded_at >= '2025-01-01'\nLEFT JOIN memory_metrics mm ON mm.host_id = m.host_id AND mm.recorded_at >= '2025-01-01'\nGROUP BY m.host_id\nHAVING AVG(c.usage_percent) > 70 AND AVG(mm.usage_percent) > 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT n.node_id, (SELECT COUNT(e.event_id) FROM network_events e WHERE e.node_id = n.node_id AND e.severity = 'critical') AS crits, (SELECT COUNT(e2.event_id) FROM network_events e2 WHERE e2.node_id = n.node_id AND e2.severity = 'warning') AS warns FROM nodes n) t\nWHERE crits > 0 OR warns > 10;", "output": "SELECT n.node_id, COUNT(CASE WHEN e.severity = 'critical' THEN 1 END) AS crits, COUNT(CASE WHEN e.severity = 'warning' THEN 1 END) AS warns\nFROM nodes n\nLEFT JOIN network_events e ON e.node_id = n.node_id\nGROUP BY n.node_id\nHAVING COUNT(CASE WHEN e.severity = 'critical' THEN 1 END) > 0 OR COUNT(CASE WHEN e.severity = 'warning' THEN 1 END) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT u.user_id, (SELECT COUNT(*) FROM subscriptions s WHERE s.user_id = u.user_id AND s.status = 'active') AS active_subs, (SELECT COUNT(*) FROM cancellations c WHERE c.user_id = u.user_id AND c.created_at >= '2024-01-01') AS cancels\nFROM users u\nWHERE active_subs > 0;", "output": "SELECT u.user_id, COUNT(CASE WHEN s.status = 'active' THEN 1 END) AS active_subs, COUNT(CASE WHEN c.created_at >= '2024-01-01' THEN 1 END) AS cancels\nFROM users u\nLEFT JOIN subscriptions s ON s.user_id = u.user_id\nLEFT JOIN cancellations c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(CASE WHEN s.status = 'active' THEN 1 END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.project_id, p.org_id, (SELECT COUNT(*) FROM issues i WHERE i.project_id = p.project_id AND i.state = 'open') AS open_issues, (SELECT MAX(i2.updated_at) FROM issues i2 WHERE i2.project_id = p.project_id) AS last_issue_time FROM projects p WHERE p.visibility IN ('public','internal')) t\nWHERE open_issues < 50\nORDER BY last_issue_time DESC ;", "output": "SELECT p.project_id, p.org_id, COUNT(CASE WHEN i.state = 'open' THEN 1 END) AS open_issues, MAX(i.updated_at) AS last_issue_time\nFROM projects p\nLEFT JOIN issues i ON i.project_id = p.project_id\nWHERE p.visibility IN ('public','internal')\nGROUP BY p.project_id, p.org_id\nHAVING COUNT(CASE WHEN i.state = 'open' THEN 1 END) < 50\nORDER BY last_issue_time DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT acc.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = acc.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = acc.account_id AND t2.type = 'debit') AS debits FROM accounts acc) z\nWHERE credits - debits > 0;", "output": "SELECT acc.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts acc\nLEFT JOIN transactions t ON t.account_id = acc.account_id\nGROUP BY acc.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.type = 'debit' THEN t.amount END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT l.listen_id, l.user_id, (SELECT COUNT(*) FROM listens li WHERE li.user_id = l.user_id AND li.played_at >= '2025-01-01') AS plays_2025 FROM listens l) t\nWHERE plays_2025 > 100;", "output": "SELECT l.user_id, COUNT(li.listen_id) AS plays_2025\nFROM listens l\nJOIN listens li ON li.user_id = l.user_id AND li.played_at >= '2025-01-01'\nGROUP BY l.user_id\nHAVING COUNT(li.listen_id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.store_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.store_id = s.store_id AND o.status IN ('paid','shipped')) AS good_orders, (SELECT COUNT(o2.order_id) FROM orders o2 WHERE o2.store_id = s.store_id AND o2.status = 'cancelled') AS cancelled FROM stores s) t\nWHERE good_orders >= 100 AND cancelled < 10;", "output": "SELECT s.store_id, COUNT(CASE WHEN o.status IN ('paid','shipped') THEN 1 END) AS good_orders, COUNT(CASE WHEN o.status = 'cancelled' THEN 1 END) AS cancelled\nFROM stores s\nLEFT JOIN orders o ON o.store_id = s.store_id\nGROUP BY s.store_id\nHAVING COUNT(CASE WHEN o.status IN ('paid','shipped') THEN 1 END) >= 100 AND COUNT(CASE WHEN o.status = 'cancelled' THEN 1 END) < 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT k.course_key, (SELECT AVG(e.score) FROM exam_results e WHERE e.course_key = k.course_key) AS avg_score, (SELECT COUNT(*) FROM enrollments en WHERE en.course_key = k.course_key) AS enrolled FROM course_keys k) t\nWHERE avg_score >= 80 AND enrolled > 50;", "output": "SELECT k.course_key, AVG(e.score) AS avg_score, COUNT(en.student_id) AS enrolled\nFROM course_keys k\nLEFT JOIN exam_results e ON e.course_key = k.course_key\nLEFT JOIN enrollments en ON en.course_key = k.course_key\nGROUP BY k.course_key\nHAVING AVG(e.score) >= 80 AND COUNT(en.student_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM geolocation_points ;", "output": "SELECT *\nFROM geolocation_points ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT t.tx_id, t.user_id, (SELECT COUNT(*) FROM tx_tags tt WHERE tt.tx_id = t.tx_id AND tt.tag = 'highrisk') AS risk_tags, (SELECT SUM(tf.fee_amount) FROM tx_fees tf WHERE tf.tx_id = t.tx_id) AS total_fees FROM transactions t) q\nWHERE risk_tags > 0 AND total_fees > 10;", "output": "SELECT t.tx_id, t.user_id, COUNT(CASE WHEN tt.tag = 'highrisk' THEN 1 END) AS risk_tags, SUM(tf.fee_amount) AS total_fees\nFROM transactions t\nLEFT JOIN tx_tags tt ON tt.tx_id = t.tx_id\nLEFT JOIN tx_fees tf ON tf.tx_id = t.tx_id\nGROUP BY t.tx_id, t.user_id\nHAVING COUNT(CASE WHEN tt.tag = 'highrisk' THEN 1 END) > 0 AND SUM(tf.fee_amount) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT r.route_id, (SELECT COUNT(*) FROM deliveries d WHERE d.route_id = r.route_id AND d.delivered = TRUE) AS delivered_cnt, (SELECT COUNT(*) FROM deliveries d2 WHERE d2.route_id = r.route_id AND d2.delivered = FALSE) AS pending_cnt FROM routes r) t\nWHERE delivered_cnt > pending_cnt;", "output": "SELECT r.route_id, COUNT(CASE WHEN d.delivered = TRUE THEN 1 END) AS delivered_cnt, COUNT(CASE WHEN d.delivered = FALSE THEN 1 END) AS pending_cnt\nFROM routes r\nLEFT JOIN deliveries d ON d.route_id = r.route_id\nGROUP BY r.route_id\nHAVING COUNT(CASE WHEN d.delivered = TRUE THEN 1 END) > COUNT(CASE WHEN d.delivered = FALSE THEN 1 END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(s.session_id) FROM sessions s WHERE s.user_id = u.user_id AND s.start_time >= '2025-01-01') AS recent_sessions, (SELECT COUNT(p.page_id) FROM pageviews p WHERE p.user_id = u.user_id AND p.url LIKE '%checkout%') AS checkout_views FROM users u) t\nWHERE recent_sessions > 2 AND checkout_views > 0;", "output": "SELECT u.user_id, COUNT(CASE WHEN s.start_time >= '2025-01-01' THEN 1 END) AS recent_sessions, COUNT(CASE WHEN p.url LIKE '%checkout%' THEN 1 END) AS checkout_views\nFROM users u\nLEFT JOIN sessions s ON s.user_id = u.user_id\nLEFT JOIN pageviews p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(CASE WHEN s.start_time >= '2025-01-01' THEN 1 END) > 2 AND COUNT(CASE WHEN p.url LIKE '%checkout%' THEN 1 END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.group_id, (SELECT COUNT(m.member_id) FROM group_members m WHERE m.group_id = g.group_id) AS members_count, (SELECT COUNT(p.post_id) FROM posts p WHERE p.group_id = g.group_id) AS posts_count FROM groups g) t\nWHERE members_count > 100 AND posts_count > 500;", "output": "SELECT g.group_id, COUNT(m.member_id) AS members_count, COUNT(p.post_id) AS posts_count\nFROM groups g\nLEFT JOIN group_members m ON m.group_id = g.group_id\nLEFT JOIN posts p ON p.group_id = g.group_id\nGROUP BY g.group_id\nHAVING COUNT(m.member_id) > 100 AND COUNT(p.post_id) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS total_spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS reviews_written FROM customers c) t\nWHERE total_spent > 10000;", "output": "SELECT c.customer_id, SUM(o.total) AS total_spent, COUNT(r.review_id) AS reviews_written\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.post_id, (SELECT COUNT(l.like_id) FROM likes l WHERE l.post_id = p.post_id) AS like_count, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.post_id = p.post_id) AS comment_count FROM posts p) t\nWHERE like_count > 100 OR comment_count > 50;", "output": "SELECT p.post_id, COUNT(l.like_id) AS like_count, COUNT(c.comment_id) AS comment_count\nFROM posts p\nLEFT JOIN likes l ON l.post_id = p.post_id\nLEFT JOIN comments c ON c.post_id = p.post_id\nGROUP BY p.post_id\nHAVING COUNT(l.like_id) > 100 OR COUNT(c.comment_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.store_id, (SELECT SUM(o.total) FROM orders o WHERE o.store_id = s.store_id AND o.status = 'completed') AS completed_sales, (SELECT SUM(o2.total) FROM orders o2 WHERE o2.store_id = s.store_id AND o2.status = 'cancelled') AS cancelled_sales FROM stores s) t\nWHERE completed_sales > cancelled_sales;", "output": "SELECT s.store_id, SUM(CASE WHEN o.status = 'completed' THEN o.total END) AS completed_sales, SUM(CASE WHEN o.status = 'cancelled' THEN o.total END) AS cancelled_sales\nFROM stores s\nLEFT JOIN orders o ON o.store_id = s.store_id\nGROUP BY s.store_id\nHAVING SUM(CASE WHEN o.status = 'completed' THEN o.total END) > SUM(CASE WHEN o.status = 'cancelled' THEN o.total END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id AND r.status = 'completed') AS completed_rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE completed_rides > 100 AND avg_rating > 4.5;", "output": "SELECT d.driver_id, COUNT(CASE WHEN r.status = 'completed' THEN 1 END) AS completed_rides, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(CASE WHEN r.status = 'completed' THEN 1 END) > 100 AND AVG(r.rating) > 4.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS booking_count, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE booking_count > 200;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS booking_count, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = p.project_id) AS task_count, (SELECT COUNT(t2.task_id) FROM tasks t2 WHERE t2.project_id = p.project_id AND t2.status = 'done') AS completed_tasks FROM projects p) t\nWHERE task_count > 50 AND completed_tasks > 40;", "output": "SELECT p.project_id, COUNT(t.task_id) AS task_count, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS completed_tasks\nFROM projects p\nLEFT JOIN tasks t ON t.project_id = p.project_id\nGROUP BY p.project_id\nHAVING COUNT(t.task_id) > 50 AND COUNT(CASE WHEN t.status = 'done' THEN 1 END) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = c.class_id) AS student_count, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = c.class_id) AS avg_grade FROM classes c) t\nWHERE student_count > 20;", "output": "SELECT c.class_id, COUNT(st.student_id) AS student_count, AVG(g.grade) AS avg_grade\nFROM classes c\nLEFT JOIN students st ON st.class_id = c.class_id\nLEFT JOIN grades g ON g.class_id = c.class_id\nGROUP BY c.class_id\nHAVING COUNT(st.student_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM logs\nWHERE LEVEL = 'WARN';", "output": "SELECT log_id, LEVEL, message, created_at\nFROM logs\nWHERE LEVEL = 'WARN';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT f.flight_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.flight_id = f.flight_id) AS sold_tickets, (SELECT COUNT(t2.ticket_id) FROM tickets t2 WHERE t2.flight_id = f.flight_id AND t2.status = 'cancelled') AS cancelled_tickets FROM flights f) t\nWHERE sold_tickets > 100;", "output": "SELECT f.flight_id, COUNT(t.ticket_id) AS sold_tickets, COUNT(CASE WHEN t.status = 'cancelled' THEN 1 END) AS cancelled_tickets\nFROM flights f\nLEFT JOIN tickets t ON t.flight_id = f.flight_id\nGROUP BY f.flight_id\nHAVING COUNT(t.ticket_id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM products ;", "output": "SELECT *\nFROM products ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(e.exam_id) FROM exams e WHERE e.student_id = s.student_id) AS exam_count, (SELECT AVG(e2.score) FROM exams e2 WHERE e2.student_id = s.student_id) AS avg_score FROM students s) t\nWHERE exam_count > 3;", "output": "SELECT s.student_id, COUNT(e.exam_id) AS exam_count, AVG(e.score) AS avg_score\nFROM students s\nLEFT JOIN exams e ON e.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(e.exam_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS post_count, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comment_count FROM users u) t\nWHERE post_count > 5 OR comment_count > 10;", "output": "SELECT u.user_id, COUNT(p.post_id) AS post_count, COUNT(c.comment_id) AS comment_count\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(p.post_id) > 5 OR COUNT(c.comment_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.department_id, (SELECT SUM(e.salary) FROM employees e WHERE e.department_id = d.department_id) AS total_salary, (SELECT COUNT(e2.id) FROM employees e2 WHERE e2.department_id = d.department_id) AS emp_count FROM departments d) t\nWHERE total_salary > 500000;", "output": "SELECT d.department_id, SUM(e.salary) AS total_salary, COUNT(e.id) AS emp_count\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.department_id\nGROUP BY d.department_id\nHAVING SUM(e.salary) > 500000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.book_id = b.book_id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE review_count > 10 AND avg_rating > 3;", "output": "SELECT b.book_id, COUNT(r.review_id) AS review_count, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN reviews r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(r.review_id) > 10 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.player_id) FROM players p WHERE p.game_id = g.game_id) AS player_count, (SELECT MAX(s.score) FROM scores s WHERE s.game_id = g.game_id) AS max_score FROM games g) t\nWHERE player_count > 5;", "output": "SELECT g.game_id, COUNT(p.player_id) AS player_count, MAX(s.score) AS max_score\nFROM games g\nLEFT JOIN players p ON p.game_id = g.game_id\nLEFT JOIN scores s ON s.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.player_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM payments ;", "output": "SELECT *\nFROM payments ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 30;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, o.customer_id, (SELECT SUM(oi.price * oi.quantity) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS return_count FROM orders o) t\nWHERE total_value > 1000 AND return_count = 0\nORDER BY total_value DESC ;", "output": "SELECT o.order_id, o.customer_id, SUM(oi.price * oi.quantity) AS total_value, COUNT(r.return_id) AS return_count\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id, o.customer_id\nHAVING SUM(oi.price * oi.quantity) > 1000 AND COUNT(r.return_id) = 0\nORDER BY total_value DESC ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary, (SELECT MAX(p.project_deadline) FROM projects p WHERE p.lead_id = e.employee_id) AS last_deadline FROM employees e) t\nWHERE avg_salary > 5000;", "output": "SELECT e.employee_id, e.department_id, AVG(s.salary) AS avg_salary, MAX(p.project_deadline) AS last_deadline\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.lead_id = e.employee_id\nGROUP BY e.employee_id, e.department_id\nHAVING AVG(s.salary) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS orders_count, (SELECT MAX(o2.order_date) FROM orders o2 WHERE o2.user_id = u.user_id) AS last_order FROM users u) t\nWHERE orders_count > 5;", "output": "SELECT u.user_id, COUNT(o.order_id) AS orders_count, MAX(o.order_date) AS last_order\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(o.order_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.category_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.category_id = c.category_id) AS product_count, (SELECT AVG(p2.price) FROM products p2 WHERE p2.category_id = c.category_id) AS avg_price FROM categories c) t\nWHERE product_count > 10;", "output": "SELECT c.category_id, COUNT(p.product_id) AS product_count, AVG(p.price) AS avg_price\nFROM categories c\nLEFT JOIN products p ON p.category_id = c.category_id\nGROUP BY c.category_id\nHAVING COUNT(p.product_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT t.team_id, (SELECT COUNT(p.player_id) FROM players p WHERE p.team_id = t.team_id) AS player_count, (SELECT AVG(p2.age) FROM players p2 WHERE p2.team_id = t.team_id) AS avg_age FROM teams t) t2\nWHERE player_count > 15;", "output": "SELECT t.team_id, COUNT(p.player_id) AS player_count, AVG(p.age) AS avg_age\nFROM teams t\nLEFT JOIN players p ON p.team_id = t.team_id\nGROUP BY t.team_id\nHAVING COUNT(p.player_id) > 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.score) FROM grades g WHERE g.student_id = s.student_id) AS avg_score, (SELECT COUNT(c.course_id) FROM enrollments c WHERE c.student_id = s.student_id) AS courses_taken FROM students s) t\nWHERE avg_score > 70;", "output": "SELECT s.student_id, AVG(g.score) AS avg_score, COUNT(c.course_id) AS courses_taken\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nLEFT JOIN enrollments c ON c.student_id = s.student_id\nGROUP BY s.student_id\nHAVING AVG(g.score) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = p.project_id AND t.status = 'done') AS completed_tasks, (SELECT COUNT(t2.task_id) FROM tasks t2 WHERE t2.project_id = p.project_id) AS total_tasks FROM projects p) t\nWHERE completed_tasks = total_tasks;", "output": "SELECT p.project_id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS completed_tasks, COUNT(t.task_id) AS total_tasks\nFROM projects p\nLEFT JOIN tasks t ON t.project_id = p.project_id\nGROUP BY p.project_id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) = COUNT(t.task_id) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books_count, (SELECT AVG(r.rating) FROM reviews r WHERE r.author_id = a.author_id) AS avg_rating FROM authors a) t\nWHERE books_count > 3;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books_count, AVG(r.rating) AS avg_rating\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN reviews r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.department_id, (SELECT SUM(e.salary) FROM employees e WHERE e.department_id = d.department_id) AS total_salary, (SELECT COUNT(e2.employee_id) FROM employees e2 WHERE e2.department_id = d.department_id) AS emp_count FROM departments d) t\nWHERE emp_count > 10;", "output": "SELECT d.department_id, SUM(e.salary) AS total_salary, COUNT(e.employee_id) AS emp_count\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.department_id\nGROUP BY d.department_id\nHAVING COUNT(e.employee_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = c.customer_id) AS orders_count, (SELECT SUM(o2.total) FROM orders o2 WHERE o2.customer_id = c.customer_id) AS total_spent FROM customers c) t\nWHERE total_spent > 5000;", "output": "SELECT c.customer_id, COUNT(o.order_id) AS orders_count, SUM(o.total) AS total_spent\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.lead_id = e.employee_id) AS projects_led, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE projects_led > 2;", "output": "SELECT e.employee_id, e.department_id, COUNT(p.project_id) AS projects_led, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN projects p ON p.lead_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id, e.department_id\nHAVING COUNT(p.project_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id) AS logins_count, (SELECT MAX(l2.login_time) FROM logins l2 WHERE l2.user_id = u.user_id) AS last_login FROM users u) t\nWHERE logins_count > 10;", "output": "SELECT u.user_id, COUNT(l.login_id) AS logins_count, MAX(l.login_time) AS last_login\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.login_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.product_id = p.product_id) AS reviews_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.product_id) AS avg_rating FROM products p) t\nWHERE reviews_count > 20;", "output": "SELECT p.product_id, COUNT(r.review_id) AS reviews_count, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.product_id\nGROUP BY p.product_id\nHAVING COUNT(r.review_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.group_id, (SELECT COUNT(m.member_id) FROM group_members m WHERE m.group_id = g.group_id) AS member_count, (SELECT MAX(p.post_date) FROM posts p WHERE p.group_id = g.group_id) AS last_post_date FROM groups g) t\nWHERE member_count > 5;", "output": "SELECT g.group_id, COUNT(m.member_id) AS member_count, MAX(p.post_date) AS last_post_date\nFROM groups g\nLEFT JOIN group_members m ON m.group_id = g.group_id\nLEFT JOIN posts p ON p.group_id = g.group_id\nGROUP BY g.group_id\nHAVING COUNT(m.member_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.article_id, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.article_id = a.article_id) AS comment_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.article_id = a.article_id) AS avg_rating FROM articles a) t\nWHERE comment_count > 50;", "output": "SELECT a.article_id, COUNT(c.comment_id) AS comment_count, AVG(r.rating) AS avg_rating\nFROM articles a\nLEFT JOIN comments c ON c.article_id = a.article_id\nLEFT JOIN ratings r ON r.article_id = a.article_id\nGROUP BY a.article_id\nHAVING COUNT(c.comment_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(a.attendee_id) FROM attendees a WHERE a.event_id = ev.event_id) AS attendees_count, (SELECT MAX(a2.registered_at) FROM attendees a2 WHERE a2.event_id = ev.event_id) AS last_registered FROM EVENTS ev) t\nWHERE attendees_count > 200;", "output": "SELECT ev.event_id, COUNT(a.attendee_id) AS attendees_count, MAX(a.registered_at) AS last_registered\nFROM EVENTS ev\nLEFT JOIN attendees a ON a.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(a.attendee_id) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shop_id, (SELECT SUM(s.amount) FROM sales s WHERE s.shop_id = sh.shop_id) AS total_sales, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.shop_id = sh.shop_id) AS return_count FROM shops sh) t\nWHERE total_sales > 10000;", "output": "SELECT sh.shop_id, SUM(s.amount) AS total_sales, COUNT(r.return_id) AS return_count\nFROM shops sh\nLEFT JOIN sales s ON s.shop_id = sh.shop_id\nLEFT JOIN RETURNS r ON r.shop_id = sh.shop_id\nGROUP BY sh.shop_id\nHAVING SUM(s.amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled_count, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled_count > 10;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled_count, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT l.library_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.library_id = l.library_id) AS book_count, (SELECT COUNT(m.member_id) FROM members m WHERE m.library_id = l.library_id) AS member_count FROM libraries l) t\nWHERE book_count > 1000;", "output": "SELECT l.library_id, COUNT(b.book_id) AS book_count, COUNT(m.member_id) AS member_count\nFROM libraries l\nLEFT JOIN books b ON b.library_id = l.library_id\nLEFT JOIN members m ON m.library_id = l.library_id\nGROUP BY l.library_id\nHAVING COUNT(b.book_id) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.player_id) FROM players p WHERE p.game_id = g.game_id) AS player_count, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE player_count > 10;", "output": "SELECT g.game_id, COUNT(p.player_id) AS player_count, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN players p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.player_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, o.customer_id, o.order_date, (SELECT COUNT(oi.item_id) FROM order_items oi WHERE oi.order_id = o.order_id) AS item_count, ROW_NUMBER() OVER (PARTITION BY o.customer_id ORDER BY o.order_date DESC) AS rn FROM orders o) t\nWHERE rn = 1 AND item_count > 5;", "output": "SELECT o.order_id, o.customer_id, o.order_date, COUNT(oi.item_id) AS item_count\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nWHERE o.order_id IN (SELECT order_id FROM (SELECT o2.order_id, ROW_NUMBER() OVER (PARTITION BY o2.customer_id ORDER BY o2.order_date DESC) AS rn FROM orders o2) x WHERE rn = 1)\nGROUP BY o.order_id, o.customer_id, o.order_date\nHAVING COUNT(oi.item_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary, RANK() OVER (PARTITION BY e.department_id ORDER BY (SELECT AVG(s2.salary) FROM salaries s2 WHERE s2.employee_id = e.employee_id) DESC) AS salary_rank FROM employees e) t\nWHERE salary_rank <= 3;", "output": "SELECT e.employee_id, e.department_id, AVG(s.salary) AS avg_salary, RANK() OVER (PARTITION BY e.department_id ORDER BY AVG(s.salary) DESC) AS salary_rank\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id, e.department_id\nHAVING RANK() OVER (PARTITION BY e.department_id ORDER BY AVG(s.salary) DESC) <= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS orders_count, DENSE_RANK() OVER (ORDER BY (SELECT COUNT(o2.order_id) FROM orders o2 WHERE o2.user_id = u.user_id) DESC) AS rnk FROM users u) t\nWHERE rnk <= 10;", "output": "SELECT u.user_id, COUNT(o.order_id) AS orders_count, DENSE_RANK() OVER (ORDER BY COUNT(o.order_id) DESC) AS rnk\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nGROUP BY u.user_id\nHAVING DENSE_RANK() OVER (ORDER BY COUNT(o.order_id) DESC) <= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, p.category_id, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.product_id) AS avg_rating, NTILE(4) OVER (ORDER BY (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.product_id) DESC) AS quartile FROM products p) x\nWHERE quartile = 1;", "output": "SELECT p.product_id, p.category_id, AVG(r.rating) AS avg_rating, NTILE(4) OVER (ORDER BY AVG(r.rating) DESC) AS quartile\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.product_id\nGROUP BY p.product_id, p.category_id\nHAVING NTILE(4) OVER (ORDER BY AVG(r.rating) DESC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.score) FROM grades g WHERE g.student_id = s.student_id) AS avg_score, ROW_NUMBER() OVER (ORDER BY (SELECT AVG(g2.score) FROM grades g2 WHERE g2.student_id = s.student_id) DESC) AS rn FROM students s) t\nWHERE rn <= 5;", "output": "SELECT s.student_id, AVG(g.score) AS avg_score, ROW_NUMBER() OVER (ORDER BY AVG(g.score) DESC) AS rn\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING ROW_NUMBER() OVER (ORDER BY AVG(g.score) DESC) <= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS total_spent, RANK() OVER (ORDER BY (SELECT SUM(o2.total) FROM orders o2 WHERE o2.customer_id = c.customer_id) DESC) AS spend_rank FROM customers c) t\nWHERE spend_rank <= 20;", "output": "SELECT c.customer_id, SUM(o.total) AS total_spent, RANK() OVER (ORDER BY SUM(o.total) DESC) AS spend_rank\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING RANK() OVER (ORDER BY SUM(o.total) DESC) <= 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT f.flight_id, (SELECT AVG(t.price) FROM tickets t WHERE t.flight_id = f.flight_id) AS avg_price, ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY (SELECT AVG(t2.price) FROM tickets t2 WHERE t2.flight_id = f.flight_id) ASC) AS rn FROM flights f) t\nWHERE rn = 1;", "output": "SELECT f.flight_id, AVG(t.price) AS avg_price, ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY AVG(t.price) ASC) AS rn\nFROM flights f\nLEFT JOIN tickets t ON t.flight_id = f.flight_id\nGROUP BY f.flight_id, f.airline_id\nHAVING ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY AVG(t.price) ASC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.artist_id, (SELECT COUNT(al.album_id) FROM albums al WHERE al.artist_id = a.artist_id) AS album_count, RANK() OVER (ORDER BY (SELECT COUNT(al2.album_id) FROM albums al2 WHERE al2.artist_id = a.artist_id) DESC) AS rnk FROM artists a) t\nWHERE rnk <= 3;", "output": "SELECT a.artist_id, COUNT(al.album_id) AS album_count, RANK() OVER (ORDER BY COUNT(al.album_id) DESC) AS rnk\nFROM artists a\nLEFT JOIN albums al ON al.artist_id = a.artist_id\nGROUP BY a.artist_id\nHAVING RANK() OVER (ORDER BY COUNT(al.album_id) DESC) <= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS ride_count, DENSE_RANK() OVER (ORDER BY (SELECT COUNT(r2.ride_id) FROM rides r2 WHERE r2.driver_id = d.driver_id) DESC) AS rnk FROM drivers d) t\nWHERE rnk <= 10;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS ride_count, DENSE_RANK() OVER (ORDER BY COUNT(r.ride_id) DESC) AS rnk\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING DENSE_RANK() OVER (ORDER BY COUNT(r.ride_id) DESC) <= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT AVG(b.price) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS avg_price, NTILE(5) OVER (ORDER BY (SELECT AVG(b2.price) FROM bookings b2 WHERE b2.hotel_id = h.hotel_id) DESC) AS quintile FROM hotels h) t\nWHERE quintile = 1;", "output": "SELECT h.hotel_id, AVG(b.price) AS avg_price, NTILE(5) OVER (ORDER BY AVG(b.price) DESC) AS quintile\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING NTILE(5) OVER (ORDER BY AVG(b.price) DESC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pr.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = pr.project_id AND t.status = 'done') AS done_tasks, (SELECT COUNT(t2.task_id) FROM tasks t2 WHERE t2.project_id = pr.project_id) AS total_tasks, RANK() OVER (ORDER BY (SELECT COUNT(t3.task_id) FROM tasks t3 WHERE t3.project_id = pr.project_id AND t3.status = 'done') DESC) AS completion_rank FROM projects pr) t\nWHERE done_tasks = total_tasks;", "output": "SELECT pr.project_id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS done_tasks, COUNT(t.task_id) AS total_tasks, RANK() OVER (ORDER BY COUNT(CASE WHEN t.status = 'done' THEN 1 END) DESC) AS completion_rank\nFROM projects pr\nLEFT JOIN tasks t ON t.project_id = pr.project_id\nGROUP BY pr.project_id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) = COUNT(t.task_id) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.class_id, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = c.class_id) AS avg_grade, ROW_NUMBER() OVER (PARTITION BY c.school_id ORDER BY (SELECT AVG(g2.grade) FROM grades g2 WHERE g2.class_id = c.class_id) DESC) AS rn FROM classes c) t\nWHERE rn <= 2;", "output": "SELECT c.class_id, AVG(g.grade) AS avg_grade, ROW_NUMBER() OVER (PARTITION BY c.school_id ORDER BY AVG(g.grade) DESC) AS rn\nFROM classes c\nLEFT JOIN grades g ON g.class_id = c.class_id\nGROUP BY c.class_id, c.school_id\nHAVING ROW_NUMBER() OVER (PARTITION BY c.school_id ORDER BY AVG(g.grade) DESC) <= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS post_count, RANK() OVER (ORDER BY (SELECT COUNT(p2.post_id) FROM posts p2 WHERE p2.user_id = u.user_id) DESC) AS rnk FROM users u) t\nWHERE rnk <= 50;", "output": "SELECT u.user_id, COUNT(p.post_id) AS post_count, RANK() OVER (ORDER BY COUNT(p.post_id) DESC) AS rnk\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING RANK() OVER (ORDER BY COUNT(p.post_id) DESC) <= 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT v.vehicle_id, (SELECT COUNT(m.maintenance_id) FROM maintenance m WHERE m.vehicle_id = v.vehicle_id) AS maintenance_count, ROW_NUMBER() OVER (ORDER BY (SELECT COUNT(m2.maintenance_id) FROM maintenance m2 WHERE m2.vehicle_id = v.vehicle_id) DESC) AS rn FROM vehicles v) t\nWHERE rn <= 5;", "output": "SELECT v.vehicle_id, COUNT(m.maintenance_id) AS maintenance_count, ROW_NUMBER() OVER (ORDER BY COUNT(m.maintenance_id) DESC) AS rn\nFROM vehicles v\nLEFT JOIN maintenance m ON m.vehicle_id = v.vehicle_id\nGROUP BY v.vehicle_id\nHAVING ROW_NUMBER() OVER (ORDER BY COUNT(m.maintenance_id) DESC) <= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT AVG(g.score) FROM grades g WHERE g.course_id = c.course_id) AS avg_score, NTILE(3) OVER (ORDER BY (SELECT AVG(g2.score) FROM grades g2 WHERE g2.course_id = c.course_id) DESC) AS tertile FROM courses c) t\nWHERE tertile = 1;", "output": "SELECT c.course_id, AVG(g.score) AS avg_score, NTILE(3) OVER (ORDER BY AVG(g.score) DESC) AS tertile\nFROM courses c\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING NTILE(3) OVER (ORDER BY AVG(g.score) DESC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.song_id, (SELECT AVG(r.rating) FROM ratings r WHERE r.song_id = s.song_id) AS avg_rating, ROW_NUMBER() OVER (PARTITION BY s.album_id ORDER BY (SELECT AVG(r2.rating) FROM ratings r2 WHERE r2.song_id = s.song_id) DESC) AS rn FROM songs s) t\nWHERE rn <= 3;", "output": "SELECT s.song_id, AVG(r.rating) AS avg_rating, ROW_NUMBER() OVER (PARTITION BY s.album_id ORDER BY AVG(r.rating) DESC) AS rn\nFROM songs s\nLEFT JOIN ratings r ON r.song_id = s.song_id\nGROUP BY s.song_id, s.album_id\nHAVING ROW_NUMBER() OVER (PARTITION BY s.album_id ORDER BY AVG(r.rating) DESC) <= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS book_count, DENSE_RANK() OVER (ORDER BY (SELECT COUNT(b2.book_id) FROM books b2 WHERE b2.author_id = a.author_id) DESC) AS rnk FROM authors a) t\nWHERE rnk <= 5;", "output": "SELECT a.author_id, COUNT(b.book_id) AS book_count, DENSE_RANK() OVER (ORDER BY COUNT(b.book_id) DESC) AS rnk\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nGROUP BY a.author_id\nHAVING DENSE_RANK() OVER (ORDER BY COUNT(b.book_id) DESC) <= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, o.customer_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS return_count, ROW_NUMBER() OVER (PARTITION BY o.customer_id ORDER BY o.order_date DESC) AS rn FROM orders o) t\nWHERE rn = 1 AND total_value > 500 AND return_count = 0;", "output": "SELECT o.order_id, o.customer_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS return_count\nFROM (SELECT order_id, customer_id, order_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date DESC) AS rn FROM orders) o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nWHERE o.rn = 1\nGROUP BY o.order_id, o.customer_id\nHAVING SUM(oi.price * oi.qty) > 500 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary, RANK() OVER (PARTITION BY e.department_id ORDER BY (SELECT AVG(s2.salary) FROM salaries s2 WHERE s2.employee_id = e.employee_id) DESC) AS salary_rank, (SELECT COUNT(p.project_id) FROM projects p WHERE p.lead_id = e.employee_id) AS projects_led FROM employees e) t\nWHERE salary_rank <= 3 AND projects_led > 2;", "output": "SELECT e.employee_id, e.department_id, AVG(s.salary) AS avg_salary, RANK() OVER (PARTITION BY e.department_id ORDER BY AVG(s.salary) DESC) AS salary_rank, COUNT(p.project_id) AS projects_led\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.lead_id = e.employee_id\nGROUP BY e.employee_id, e.department_id\nHAVING COUNT(p.project_id) > 2 AND RANK() OVER (PARTITION BY e.department_id ORDER BY AVG(s.salary) DESC) <= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS orders_count, DENSE_RANK() OVER (ORDER BY (SELECT COUNT(o2.order_id) FROM orders o2 WHERE o2.user_id = u.user_id) DESC) AS rnk, (SELECT MAX(p.post_date) FROM posts p WHERE p.user_id = u.user_id) AS last_post FROM users u) t\nWHERE rnk <= 20;", "output": "SELECT u.user_id, COUNT(o.order_id) AS orders_count, DENSE_RANK() OVER (ORDER BY COUNT(o.order_id) DESC) AS rnk, MAX(p.post_date) AS last_post\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nLEFT JOIN posts p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING DENSE_RANK() OVER (ORDER BY COUNT(o.order_id) DESC) <= 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.product_id) AS avg_rating, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.product_id = p.product_id) AS sales_count, NTILE(4) OVER (ORDER BY (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.product_id) DESC) AS quartile FROM products p) t\nWHERE quartile = 1 AND sales_count > 100;", "output": "SELECT p.product_id, AVG(r.rating) AS avg_rating, COUNT(s.sale_id) AS sales_count, NTILE(4) OVER (ORDER BY AVG(r.rating) DESC) AS quartile\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.product_id\nLEFT JOIN sales s ON s.product_id = p.product_id\nGROUP BY p.product_id\nHAVING COUNT(s.sale_id) > 100 AND NTILE(4) OVER (ORDER BY AVG(r.rating) DESC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.score) FROM grades g WHERE g.student_id = s.student_id) AS avg_score, (SELECT COUNT(e.exam_id) FROM exams e WHERE e.student_id = s.student_id) AS exam_count, ROW_NUMBER() OVER (ORDER BY (SELECT AVG(g2.score) FROM grades g2 WHERE g2.student_id = s.student_id) DESC) AS rn FROM students s) t\nWHERE rn <= 5 AND exam_count > 3;", "output": "SELECT s.student_id, AVG(g.score) AS avg_score, COUNT(e.exam_id) AS exam_count, ROW_NUMBER() OVER (ORDER BY AVG(g.score) DESC) AS rn\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nLEFT JOIN exams e ON e.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(e.exam_id) > 3 AND ROW_NUMBER() OVER (ORDER BY AVG(g.score) DESC) <= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS total_spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS review_count, RANK() OVER (ORDER BY (SELECT SUM(o2.total) FROM orders o2 WHERE o2.customer_id = c.customer_id) DESC) AS spend_rank FROM customers c) t\nWHERE spend_rank <= 10 AND review_count > 5;", "output": "SELECT c.customer_id, SUM(o.total) AS total_spent, COUNT(r.review_id) AS review_count, RANK() OVER (ORDER BY SUM(o.total) DESC) AS spend_rank\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING COUNT(r.review_id) > 5 AND RANK() OVER (ORDER BY SUM(o.total) DESC) <= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT f.flight_id, (SELECT AVG(t.price) FROM tickets t WHERE t.flight_id = f.flight_id) AS avg_price, (SELECT COUNT(t2.ticket_id) FROM tickets t2 WHERE t2.flight_id = f.flight_id AND t2.status = 'cancelled') AS cancelled_count, ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY (SELECT AVG(t3.price) FROM tickets t3 WHERE t3.flight_id = f.flight_id) ASC) AS rn FROM flights f) t\nWHERE rn = 1 AND cancelled_count < 5;", "output": "SELECT f.flight_id, AVG(t.price) AS avg_price, COUNT(CASE WHEN t.status = 'cancelled' THEN 1 END) AS cancelled_count, ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY AVG(t.price) ASC) AS rn\nFROM flights f\nLEFT JOIN tickets t ON t.flight_id = f.flight_id\nGROUP BY f.flight_id, f.airline_id\nHAVING COUNT(CASE WHEN t.status = 'cancelled' THEN 1 END) < 5 AND ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY AVG(t.price) ASC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.artist_id, (SELECT COUNT(al.album_id) FROM albums al WHERE al.artist_id = a.artist_id) AS album_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.artist_id = a.artist_id) AS avg_rating, RANK() OVER (ORDER BY (SELECT COUNT(al2.album_id) FROM albums al2 WHERE al2.artist_id = a.artist_id) DESC) AS rnk FROM artists a) t\nWHERE rnk <= 5;", "output": "SELECT a.artist_id, COUNT(al.album_id) AS album_count, AVG(r.rating) AS avg_rating, RANK() OVER (ORDER BY COUNT(al.album_id) DESC) AS rnk\nFROM artists a\nLEFT JOIN albums al ON al.artist_id = a.artist_id\nLEFT JOIN ratings r ON r.artist_id = a.artist_id\nGROUP BY a.artist_id\nHAVING RANK() OVER (ORDER BY COUNT(al.album_id) DESC) <= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS ride_count, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating, DENSE_RANK() OVER (ORDER BY (SELECT COUNT(r3.ride_id) FROM rides r3 WHERE r3.driver_id = d.driver_id) DESC) AS rnk FROM drivers d) t\nWHERE rnk <= 10 AND avg_rating > 4.5;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS ride_count, AVG(r.rating) AS avg_rating, DENSE_RANK() OVER (ORDER BY COUNT(r.ride_id) DESC) AS rnk\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING AVG(r.rating) > 4.5 AND DENSE_RANK() OVER (ORDER BY COUNT(r.ride_id) DESC) <= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT AVG(b.price) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS avg_price, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS review_count, NTILE(5) OVER (ORDER BY (SELECT AVG(b2.price) FROM bookings b2 WHERE b2.hotel_id = h.hotel_id) DESC) AS quintile FROM hotels h) t\nWHERE quintile = 1 AND review_count > 50;", "output": "SELECT h.hotel_id, AVG(b.price) AS avg_price, COUNT(r.review_id) AS review_count, NTILE(5) OVER (ORDER BY AVG(b.price) DESC) AS quintile\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(r.review_id) > 50 AND NTILE(5) OVER (ORDER BY AVG(b.price) DESC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pr.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = pr.project_id AND t.status = 'done') AS done_tasks, (SELECT COUNT(t2.task_id) FROM tasks t2 WHERE t2.project_id = pr.project_id) AS total_tasks, RANK() OVER (ORDER BY (SELECT COUNT(t3.task_id) FROM tasks t3 WHERE t3.project_id = pr.project_id AND t3.status = 'done') DESC) AS completion_rank, (SELECT MAX(m.member_id) FROM members m WHERE m.project_id = pr.project_id) AS last_member FROM projects pr) t\nWHERE done_tasks = total_tasks;", "output": "SELECT pr.project_id, COUNT(CASE WHEN t.status = 'done' THEN 1 END) AS done_tasks, COUNT(t.task_id) AS total_tasks, MAX(m.member_id) AS last_member, RANK() OVER (ORDER BY COUNT(CASE WHEN t.status = 'done' THEN 1 END) DESC) AS completion_rank\nFROM projects pr\nLEFT JOIN tasks t ON t.project_id = pr.project_id\nLEFT JOIN members m ON m.project_id = pr.project_id\nGROUP BY pr.project_id\nHAVING COUNT(CASE WHEN t.status = 'done' THEN 1 END) = COUNT(t.task_id) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.class_id, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = c.class_id) AS avg_grade, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = c.class_id) AS student_count, ROW_NUMBER() OVER (PARTITION BY c.school_id ORDER BY (SELECT AVG(g2.grade) FROM grades g2 WHERE g2.class_id = c.class_id) DESC) AS rn FROM classes c) t\nWHERE rn <= 3;", "output": "SELECT c.class_id, AVG(g.grade) AS avg_grade, COUNT(st.student_id) AS student_count, ROW_NUMBER() OVER (PARTITION BY c.school_id ORDER BY AVG(g.grade) DESC) AS rn\nFROM classes c\nLEFT JOIN grades g ON g.class_id = c.class_id\nLEFT JOIN students st ON st.class_id = c.class_id\nGROUP BY c.class_id, c.school_id\nHAVING ROW_NUMBER() OVER (PARTITION BY c.school_id ORDER BY AVG(g.grade) DESC) <= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS post_count, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comment_count, RANK() OVER (ORDER BY (SELECT COUNT(p2.post_id) FROM posts p2 WHERE p2.user_id = u.user_id) DESC) AS rnk FROM users u) t\nWHERE rnk <= 50 AND comment_count > 100;", "output": "SELECT u.user_id, COUNT(p.post_id) AS post_count, COUNT(c.comment_id) AS comment_count, RANK() OVER (ORDER BY COUNT(p.post_id) DESC) AS rnk\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(c.comment_id) > 100 AND RANK() OVER (ORDER BY COUNT(p.post_id) DESC) <= 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, o.customer_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS return_count, (SELECT AVG(p.rating) FROM products pr JOIN reviews p ON p.product_id = pr.product_id WHERE pr.product_id IN (SELECT oi2.product_id FROM order_items oi2 WHERE oi2.order_id = o.order_id)) AS avg_product_rating, ROW_NUMBER() OVER (PARTITION BY o.customer_id ORDER BY o.order_date DESC) AS rn FROM orders o) t\nWHERE rn = 1 AND total_value > 1000 AND return_count = 0 AND avg_product_rating > 4;", "output": "SELECT o.order_id, o.customer_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS return_count, AVG(p.rating) AS avg_product_rating\nFROM (SELECT order_id, customer_id, order_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date DESC) AS rn FROM orders) o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nLEFT JOIN reviews p ON p.product_id = oi.product_id\nWHERE o.rn = 1\nGROUP BY o.order_id, o.customer_id\nHAVING SUM(oi.price * oi.qty) > 1000 AND COUNT(r.return_id) = 0 AND AVG(p.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary, (SELECT COUNT(p.project_id) FROM projects p WHERE p.lead_id = e.employee_id) AS projects_led, RANK() OVER (PARTITION BY e.department_id ORDER BY (SELECT AVG(s2.salary) FROM salaries s2 WHERE s2.employee_id = e.employee_id) DESC) AS salary_rank, (SELECT COUNT(c.cert_id) FROM certifications c WHERE c.employee_id = e.employee_id) AS certs FROM employees e) t\nWHERE salary_rank <= 3 AND projects_led > 2 AND certs >= 1;", "output": "SELECT e.employee_id, e.department_id, AVG(s.salary) AS avg_salary, COUNT(p.project_id) AS projects_led, COUNT(c.cert_id) AS certs, RANK() OVER (PARTITION BY e.department_id ORDER BY AVG(s.salary) DESC) AS salary_rank\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.lead_id = e.employee_id\nLEFT JOIN certifications c ON c.employee_id = e.employee_id\nGROUP BY e.employee_id, e.department_id\nHAVING COUNT(p.project_id) > 2 AND COUNT(c.cert_id) >= 1 AND RANK() OVER (PARTITION BY e.department_id ORDER BY AVG(s.salary) DESC) <= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS orders_count, (SELECT MAX(o2.order_date) FROM orders o2 WHERE o2.user_id = u.user_id) AS last_order, (SELECT SUM(p.amount) FROM payments p WHERE p.user_id = u.user_id) AS total_paid, DENSE_RANK() OVER (ORDER BY (SELECT SUM(o3.total) FROM orders o3 WHERE o3.user_id = u.user_id) DESC) AS rnk FROM users u) t\nWHERE rnk <= 10 AND total_paid > 500;", "output": "SELECT u.user_id, COUNT(o.order_id) AS orders_count, MAX(o.order_date) AS last_order, SUM(p.amount) AS total_paid, DENSE_RANK() OVER (ORDER BY SUM(o.total) DESC) AS rnk\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nLEFT JOIN payments p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING SUM(p.amount) > 500 AND DENSE_RANK() OVER (ORDER BY SUM(o.total) DESC) <= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, p.category_id, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.product_id) AS avg_rating, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.product_id = p.product_id) AS sales_count, NTILE(4) OVER (ORDER BY (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.product_id) DESC) AS quartile, (SELECT SUM(inv.stock) FROM inventory inv WHERE inv.product_id = p.product_id) AS total_stock FROM products p) t\nWHERE quartile = 1 AND sales_count > 100 AND total_stock > 50;", "output": "SELECT p.product_id, p.category_id, AVG(r.rating) AS avg_rating, COUNT(s.sale_id) AS sales_count, SUM(inv.stock) AS total_stock, NTILE(4) OVER (ORDER BY AVG(r.rating) DESC) AS quartile\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.product_id\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN inventory inv ON inv.product_id = p.product_id\nGROUP BY p.product_id, p.category_id\nHAVING COUNT(s.sale_id) > 100 AND SUM(inv.stock) > 50 AND NTILE(4) OVER (ORDER BY AVG(r.rating) DESC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.score) FROM grades g WHERE g.student_id = s.student_id) AS avg_score, (SELECT COUNT(e.exam_id) FROM exams e WHERE e.student_id = s.student_id) AS exam_count, (SELECT SUM(a.attendance) FROM attendance a WHERE a.student_id = s.student_id) AS total_attendance, ROW_NUMBER() OVER (ORDER BY (SELECT AVG(g2.score) FROM grades g2 WHERE g2.student_id = s.student_id) DESC) AS rn FROM students s) t\nWHERE rn <= 5 AND exam_count > 3 AND total_attendance >= 90;", "output": "SELECT s.student_id, AVG(g.score) AS avg_score, COUNT(e.exam_id) AS exam_count, SUM(a.attendance) AS total_attendance, ROW_NUMBER() OVER (ORDER BY AVG(g.score) DESC) AS rn\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nLEFT JOIN exams e ON e.student_id = s.student_id\nLEFT JOIN attendance a ON a.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(e.exam_id) > 3 AND SUM(a.attendance) >= 90 AND ROW_NUMBER() OVER (ORDER BY AVG(g.score) DESC) <= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS total_spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS review_count, (SELECT AVG(f.feedback_score) FROM feedback f WHERE f.customer_id = c.customer_id) AS avg_feedback, RANK() OVER (ORDER BY (SELECT SUM(o2.total) FROM orders o2 WHERE o2.customer_id = c.customer_id) DESC) AS spend_rank FROM customers c) t\nWHERE spend_rank <= 20 AND avg_feedback > 3;", "output": "SELECT c.customer_id, SUM(o.total) AS total_spent, COUNT(r.review_id) AS review_count, AVG(f.feedback_score) AS avg_feedback, RANK() OVER (ORDER BY SUM(o.total) DESC) AS spend_rank\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nLEFT JOIN feedback f ON f.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING AVG(f.feedback_score) > 3 AND RANK() OVER (ORDER BY SUM(o.total) DESC) <= 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT f.flight_id, (SELECT AVG(t.price) FROM tickets t WHERE t.flight_id = f.flight_id) AS avg_price, (SELECT COUNT(t2.ticket_id) FROM tickets t2 WHERE t2.flight_id = f.flight_id AND t2.status = 'cancelled') AS cancelled_count, (SELECT SUM(b.baggage_weight) FROM baggage b WHERE b.flight_id = f.flight_id) AS total_baggage, ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY (SELECT AVG(t3.price) FROM tickets t3 WHERE t3.flight_id = f.flight_id) ASC) AS rn FROM flights f) t\nWHERE rn = 1 AND cancelled_count < 5 AND total_baggage < 10000;", "output": "SELECT f.flight_id, AVG(t.price) AS avg_price, COUNT(CASE WHEN t.status = 'cancelled' THEN 1 END) AS cancelled_count, SUM(b.baggage_weight) AS total_baggage, ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY AVG(t.price) ASC) AS rn\nFROM flights f\nLEFT JOIN tickets t ON t.flight_id = f.flight_id\nLEFT JOIN baggage b ON b.flight_id = f.flight_id\nGROUP BY f.flight_id, f.airline_id\nHAVING COUNT(CASE WHEN t.status = 'cancelled' THEN 1 END) < 5 AND SUM(b.baggage_weight) < 10000 AND ROW_NUMBER() OVER (PARTITION BY f.airline_id ORDER BY AVG(t.price) ASC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.artist_id, (SELECT COUNT(al.album_id) FROM albums al WHERE al.artist_id = a.artist_id) AS album_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.artist_id = a.artist_id) AS avg_rating, (SELECT COUNT(s.song_id) FROM songs s WHERE s.artist_id = a.artist_id) AS song_count, RANK() OVER (ORDER BY (SELECT COUNT(al2.album_id) FROM albums al2 WHERE al2.artist_id = a.artist_id) DESC) AS rnk FROM artists a) t\nWHERE rnk <= 5 AND song_count > 50;", "output": "SELECT a.artist_id, COUNT(al.album_id) AS album_count, AVG(r.rating) AS avg_rating, COUNT(s.song_id) AS song_count, RANK() OVER (ORDER BY COUNT(al.album_id) DESC) AS rnk\nFROM artists a\nLEFT JOIN albums al ON al.artist_id = a.artist_id\nLEFT JOIN ratings r ON r.artist_id = a.artist_id\nLEFT JOIN songs s ON s.artist_id = a.artist_id\nGROUP BY a.artist_id\nHAVING COUNT(s.song_id) > 50 AND RANK() OVER (ORDER BY COUNT(al.album_id) DESC) <= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS ride_count, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.driver_id = d.driver_id) AS total_earnings, DENSE_RANK() OVER (ORDER BY (SELECT COUNT(r3.ride_id) FROM rides r3 WHERE r3.driver_id = d.driver_id) DESC) AS rnk FROM drivers d) t\nWHERE rnk <= 10 AND avg_rating > 4.5 AND total_earnings > 10000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS ride_count, AVG(r.rating) AS avg_rating, SUM(p.payment_amount) AS total_earnings, DENSE_RANK() OVER (ORDER BY COUNT(r.ride_id) DESC) AS rnk\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING AVG(r.rating) > 4.5 AND SUM(p.payment_amount) > 10000 AND DENSE_RANK() OVER (ORDER BY COUNT(r.ride_id) DESC) <= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT AVG(b.price) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS avg_price, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS review_count, (SELECT SUM(s.staff_id) FROM staff s WHERE s.hotel_id = h.hotel_id) AS staff_count, NTILE(5) OVER (ORDER BY (SELECT AVG(b2.price) FROM bookings b2 WHERE b2.hotel_id = h.hotel_id) DESC) AS quintile FROM hotels h) t\nWHERE quintile = 1 AND review_count > 50 AND staff_count > 100;", "output": "SELECT h.hotel_id, AVG(b.price) AS avg_price, COUNT(r.review_id) AS review_count, COUNT(s.staff_id) AS staff_count, NTILE(5) OVER (ORDER BY AVG(b.price) DESC) AS quintile\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nLEFT JOIN staff s ON s.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(r.review_id) > 50 AND COUNT(s.staff_id) > 100 AND NTILE(5) OVER (ORDER BY AVG(b.price) DESC) = 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary, RANK() OVER (PARTITION BY e.department_id ORDER BY (SELECT AVG(s2.salary) FROM salaries s2 WHERE s2.employee_id = e.employee_id) DESC) AS rnk FROM employees e) t\nWHERE rnk <= 3 AND avg_salary IS NOT NULL;", "output": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, AVG(s.salary) AS avg_salary, RANK() OVER (PARTITION BY e.department_id ORDER BY AVG(s.salary) DESC) AS rnk FROM employees e LEFT JOIN salaries s ON s.employee_id = e.employee_id GROUP BY e.employee_id, e.department_id) q\nWHERE q.rnk <= 3 AND q.avg_salary IS NOT NULL;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.user_id, (SELECT MAX(s2.start_date) FROM subscriptions s2 WHERE s2.user_id = s.user_id) AS last_start, (SELECT COUNT(e.event_id) FROM subscription_events e WHERE e.user_id = s.user_id AND e.event_type = 'renewal') AS renewals, ROW_NUMBER() OVER (PARTITION BY s.user_id ORDER BY s.created_at DESC) AS rn FROM subscriptions s) t\nWHERE rn = 1 AND renewals >= 2;", "output": "SELECT u.user_id, (SELECT MAX(s2.start_date) FROM subscriptions s2 WHERE s2.user_id = u.user_id) AS last_start, COUNT(CASE WHEN e.event_type = 'renewal' THEN 1 END) AS renewals\nFROM (SELECT DISTINCT user_id FROM subscriptions) u\nLEFT JOIN subscription_events e ON e.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(CASE WHEN e.event_type = 'renewal' THEN 1 END) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS pkg_cnt, (SELECT SUM(p2.weight_kg) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) x\nWHERE pkg_cnt > 5 AND total_weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS pkg_cnt, SUM(p.weight_kg) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight_kg) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pr.product_id, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = pr.product_id AND rv.rating = 5) AS five_star, (SELECT SUM(oi.quantity) FROM order_items oi WHERE oi.product_id = pr.product_id) AS units FROM products pr) t\nWHERE five_star >= 10 AND units > 500;", "output": "SELECT pr.product_id, COUNT(CASE WHEN rv.rating = 5 THEN 1 END) AS five_star, SUM(oi.quantity) AS units\nFROM products pr\nLEFT JOIN reviews rv ON rv.product_id = pr.product_id\nLEFT JOIN order_items oi ON oi.product_id = pr.product_id\nGROUP BY pr.product_id\nHAVING COUNT(CASE WHEN rv.rating = 5 THEN 1 END) >= 10 AND SUM(oi.quantity) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT DISTINCT u.user_id\nFROM users u\nWHERE u.user_id IN (SELECT f.followee_id FROM follows f) AND EXISTS (SELECT 1 FROM posts p WHERE p.user_id = u.user_id AND p.created_at >= '2025-01-01');", "output": "SELECT DISTINCT u.user_id\nFROM users u\nJOIN follows f ON f.followee_id = u.user_id\nJOIN posts p ON p.user_id = u.user_id\nWHERE p.created_at >= '2025-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS last_value, (SELECT MAX(r2.recorded_at) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS last_time FROM sensors sn) t\nWHERE last_value > 50;", "output": "SELECT sn.sensor_id, MAX(r.value) AS last_value, MAX(r.recorded_at) AS last_time\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.tx_type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.tx_type = 'debit') AS debits\nFROM accounts a\nWHERE credits - debits > 0;", "output": "SELECT a.account_id, SUM(CASE WHEN t.tx_type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.tx_type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.tx_type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.tx_type = 'debit' THEN t.amount END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(*) FROM followers f WHERE f.followee_id = u.user_id) AS followers_cnt, (SELECT COUNT(*) FROM followers f2 WHERE f2.follower_id = u.user_id) AS following_cnt FROM users u) t\nWHERE followers_cnt >= 1000 AND following_cnt >= 100;", "output": "SELECT u.user_id, COUNT(f1.followee_id) AS followers_cnt, COUNT(f2.follower_id) AS following_cnt\nFROM users u\nLEFT JOIN followers f1 ON f1.followee_id = u.user_id\nLEFT JOIN followers f2 ON f2.follower_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(f1.followee_id) >= 1000 AND COUNT(f2.follower_id) >= 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.session_id, (SELECT COUNT(l.id) FROM logs l WHERE l.session_id = s.session_id AND l.level = 'ERROR') AS err_cnt, (SELECT COUNT(l2.id) FROM logs l2 WHERE l2.session_id = s.session_id AND l2.level = 'WARN') AS warn_cnt FROM sessions s) t\nWHERE err_cnt > 0 OR warn_cnt > 10;", "output": "SELECT s.session_id, COUNT(CASE WHEN l.level = 'ERROR' THEN 1 END) AS err_cnt, COUNT(CASE WHEN l.level = 'WARN' THEN 1 END) AS warn_cnt\nFROM sessions s\nLEFT JOIN logs l ON l.session_id = s.session_id\nGROUP BY s.session_id\nHAVING COUNT(CASE WHEN l.level = 'ERROR' THEN 1 END) > 0 OR COUNT(CASE WHEN l.level = 'WARN' THEN 1 END) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.article_id, a.category_id, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.article_id = a.article_id) AS cmts, ROW_NUMBER() OVER (PARTITION BY a.category_id ORDER BY (SELECT COUNT(c2.comment_id) FROM comments c2 WHERE c2.article_id = a.article_id) DESC) AS rn FROM articles a) z\nWHERE rn <= 3;", "output": "SELECT *\nFROM (SELECT a.article_id, a.category_id, COUNT(c.comment_id) AS cmts, ROW_NUMBER() OVER (PARTITION BY a.category_id ORDER BY COUNT(c.comment_id) DESC) AS rn FROM articles a LEFT JOIN comments c ON c.article_id = a.article_id GROUP BY a.article_id, a.category_id) q\nWHERE q.rn <= 3;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.patient_id, (SELECT COUNT(appt.id) FROM appointments appt WHERE appt.patient_id = p.patient_id) AS visit_cnt, (SELECT MAX(appt2.visit_date) FROM appointments appt2 WHERE appt2.patient_id = p.patient_id) AS last_visit FROM patients p) t\nWHERE visit_cnt > 2;", "output": "SELECT p.patient_id, COUNT(a.id) AS visit_cnt, MAX(a.visit_date) AS last_visit\nFROM patients p\nLEFT JOIN appointments a ON a.patient_id = p.patient_id\nGROUP BY p.patient_id\nHAVING COUNT(a.id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) x\nWHERE enrolled >= 30 AND avg_grade >= 70;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) >= 30 AND AVG(g.grade) >= 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM warehouses ;", "output": "SELECT *\nFROM warehouses ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT order_id, total\nFROM orders\nWHERE status = 'paid';", "output": "SELECT order_id, total\nFROM orders\nWHERE status = 'paid';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE event_date >= '2025-01-01';", "output": "SELECT *\nFROM EVENTS\nWHERE event_date >= '2025-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.service_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.service_id = s.service_id AND t.priority = 'high') AS high_tickets, (SELECT COUNT(t2.ticket_id) FROM tickets t2 WHERE t2.service_id = s.service_id AND t2.status = 'open') AS open_tickets FROM services s) t\nWHERE high_tickets > 10 OR open_tickets > 50;", "output": "SELECT s.service_id, COUNT(CASE WHEN t.priority = 'high' THEN 1 END) AS high_tickets, COUNT(CASE WHEN t.status = 'open' THEN 1 END) AS open_tickets\nFROM services s\nLEFT JOIN tickets t ON t.service_id = s.service_id\nGROUP BY s.service_id\nHAVING COUNT(CASE WHEN t.priority = 'high' THEN 1 END) > 10 OR COUNT(CASE WHEN t.status = 'open' THEN 1 END) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT inv.invoice_id, (SELECT SUM(il.line_total) FROM invoice_lines il WHERE il.invoice_id = inv.invoice_id) AS total_lines, (SELECT SUM(p.amount) FROM payments p WHERE p.invoice_id = inv.invoice_id) AS total_paid FROM invoices inv) t\nWHERE total_lines - total_paid > 0;", "output": "SELECT inv.invoice_id, SUM(il.line_total) AS total_lines, COALESCE(SUM(p.amount),0) AS total_paid\nFROM invoices inv\nLEFT JOIN invoice_lines il ON il.invoice_id = inv.invoice_id\nLEFT JOIN payments p ON p.invoice_id = inv.invoice_id\nGROUP BY inv.invoice_id\nHAVING SUM(il.line_total) - COALESCE(SUM(p.amount),0) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM tasks tk\nWHERE tk.assignee_id IN (SELECT u.user_id FROM users u WHERE u.active = TRUE);", "output": "SELECT tk.*\nFROM tasks tk\nJOIN users u ON u.user_id = tk.assignee_id AND u.active = TRUE ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches_played, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches_played > 50 AND avg_score > 20;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches_played, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 50 AND AVG(sc.score) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrow_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrow_count > 10 AND avg_rating >= 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrow_count, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 10 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS rest_count, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) x\nWHERE rest_count > 100 AND avg_rating > 3;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS rest_count, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 100 AND AVG(rv.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS play_count, (SELECT SUM(s.score) FROM scores s WHERE s.game_id = g.game_id) AS total_score FROM games g) t\nWHERE play_count > 5 AND total_score > 100;", "output": "SELECT g.game_id, COUNT(p.play_id) AS play_count, SUM(s.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores s ON s.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 5 AND SUM(s.score) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS book_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS avg_rating FROM authors a) y\nWHERE book_count >= 3 AND avg_rating >= 4;", "output": "SELECT a.author_id, COUNT(b.book_id) AS book_count, AVG(r.rating) AS avg_rating\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) >= 3 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(emp.employee_id) FROM employees emp WHERE emp.company_id = co.company_id) AS emp_count, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS total_salary FROM companies co) t\nWHERE emp_count > 100 AND total_salary > 1000000;", "output": "SELECT co.company_id, COUNT(emp.employee_id) AS emp_count, SUM(s.salary) AS total_salary\nFROM companies co\nLEFT JOIN employees emp ON emp.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(emp.employee_id) > 100 AND SUM(s.salary) > 1000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sale_count, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS total_sales FROM stores st) t\nWHERE sale_count > 200 AND total_sales > 50000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sale_count, SUM(s.amount) AS total_sales\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 200 AND SUM(s.amount) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts_count, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comments_count, RANK() OVER (ORDER BY (SELECT COUNT(p2.post_id) FROM posts p2 WHERE p2.user_id = u.user_id) DESC) AS rnk FROM users u) t\nWHERE rnk <= 10 AND comments_count > 50;", "output": "SELECT u.user_id, COUNT(p.post_id) AS posts_count, COUNT(c.comment_id) AS comments_count, RANK() OVER (ORDER BY COUNT(p.post_id) DESC) AS rnk\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(c.comment_id) > 50 AND RANK() OVER (ORDER BY COUNT(p.post_id) DESC) <= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, o.customer_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS return_count FROM orders o) t\nWHERE total_value > 500 AND return_count = 0;", "output": "SELECT o.order_id, o.customer_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS return_count\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id, o.customer_id\nHAVING SUM(oi.price * oi.qty) > 500 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, e.department_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE avg_salary > 60000;", "output": "SELECT e.employee_id, e.department_id, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id, e.department_id\nHAVING AVG(s.salary) > 60000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = c.customer_id) AS order_count, (SELECT SUM(o2.total) FROM orders o2 WHERE o2.customer_id = c.customer_id) AS total_spent FROM customers c) t\nWHERE order_count > 5 AND total_spent > 2000;", "output": "SELECT c.customer_id, COUNT(o.order_id) AS order_count, SUM(o.total) AS total_spent\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING COUNT(o.order_id) > 5 AND SUM(o.total) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.product_id = p.product_id) AS review_count, (SELECT AVG(r2.rating) FROM reviews r2 WHERE r2.product_id = p.product_id) AS avg_rating FROM products p) t\nWHERE review_count > 20 AND avg_rating > 4;", "output": "SELECT p.product_id, COUNT(r.review_id) AS review_count, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN reviews r ON r.product_id = p.product_id\nGROUP BY p.product_id\nHAVING COUNT(r.review_id) > 20 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade, (SELECT COUNT(e.exam_id) FROM exams e WHERE e.student_id = s.student_id) AS exam_count FROM students s) t\nWHERE avg_grade > 80 AND exam_count >= 3;", "output": "SELECT s.student_id, AVG(g.grade) AS avg_grade, COUNT(e.exam_id) AS exam_count\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nLEFT JOIN exams e ON e.student_id = s.student_id\nGROUP BY s.student_id\nHAVING AVG(g.grade) > 80 AND COUNT(e.exam_id) >= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS book_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS avg_rating FROM authors a) t\nWHERE book_count > 5 AND avg_rating > 3;", "output": "SELECT a.author_id, COUNT(b.book_id) AS book_count, AVG(r.rating) AS avg_rating\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 5 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM warehouses ;", "output": "SELECT *\nFROM warehouses ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM orders\nWHERE order_date BETWEEN '2025-01-01' AND '2025-12-31';", "output": "SELECT *\nFROM orders\nWHERE order_date BETWEEN '2025-01-01' AND '2025-12-31';"}
{"instruction": "Optimize the SQL query", "input": "SELECT order_id, total\nFROM orders\nWHERE status = 'paid';", "output": "SELECT order_id, total\nFROM orders\nWHERE status = 'paid';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM EVENTS\nWHERE event_date >= '2025-01-01';", "output": "SELECT *\nFROM EVENTS\nWHERE event_date >= '2025-01-01';"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS booking_count, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE booking_count > 200 AND avg_rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS booking_count, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 200 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS ride_count, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE ride_count > 100 AND avg_rating >= 4.5;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS ride_count, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 100 AND AVG(r.rating) >= 4.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS rest_count, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE rest_count > 500 AND avg_rating > 3;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS rest_count, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 500 AND AVG(rv.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS play_count, (SELECT SUM(s.score) FROM scores s WHERE s.game_id = g.game_id) AS total_score FROM games g) t\nWHERE play_count > 10 AND total_score > 200;", "output": "SELECT g.game_id, COUNT(p.play_id) AS play_count, SUM(s.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores s ON s.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 AND SUM(s.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS emp_count, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS total_salary FROM companies co) t\nWHERE emp_count > 500 AND total_salary > 5000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS emp_count, SUM(s.salary) AS total_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 500 AND SUM(s.salary) > 5000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sale_count, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS total_sales FROM stores st) t\nWHERE sale_count > 1000 AND total_sales > 100000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sale_count, SUM(s.amount) AS total_sales\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 1000 AND SUM(s.amount) > 100000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches_played, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches_played > 30 AND avg_score > 25;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches_played, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 30 AND AVG(sc.score) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrow_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrow_count > 20 AND avg_rating > 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrow_count, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 20 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.user_id = u.user_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.user_id = u.user_id AND t2.type = 'debit') AS debits FROM users u) t\nWHERE credits - debits > 100;", "output": "SELECT u.user_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM users u\nLEFT JOIN transactions t ON t.user_id = u.user_id\nGROUP BY u.user_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.type = 'debit' THEN t.amount END) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.department_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.department_id = d.department_id) AS emp_count, (SELECT AVG(s.salary) FROM salaries s WHERE s.department_id = d.department_id) AS avg_salary FROM departments d) t\nWHERE emp_count > 20 AND avg_salary > 70000;", "output": "SELECT d.department_id, COUNT(e.employee_id) AS emp_count, AVG(s.salary) AS avg_salary\nFROM departments d\nLEFT JOIN employees e ON e.department_id = d.department_id\nLEFT JOIN salaries s ON s.department_id = d.department_id\nGROUP BY d.department_id\nHAVING COUNT(e.employee_id) > 20 AND AVG(s.salary) > 70000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT MAX(t.date) FROM transactions t WHERE t.account_id = a.account_id) AS last_tx, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id) AS total_amount FROM accounts a) t\nWHERE total_amount > 1000;", "output": "SELECT a.account_id, MAX(t.date) AS last_tx, SUM(t.amount) AS total_amount\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(t.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pr.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = pr.project_id) AS task_count, (SELECT SUM(t2.hours) FROM tasks t2 WHERE t2.project_id = pr.project_id) AS total_hours FROM projects pr) t\nWHERE task_count > 10 AND total_hours > 100;", "output": "SELECT pr.project_id, COUNT(t.task_id) AS task_count, SUM(t.hours) AS total_hours\nFROM projects pr\nLEFT JOIN tasks t ON t.project_id = pr.project_id\nGROUP BY pr.project_id\nHAVING COUNT(t.task_id) > 10 AND SUM(t.hours) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS student_count, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE student_count > 20 AND avg_grade >= 75;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS student_count, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 20 AND AVG(g.grade) >= 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id) AS login_count, (SELECT MAX(l2.login_time) FROM logins l2 WHERE l2.user_id = u.user_id) AS last_login FROM users u) t\nWHERE login_count > 5;", "output": "SELECT u.user_id, COUNT(l.login_id) AS login_count, MAX(l.login_time) AS last_login\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.login_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS total_sales, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.product_id) AS avg_rating FROM products p) t\nWHERE total_sales > 1000 AND avg_rating > 4;", "output": "SELECT p.product_id, SUM(s.amount) AS total_sales, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews r ON r.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 1000 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = c.customer_id) AS order_count FROM customers c) t\nWHERE order_count > 3;", "output": "SELECT c.customer_id, COUNT(o.order_id) AS order_count\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING COUNT(o.order_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE avg_salary > 50000;", "output": "SELECT e.employee_id, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exam_count FROM students s) t\nWHERE avg_grade >= 80 AND exam_count >= 2;", "output": "SELECT s.student_id, AVG(g.grade) AS avg_grade, COUNT(ex.exam_id) AS exam_count\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nGROUP BY s.student_id\nHAVING AVG(g.grade) >= 80 AND COUNT(ex.exam_id) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS booking_count, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE booking_count > 100 AND avg_rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS booking_count, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 100 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS ride_count, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE ride_count > 50 AND avg_rating > 4.2;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS ride_count, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 50 AND AVG(r.rating) > 4.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS rest_count FROM cities c) t\nWHERE rest_count > 200;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS rest_count\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS play_count FROM games g) t\nWHERE play_count > 10;", "output": "SELECT g.game_id, COUNT(p.play_id) AS play_count\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS emp_count FROM companies co) t\nWHERE emp_count > 100;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS emp_count\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT SUM(s.amount) FROM sales s WHERE s.store_id = st.store_id) AS total_sales FROM stores st) t\nWHERE total_sales > 10000;", "output": "SELECT st.store_id, SUM(s.amount) AS total_sales\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING SUM(s.amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches_played FROM players pl) t\nWHERE matches_played > 20;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches_played\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrow_count FROM books b) t\nWHERE borrow_count > 5;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrow_count\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS student_count FROM classes cl) t\nWHERE student_count > 25;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS student_count\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pr.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = pr.project_id) AS task_count FROM projects pr) t\nWHERE task_count > 8;", "output": "SELECT pr.project_id, COUNT(t.task_id) AS task_count\nFROM projects pr\nLEFT JOIN tasks t ON t.project_id = pr.project_id\nGROUP BY pr.project_id\nHAVING COUNT(t.task_id) > 8 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id) AS total_amount FROM accounts a) t\nWHERE total_amount > 1000;", "output": "SELECT a.account_id, SUM(t.amount) AS total_amount\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(t.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.patient_id, (SELECT COUNT(appt.appointment_id) FROM appointments appt WHERE appt.patient_id = p.patient_id) AS appointment_count FROM patients p) t\nWHERE appointment_count > 2;", "output": "SELECT p.patient_id, COUNT(appt.appointment_id) AS appointment_count\nFROM patients p\nLEFT JOIN appointments appt ON appt.patient_id = p.patient_id\nGROUP BY p.patient_id\nHAVING COUNT(appt.appointment_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS ticket_count FROM EVENTS ev) t\nWHERE ticket_count > 50;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS ticket_count\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.supplier_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.supplier_id = s.supplier_id) AS product_count FROM suppliers s) t\nWHERE product_count > 10;", "output": "SELECT s.supplier_id, COUNT(p.product_id) AS product_count\nFROM suppliers s\nLEFT JOIN products p ON p.supplier_id = s.supplier_id\nGROUP BY s.supplier_id\nHAVING COUNT(p.product_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS order_count, (SELECT SUM(p.amount) FROM payments p WHERE p.user_id = u.user_id) AS total_paid FROM users u) t\nWHERE order_count > 5 AND total_paid > 500;", "output": "SELECT u.user_id, COUNT(o.order_id) AS order_count, SUM(p.amount) AS total_paid\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nLEFT JOIN payments p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(o.order_id) > 5 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS project_count FROM employees e) t\nWHERE avg_salary > 60000 AND project_count >= 2;", "output": "SELECT e.employee_id, AVG(s.salary) AS avg_salary, COUNT(p.project_id) AS project_count\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 60000 AND COUNT(p.project_id) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exam_count, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exam_count > 3 AND avg_grade >= 75;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exam_count, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 3 AND AVG(g.grade) >= 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS booking_count, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating, (SELECT SUM(s.staff_id) FROM staff s WHERE s.hotel_id = h.hotel_id) AS staff_count FROM hotels h) t\nWHERE booking_count > 100 AND avg_rating > 4 AND staff_count > 50;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS booking_count, AVG(r.rating) AS avg_rating, COUNT(s.staff_id) AS staff_count\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nLEFT JOIN staff s ON s.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 100 AND AVG(r.rating) > 4 AND COUNT(s.staff_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS ride_count, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS total_earned FROM drivers d) t\nWHERE ride_count > 50 AND avg_rating >= 4.5 AND total_earned > 5000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS ride_count, AVG(r.rating) AS avg_rating, SUM(p.amount) AS total_earned\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 50 AND AVG(r.rating) >= 4.5 AND SUM(p.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS total_spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS review_count FROM customers c) t\nWHERE total_spent > 1000 AND review_count >= 5;", "output": "SELECT c.customer_id, SUM(o.total) AS total_spent, COUNT(r.review_id) AS review_count\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 1000 AND COUNT(r.review_id) >= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS total_sales, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = p.product_id) AS review_count FROM products p) t\nWHERE total_sales > 500 AND review_count >= 10;", "output": "SELECT p.product_id, SUM(s.amount) AS total_sales, COUNT(rv.review_id) AS review_count\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 500 AND COUNT(rv.review_id) >= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches_played, (SELECT SUM(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS total_score FROM players pl) t\nWHERE matches_played > 20 AND total_score > 200;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches_played, SUM(sc.score) AS total_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND SUM(sc.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrow_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrow_count > 5 AND avg_rating >= 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrow_count, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 5 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS student_count, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE student_count > 20 AND avg_grade >= 70;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS student_count, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 20 AND AVG(g.grade) >= 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS emp_count, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS total_salary FROM companies co) t\nWHERE emp_count > 100 AND total_salary > 1000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS emp_count, SUM(s.salary) AS total_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 AND SUM(s.salary) > 1000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sale_count, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS total_sales FROM stores st) t\nWHERE sale_count > 200 AND total_sales > 5000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sale_count, SUM(s.amount) AS total_sales\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 200 AND SUM(s.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.supplier_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.supplier_id = s.supplier_id) AS product_count FROM suppliers s) t\nWHERE product_count > 15;", "output": "SELECT s.supplier_id, COUNT(p.product_id) AS product_count\nFROM suppliers s\nLEFT JOIN products p ON p.supplier_id = s.supplier_id\nGROUP BY s.supplier_id\nHAVING COUNT(p.product_id) > 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS ticket_count, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE ticket_count > 50 AND total_revenue > 10000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS ticket_count, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits - debits > 0;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.type = 'debit' THEN t.amount END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 100 AND avg_val > 50;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 100 AND AVG(r.value) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS book_count, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE book_count > 2 AND rating_sum > 10;", "output": "SELECT a.author_id, COUNT(b.book_id) AS book_count, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 2 AND SUM(r.rating) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrollment_count, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrollment_count > 30 AND avg_grade >= 65;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrollment_count, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 30 AND AVG(g.grade) >= 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS pkg_count, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE pkg_count > 5 AND total_weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS pkg_count, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(m.message_id) FROM messages m WHERE m.user_id = u.user_id) AS msg_count, (SELECT MAX(m2.sent_at) FROM messages m2 WHERE m2.user_id = u.user_id) AS last_msg FROM users u) t\nWHERE msg_count > 100;", "output": "SELECT u.user_id, COUNT(m.message_id) AS msg_count, MAX(m.sent_at) AS last_msg\nFROM users u\nLEFT JOIN messages m ON m.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(m.message_id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = c.customer_id) AS order_count, (SELECT MAX(p.payment_date) FROM payments p WHERE p.customer_id = c.customer_id) AS last_payment FROM customers c) t\nWHERE order_count > 10;", "output": "SELECT c.customer_id, COUNT(o.order_id) AS order_count, MAX(p.payment_date) AS last_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN payments p ON p.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING COUNT(o.order_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS project_count, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE project_count > 2 AND avg_salary > 50000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS project_count, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 2 AND AVG(s.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS course_count, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE course_count > 3 AND avg_grade > 70;", "output": "SELECT s.student_id, COUNT(c.course_id) AS course_count, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 3 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS total_sales, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = p.product_id) AS review_count FROM products p) t\nWHERE total_sales > 500 AND review_count > 20;", "output": "SELECT p.product_id, SUM(s.amount) AS total_sales, COUNT(rv.review_id) AS review_count\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 500 AND COUNT(rv.review_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS booking_count, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE booking_count > 200 AND avg_rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS booking_count, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 200 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS ride_count, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE ride_count > 100 AND avg_rating > 4.5;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS ride_count, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 100 AND AVG(r.rating) > 4.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS play_count, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS total_score FROM games g) t\nWHERE play_count > 10 AND total_score > 200;", "output": "SELECT g.game_id, COUNT(p.play_id) AS play_count, SUM(sc.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 AND SUM(sc.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS rest_count, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE rest_count > 500 AND avg_rating > 3;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS rest_count, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 500 AND AVG(rv.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS emp_count, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS total_salary FROM companies co) t\nWHERE emp_count > 500 AND total_salary > 5000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS emp_count, SUM(s.salary) AS total_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 500 AND SUM(s.salary) > 5000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sale_count, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS total_sales FROM stores st) t\nWHERE sale_count > 1000 AND total_sales > 100000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sale_count, SUM(s.amount) AS total_sales\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 1000 AND SUM(s.amount) > 100000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches_played, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches_played > 30 AND avg_score > 25;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches_played, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 30 AND AVG(sc.score) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrow_count, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrow_count > 20 AND avg_rating > 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrow_count, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 20 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.patient_id, (SELECT COUNT(appt.appointment_id) FROM appointments appt WHERE appt.patient_id = p.patient_id) AS appointment_count, (SELECT MAX(appt2.date) FROM appointments appt2 WHERE appt2.patient_id = p.patient_id) AS last_appointment FROM patients p) t\nWHERE appointment_count > 2;", "output": "SELECT p.patient_id, COUNT(appt.appointment_id) AS appointment_count, MAX(appt.date) AS last_appointment\nFROM patients p\nLEFT JOIN appointments appt ON appt.patient_id = p.patient_id\nGROUP BY p.patient_id\nHAVING COUNT(appt.appointment_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS ticket_count, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE ticket_count > 50 AND total_revenue > 10000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS ticket_count, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits - debits > 0;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.type = 'debit' THEN t.amount END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS pkg_count, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE pkg_count > 5 AND total_weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS pkg_count, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS book_count, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE book_count > 2 AND rating_sum > 10;", "output": "SELECT a.author_id, COUNT(b.book_id) AS book_count, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 2 AND SUM(r.rating) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(f.follow_id) FROM follows f WHERE f.user_id = u.user_id) AS followers, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts FROM users u) t\nWHERE followers > 100 AND posts > 10;", "output": "SELECT u.user_id, COUNT(f.follow_id) AS followers, COUNT(p.post_id) AS posts\nFROM users u\nLEFT JOIN follows f ON f.user_id = u.user_id\nLEFT JOIN posts p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(f.follow_id) > 100 AND COUNT(p.post_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS return_count FROM orders o) t\nWHERE total_value > 200 AND return_count = 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS return_count\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 200 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS proj_count FROM employees e) t\nWHERE avg_salary > 50000 AND proj_count >= 1;", "output": "SELECT e.employee_id, AVG(s.salary) AS avg_salary, COUNT(p.project_id) AS proj_count\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 50000 AND COUNT(p.project_id) >= 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exams > 2 AND avg_grade > 75;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 2 AND AVG(g.grade) > 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 300 AND rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 300 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 100 AND avg_rating >= 4.5 AND earnings > 1000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 100 AND AVG(r.rating) >= 4.5 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS total, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS reviews FROM customers c) t\nWHERE total > 500 AND reviews > 3;", "output": "SELECT c.customer_id, SUM(o.total) AS total, COUNT(r.review_id) AS reviews\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 500 AND COUNT(r.review_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.product_id = p.product_id) AS sales, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.product_id = p.product_id) AS avg_rating FROM products p) t\nWHERE sales > 50 AND avg_rating > 4;", "output": "SELECT p.product_id, COUNT(s.sale_id) AS sales, AVG(rv.rating) AS avg_rating\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING COUNT(s.sale_id) > 50 AND AVG(rv.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 20 AND avg_score > 30;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND AVG(sc.score) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 5 AND avg_rating >= 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 5 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE students > 25 AND avg_grade > 70;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 25 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 100 AND payroll > 1000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 AND SUM(s.salary) > 1000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS total FROM stores st) t\nWHERE sales > 200 AND total > 10000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS total\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 200 AND SUM(s.amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE tickets > 50 AND revenue > 5000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.supplier_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.supplier_id = s.supplier_id) AS products, (SELECT SUM(p2.price) FROM products p2 WHERE p2.supplier_id = s.supplier_id) AS total_value FROM suppliers s) t\nWHERE products > 10 AND total_value > 1000;", "output": "SELECT s.supplier_id, COUNT(p.product_id) AS products, SUM(p.price) AS total_value\nFROM suppliers s\nLEFT JOIN products p ON p.supplier_id = s.supplier_id\nGROUP BY s.supplier_id\nHAVING COUNT(p.product_id) > 10 AND SUM(p.price) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS weight FROM shipments sh) t\nWHERE packages > 5 AND weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 20 AND avg_grade > 65;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 20 AND AVG(g.grade) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 100 AND avg_val > 50;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 100 AND AVG(r.value) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id) AS logins, (SELECT MAX(l2.login_time) FROM logins l2 WHERE l2.user_id = u.user_id) AS last_login FROM users u) t\nWHERE logins > 5;", "output": "SELECT u.user_id, COUNT(l.login_id) AS logins, MAX(l.login_time) AS last_login\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.login_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS total_sales, (SELECT AVG(r.rating) FROM reviews r WHERE r.product_id = p.product_id) AS avg_rating FROM products p) t\nWHERE total_sales > 1000 AND avg_rating > 4;", "output": "SELECT p.product_id, SUM(s.amount) AS total_sales, AVG(r.rating) AS avg_rating\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews r ON r.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 1000 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = c.customer_id) AS orders FROM customers c) t\nWHERE orders > 3;", "output": "SELECT c.customer_id, COUNT(o.order_id) AS orders\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING COUNT(o.order_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS salary FROM employees e) t\nWHERE salary > 50000;", "output": "SELECT e.employee_id, AVG(s.salary) AS salary\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams FROM students s) t\nWHERE avg_grade >= 80 AND exams >= 2;", "output": "SELECT s.student_id, AVG(g.grade) AS avg_grade, COUNT(ex.exam_id) AS exams\nFROM students s\nLEFT JOIN grades g ON g.student_id = s.student_id\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nGROUP BY s.student_id\nHAVING AVG(g.grade) >= 80 AND COUNT(ex.exam_id) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 100 AND rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 100 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS rating FROM drivers d) t\nWHERE rides > 50 AND rating > 4.2;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 50 AND AVG(r.rating) > 4.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants FROM cities c) t\nWHERE restaurants > 200;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays FROM games g) t\nWHERE plays > 10;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees FROM companies co) t\nWHERE employees > 100;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT SUM(s.amount) FROM sales s WHERE s.store_id = st.store_id) AS sales FROM stores st) t\nWHERE sales > 10000;", "output": "SELECT st.store_id, SUM(s.amount) AS sales\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING SUM(s.amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches FROM players pl) t\nWHERE matches > 20;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows FROM books b) t\nWHERE borrows > 5;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students FROM classes cl) t\nWHERE students > 25;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pr.project_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.project_id = pr.project_id) AS tasks FROM projects pr) t\nWHERE tasks > 8;", "output": "SELECT pr.project_id, COUNT(t.task_id) AS tasks\nFROM projects pr\nLEFT JOIN tasks t ON t.project_id = pr.project_id\nGROUP BY pr.project_id\nHAVING COUNT(t.task_id) > 8 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id) AS total FROM accounts a) t\nWHERE total > 1000;", "output": "SELECT a.account_id, SUM(t.amount) AS total\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(t.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.patient_id, (SELECT COUNT(appt.appointment_id) FROM appointments appt WHERE appt.patient_id = p.patient_id) AS appts FROM patients p) t\nWHERE appts > 2;", "output": "SELECT p.patient_id, COUNT(appt.appointment_id) AS appts\nFROM patients p\nLEFT JOIN appointments appt ON appt.patient_id = p.patient_id\nGROUP BY p.patient_id\nHAVING COUNT(appt.appointment_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets FROM EVENTS ev) t\nWHERE tickets > 50;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.supplier_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.supplier_id = s.supplier_id) AS products FROM suppliers s) t\nWHERE products > 10;", "output": "SELECT s.supplier_id, COUNT(p.product_id) AS products\nFROM suppliers s\nLEFT JOIN products p ON p.supplier_id = s.supplier_id\nGROUP BY s.supplier_id\nHAVING COUNT(p.product_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS orders, (SELECT SUM(p.amount) FROM payments p WHERE p.user_id = u.user_id) AS total_paid FROM users u) t\nWHERE orders > 5 AND total_paid > 500;", "output": "SELECT u.user_id, COUNT(o.order_id) AS orders, SUM(p.amount) AS total_paid\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nLEFT JOIN payments p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(o.order_id) > 5 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS salary, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects FROM employees e) t\nWHERE salary > 60000 AND projects >= 2;", "output": "SELECT e.employee_id, AVG(s.salary) AS salary, COUNT(p.project_id) AS projects\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 60000 AND COUNT(p.project_id) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS grade FROM students s) t\nWHERE exams > 3 AND grade >= 75;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 3 AND AVG(g.grade) >= 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 100 AND rating > 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 100 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS rating, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 50 AND rating >= 4.5 AND earnings > 5000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS rating, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 50 AND AVG(r.rating) >= 4.5 AND SUM(p.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS reviews FROM customers c) t\nWHERE spent > 1000 AND reviews >= 5;", "output": "SELECT c.customer_id, SUM(o.total) AS spent, COUNT(r.review_id) AS reviews\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 1000 AND COUNT(r.review_id) >= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS sales, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = p.product_id) AS reviews FROM products p) t\nWHERE sales > 500 AND reviews >= 10;", "output": "SELECT p.product_id, SUM(s.amount) AS sales, COUNT(rv.review_id) AS reviews\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 500 AND COUNT(rv.review_id) >= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT SUM(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS score FROM players pl) t\nWHERE matches > 20 AND score > 200;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, SUM(sc.score) AS score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND SUM(sc.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS rating FROM books b) t\nWHERE borrows > 5 AND rating >= 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 5 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS grade FROM classes cl) t\nWHERE students > 20 AND grade >= 70;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students, AVG(g.grade) AS grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 20 AND AVG(g.grade) >= 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 100 AND payroll > 1000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 AND SUM(s.salary) > 1000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 200 AND revenue > 5000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 200 AND SUM(s.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.supplier_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.supplier_id = s.supplier_id) AS products FROM suppliers s) t\nWHERE products > 15;", "output": "SELECT s.supplier_id, COUNT(p.product_id) AS products\nFROM suppliers s\nLEFT JOIN products p ON p.supplier_id = s.supplier_id\nGROUP BY s.supplier_id\nHAVING COUNT(p.product_id) > 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE tickets > 50 AND revenue > 10000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits - debits > 0;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.type = 'debit' THEN t.amount END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 100 AND avg_val > 50;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 100 AND AVG(r.value) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 2 AND rating_sum > 10;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 2 AND SUM(r.rating) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS grade FROM courses c) t\nWHERE enrolled > 30 AND grade >= 65;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 30 AND AVG(g.grade) >= 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS weight FROM shipments sh) t\nWHERE packages > 5 AND weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(m.message_id) FROM messages m WHERE m.user_id = u.user_id) AS messages, (SELECT MAX(m2.sent_at) FROM messages m2 WHERE m2.user_id = u.user_id) AS last_msg FROM users u) t\nWHERE messages > 100;", "output": "SELECT u.user_id, COUNT(m.message_id) AS messages, MAX(m.sent_at) AS last_msg\nFROM users u\nLEFT JOIN messages m ON m.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(m.message_id) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = c.customer_id) AS orders, (SELECT MAX(p.payment_date) FROM payments p WHERE p.customer_id = c.customer_id) AS last_payment FROM customers c) t\nWHERE orders > 10;", "output": "SELECT c.customer_id, COUNT(o.order_id) AS orders, MAX(p.payment_date) AS last_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN payments p ON p.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING COUNT(o.order_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS salary FROM employees e) t\nWHERE projects > 2 AND salary > 50000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, AVG(s.salary) AS salary\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 2 AND AVG(s.salary) > 50000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS grade FROM students s) t\nWHERE courses > 3 AND grade > 70;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, AVG(g.grade) AS grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 3 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS sales, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = p.product_id) AS reviews FROM products p) t\nWHERE sales > 500 AND reviews > 20;", "output": "SELECT p.product_id, SUM(s.amount) AS sales, COUNT(rv.review_id) AS reviews\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 500 AND COUNT(rv.review_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 200 AND rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 200 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS rating FROM drivers d) t\nWHERE rides > 100 AND rating > 4.5;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 100 AND AVG(r.rating) > 4.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS score FROM games g) t\nWHERE plays > 10 AND score > 200;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 AND SUM(sc.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS rating FROM cities c) t\nWHERE restaurants > 500 AND rating > 3;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 500 AND AVG(rv.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 500 AND payroll > 5000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 500 AND SUM(s.salary) > 5000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 1000 AND revenue > 100000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 1000 AND SUM(s.amount) > 100000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 30 AND avg_score > 25;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 30 AND AVG(sc.score) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS rating FROM books b) t\nWHERE borrows > 20 AND rating > 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 20 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.patient_id, (SELECT COUNT(appt.appointment_id) FROM appointments appt WHERE appt.patient_id = p.patient_id) AS appointments, (SELECT MAX(appt2.date) FROM appointments appt2 WHERE appt2.patient_id = p.patient_id) AS last_appt FROM patients p) t\nWHERE appointments > 2;", "output": "SELECT p.patient_id, COUNT(appt.appointment_id) AS appointments, MAX(appt.date) AS last_appt\nFROM patients p\nLEFT JOIN appointments appt ON appt.patient_id = p.patient_id\nGROUP BY p.patient_id\nHAVING COUNT(appt.appointment_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE tickets > 50 AND revenue > 10000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits - debits > 0;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.type = 'debit' THEN t.amount END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS weight FROM shipments sh) t\nWHERE packages > 5 AND weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(f.follow_id) FROM follows f WHERE f.user_id = u.user_id) AS followers, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts FROM users u) t\nWHERE followers > 100 AND posts > 10;", "output": "SELECT u.user_id, COUNT(f.follow_id) AS followers, COUNT(p.post_id) AS posts\nFROM users u\nLEFT JOIN follows f ON f.user_id = u.user_id\nLEFT JOIN posts p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(f.follow_id) > 100 AND COUNT(p.post_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS RETURNS FROM orders o) t\nWHERE total_value > 200 AND RETURNS = 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS RETURNS\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 200 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS salary, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects FROM employees e) t\nWHERE salary > 50000 AND projects > 1;", "output": "SELECT e.employee_id, AVG(s.salary) AS salary, COUNT(p.project_id) AS projects\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 50000 AND COUNT(p.project_id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS grade FROM students s) t\nWHERE exams > 2 AND grade > 75;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 2 AND AVG(g.grade) > 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 300 AND rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 300 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS rating, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 100 AND rating >= 4.5 AND earnings > 1000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS rating, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 100 AND AVG(r.rating) >= 4.5 AND SUM(p.amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS reviews FROM customers c) t\nWHERE spent > 500 AND reviews > 3;", "output": "SELECT c.customer_id, SUM(o.total) AS spent, COUNT(r.review_id) AS reviews\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 500 AND COUNT(r.review_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.product_id = p.product_id) AS sales, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.product_id = p.product_id) AS rating FROM products p) t\nWHERE sales > 50 AND rating > 4;", "output": "SELECT p.product_id, COUNT(s.sale_id) AS sales, AVG(rv.rating) AS rating\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING COUNT(s.sale_id) > 50 AND AVG(rv.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 20 AND avg_score > 30;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND AVG(sc.score) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS rating FROM books b) t\nWHERE borrows > 5 AND rating >= 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 5 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS grade FROM classes cl) t\nWHERE students > 25 AND grade > 70;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students, AVG(g.grade) AS grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 25 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 100 AND payroll > 1000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 AND SUM(s.salary) > 1000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 200 AND revenue > 10000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 200 AND SUM(s.amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE tickets > 50 AND revenue > 5000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.supplier_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.supplier_id = s.supplier_id) AS products, (SELECT SUM(p2.price) FROM products p2 WHERE p2.supplier_id = s.supplier_id) AS value FROM suppliers s) t\nWHERE products > 10 AND value > 1000;", "output": "SELECT s.supplier_id, COUNT(p.product_id) AS products, SUM(p.price) AS value\nFROM suppliers s\nLEFT JOIN products p ON p.supplier_id = s.supplier_id\nGROUP BY s.supplier_id\nHAVING COUNT(p.product_id) > 10 AND SUM(p.price) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS weight FROM shipments sh) t\nWHERE packages > 5 AND weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS grade FROM courses c) t\nWHERE enrolled > 20 AND grade > 65;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 20 AND AVG(g.grade) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 100 AND avg_val > 50;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 100 AND AVG(r.value) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS orders, (SELECT SUM(p.amount) FROM payments p WHERE p.user_id = u.user_id) AS paid FROM users u) t\nWHERE orders > 5 AND paid > 500;", "output": "SELECT u.user_id, COUNT(o.order_id) AS orders, SUM(p.amount) AS paid\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nLEFT JOIN payments p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(o.order_id) > 5 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS salary, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects FROM employees e) t\nWHERE salary > 60000 AND projects >= 2;", "output": "SELECT e.employee_id, AVG(s.salary) AS salary, COUNT(p.project_id) AS projects\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 60000 AND COUNT(p.project_id) >= 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS grade FROM students s) t\nWHERE exams > 3 AND grade >= 75;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 3 AND AVG(g.grade) >= 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 100 AND rating > 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 100 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS rating, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 50 AND rating >= 4.5 AND earnings > 5000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS rating, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 50 AND AVG(r.rating) >= 4.5 AND SUM(p.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS reviews FROM customers c) t\nWHERE spent > 1000 AND reviews >= 5;", "output": "SELECT c.customer_id, SUM(o.total) AS spent, COUNT(r.review_id) AS reviews\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 1000 AND COUNT(r.review_id) >= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS sales, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = p.product_id) AS reviews FROM products p) t\nWHERE sales > 500 AND reviews >= 10;", "output": "SELECT p.product_id, SUM(s.amount) AS sales, COUNT(rv.review_id) AS reviews\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 500 AND COUNT(rv.review_id) >= 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT SUM(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS score FROM players pl) t\nWHERE matches > 20 AND score > 200;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, SUM(sc.score) AS score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND SUM(sc.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS rating FROM books b) t\nWHERE borrows > 5 AND rating >= 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 5 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS grade FROM classes cl) t\nWHERE students > 20 AND grade >= 70;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students, AVG(g.grade) AS grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 20 AND AVG(g.grade) >= 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 100 AND payroll > 1000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 AND SUM(s.salary) > 1000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 200 AND revenue > 5000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 200 AND SUM(s.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.supplier_id, (SELECT COUNT(p.product_id) FROM products p WHERE p.supplier_id = s.supplier_id) AS products FROM suppliers s) t\nWHERE products > 15;", "output": "SELECT s.supplier_id, COUNT(p.product_id) AS products\nFROM suppliers s\nLEFT JOIN products p ON p.supplier_id = s.supplier_id\nGROUP BY s.supplier_id\nHAVING COUNT(p.product_id) > 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE tickets > 50 AND revenue > 10000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits - debits > 0;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) - SUM(CASE WHEN t.type = 'debit' THEN t.amount END) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 100 AND avg_val > 50;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 100 AND AVG(r.value) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 2 AND rating_sum > 10;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 2 AND SUM(r.rating) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS grade FROM courses c) t\nWHERE enrolled > 30 AND grade >= 65;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 30 AND AVG(g.grade) >= 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS weight FROM shipments sh) t\nWHERE packages > 5 AND weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(m.message_id) FROM messages m WHERE m.user_id = u.user_id) AS messages, (SELECT MAX(m2.sent_at) FROM messages m2 WHERE m2.user_id = u.user_id) AS last_msg FROM users u) t\nWHERE messages > 50;", "output": "SELECT u.user_id, COUNT(m.message_id) AS messages, MAX(m.sent_at) AS last_msg\nFROM users u\nLEFT JOIN messages m ON m.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(m.message_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.customer_id = c.customer_id) AS orders, (SELECT MAX(p.payment_date) FROM payments p WHERE p.customer_id = c.customer_id) AS last_payment FROM customers c) t\nWHERE orders > 5;", "output": "SELECT c.customer_id, COUNT(o.order_id) AS orders, MAX(p.payment_date) AS last_payment\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN payments p ON p.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING COUNT(o.order_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS salary FROM employees e) t\nWHERE projects > 1 AND salary > 40000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, AVG(s.salary) AS salary\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 1 AND AVG(s.salary) > 40000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS grade FROM students s) t\nWHERE courses > 2 AND grade > 70;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, AVG(g.grade) AS grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 2 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS sales, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = p.product_id) AS reviews FROM products p) t\nWHERE sales > 100 AND reviews > 10;", "output": "SELECT p.product_id, SUM(s.amount) AS sales, COUNT(rv.review_id) AS reviews\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 100 AND COUNT(rv.review_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 50 AND rating > 3;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 50 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS rating FROM drivers d) t\nWHERE rides > 10 AND rating >= 4;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 10 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS score FROM games g) t\nWHERE plays > 5 AND score > 50;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 5 AND SUM(sc.score) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS rating FROM cities c) t\nWHERE restaurants > 50 AND rating > 2;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 50 AND AVG(rv.rating) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 200 AND payroll > 2000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 200 AND SUM(s.salary) > 2000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 100 AND revenue > 5000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 100 AND SUM(s.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 15 AND avg_score > 20;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 15 AND AVG(sc.score) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS rating FROM books b) t\nWHERE borrows > 2 AND rating >= 3;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 2 AND AVG(r.rating) >= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS grade FROM classes cl) t\nWHERE students > 10 AND grade >= 60;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students, AVG(g.grade) AS grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 10 AND AVG(g.grade) >= 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE tickets > 20 AND revenue > 1000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 20 AND SUM(p.payment_amount) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 80 AND avg_val > 40;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 80 AND AVG(r.value) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 1 AND rating_sum > 5;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 1 AND SUM(r.rating) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(f.friend_id) FROM friends f WHERE f.user_id = u.user_id) AS friends, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts FROM users u) t\nWHERE friends > 50 AND posts > 5;", "output": "SELECT u.user_id, COUNT(f.friend_id) AS friends, COUNT(p.post_id) AS posts\nFROM users u\nLEFT JOIN friends f ON f.user_id = u.user_id\nLEFT JOIN posts p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(f.friend_id) > 50 AND COUNT(p.post_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS RETURNS FROM orders o) t\nWHERE total_value > 300 AND RETURNS = 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS RETURNS\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 300 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS salary, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects FROM employees e) t\nWHERE salary > 55000 AND projects > 1;", "output": "SELECT e.employee_id, AVG(s.salary) AS salary, COUNT(p.project_id) AS projects\nFROM employees e\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING AVG(s.salary) > 55000 AND COUNT(p.project_id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS grade FROM students s) t\nWHERE exams > 4 AND grade > 65;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 4 AND AVG(g.grade) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating FROM hotels h) t\nWHERE bookings > 150 AND rating >= 3.5;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 150 AND AVG(r.rating) >= 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS rating FROM drivers d) t\nWHERE rides > 20 AND rating >= 4.2;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 20 AND AVG(r.rating) >= 4.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS score FROM games g) t\nWHERE plays > 20 AND score > 300;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 20 AND SUM(sc.score) > 300 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS rating FROM cities c) t\nWHERE restaurants > 200 AND rating > 3;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 200 AND AVG(rv.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 300 AND payroll > 4000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 300 AND SUM(s.salary) > 4000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 300 AND revenue > 15000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 300 AND SUM(s.amount) > 15000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 10 AND avg_score > 25;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 10 AND AVG(sc.score) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS rating FROM books b) t\nWHERE borrows > 15 AND rating >= 3.5;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 15 AND AVG(r.rating) >= 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS grade FROM classes cl) t\nWHERE students > 40 AND grade >= 75;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students, AVG(g.grade) AS grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 40 AND AVG(g.grade) >= 75 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE tickets > 100 AND revenue > 20000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 100 AND SUM(p.payment_amount) > 20000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 70 AND avg_val > 35;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 70 AND AVG(r.value) > 35 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 3 AND rating_sum > 20;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 3 AND SUM(r.rating) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS grade FROM courses c) t\nWHERE enrolled > 15 AND grade > 60;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 15 AND AVG(g.grade) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.like_id) FROM likes l WHERE l.user_id = u.user_id) AS likes, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comments FROM users u) t\nWHERE likes > 100 AND comments > 50;", "output": "SELECT u.user_id, COUNT(l.like_id) AS likes, COUNT(c.comment_id) AS comments\nFROM users u\nLEFT JOIN likes l ON l.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.like_id) > 100 AND COUNT(c.comment_id) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(sh.shipment_id) FROM shipments sh WHERE sh.order_id = o.order_id) AS shipments FROM orders o) t\nWHERE total_value > 500 AND shipments > 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(sh.shipment_id) AS shipments\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN shipments sh ON sh.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 500 AND COUNT(sh.shipment_id) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE projects > 2 AND avg_salary > 45000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 2 AND AVG(s.salary) > 45000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exams > 2 AND avg_grade >= 70;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 2 AND AVG(g.grade) >= 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 250 AND avg_rating >= 3.5;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 250 AND AVG(r.rating) >= 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS total_earnings FROM drivers d) t\nWHERE rides > 30 AND avg_rating >= 4 AND total_earnings > 2000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating, SUM(p.amount) AS total_earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 30 AND AVG(r.rating) >= 4 AND SUM(p.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.customer_id, (SELECT SUM(o.total) FROM orders o WHERE o.customer_id = c.customer_id) AS total_spent, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.customer_id = c.customer_id) AS reviews FROM customers c) t\nWHERE total_spent > 2000 AND reviews > 3;", "output": "SELECT c.customer_id, SUM(o.total) AS total_spent, COUNT(r.review_id) AS reviews\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.customer_id\nLEFT JOIN reviews r ON r.customer_id = c.customer_id\nGROUP BY c.customer_id\nHAVING SUM(o.total) > 2000 AND COUNT(r.review_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT p.product_id, (SELECT SUM(s.amount) FROM sales s WHERE s.product_id = p.product_id) AS total_sales, (SELECT COUNT(rv.review_id) FROM reviews rv WHERE rv.product_id = p.product_id) AS total_reviews FROM products p) t\nWHERE total_sales > 1000 AND total_reviews >= 5;", "output": "SELECT p.product_id, SUM(s.amount) AS total_sales, COUNT(rv.review_id) AS total_reviews\nFROM products p\nLEFT JOIN sales s ON s.product_id = p.product_id\nLEFT JOIN reviews rv ON rv.product_id = p.product_id\nGROUP BY p.product_id\nHAVING SUM(s.amount) > 1000 AND COUNT(rv.review_id) >= 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 40 AND avg_score > 15;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 40 AND AVG(sc.score) > 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 8 AND avg_rating > 3;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 8 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 30 AND avg_grade >= 60;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 30 AND AVG(g.grade) >= 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 50 AND total_revenue > 5000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 120 AND avg_val > 70;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 120 AND AVG(r.value) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS total_ratings FROM authors a) t\nWHERE books > 5 AND total_ratings > 15;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS total_ratings\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 5 AND SUM(r.rating) > 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 10 AND avg_grade >= 55;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 10 AND AVG(g.grade) >= 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 5 AND total_weight > 100;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 5 AND SUM(p.weight) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comments FROM users u) t\nWHERE posts > 20 AND comments > 5;", "output": "SELECT u.user_id, COUNT(p.post_id) AS posts, COUNT(c.comment_id) AS comments\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(p.post_id) > 20 AND COUNT(c.comment_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS RETURNS FROM orders o) t\nWHERE total_value > 100 AND RETURNS = 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS RETURNS\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 100 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE projects > 1 AND avg_salary > 30000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 1 AND AVG(s.salary) > 30000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exams > 1 AND avg_grade > 60;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 1 AND AVG(g.grade) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 80 AND avg_rating >= 3;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 80 AND AVG(r.rating) >= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE rides > 15 AND avg_rating >= 4;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 15 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS score FROM games g) t\nWHERE plays > 10 AND score > 100;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 AND SUM(sc.score) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 100 AND avg_rating > 2;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 100 AND AVG(rv.rating) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 150 AND payroll > 1500000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 150 AND SUM(s.salary) > 1500000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 50 AND revenue > 3000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 50 AND SUM(s.amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 5 AND avg_score > 10;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 5 AND AVG(sc.score) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 3 AND avg_rating >= 2.5;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 3 AND AVG(r.rating) >= 2.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 15 AND avg_grade >= 55;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 15 AND AVG(g.grade) >= 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 20 AND total_revenue > 2000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 20 AND SUM(p.payment_amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 60 AND avg_val > 30;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 60 AND AVG(r.value) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS total_ratings FROM authors a) t\nWHERE books > 2 AND total_ratings > 5;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS total_ratings\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 2 AND SUM(r.rating) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 5 AND avg_grade >= 50;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 5 AND AVG(g.grade) >= 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 2 AND total_weight > 20;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 2 AND SUM(p.weight) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(o.order_id) FROM orders o WHERE o.user_id = u.user_id) AS orders, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.user_id = u.user_id) AS total_paid FROM users u) t\nWHERE orders > 10 AND total_paid > 500;", "output": "SELECT u.user_id, COUNT(o.order_id) AS orders, SUM(p.payment_amount) AS total_paid\nFROM users u\nLEFT JOIN orders o ON o.user_id = u.user_id\nLEFT JOIN payments p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(o.order_id) > 10 AND SUM(p.payment_amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(a.attendance_id) FROM attendance a WHERE a.employee_id = e.employee_id) AS days_present, (SELECT SUM(b.bonus) FROM bonuses b WHERE b.employee_id = e.employee_id) AS total_bonus FROM employees e) t\nWHERE days_present > 20 AND total_bonus > 1000;", "output": "SELECT e.employee_id, COUNT(a.attendance_id) AS days_present, SUM(b.bonus) AS total_bonus\nFROM employees e\nLEFT JOIN attendance a ON a.employee_id = e.employee_id\nLEFT JOIN bonuses b ON b.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(a.attendance_id) > 20 AND SUM(b.bonus) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE courses > 3 AND avg_grade > 60;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 3 AND AVG(g.grade) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.hotel_id = h.hotel_id) AS total_revenue FROM hotels h) t\nWHERE bookings > 50 AND total_revenue > 10000;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, SUM(p.payment_amount) AS total_revenue\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN payments p ON p.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 50 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS total_earnings FROM drivers d) t\nWHERE rides > 25 AND total_earnings > 500;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS total_earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 25 AND SUM(p.amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE plays > 15 AND avg_score > 20;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 15 AND AVG(sc.score) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 50 AND avg_rating > 2.5;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 50 AND AVG(rv.rating) > 2.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 100 AND payroll > 2000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 AND SUM(s.salary) > 2000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 40 AND revenue > 2000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 40 AND SUM(s.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 8 AND avg_score > 12;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 8 AND AVG(sc.score) > 12 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 6 AND avg_rating > 3;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 6 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 25 AND avg_grade >= 65;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 25 AND AVG(g.grade) >= 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 30 AND total_revenue > 4000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 30 AND SUM(p.payment_amount) > 4000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 90 AND avg_val > 40;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 90 AND AVG(r.value) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS total_ratings FROM authors a) t\nWHERE books > 4 AND total_ratings > 12;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS total_ratings\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 4 AND SUM(r.rating) > 12 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 8 AND avg_grade >= 55;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 8 AND AVG(g.grade) >= 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 4 AND total_weight > 50;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 4 AND SUM(p.weight) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.like_id) FROM likes l WHERE l.user_id = u.user_id) AS likes, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comments FROM users u) t\nWHERE likes > 200 AND comments > 20;", "output": "SELECT u.user_id, COUNT(l.like_id) AS likes, COUNT(c.comment_id) AS comments\nFROM users u\nLEFT JOIN likes l ON l.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.like_id) > 200 AND COUNT(c.comment_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(sh.shipment_id) FROM shipments sh WHERE sh.order_id = o.order_id) AS shipments FROM orders o) t\nWHERE total_value > 250 AND shipments > 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(sh.shipment_id) AS shipments\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN shipments sh ON sh.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 250 AND COUNT(sh.shipment_id) > 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE projects > 5 AND avg_salary > 60000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 5 AND AVG(s.salary) > 60000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exams > 3 AND avg_grade > 70;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 3 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 300 AND avg_rating >= 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 300 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE rides > 50 AND avg_rating >= 4.5;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 50 AND AVG(r.rating) >= 4.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS total_score FROM games g) t\nWHERE plays > 30 AND total_score > 500;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 30 AND SUM(sc.score) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 300 AND avg_rating > 3.5;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 300 AND AVG(rv.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 500 AND payroll > 5000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 500 AND SUM(s.salary) > 5000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 200 AND revenue > 5000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 200 AND SUM(s.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 20 AND avg_score > 30;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND AVG(sc.score) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 20 AND avg_rating >= 4;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 20 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE students > 60 AND avg_grade >= 70;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 60 AND AVG(g.grade) >= 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 150 AND total_revenue > 30000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 150 AND SUM(p.payment_amount) > 30000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 80 AND avg_val > 50;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 80 AND AVG(r.value) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 10 AND rating_sum > 40;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 10 AND SUM(r.rating) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 20 AND avg_grade >= 60;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 20 AND AVG(g.grade) >= 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 10 AND total_weight > 200;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 10 AND SUM(p.weight) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(f.friend_id) FROM friends f WHERE f.user_id = u.user_id) AS friends, (SELECT COUNT(m.message_id) FROM messages m WHERE m.user_id = u.user_id) AS messages FROM users u) t\nWHERE friends > 100 AND messages > 20;", "output": "SELECT u.user_id, COUNT(f.friend_id) AS friends, COUNT(m.message_id) AS messages\nFROM users u\nLEFT JOIN friends f ON f.user_id = u.user_id\nLEFT JOIN messages m ON m.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(f.friend_id) > 100 AND COUNT(m.message_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(p.payment_id) FROM payments p WHERE p.order_id = o.order_id) AS payments FROM orders o) t\nWHERE total_value > 600 AND payments > 1;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(p.payment_id) AS payments\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN payments p ON p.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 600 AND COUNT(p.payment_id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT SUM(b.bonus) FROM bonuses b WHERE b.employee_id = e.employee_id) AS total_bonus FROM employees e) t\nWHERE projects > 2 AND total_bonus > 1000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, SUM(b.bonus) AS total_bonus\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN bonuses b ON b.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 2 AND SUM(b.bonus) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE courses > 4 AND avg_grade > 65;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 4 AND AVG(g.grade) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 400 AND avg_rating >= 4.2;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 400 AND AVG(r.rating) >= 4.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS total_earnings FROM drivers d) t\nWHERE rides > 70 AND total_earnings > 7000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS total_earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 70 AND SUM(p.amount) > 7000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE plays > 40 AND avg_score > 35;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 40 AND AVG(sc.score) > 35 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT SUM(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS rating_sum FROM cities c) t\nWHERE restaurants > 250 AND rating_sum > 1000;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, SUM(rv.rating) AS rating_sum\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 250 AND SUM(rv.rating) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 600 AND payroll > 6000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 600 AND SUM(s.salary) > 6000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 250 AND revenue > 8000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 250 AND SUM(s.amount) > 8000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 25 AND avg_score > 28;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 25 AND AVG(sc.score) > 28 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 25 AND avg_rating >= 3.8;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 25 AND AVG(r.rating) >= 3.8 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 70 AND avg_grade >= 68;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 70 AND AVG(g.grade) >= 68 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 120 AND total_revenue > 25000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 120 AND SUM(p.payment_amount) > 25000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 100 AND avg_val > 55;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 100 AND AVG(r.value) > 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 12 AND rating_sum > 30;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 12 AND SUM(r.rating) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 12 AND avg_grade >= 62;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 12 AND AVG(g.grade) >= 62 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 15 AND total_weight > 120;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 15 AND SUM(p.weight) > 120 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(a.attendance_id) FROM attendance a WHERE a.employee_id = e.employee_id) AS days_present, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE days_present > 20 AND avg_salary > 45000;", "output": "SELECT e.employee_id, COUNT(a.attendance_id) AS days_present, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN attendance a ON a.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(a.attendance_id) > 20 AND AVG(s.salary) > 45000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE courses > 2 AND avg_grade > 55;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 2 AND AVG(g.grade) > 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.hotel_id = h.hotel_id) AS total_revenue FROM hotels h) t\nWHERE bookings > 100 AND total_revenue > 5000;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, SUM(p.payment_amount) AS total_revenue\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN payments p ON p.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 100 AND SUM(p.payment_amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS total_earnings FROM drivers d) t\nWHERE rides > 30 AND total_earnings > 2000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS total_earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 30 AND SUM(p.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE plays > 12 AND avg_score > 18;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 12 AND AVG(sc.score) > 18 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 120 AND avg_rating > 2.8;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 120 AND AVG(rv.rating) > 2.8 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 200 AND payroll > 2500000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 200 AND SUM(s.salary) > 2500000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 60 AND revenue > 2500;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 60 AND SUM(s.amount) > 2500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 15 AND avg_score > 22;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 15 AND AVG(sc.score) > 22 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 10 AND avg_rating >= 3;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 10 AND AVG(r.rating) >= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 35 AND avg_grade >= 60;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 35 AND AVG(g.grade) >= 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 80 AND total_revenue > 15000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 80 AND SUM(p.payment_amount) > 15000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 70 AND avg_val > 35;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 70 AND AVG(r.value) > 35 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS total_ratings FROM authors a) t\nWHERE books > 6 AND total_ratings > 20;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS total_ratings\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 6 AND SUM(r.rating) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 18 AND avg_grade >= 58;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 18 AND AVG(g.grade) >= 58 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 8 AND total_weight > 90;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 8 AND SUM(p.weight) > 90 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comments FROM users u) t\nWHERE posts > 15 AND comments > 10;", "output": "SELECT u.user_id, COUNT(p.post_id) AS posts, COUNT(c.comment_id) AS comments\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(p.post_id) > 15 AND COUNT(c.comment_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS RETURNS FROM orders o) t\nWHERE total_value > 400 AND RETURNS = 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS RETURNS\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 400 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT SUM(b.bonus) FROM bonuses b WHERE b.employee_id = e.employee_id) AS total_bonus FROM employees e) t\nWHERE projects > 3 AND total_bonus > 1500;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, SUM(b.bonus) AS total_bonus\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN bonuses b ON b.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 3 AND SUM(b.bonus) > 1500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exams > 5 AND avg_grade > 72;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 5 AND AVG(g.grade) > 72 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 150 AND avg_rating >= 3.2;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 150 AND AVG(r.rating) >= 3.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE rides > 35 AND avg_rating >= 4;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 35 AND AVG(r.rating) >= 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS total_score FROM games g) t\nWHERE plays > 20 AND total_score > 250;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 20 AND SUM(sc.score) > 250 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 200 AND avg_rating > 3;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 200 AND AVG(rv.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 350 AND payroll > 3500000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 350 AND SUM(s.salary) > 3500000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 100 AND revenue > 4000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 100 AND SUM(s.amount) > 4000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 18 AND avg_score > 20;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 18 AND AVG(sc.score) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 12 AND avg_rating >= 3.2;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 12 AND AVG(r.rating) >= 3.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 40 AND avg_grade >= 65;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 40 AND AVG(g.grade) >= 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 90 AND total_revenue > 18000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 90 AND SUM(p.payment_amount) > 18000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 95 AND avg_val > 45;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 95 AND AVG(r.value) > 45 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 7 AND rating_sum > 25;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 7 AND SUM(r.rating) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 20 AND avg_grade >= 57;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 20 AND AVG(g.grade) >= 57 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 12 AND total_weight > 70;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 12 AND SUM(p.weight) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id) AS logins, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts FROM users u) t\nWHERE logins > 50 AND posts > 5;", "output": "SELECT u.user_id, COUNT(l.login_id) AS logins, COUNT(p.post_id) AS posts\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nLEFT JOIN posts p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.login_id) > 50 AND COUNT(p.post_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(sh.shipment_id) FROM shipments sh WHERE sh.order_id = o.order_id) AS shipments FROM orders o) t\nWHERE total_value > 700 AND shipments > 1;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(sh.shipment_id) AS shipments\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN shipments sh ON sh.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 700 AND COUNT(sh.shipment_id) > 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.employee_id = e.employee_id) AS tasks, (SELECT SUM(w.hours) FROM worklogs w WHERE w.employee_id = e.employee_id) AS hours FROM employees e) t\nWHERE tasks > 5 AND hours > 120;", "output": "SELECT e.employee_id, COUNT(t.task_id) AS tasks, SUM(w.hours) AS hours\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.employee_id\nLEFT JOIN worklogs w ON w.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(t.task_id) > 5 AND SUM(w.hours) > 120 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams FROM students s) t\nWHERE courses > 3 AND exams > 2;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, COUNT(ex.exam_id) AS exams\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 3 AND COUNT(ex.exam_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS reviews FROM hotels h) t\nWHERE bookings > 60 AND reviews > 20;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, COUNT(r.review_id) AS reviews\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 60 AND COUNT(r.review_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS total_earnings FROM drivers d) t\nWHERE rides > 40 AND total_earnings > 3000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS total_earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 40 AND SUM(p.amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE plays > 10 AND avg_score > 40;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 AND AVG(sc.score) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT SUM(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS rating_sum FROM cities c) t\nWHERE restaurants > 80 AND rating_sum > 150;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, SUM(rv.rating) AS rating_sum\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 80 AND SUM(rv.rating) > 150 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT AVG(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS avg_salary FROM companies co) t\nWHERE employees > 120 AND avg_salary > 40000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, AVG(s.salary) AS avg_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 120 AND AVG(s.salary) > 40000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 30 AND revenue > 1200;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 30 AND SUM(s.amount) > 1200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT SUM(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS total_score FROM players pl) t\nWHERE matches > 20 AND total_score > 300;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, SUM(sc.score) AS total_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND SUM(sc.score) > 300 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 15 AND avg_rating > 3.5;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 15 AND AVG(r.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT SUM(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS total_grades FROM classes cl) t\nWHERE total_students > 25 AND total_grades > 2000;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, SUM(g.grade) AS total_grades\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 25 AND SUM(g.grade) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE total_tickets > 70 AND revenue > 12000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 70 AND SUM(p.payment_amount) > 12000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 90 AND avg_val > 55;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 90 AND AVG(r.value) > 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT AVG(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS avg_rating FROM authors a) t\nWHERE books > 4 AND avg_rating > 2.5;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, AVG(r.rating) AS avg_rating\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 4 AND AVG(r.rating) > 2.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT SUM(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS total_grades FROM courses c) t\nWHERE enrolled > 15 AND total_grades > 700;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, SUM(g.grade) AS total_grades\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 15 AND SUM(g.grade) > 700 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 10 AND total_weight > 80;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 10 AND SUM(p.weight) > 80 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(m.message_id) FROM messages m WHERE m.user_id = u.user_id) AS messages, (SELECT COUNT(f.friend_id) FROM friends f WHERE f.user_id = u.user_id) AS friends FROM users u) t\nWHERE messages > 100 AND friends > 20;", "output": "SELECT u.user_id, COUNT(m.message_id) AS messages, COUNT(f.friend_id) AS friends\nFROM users u\nLEFT JOIN messages m ON m.user_id = u.user_id\nLEFT JOIN friends f ON f.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(m.message_id) > 100 AND COUNT(f.friend_id) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS RETURNS FROM orders o) t\nWHERE total_value > 1000 AND RETURNS < 2;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS RETURNS\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 1000 AND COUNT(r.return_id) < 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT SUM(b.bonus) FROM bonuses b WHERE b.employee_id = e.employee_id) AS total_bonus FROM employees e) t\nWHERE projects > 5 AND total_bonus > 2000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, SUM(b.bonus) AS total_bonus\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN bonuses b ON b.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 5 AND SUM(b.bonus) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT SUM(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS total_grades FROM students s) t\nWHERE exams > 3 AND total_grades > 180;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, SUM(g.grade) AS total_grades\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 3 AND SUM(g.grade) > 180 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.hotel_id = h.hotel_id) AS total_revenue FROM hotels h) t\nWHERE bookings > 200 AND total_revenue > 10000;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, SUM(p.payment_amount) AS total_revenue\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN payments p ON p.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 200 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r2.rating) FROM rides r2 WHERE r2.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE rides > 60 AND avg_rating > 4;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 60 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS total_score FROM games g) t\nWHERE plays > 30 AND total_score > 400;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 30 AND SUM(sc.score) > 400 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 150 AND avg_rating > 3.5;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 150 AND AVG(rv.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT AVG(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS avg_salary FROM companies co) t\nWHERE employees > 300 AND avg_salary > 42000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, AVG(s.salary) AS avg_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 300 AND AVG(s.salary) > 42000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 120 AND revenue > 5000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 120 AND SUM(s.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 25 AND avg_score > 30;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 25 AND AVG(sc.score) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 20 AND avg_rating >= 3;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 20 AND AVG(r.rating) >= 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT SUM(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS total_grades FROM classes cl) t\nWHERE total_students > 50 AND total_grades > 2500;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, SUM(g.grade) AS total_grades\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 50 AND SUM(g.grade) > 2500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE total_tickets > 110 AND revenue > 22000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 110 AND SUM(p.payment_amount) > 22000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 85 AND avg_val > 60;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 85 AND AVG(r.value) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS total_ratings FROM authors a) t\nWHERE books > 9 AND total_ratings > 40;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS total_ratings\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 9 AND SUM(r.rating) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 25 AND avg_grade >= 70;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 25 AND AVG(g.grade) >= 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 20 AND total_weight > 150;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 20 AND SUM(p.weight) > 150 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comments, (SELECT COUNT(l.like_id) FROM likes l WHERE l.user_id = u.user_id) AS likes FROM users u) t\nWHERE comments > 50 AND likes > 200;", "output": "SELECT u.user_id, COUNT(c.comment_id) AS comments, COUNT(l.like_id) AS likes\nFROM users u\nLEFT JOIN comments c ON c.user_id = u.user_id\nLEFT JOIN likes l ON l.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(c.comment_id) > 50 AND COUNT(l.like_id) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT SUM(sh.shipping_cost) FROM shippings sh WHERE sh.order_id = o.order_id) AS shipping FROM orders o) t\nWHERE total_value > 1500 AND shipping < 200;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, SUM(sh.shipping_cost) AS shipping\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN shippings sh ON sh.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 1500 AND SUM(sh.shipping_cost) < 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(a.attendance_id) FROM attendance a WHERE a.employee_id = e.employee_id) AS attendance_days, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE attendance_days > 20 AND avg_salary > 35000;", "output": "SELECT e.employee_id, COUNT(a.attendance_id) AS attendance_days, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN attendance a ON a.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(a.attendance_id) > 20 AND AVG(s.salary) > 35000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams FROM students s) t\nWHERE courses > 4 AND exams > 3;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, COUNT(ex.exam_id) AS exams\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 4 AND COUNT(ex.exam_id) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 120 AND avg_rating > 3.7;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 120 AND AVG(r.rating) > 3.7 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 80 AND earnings > 6000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 80 AND SUM(p.amount) > 6000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE plays > 25 AND avg_score > 50;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 25 AND AVG(sc.score) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT SUM(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS total_rating FROM cities c) t\nWHERE restaurants > 100 AND total_rating > 300;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, SUM(rv.rating) AS total_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 100 AND SUM(rv.rating) > 300 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 500 AND payroll > 8000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 500 AND SUM(s.salary) > 8000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 70 AND revenue > 2500;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 70 AND SUM(s.amount) > 2500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT SUM(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS total_score FROM players pl) t\nWHERE matches > 35 AND total_score > 500;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, SUM(sc.score) AS total_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 35 AND SUM(sc.score) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 25 AND avg_rating > 3.2;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 25 AND AVG(r.rating) > 3.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 60 AND avg_grade > 65;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 60 AND AVG(g.grade) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS revenue FROM EVENTS ev) t\nWHERE total_tickets > 150 AND revenue > 30000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 150 AND SUM(p.payment_amount) > 30000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 100 AND avg_val > 60;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 100 AND AVG(r.value) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS total_ratings FROM authors a) t\nWHERE books > 15 AND total_ratings > 60;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS total_ratings\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 15 AND SUM(r.rating) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT SUM(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS total_grades FROM courses c) t\nWHERE enrolled > 30 AND total_grades > 900;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, SUM(g.grade) AS total_grades\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 30 AND SUM(g.grade) > 900 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 18 AND total_weight > 120;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 18 AND SUM(p.weight) > 120 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts, (SELECT COUNT(f.friend_id) FROM friends f WHERE f.user_id = u.user_id) AS friends FROM users u) t\nWHERE posts > 20 AND friends > 10;", "output": "SELECT u.user_id, COUNT(p.post_id) AS posts, COUNT(f.friend_id) AS friends\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nLEFT JOIN friends f ON f.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(p.post_id) > 20 AND COUNT(f.friend_id) > 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.order_id = o.order_id) AS payments FROM orders o) t\nWHERE total_value > 1200 AND payments > 2;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, SUM(p.payment_amount) AS payments\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN payments p ON p.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 1200 AND SUM(p.payment_amount) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT AVG(b.bonus) FROM bonuses b WHERE b.employee_id = e.employee_id) AS avg_bonus FROM employees e) t\nWHERE projects > 6 AND avg_bonus > 500;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, AVG(b.bonus) AS avg_bonus\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN bonuses b ON b.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 6 AND AVG(b.bonus) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE courses > 5 AND avg_grade > 70;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 5 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.hotel_id = h.hotel_id) AS revenue FROM hotels h) t\nWHERE bookings > 180 AND revenue > 15000;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, SUM(p.payment_amount) AS revenue\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN payments p ON p.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 180 AND SUM(p.payment_amount) > 15000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 50 AND earnings > 4000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 50 AND SUM(p.amount) > 4000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS total_score FROM games g) t\nWHERE plays > 15 AND total_score > 200;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 15 AND SUM(sc.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 60 AND avg_rating > 3.5;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 60 AND AVG(rv.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 400 AND payroll > 7000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 400 AND SUM(s.salary) > 7000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 90 AND revenue > 3000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 90 AND SUM(s.amount) > 3000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 30 AND avg_score > 25;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 30 AND AVG(sc.score) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT SUM(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS rating_sum FROM books b) t\nWHERE borrows > 18 AND rating_sum > 50;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, SUM(r.rating) AS rating_sum\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 18 AND SUM(r.rating) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT SUM(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS total_grades FROM classes cl) t\nWHERE total_students > 40 AND total_grades > 1800;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, SUM(g.grade) AS total_grades\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 40 AND SUM(g.grade) > 1800 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT AVG(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS avg_payment FROM EVENTS ev) t\nWHERE total_tickets > 100 AND avg_payment > 120;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, AVG(p.payment_amount) AS avg_payment\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 100 AND AVG(p.payment_amount) > 120 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT MIN(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS min_val FROM sensors sn) t\nWHERE max_val > 90 AND min_val < 10;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, MIN(r.value) AS min_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 90 AND MIN(r.value) < 10 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT AVG(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS avg_rating FROM authors a) t\nWHERE books > 12 AND avg_rating > 3;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, AVG(r.rating) AS avg_rating\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 12 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT SUM(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS total_grades FROM courses c) t\nWHERE enrolled > 25 AND total_grades > 1000;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, SUM(g.grade) AS total_grades\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 25 AND SUM(g.grade) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 20 AND total_weight > 200;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 20 AND SUM(p.weight) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id) AS logins, (SELECT COUNT(p.purchase_id) FROM purchases p WHERE p.user_id = u.user_id) AS purchases FROM users u) t\nWHERE logins > 30 AND purchases > 5;", "output": "SELECT u.user_id, COUNT(l.login_id) AS logins, COUNT(p.purchase_id) AS purchases\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nLEFT JOIN purchases p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.login_id) > 30 AND COUNT(p.purchase_id) > 5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS RETURNS FROM orders o) t\nWHERE total_value > 2000 AND RETURNS < 1;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS RETURNS\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 2000 AND COUNT(r.return_id) < 1 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.employee_id = e.employee_id) AS tasks, (SELECT SUM(w.hours) FROM worklogs w WHERE w.employee_id = e.employee_id) AS hours FROM employees e) t\nWHERE tasks > 10 AND hours > 300;", "output": "SELECT e.employee_id, COUNT(t.task_id) AS tasks, SUM(w.hours) AS hours\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.employee_id\nLEFT JOIN worklogs w ON w.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(t.task_id) > 10 AND SUM(w.hours) > 300 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exams > 4 AND avg_grade > 65;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 4 AND AVG(g.grade) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.hotel_id = h.hotel_id) AS revenue FROM hotels h) t\nWHERE bookings > 220 AND revenue > 20000;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, SUM(p.payment_amount) AS revenue\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN payments p ON p.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 220 AND SUM(p.payment_amount) > 20000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r.rating) FROM rides r WHERE r.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE rides > 70 AND avg_rating > 4.2;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 70 AND AVG(r.rating) > 4.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS total_score FROM games g) t\nWHERE plays > 40 AND total_score > 500;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 40 AND SUM(sc.score) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT SUM(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS total_rating FROM cities c) t\nWHERE restaurants > 90 AND total_rating > 500;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, SUM(rv.rating) AS total_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 90 AND SUM(rv.rating) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT AVG(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS avg_salary FROM companies co) t\nWHERE employees > 350 AND avg_salary > 41000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, AVG(s.salary) AS avg_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 350 AND AVG(s.salary) > 41000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 110 AND revenue > 6000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 110 AND SUM(s.amount) > 6000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 22 AND avg_score > 28;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 22 AND AVG(sc.score) > 28 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 30 AND avg_rating > 3.6;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 30 AND AVG(r.rating) > 3.6 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 70 AND avg_grade > 60;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 70 AND AVG(g.grade) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 200 AND total_revenue > 40000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 200 AND SUM(p.payment_amount) > 40000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 110 AND avg_val > 65;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 110 AND AVG(r.value) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 20 AND rating_sum > 80;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 20 AND SUM(r.rating) > 80 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 20 AND avg_grade > 68;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 20 AND AVG(g.grade) > 68 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 25 AND total_weight > 180;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 25 AND SUM(p.weight) > 180 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(c.comment_id) FROM comments c WHERE c.user_id = u.user_id) AS comments, (SELECT SUM(l.value) FROM likes l WHERE l.user_id = u.user_id) AS likes FROM users u) t\nWHERE comments > 40 AND likes > 100;", "output": "SELECT u.user_id, COUNT(c.comment_id) AS comments, SUM(l.value) AS likes\nFROM users u\nLEFT JOIN comments c ON c.user_id = u.user_id\nLEFT JOIN likes l ON l.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(c.comment_id) > 40 AND SUM(l.value) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(sh.shipment_id) FROM shipments sh WHERE sh.order_id = o.order_id) AS shipments FROM orders o) t\nWHERE total_value > 2500 AND shipments > 2;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(sh.shipment_id) AS shipments\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN shipments sh ON sh.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 2500 AND COUNT(sh.shipment_id) > 2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT SUM(b.bonus) FROM bonuses b WHERE b.employee_id = e.employee_id) AS total_bonus FROM employees e) t\nWHERE projects > 8 AND total_bonus > 1000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, SUM(b.bonus) AS total_bonus\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN bonuses b ON b.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 8 AND SUM(b.bonus) > 1000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT SUM(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS total_grades FROM students s) t\nWHERE courses > 6 AND total_grades > 450;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, SUM(g.grade) AS total_grades\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 6 AND SUM(g.grade) > 450 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 100 AND avg_rating > 4;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 100 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 60 AND earnings > 5000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 60 AND SUM(p.amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE plays > 35 AND avg_score > 45;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 35 AND AVG(sc.score) > 45 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 70 AND avg_rating > 3.8;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 70 AND AVG(rv.rating) > 3.8 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 500 AND payroll > 10000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 500 AND SUM(s.salary) > 10000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 50 AND revenue > 2000;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 50 AND SUM(s.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT SUM(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS total_score FROM players pl) t\nWHERE matches > 20 AND total_score > 300;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, SUM(sc.score) AS total_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 20 AND SUM(sc.score) > 300 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 15 AND avg_rating > 3.3;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 15 AND AVG(r.rating) > 3.3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT SUM(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS total_grades FROM classes cl) t\nWHERE total_students > 30 AND total_grades > 1200;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, SUM(g.grade) AS total_grades\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 30 AND SUM(g.grade) > 1200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT AVG(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS avg_payment FROM EVENTS ev) t\nWHERE total_tickets > 80 AND avg_payment > 100;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, AVG(p.payment_amount) AS avg_payment\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 80 AND AVG(p.payment_amount) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT MIN(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS min_val FROM sensors sn) t\nWHERE max_val > 95 AND min_val < 15;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, MIN(r.value) AS min_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 95 AND MIN(r.value) < 15 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS total_ratings FROM authors a) t\nWHERE books > 10 AND total_ratings > 40;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS total_ratings\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 10 AND SUM(r.rating) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 15 AND avg_grade > 70;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 15 AND AVG(g.grade) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 15 AND total_weight > 90;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 15 AND SUM(p.weight) > 90 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(p.post_id) FROM posts p WHERE p.user_id = u.user_id) AS posts, (SELECT SUM(c.likes) FROM comments c WHERE c.user_id = u.user_id) AS likes FROM users u) t\nWHERE posts > 10 AND likes > 50;", "output": "SELECT u.user_id, COUNT(p.post_id) AS posts, SUM(c.likes) AS likes\nFROM users u\nLEFT JOIN posts p ON p.user_id = u.user_id\nLEFT JOIN comments c ON c.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(p.post_id) > 10 AND SUM(c.likes) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT COUNT(oi.item_id) FROM order_items oi WHERE oi.order_id = o.order_id) AS items, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.order_id = o.order_id) AS payments FROM orders o) t\nWHERE items > 3 AND payments > 200;", "output": "SELECT o.order_id, COUNT(oi.item_id) AS items, SUM(p.payment_amount) AS payments\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN payments p ON p.order_id = o.order_id\nGROUP BY o.order_id\nHAVING COUNT(oi.item_id) > 3 AND SUM(p.payment_amount) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(t.task_id) FROM tasks t WHERE t.employee_id = e.employee_id) AS tasks, (SELECT SUM(w.hours) FROM worklogs w WHERE w.employee_id = e.employee_id) AS hours FROM employees e) t\nWHERE tasks > 5 AND hours > 160;", "output": "SELECT e.employee_id, COUNT(t.task_id) AS tasks, SUM(w.hours) AS hours\nFROM employees e\nLEFT JOIN tasks t ON t.employee_id = e.employee_id\nLEFT JOIN worklogs w ON w.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(t.task_id) > 5 AND SUM(w.hours) > 160 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(ex.exam_id) FROM exams ex WHERE ex.student_id = s.student_id) AS exams, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE exams > 3 AND avg_grade > 60;", "output": "SELECT s.student_id, COUNT(ex.exam_id) AS exams, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN exams ex ON ex.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(ex.exam_id) > 3 AND AVG(g.grade) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.hotel_id = h.hotel_id) AS revenue FROM hotels h) t\nWHERE bookings > 80 AND revenue > 7000;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, SUM(p.payment_amount) AS revenue\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN payments p ON p.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 80 AND SUM(p.payment_amount) > 7000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 40 AND earnings > 2500;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 40 AND SUM(p.amount) > 2500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT AVG(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS avg_score FROM games g) t\nWHERE plays > 10 AND avg_score > 30;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, AVG(sc.score) AS avg_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 10 AND AVG(sc.score) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT SUM(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS total_rating FROM cities c) t\nWHERE restaurants > 30 AND total_rating > 200;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, SUM(rv.rating) AS total_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 30 AND SUM(rv.rating) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT AVG(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS avg_salary FROM companies co) t\nWHERE employees > 100 AND avg_salary > 40000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, AVG(s.salary) AS avg_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 100 AND AVG(s.salary) > 40000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 40 AND revenue > 1500;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 40 AND SUM(s.amount) > 1500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 15 AND avg_score > 20;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 15 AND AVG(sc.score) > 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 20 AND avg_rating > 3.5;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 20 AND AVG(r.rating) > 3.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 25 AND avg_grade > 55;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 25 AND AVG(g.grade) > 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 50 AND total_revenue > 10000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 50 AND SUM(p.payment_amount) > 10000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT MIN(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS min_val FROM sensors sn) t\nWHERE max_val > 80 AND min_val < 20;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, MIN(r.value) AS min_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 80 AND MIN(r.value) < 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT AVG(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS avg_rating FROM authors a) t\nWHERE books > 5 AND avg_rating > 2.5;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, AVG(r.rating) AS avg_rating\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 5 AND AVG(r.rating) > 2.5 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT SUM(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS total_grades FROM courses c) t\nWHERE enrolled > 12 AND total_grades > 400;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, SUM(g.grade) AS total_grades\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 12 AND SUM(g.grade) > 400 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 10 AND total_weight > 50;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 10 AND SUM(p.weight) > 50 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(l.login_id) FROM logins l WHERE l.user_id = u.user_id) AS logins, (SELECT SUM(p.purchase_amount) FROM purchases p WHERE p.user_id = u.user_id) AS spent FROM users u) t\nWHERE logins > 20 AND spent > 500;", "output": "SELECT u.user_id, COUNT(l.login_id) AS logins, SUM(p.purchase_amount) AS spent\nFROM users u\nLEFT JOIN logins l ON l.user_id = u.user_id\nLEFT JOIN purchases p ON p.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(l.login_id) > 20 AND SUM(p.purchase_amount) > 500 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT COUNT(oi.item_id) FROM order_items oi WHERE oi.order_id = o.order_id) AS items, (SELECT SUM(sh.shipping_cost) FROM shippings sh WHERE sh.order_id = o.order_id) AS shipping FROM orders o) t\nWHERE items > 5 AND shipping < 100;", "output": "SELECT o.order_id, COUNT(oi.item_id) AS items, SUM(sh.shipping_cost) AS shipping\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN shippings sh ON sh.order_id = o.order_id\nGROUP BY o.order_id\nHAVING COUNT(oi.item_id) > 5 AND SUM(sh.shipping_cost) < 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(p.project_id) FROM projects p WHERE p.employee_id = e.employee_id) AS projects, (SELECT AVG(s.salary) FROM salaries s WHERE s.employee_id = e.employee_id) AS avg_salary FROM employees e) t\nWHERE projects > 3 AND avg_salary > 45000;", "output": "SELECT e.employee_id, COUNT(p.project_id) AS projects, AVG(s.salary) AS avg_salary\nFROM employees e\nLEFT JOIN projects p ON p.employee_id = e.employee_id\nLEFT JOIN salaries s ON s.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(p.project_id) > 3 AND AVG(s.salary) > 45000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT AVG(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS avg_grade FROM students s) t\nWHERE courses > 2 AND avg_grade > 65;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, AVG(g.grade) AS avg_grade\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 2 AND AVG(g.grade) > 65 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT SUM(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS rating_sum FROM hotels h) t\nWHERE bookings > 60 AND rating_sum > 200;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, SUM(r.rating) AS rating_sum\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 60 AND SUM(r.rating) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT AVG(r.rating) FROM rides r WHERE r.driver_id = d.driver_id) AS avg_rating FROM drivers d) t\nWHERE rides > 30 AND avg_rating > 4;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, AVG(r.rating) AS avg_rating\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 30 AND AVG(r.rating) > 4 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS score_sum FROM games g) t\nWHERE plays > 8 AND score_sum > 100;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS score_sum\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 8 AND SUM(sc.score) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT AVG(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS avg_rating FROM cities c) t\nWHERE restaurants > 25 AND avg_rating > 3.2;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, AVG(rv.rating) AS avg_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 25 AND AVG(rv.rating) > 3.2 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT SUM(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS payroll FROM companies co) t\nWHERE employees > 200 AND payroll > 5000000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, SUM(s.salary) AS payroll\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 200 AND SUM(s.salary) > 5000000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT AVG(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS avg_sale FROM stores st) t\nWHERE sales > 30 AND avg_sale > 40;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, AVG(s.amount) AS avg_sale\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 30 AND AVG(s.amount) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT SUM(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS total_score FROM players pl) t\nWHERE matches > 18 AND total_score > 200;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, SUM(sc.score) AS total_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 18 AND SUM(sc.score) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT SUM(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS total_ratings FROM books b) t\nWHERE borrows > 12 AND total_ratings > 30;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, SUM(r.rating) AS total_ratings\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 12 AND SUM(r.rating) > 30 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT AVG(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS avg_grade FROM classes cl) t\nWHERE total_students > 20 AND avg_grade > 55;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, AVG(g.grade) AS avg_grade\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 20 AND AVG(g.grade) > 55 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT AVG(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS avg_payment FROM EVENTS ev) t\nWHERE total_tickets > 60 AND avg_payment > 80;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, AVG(p.payment_amount) AS avg_payment\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 60 AND AVG(p.payment_amount) > 80 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT AVG(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS avg_val FROM sensors sn) t\nWHERE max_val > 70 AND avg_val > 40;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, AVG(r.value) AS avg_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 70 AND AVG(r.value) > 40 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT AVG(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS avg_rating FROM authors a) t\nWHERE books > 8 AND avg_rating > 3;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, AVG(r.rating) AS avg_rating\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 8 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT SUM(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS total_grades FROM courses c) t\nWHERE enrolled > 10 AND total_grades > 300;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, SUM(g.grade) AS total_grades\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 10 AND SUM(g.grade) > 300 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 12 AND total_weight > 70;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 12 AND SUM(p.weight) > 70 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT u.user_id, (SELECT COUNT(f.friend_id) FROM friends f WHERE f.user_id = u.user_id) AS friends, (SELECT COUNT(m.message_id) FROM messages m WHERE m.user_id = u.user_id) AS messages FROM users u) t\nWHERE friends > 50 AND messages > 200;", "output": "SELECT u.user_id, COUNT(f.friend_id) AS friends, COUNT(m.message_id) AS messages\nFROM users u\nLEFT JOIN friends f ON f.user_id = u.user_id\nLEFT JOIN messages m ON m.user_id = u.user_id\nGROUP BY u.user_id\nHAVING COUNT(f.friend_id) > 50 AND COUNT(m.message_id) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT o.order_id, (SELECT SUM(oi.price * oi.qty) FROM order_items oi WHERE oi.order_id = o.order_id) AS total_value, (SELECT COUNT(r.return_id) FROM RETURNS r WHERE r.order_id = o.order_id) AS RETURNS FROM orders o) t\nWHERE total_value > 500 AND RETURNS = 0;", "output": "SELECT o.order_id, SUM(oi.price * oi.qty) AS total_value, COUNT(r.return_id) AS RETURNS\nFROM orders o\nLEFT JOIN order_items oi ON oi.order_id = o.order_id\nLEFT JOIN RETURNS r ON r.order_id = o.order_id\nGROUP BY o.order_id\nHAVING SUM(oi.price * oi.qty) > 500 AND COUNT(r.return_id) = 0 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT e.employee_id, (SELECT COUNT(a.attendance_id) FROM attendance a WHERE a.employee_id = e.employee_id) AS days_present, (SELECT SUM(w.hours) FROM worklogs w WHERE w.employee_id = e.employee_id) AS total_hours FROM employees e) t\nWHERE days_present > 20 AND total_hours > 160;", "output": "SELECT e.employee_id, COUNT(a.attendance_id) AS days_present, SUM(w.hours) AS total_hours\nFROM employees e\nLEFT JOIN attendance a ON a.employee_id = e.employee_id\nLEFT JOIN worklogs w ON w.employee_id = e.employee_id\nGROUP BY e.employee_id\nHAVING COUNT(a.attendance_id) > 20 AND SUM(w.hours) > 160 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT s.student_id, (SELECT COUNT(c.course_id) FROM courses c WHERE c.student_id = s.student_id) AS courses, (SELECT SUM(g.grade) FROM grades g WHERE g.student_id = s.student_id) AS total_grades FROM students s) t\nWHERE courses > 3 AND total_grades > 200;", "output": "SELECT s.student_id, COUNT(c.course_id) AS courses, SUM(g.grade) AS total_grades\nFROM students s\nLEFT JOIN courses c ON c.student_id = s.student_id\nLEFT JOIN grades g ON g.student_id = s.student_id\nGROUP BY s.student_id\nHAVING COUNT(c.course_id) > 3 AND SUM(g.grade) > 200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS bookings, (SELECT AVG(r.rating) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_rating FROM hotels h) t\nWHERE bookings > 40 AND avg_rating > 3.7;", "output": "SELECT h.hotel_id, COUNT(b.booking_id) AS bookings, AVG(r.rating) AS avg_rating\nFROM hotels h\nLEFT JOIN bookings b ON b.hotel_id = h.hotel_id\nLEFT JOIN reviews r ON r.hotel_id = h.hotel_id\nGROUP BY h.hotel_id\nHAVING COUNT(b.booking_id) > 40 AND AVG(r.rating) > 3.7 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT d.driver_id, (SELECT COUNT(r.ride_id) FROM rides r WHERE r.driver_id = d.driver_id) AS rides, (SELECT SUM(p.amount) FROM payments p WHERE p.driver_id = d.driver_id) AS earnings FROM drivers d) t\nWHERE rides > 15 AND earnings > 2000;", "output": "SELECT d.driver_id, COUNT(r.ride_id) AS rides, SUM(p.amount) AS earnings\nFROM drivers d\nLEFT JOIN rides r ON r.driver_id = d.driver_id\nLEFT JOIN payments p ON p.driver_id = d.driver_id\nGROUP BY d.driver_id\nHAVING COUNT(r.ride_id) > 15 AND SUM(p.amount) > 2000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT g.game_id, (SELECT COUNT(p.play_id) FROM plays p WHERE p.game_id = g.game_id) AS plays, (SELECT SUM(sc.score) FROM scores sc WHERE sc.game_id = g.game_id) AS total_score FROM games g) t\nWHERE plays > 12 AND total_score > 180;", "output": "SELECT g.game_id, COUNT(p.play_id) AS plays, SUM(sc.score) AS total_score\nFROM games g\nLEFT JOIN plays p ON p.game_id = g.game_id\nLEFT JOIN scores sc ON sc.game_id = g.game_id\nGROUP BY g.game_id\nHAVING COUNT(p.play_id) > 12 AND SUM(sc.score) > 180 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.city_id, (SELECT COUNT(r.restaurant_id) FROM restaurants r WHERE r.city_id = c.city_id) AS restaurants, (SELECT SUM(rv.rating) FROM reviews rv WHERE rv.city_id = c.city_id) AS total_rating FROM cities c) t\nWHERE restaurants > 20 AND total_rating > 100;", "output": "SELECT c.city_id, COUNT(r.restaurant_id) AS restaurants, SUM(rv.rating) AS total_rating\nFROM cities c\nLEFT JOIN restaurants r ON r.city_id = c.city_id\nLEFT JOIN reviews rv ON rv.city_id = c.city_id\nGROUP BY c.city_id\nHAVING COUNT(r.restaurant_id) > 20 AND SUM(rv.rating) > 100 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT co.company_id, (SELECT COUNT(e.employee_id) FROM employees e WHERE e.company_id = co.company_id) AS employees, (SELECT AVG(s.salary) FROM salaries s WHERE s.company_id = co.company_id) AS avg_salary FROM companies co) t\nWHERE employees > 150 AND avg_salary > 38000;", "output": "SELECT co.company_id, COUNT(e.employee_id) AS employees, AVG(s.salary) AS avg_salary\nFROM companies co\nLEFT JOIN employees e ON e.company_id = co.company_id\nLEFT JOIN salaries s ON s.company_id = co.company_id\nGROUP BY co.company_id\nHAVING COUNT(e.employee_id) > 150 AND AVG(s.salary) > 38000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT st.store_id, (SELECT COUNT(s.sale_id) FROM sales s WHERE s.store_id = st.store_id) AS sales, (SELECT SUM(s2.amount) FROM sales s2 WHERE s2.store_id = st.store_id) AS revenue FROM stores st) t\nWHERE sales > 20 AND revenue > 1200;", "output": "SELECT st.store_id, COUNT(s.sale_id) AS sales, SUM(s.amount) AS revenue\nFROM stores st\nLEFT JOIN sales s ON s.store_id = st.store_id\nGROUP BY st.store_id\nHAVING COUNT(s.sale_id) > 20 AND SUM(s.amount) > 1200 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT pl.player_id, (SELECT COUNT(m.match_id) FROM matches m WHERE m.player_id = pl.player_id) AS matches, (SELECT AVG(sc.score) FROM scores sc WHERE sc.player_id = pl.player_id) AS avg_score FROM players pl) t\nWHERE matches > 25 AND avg_score > 22;", "output": "SELECT pl.player_id, COUNT(m.match_id) AS matches, AVG(sc.score) AS avg_score\nFROM players pl\nLEFT JOIN matches m ON m.player_id = pl.player_id\nLEFT JOIN scores sc ON sc.player_id = pl.player_id\nGROUP BY pl.player_id\nHAVING COUNT(m.match_id) > 25 AND AVG(sc.score) > 22 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT b.book_id, (SELECT COUNT(br.borrow_id) FROM borrows br WHERE br.book_id = b.book_id) AS borrows, (SELECT AVG(r.rating) FROM ratings r WHERE r.book_id = b.book_id) AS avg_rating FROM books b) t\nWHERE borrows > 10 AND avg_rating > 3;", "output": "SELECT b.book_id, COUNT(br.borrow_id) AS borrows, AVG(r.rating) AS avg_rating\nFROM books b\nLEFT JOIN borrows br ON br.book_id = b.book_id\nLEFT JOIN ratings r ON r.book_id = b.book_id\nGROUP BY b.book_id\nHAVING COUNT(br.borrow_id) > 10 AND AVG(r.rating) > 3 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT cl.class_id, (SELECT COUNT(st.student_id) FROM students st WHERE st.class_id = cl.class_id) AS total_students, (SELECT SUM(g.grade) FROM grades g WHERE g.class_id = cl.class_id) AS total_grades FROM classes cl) t\nWHERE total_students > 35 AND total_grades > 800;", "output": "SELECT cl.class_id, COUNT(st.student_id) AS total_students, SUM(g.grade) AS total_grades\nFROM classes cl\nLEFT JOIN students st ON st.class_id = cl.class_id\nLEFT JOIN grades g ON g.class_id = cl.class_id\nGROUP BY cl.class_id\nHAVING COUNT(st.student_id) > 35 AND SUM(g.grade) > 800 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT ev.event_id, (SELECT COUNT(t.ticket_id) FROM tickets t WHERE t.event_id = ev.event_id) AS total_tickets, (SELECT SUM(p.payment_amount) FROM payments p WHERE p.event_id = ev.event_id) AS total_revenue FROM EVENTS ev) t\nWHERE total_tickets > 30 AND total_revenue > 5000;", "output": "SELECT ev.event_id, COUNT(t.ticket_id) AS total_tickets, SUM(p.payment_amount) AS total_revenue\nFROM EVENTS ev\nLEFT JOIN tickets t ON t.event_id = ev.event_id\nLEFT JOIN payments p ON p.event_id = ev.event_id\nGROUP BY ev.event_id\nHAVING COUNT(t.ticket_id) > 30 AND SUM(p.payment_amount) > 5000 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.account_id, (SELECT SUM(t.amount) FROM transactions t WHERE t.account_id = a.account_id AND t.type = 'credit') AS credits, (SELECT SUM(t2.amount) FROM transactions t2 WHERE t2.account_id = a.account_id AND t2.type = 'debit') AS debits FROM accounts a) t\nWHERE credits > debits;", "output": "SELECT a.account_id, SUM(CASE WHEN t.type = 'credit' THEN t.amount END) AS credits, SUM(CASE WHEN t.type = 'debit' THEN t.amount END) AS debits\nFROM accounts a\nLEFT JOIN transactions t ON t.account_id = a.account_id\nGROUP BY a.account_id\nHAVING SUM(CASE WHEN t.type = 'credit' THEN t.amount END) > SUM(CASE WHEN t.type = 'debit' THEN t.amount END) ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sn.sensor_id, (SELECT MAX(r.value) FROM readings r WHERE r.sensor_id = sn.sensor_id) AS max_val, (SELECT MIN(r2.value) FROM readings r2 WHERE r2.sensor_id = sn.sensor_id) AS min_val FROM sensors sn) t\nWHERE max_val > 60 AND min_val < 20;", "output": "SELECT sn.sensor_id, MAX(r.value) AS max_val, MIN(r.value) AS min_val\nFROM sensors sn\nLEFT JOIN readings r ON r.sensor_id = sn.sensor_id\nGROUP BY sn.sensor_id\nHAVING MAX(r.value) > 60 AND MIN(r.value) < 20 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT a.author_id, (SELECT COUNT(b.book_id) FROM books b WHERE b.author_id = a.author_id) AS books, (SELECT SUM(r.rating) FROM ratings r WHERE r.author_id = a.author_id) AS rating_sum FROM authors a) t\nWHERE books > 6 AND rating_sum > 25;", "output": "SELECT a.author_id, COUNT(b.book_id) AS books, SUM(r.rating) AS rating_sum\nFROM authors a\nLEFT JOIN books b ON b.author_id = a.author_id\nLEFT JOIN ratings r ON r.author_id = a.author_id\nGROUP BY a.author_id\nHAVING COUNT(b.book_id) > 6 AND SUM(r.rating) > 25 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT c.course_id, (SELECT COUNT(e.student_id) FROM enrollments e WHERE e.course_id = c.course_id) AS enrolled, (SELECT AVG(g.grade) FROM grades g WHERE g.course_id = c.course_id) AS avg_grade FROM courses c) t\nWHERE enrolled > 15 AND avg_grade > 60;", "output": "SELECT c.course_id, COUNT(e.student_id) AS enrolled, AVG(g.grade) AS avg_grade\nFROM courses c\nLEFT JOIN enrollments e ON e.course_id = c.course_id\nLEFT JOIN grades g ON g.course_id = c.course_id\nGROUP BY c.course_id\nHAVING COUNT(e.student_id) > 15 AND AVG(g.grade) > 60 ;"}
{"instruction": "Optimize the SQL query", "input": "SELECT *\nFROM (SELECT sh.shipment_id, (SELECT COUNT(p.package_id) FROM packages p WHERE p.shipment_id = sh.shipment_id) AS packages, (SELECT SUM(p2.weight) FROM packages p2 WHERE p2.shipment_id = sh.shipment_id) AS total_weight FROM shipments sh) t\nWHERE packages > 8 AND total_weight > 40;", "output": "SELECT sh.shipment_id, COUNT(p.package_id) AS packages, SUM(p.weight) AS total_weight\nFROM shipments sh\nLEFT JOIN packages p ON p.shipment_id = sh.shipment_id\nGROUP BY sh.shipment_id\nHAVING COUNT(p.package_id) > 8 AND SUM(p.weight) > 40 ;"}
