# API Creating

# SQL Query Optimization API

REST API —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–æ–æ–±—É—á–µ–Ω–Ω–æ–π —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏. –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–∞–ª–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –º–æ—â–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

##  –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤** —á–µ—Ä–µ–∑ REST API
- **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ
- **RAG-—Å–∏—Å—Ç–µ–º–∞** —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é** GPU

##  –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **FastAPI** - –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π REST API —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Uvicorn** - ASGI-—Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- **PyTorch + CUDA** - —Ä–∞–±–æ—Ç–∞ —Å GPU –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –º–æ–¥–µ–ª–µ–π
- **Transformers** - –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
- **FAISS** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- **SentenceTransformers** - —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è RAG-—Å–∏—Å—Ç–µ–º—ã

##  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- CUDA-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è GPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- 6GB+ RAM

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ
```bash
uvicorn main:app
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

## API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```http
POST /new
Content-Type: application/json

{
  "ddl": ["CREATE TABLE users (id INT, name VARCHAR);"],
  "queries": [
    {
      "queryid": "q1",
      "query": "SELECT * FROM users WHERE id IN (SELECT id FROM orders)"
    }
  ]
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
```http
GET /status?task_id={task_id}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```http
GET /getresult?task_id={task_id}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
```http
GET /health
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
MAX_CONCURRENT_BG_TASKS=3  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏
–°–µ—Ä–≤–∏—Å –æ–∂–∏–¥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤:
- `sqlcoder_finetuned_2/` - –¥–æ–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å SQLCoder
- `RAG2/faiss_index.idx` - FAISS –∏–Ω–¥–µ–∫—Å –¥–ª—è RAG
- `RAG2/texts_metas.pkl` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è RAG-—Å–∏—Å—Ç–µ–º—ã

##  –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞
2. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** –≤ RAG-—Å–∏—Å—Ç–µ–º–µ –¥–ª—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SQL** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º few-shot –ø—Ä–∏–º–µ—Ä–æ–≤
4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å —Ç–∞–π–º–∞—É—Ç–æ–º 20 –º–∏–Ω—É—Ç –Ω–∞ –∑–∞–¥–∞—á—É
5. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é** GPU –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

##  –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–°–µ–º–∞—Ñ–æ—Ä—ã** –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **–¢–∞–π–º–∞—É—Ç—ã** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏–π
- **–û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏ GPU** –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

##  –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ 4-bit –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

##  –†–∞–∑–≤–∏—Ç–∏–µ

- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–∏–∞–ª–µ–∫—Ç–æ–≤ SQL
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –£–ª—É—á—à–µ–Ω–∏–µ RAG-—Å–∏—Å—Ç–µ–º—ã —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –∑–Ω–∞–Ω–∏–π

---
# –î–ª—è –∑–∞–ø—É—Å–∫–∞ API –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞–ø—É—Å–∫—É

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `RAG2`
–°–∫–∞—á–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `RAG2` —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:
- `faiss_index.idx`
- `texts_metas.pkl`

–ê —Ç–∞–∫–∂–µ –ø–∞–ø–∫—É `data`, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 2 –ø–∞–ø–∫–∏:

#### üìä CSV —Ñ–∞–π–ª—ã:
- `SQLInjection_XSS_CommandInjection_MixDataset.1.0.0.csv`
- `Modified_SQL_Dataset.csv`
- `Train.csv`

#### üìÑ PDF —Ñ–∞–π–ª—ã:
- `16_4.pdf`
- `3000-Article Text-13981-1-10-20220927.pdf`
- `118681.pdf`
- `142385_20210429.pdf`
- `142385_20210429-2.pdf`
- `beatap`
- `+jcsi19(2021)151-158.pdf`
- `chaudhuri98.pdf`
- `NormalizationDenormalizationWhitePaper.pdf`
- `p1058-leis.pdf`
- `Paper_19.pdf`
- `rzajq.pdf`
- `SQL_Server_Execution_Plans.pdf`
- `technical-brief-explain-the-explain-plan-052011.pdf`

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `sqlcoder_finetuned_2`
–°–∫–∞—á–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `sqlcoder_finetuned_2` —Ñ–∞–π–ª—ã:
- `adapter_config.json`
- `adapter_model.safetensors`
- `README.md`
- `special_tokens_map.json`
- `tokenizer.json`
- `tokenizer.model`
- `tokenizer_config.json`

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `static`
–°–∫–∞—á–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `static` —Ñ–∞–π–ª:
- `static.css`

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `templates`
–°–∫–∞—á–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `templates` —Ñ–∞–π–ª—ã:
- `results.html`
- `results1.html`
- `results2.html`

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ 4 –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –æ–¥–Ω—É –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å —Ñ–∞–π–ª–∞–º–∏


## 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ó–∞–ø—É—Å—Ç–∏—Ç—å `main.py` –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

```bash
python main.py
