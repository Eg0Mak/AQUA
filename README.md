<img width="1432" height="744" alt="image" src="https://github.com/user-attachments/assets/4bc01477-54ad-48a7-8223-e5b694ce7fe9" />

# AQUA - Artificial Query Analyzer

### Описание задачи
Необходимо разработать интеллектуальный сервис с применением языковых моделей (LLM),
который будет анализировать SQL-запросы, логическую и физическую структуру хранилища
данных на базе S3, Apache Iceberg, Trino и Spark.

Цель - выдавать рекомендации по изменению запросов и моделей хранения для повышения
производительности и более рационального использования ресурсов.
### Актуальность
Современные Data Lakehouse - системы обеспечивают гибкость и масштабируемость для
хранения и аналитики данных, но быстрое развитие технологий делает задачу их
оптимизации крайне важной. Автоматизированные рекомендации по улучшению
производительности позволяют компаниям снижать издержки и ускорять аналитику.

### Ресурсы
Текущая схема данных (DDL), список запросов и количество выполнений каждого запроса,
строка подключения к демонстрационному датасету в Trino (для оценки состава данных).
Вычислительные мощности для отработки запросов для финалистов.

### Состав
* **Егор Шипилов** – ML-engineer
* **Никита Кирнасов** – Fullstack-разработчик
* **Владислав Апухтин** – Data Scientist
* **Фёдор Дубовицкий** – Data Storyteller
* **Ярослав Кудрявцев** – Капитан, Data Analyst

### Схема архитектуры VK Data Lakehouse

<img src="/img/architecture_lakehouse.jpeg" alt="Схема архитектуры VK Data Lakehouse" width="800" height="800">

### Описания решения

#### Основной технологический стек

**Backend & AI-компоненты:**

FastAPI + Uvicorn - высокопроизводительный REST API и ASGI-сервер для развертывания
["ССЫЛКА НА РИДМИ АПИ"](https://github.com/Eg0Mak/AQUA/blob/main/API/README.md)

SQLCoder 2 + SFT/LoRA - базовая LLM с эффективным дообучением через адаптеры
RAG-система + Optuna - база знаний по оптимизации запросов с автоматической настройкой гиперпараметров
["ССЫЛКА НА РИДМИ МЛ"](https://github.com/Eg0Mak/AQUA/blob/main/Machine%20Learning/README.md)

**Бенчмарк-система**:

Кастомный модуль оценки - проверка валидности, безопасности и оптимизации SQL-запросов
Многокритериальная оценка
Интегральные метрики - взвешенная оценка качества запросов
(https://github.com/Eg0Mak/AQUA/blob/main/Benchmark/README.md)

**Рабочий процесс:**

Запрос через REST API → пользователь отправляет SQL-запрос

Бенчмарк SQL-запроса до обработки

Обработка моделью → система анализирует и оптимизирует запрос с использованием контекста из RAG

Возврат результата → клиент получает оптимизированную версию запроса

Бенчмарк SQL-запроса после обработки
